{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":1,"renderable":1},{"_id":"themes/next/source/images/Challestend.png","path":"images/Challestend.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon-next.png","path":"images/apple-touch-icon-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/algolia_logo.svg","path":"images/algolia_logo.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","path":"images/cc-by-nc-sa.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","path":"images/cc-by-nc-nd.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-sa.svg","path":"images/cc-by-sa.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nc.svg","path":"images/cc-by-nc.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16-next.png","path":"images/favicon-16x16-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by-nd.svg","path":"images/cc-by-nd.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/loading.gif","path":"images/loading.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-by.svg","path":"images/cc-by.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/placeholder.gif","path":"images/placeholder.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32-next.png","path":"images/favicon-32x32-next.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/cc-zero.svg","path":"images/cc-zero.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/quote-l.svg","path":"images/quote-l.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/searchicon.png","path":"images/searchicon.png","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/bootstrap.js","path":"js/src/bootstrap.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/affix.js","path":"js/src/affix.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/motion.js","path":"js/src/motion.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/post-details.js","path":"js/src/post-details.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/algolia-search.js","path":"js/src/algolia-search.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/scrollspy.js","path":"js/src/scrollspy.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/utils.js","path":"js/src/utils.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/exturl.js","path":"js/src/exturl.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/bookmark/bookmark.min.js","path":"lib/bookmark/bookmark.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/js.cookie.js","path":"js/src/js.cookie.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/scroll-cookie.js","path":"js/src/scroll-cookie.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/bookmark/LICENSE","path":"lib/bookmark/LICENSE","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/LICENSE","path":"lib/fancybox/LICENSE","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/README.md","path":"lib/fancybox/README.md","modified":1,"renderable":1},{"_id":"themes/next/source/lib/bookmark/README.md","path":"lib/bookmark/README.md","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/bower.json","path":"lib/font-awesome/bower.json","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","path":"lib/font-awesome/HELP-US-OUT.txt","modified":1,"renderable":1},{"_id":"themes/next/source/lib/bookmark/index.js","path":"lib/bookmark/index.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/bookmark/package.json","path":"lib/bookmark/package.json","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","path":"lib/pace/pace-theme-barber-shop.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/README.md","path":"lib/pace/README.md","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","path":"lib/pace/pace-theme-big-counter.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","path":"lib/pace/pace-theme-bounce.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","path":"lib/pace/pace-theme-center-simple.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","path":"lib/pace/pace-theme-fill-left.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","path":"lib/pace/pace-theme-center-atom.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","path":"lib/pace/pace-theme-center-circle.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","path":"lib/pace/pace-theme-center-radar.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace.min.js","path":"lib/pace/pace.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.min.js","path":"lib/velocity/velocity.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","path":"lib/pace/pace-theme-flash.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","path":"lib/velocity/velocity.ui.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","path":"lib/pace/pace-theme-loading-bar.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","path":"lib/pace/pace-theme-corner-indicator.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","path":"lib/pace/pace-theme-minimal.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/reading_progress/reading_progress.js","path":"lib/reading_progress/reading_progress.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","path":"lib/velocity/velocity.ui.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","path":"lib/pace/pace-theme-mac-osx.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/reading_progress/reading_progress.min.js","path":"lib/reading_progress/reading_progress.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/pace/LICENSE","path":"lib/pace/LICENSE","modified":1,"renderable":1},{"_id":"themes/next/source/lib/jquery/index.js","path":"lib/jquery/index.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/reading_progress/LICENSE","path":"lib/reading_progress/LICENSE","modified":1,"renderable":1},{"_id":"themes/next/source/lib/reading_progress/README.md","path":"lib/reading_progress/README.md","modified":1,"renderable":1},{"_id":"themes/next/source/lib/reading_progress/package.json","path":"lib/reading_progress/package.json","modified":1,"renderable":1},{"_id":"themes/next/source/js/src/schemes/pisces.js","path":"js/src/schemes/pisces.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","path":"lib/fancybox/source/jquery.fancybox.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.min.css","path":"lib/fancybox/source/jquery.fancybox.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.min.js","path":"lib/fancybox/source/jquery.fancybox.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","path":"lib/font-awesome/css/font-awesome.min.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","path":"lib/font-awesome/css/font-awesome.css","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","path":"lib/font-awesome/css/font-awesome.css.map","modified":1,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","path":"lib/ua-parser-js/dist/ua-parser.min.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","path":"lib/ua-parser-js/dist/ua-parser.pack.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","path":"lib/font-awesome/fonts/fontawesome-webfont.woff","modified":1,"renderable":1},{"_id":"themes/next/source/lib/velocity/velocity.js","path":"lib/velocity/velocity.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","path":"lib/font-awesome/fonts/fontawesome-webfont.woff2","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","path":"lib/fancybox/source/jquery.fancybox.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","path":"lib/fancybox/source/jquery.fancybox.pack.js","modified":1,"renderable":1},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","path":"lib/font-awesome/fonts/fontawesome-webfont.eot","modified":1,"renderable":1}],"Cache":[{"_id":"source/404.html","hash":"9f90171e400d06f743a6decc988102454bed0ac7","modified":1544709358098},{"_id":"themes/next/.eslintrc.json","hash":"d3c11de434171d55d70daadd3914bc33544b74b8","modified":1538027465504},{"_id":"themes/next/.bowerrc","hash":"334da94ca6f024d60d012cc26ea655681e724ad8","modified":1538027465504},{"_id":"themes/next/.editorconfig","hash":"211d2c92bfdddb3e81ea946f4ca7a539f150f4da","modified":1538027465504},{"_id":"themes/next/.gitattributes","hash":"8454b9313cb1a97b63fb87e2d29daee497ce6249","modified":1538027465504},{"_id":"themes/next/.gitignore","hash":"0378adb9c2dc4855b3198184df4863cb30e4059c","modified":1538027465504},{"_id":"themes/next/.stylintrc","hash":"3b7f9785e9ad0dab764e1c535b40df02f4ff5fd6","modified":1538027465504},{"_id":"themes/next/LICENSE.md","hash":"f0190c7d83a98464549a6b3a51bb206148d88e1b","modified":1538027465504},{"_id":"themes/next/README.md","hash":"460ef40953c2eccea4f87bc67043aac2eb87b1a9","modified":1538027465504},{"_id":"themes/next/.travis.yml","hash":"fb9ac54e875f6ea16d5c83db497f6bd70ae83198","modified":1538027465504},{"_id":"themes/next/bower.json","hash":"960159e57be380d14aef75360412575cd8cb938f","modified":1538027465504},{"_id":"themes/next/_config.yml","hash":"c508b118af8a647260fb4150472b1d90e5c92d75","modified":1544702436166},{"_id":"themes/next/crowdin.yml","hash":"4a53f5985e545c635cb56b2a57ed290cb8cf8942","modified":1538027465504},{"_id":"themes/next/package-lock.json","hash":"de42534e63dc2984e8fc8c71bb7c16d32c934a73","modified":1542156325650},{"_id":"themes/next/gulpfile.coffee","hash":"67eaf2515100971f6195b60eeebbfe5e8de895ab","modified":1538027465521},{"_id":"themes/next/package.json","hash":"d74dc584653e0bfab272de5d284d4be8a30c8e48","modified":1542156325619},{"_id":"source/_posts/2018-09-27-hello-world.md","hash":"77bcd1b920dfae75dee60651a19d8a4439c84ecf","modified":1544580167401},{"_id":"source/_posts/2018-09-27-luogu-t47720-solution.md","hash":"6fa0569b9dfc0c2f807c945d81bfed6e6e46b0f3","modified":1544580326495},{"_id":"source/_posts/2018-09-29-luogu-p3924-solution.md","hash":"7edb001d2f1bc2d31e70378687198e4997efea62","modified":1544580248006},{"_id":"source/_posts/2018-10-04-luogu-p4900-solution.md","hash":"453a42272a08448a011612ad107cee3e04cd3230","modified":1544580277245},{"_id":"source/_posts/2018-10-12-luogu-p2154-solution.md","hash":"2eb72891edf74b01c03041c67afc35d83efe5d9b","modified":1544580409568},{"_id":"source/_posts/2018-10-13-chtholly-tree-learning-notes.md","hash":"76284c39e91f9f3f19ba071477fcc85f2993ccf2","modified":1544580118259},{"_id":"source/_posts/2018-10-24-status-compression-learning-notes.md","hash":"deb913ee8b00257d433750f9e10e017d84308792","modified":1544580515601},{"_id":"source/_posts/2018-11-09-noip-2018-notes.md","hash":"9dbe90cf21ebae97acfc8999dfb5363362a1e7a7","modified":1544580381728},{"_id":"source/log/index.md","hash":"e9d5a0aa5c856a919c75276de5b77bd4a122c5dd","modified":1544744291222},{"_id":"source/categories/index.md","hash":"4cad6080ff7e7520395bc14c4774a819f06edbb2","modified":1544615434445},{"_id":"source/tags/index.md","hash":"f2fa43fef7340cc16817d1f4f375ccd7494db7a9","modified":1544615444607},{"_id":"source/_posts/2018-11-08-luogu-p5009-solution.md","hash":"e75bd168f978260dd123c3eb9f86f49ffe0afa04","modified":1544580304885},{"_id":"source/_posts/2018-11-14-poisonous-problems.md","hash":"764072cd44b09217ddbc1180e2fd67efcbd40f2c","modified":1544600967217},{"_id":"source/_posts/2018-11-29-number-theory-learning-notes.md","hash":"d52dc09d7f00837dd21c27650858d718b552fb55","modified":1544580461534},{"_id":"source/about/index.md","hash":"ab8205a9b0391dc468a4a0b9273926dd8ea74b92","modified":1544615425678},{"_id":"themes/next/.github/ISSUE_TEMPLATE.md","hash":"1e212fe229bd659726b4a3bcf4b5b14e0310ba3a","modified":1538027465504},{"_id":"themes/next/.github/CONTRIBUTING.md","hash":"40b0fd9fdb8586fab98e23f713940e7a2f80e2f9","modified":1538027465504},{"_id":"source/_posts/2018-12-08-future-algorithm-ep1.md","hash":"9fee8c542b1fe7f84ff97efc660cf4c91ab67706","modified":1544596894035},{"_id":"themes/next/.github/CODE_OF_CONDUCT.md","hash":"22f2ccc5522563b67c8663849fc1d6cbae93a8ff","modified":1538027465504},{"_id":"themes/next/.github/PULL_REQUEST_TEMPLATE.md","hash":"36201119490a04107c8179b10202548a9d0e5e60","modified":1538027465504},{"_id":"themes/next/.github/browserstack_logo.png","hash":"a6c43887f64a7f48a2814e3714eaa1215e542037","modified":1538027465504},{"_id":"themes/next/.github/stale.yml","hash":"dbd5e6bf89b76ad1f2b081578b239c7ae32755af","modified":1538027465504},{"_id":"themes/next/docs/AGPL3.md","hash":"f463f95b169d64983f59fa6f3e4b6760290a0e6b","modified":1538027465504},{"_id":"themes/next/docs/ALGOLIA-SEARCH.md","hash":"1dada3c3404445a00367882b8f97cdf092b7943d","modified":1538027465519},{"_id":"themes/next/docs/AUTHORS.md","hash":"51a0a13da55ff3d596970b2f9ab4531c6b2211f2","modified":1538027465519},{"_id":"themes/next/docs/DATA-FILES.md","hash":"9a1895c0a0db705c4c48f512e86917f9af1ec3fb","modified":1538027465519},{"_id":"themes/next/docs/INSTALLATION.md","hash":"b74ef6fedf76cdb156e2265759ee0a789ddd49cc","modified":1538027465519},{"_id":"themes/next/docs/LEANCLOUD-COUNTER-SECURITY.md","hash":"f2fd611a84dd6f9ed5395b63e187e29e9effbcd3","modified":1538027465520},{"_id":"themes/next/docs/LICENSE","hash":"5b702310012d480b40529fd10cf1872f687277a0","modified":1538027465520},{"_id":"themes/next/languages/default.yml","hash":"ea5e6aee4cb14510793ac4593a3bddffe23e530c","modified":1538027465521},{"_id":"themes/next/docs/MATH.md","hash":"34a46ca9a05b4570903beaadd4807e6759afb52e","modified":1538027465520},{"_id":"themes/next/docs/UPDATE-FROM-5.1.X.md","hash":"c9f2ed8e15c137b1885d9ca8b7197d9f457971e9","modified":1538027465520},{"_id":"themes/next/languages/de.yml","hash":"641e49587d41bb87e4d5932dc3d975754ded7953","modified":1538027465521},{"_id":"themes/next/languages/en.yml","hash":"d66b8b48840443a4f9c72c7696a21e292f685a47","modified":1543472212052},{"_id":"themes/next/languages/fr.yml","hash":"ebcd1f188af8c3f5ef1f0923e794c839fbfae2d4","modified":1538027465521},{"_id":"themes/next/languages/id.yml","hash":"9709a4dbacc56a1571a96b139b872128d6959e90","modified":1538027465521},{"_id":"themes/next/languages/it.yml","hash":"4e3adeb10c0fa627935d69ae1783ce0894f5dee5","modified":1538027465521},{"_id":"themes/next/languages/ja.yml","hash":"82afb0a5637ad67065fa5b2624fa56c7c240c3c6","modified":1538027465521},{"_id":"themes/next/languages/ko.yml","hash":"33e065ceb21590b8eb32430a69e76c2f057eb758","modified":1538027465521},{"_id":"themes/next/languages/nl.yml","hash":"060efc260c1c529469d739d97dcee79683e8f411","modified":1538027465521},{"_id":"themes/next/languages/pt-BR.yml","hash":"dc09e290e908744ca28e093dbdd859ca2a20290e","modified":1538027465521},{"_id":"themes/next/languages/pt.yml","hash":"53e2a52b9d5dc20c04080acd4f5b954e8699780f","modified":1538027465521},{"_id":"themes/next/languages/ru.yml","hash":"720b92a9ec075b68737d296b1f29ad8e01151c85","modified":1538027465521},{"_id":"themes/next/languages/vi.yml","hash":"e2b3b18359ab41d58c64b2002acfedd60a7505a4","modified":1538027465521},{"_id":"themes/next/languages/zh-CN.yml","hash":"7582e644ccb0225c340f13ceba3d3fd3531a9970","modified":1544697436756},{"_id":"themes/next/languages/zh-HK.yml","hash":"c22113c4a6c748c18093dae56da5a9e8c5b963cd","modified":1538027465521},{"_id":"themes/next/languages/tr.yml","hash":"6d2f53d3687a7a46c67c78ab47908accd8812add","modified":1538027465521},{"_id":"themes/next/languages/zh-TW.yml","hash":"dbf4dd87716babb2db4f5332fae9ec190a6f636a","modified":1538027465521},{"_id":"themes/next/layout/category.swig","hash":"f0e3338bfa5efb205d2c28e635e9611f1fff3b55","modified":1544593568995},{"_id":"themes/next/layout/page.swig","hash":"9ddf40303f82e3db76d59dc82b6d4eadfed203c6","modified":1543300973205},{"_id":"themes/next/layout/post.swig","hash":"0554f42f90f4a524666c2b520be30b689c1d6a87","modified":1543296440228},{"_id":"themes/next/scripts/helpers.js","hash":"7849f9b9a86fc82d6e186e32a5e26e1f27c49b47","modified":1538027465537},{"_id":"themes/next/layout/_layout.swig","hash":"41ab1ee113e1a3ddb2aff0014445fcecb1d59c9c","modified":1541426221025},{"_id":"themes/next/layout/index.swig","hash":"bdcc9f57adef49706b16b107791cacecbc23c1dc","modified":1543300977401},{"_id":"themes/next/scripts/merge-configs.js","hash":"5f96f63e86825fd7028c2522e4111103e261a758","modified":1538027465537},{"_id":"themes/next/scripts/merge.js","hash":"39b84b937b2a9608b94e5872349a47200e1800ff","modified":1538027465537},{"_id":"themes/next/layout/archive.swig","hash":"4b53070008775ecfd03953bd1b4adfcb0fabcaac","modified":1543466184571},{"_id":"themes/next/test/.jshintrc","hash":"c9fca43ae0d99718e45a6f5ce736a18ba5fc8fb6","modified":1538027465587},{"_id":"themes/next/layout/schedule.swig","hash":"d99b9eff0cff38caf095445f27c08aaf11a5b862","modified":1543300974836},{"_id":"themes/next/layout/tag.swig","hash":"7cda2822e50b9fee9848a6b81e6c2d1aca830aeb","modified":1543300979170},{"_id":"themes/next/source/fonts/.gitkeep","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1538027465571},{"_id":"themes/next/test/helpers.js","hash":"f25e7f3265eb5a6e1ccbb5e5012fa9bebf134105","modified":1538027465588},{"_id":"themes/next/docs/ru/DATA-FILES.md","hash":"a51de08657f5946f4028b11373280ddc04639525","modified":1538027465520},{"_id":"themes/next/test/intern.js","hash":"db90b1063356727d72be0d77054fdc32fa882a66","modified":1538027465588},{"_id":"themes/next/docs/ru/INSTALLATION.md","hash":"7b2963daac19b0c14f98ebef375d5fbce8fc3f44","modified":1538027465521},{"_id":"themes/next/docs/ru/README.md","hash":"caaad965f9d54f82382c934f44a507d37a863fa3","modified":1538027465521},{"_id":"themes/next/docs/zh-CN/ALGOLIA-SEARCH.md","hash":"e771c5b745608c6fb5ae2fa1c06c61b3699627ec","modified":1538027465521},{"_id":"themes/next/docs/ru/UPDATE-FROM-5.1.X.md","hash":"1a4e41adcf5831057f3f7b3025ed4a5ef7c442b4","modified":1538027465521},{"_id":"themes/next/docs/zh-CN/CONTRIBUTING.md","hash":"6ea741f380dc3e90661d12db7e115a94b77643a4","modified":1538027465521},{"_id":"themes/next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"9b512cb820627fcc45c9f77c7a122aa99e021bd5","modified":1538027465521},{"_id":"themes/next/docs/zh-CN/DATA-FILES.md","hash":"67f4a987e7db0ab1ce1ea4c311f2961df07b6681","modified":1538027465521},{"_id":"themes/next/docs/zh-CN/INSTALLATION.md","hash":"baca12cc24be082f1db28c7f283493569666321c","modified":1538027465521},{"_id":"themes/next/docs/zh-CN/LEANCLOUD-COUNTER-SECURITY.md","hash":"7214fcd1b5830e62b3ac0836ad2d1b0fa391ae12","modified":1538027465521},{"_id":"themes/next/layout/_custom/head.swig","hash":"a223919d2e1bf17ca4d6abb2c86f2efca9883dc1","modified":1538027465521},{"_id":"themes/next/layout/_custom/header.swig","hash":"ba8ab5a0280b953aa97435ff8946cbcbb2755a27","modified":1538027465521},{"_id":"themes/next/node_modules/hexo-symbols-count-time/.eslintrc.json","hash":"cc5f297f0322672fe3f684f823bc4659e4a54c41","modified":1529948346000},{"_id":"themes/next/layout/_custom/sidebar.swig","hash":"ba8ab5a0280b953aa97435ff8946cbcbb2755a27","modified":1538027465521},{"_id":"themes/next/docs/zh-CN/MATH.md","hash":"4d68054b062b3c8404b146a155d9624d2d25dd9b","modified":1538027465521},{"_id":"themes/next/docs/zh-CN/README.md","hash":"0e6652be1b6bca87479f2601ff89105def200b4c","modified":1538027465521},{"_id":"themes/next/node_modules/hexo-symbols-count-time/index.js","hash":"8cea6bfa58366019ebfd0b42cf737efa1ecab622","modified":1515238533000},{"_id":"themes/next/docs/zh-CN/UPDATE-FROM-5.1.X.md","hash":"2095d1214a4e519a1d31b67b41c89080fa3285d3","modified":1538027465521},{"_id":"themes/next/layout/_partials/comments.swig","hash":"412d2a0e18a237e490e1b8bce5547558768b9da3","modified":1538027465521},{"_id":"themes/next/node_modules/hexo-symbols-count-time/LICENSE","hash":"f45ee1c765646813b442ca58de72e20a64a7ddba","modified":1515238533000},{"_id":"themes/next/layout/_partials/pagination.swig","hash":"914155d5d758306cff405beefd4a07973fd8fc77","modified":1538027465521},{"_id":"themes/next/node_modules/hexo-symbols-count-time/README.md","hash":"2cfab30720b9e9882ca5383c5f2e4ebaacb1ec52","modified":1529985681000},{"_id":"themes/next/node_modules/hexo-symbols-count-time/package.json","hash":"6a597ccf45ddb666d2458873381b78b0ce8bedd1","modified":1542156325603},{"_id":"themes/next/layout/_partials/page-header.swig","hash":"206cbd6ac9ca6a219a8516f59beae25b3c770199","modified":1538027465521},{"_id":"themes/next/layout/_scripts/commons.swig","hash":"f544e21883d249d5a341c684c97bd25831008f07","modified":1538027465521},{"_id":"themes/next/layout/_scripts/boostrap.swig","hash":"27fb1d81151b9b79683e488579df19eee7e654d6","modified":1538027465521},{"_id":"themes/next/layout/_scripts/vendors.swig","hash":"f134aeb8d5bee351e5277edb92ac694af314b75f","modified":1538027465537},{"_id":"themes/next/layout/_third-party/bookmark.swig","hash":"ed62ea83d3f2c9db2ea57bf23a7d765ed82504c2","modified":1538027465537},{"_id":"themes/next/layout/_third-party/copy-code.swig","hash":"c62c37474c8de78cf34e54c6219b503ec28d9815","modified":1538027465537},{"_id":"themes/next/layout/_third-party/exturl.swig","hash":"53861f78a1fb52e96a43cf6909e1530dcf6cbff8","modified":1538027465537},{"_id":"themes/next/layout/_partials/footer.swig","hash":"ec4f8a69dbb2d8ebab7ef28e342eae543eaee241","modified":1538027465521},{"_id":"themes/next/layout/_third-party/needsharebutton.swig","hash":"debba9b7110f635204a15df148194d4c2fd2668b","modified":1538027465537},{"_id":"themes/next/layout/_third-party/pangu.swig","hash":"ccf0035086e14dcefa24c2907301edf4c37d5448","modified":1538027465537},{"_id":"themes/next/layout/_third-party/rating.swig","hash":"554ec568e9d2c71e4a624a8de3cb5929050811d6","modified":1538027465537},{"_id":"themes/next/layout/_third-party/scroll-cookie.swig","hash":"a174d4a0c9188f9c4a2652f49bfa7a60ad0a83e3","modified":1538027465537},{"_id":"themes/next/layout/_partials/breadcrumb.swig","hash":"4b48fdbfe3bf41ddeda4ff74c1ff17ab9f15c14e","modified":1538027465521},{"_id":"themes/next/layout/_third-party/github-banner.swig","hash":"736cb278fa09d3b4ed6f305b56353941ea918793","modified":1538027465537},{"_id":"themes/next/layout/_third-party/schedule.swig","hash":"db15d7e1552aa2d2386a6b8a33b3b3a40bf9e43d","modified":1538027465537},{"_id":"themes/next/layout/_macro/post.swig","hash":"1d2ac8fa186bd412dc3d0ed2d9f6d77aabbc09e1","modified":1544579505873},{"_id":"themes/next/layout/_scripts/noscript.swig","hash":"f8c7e729ad6e72b4c705a2c5d5041589c2b4cc52","modified":1538027465521},{"_id":"themes/next/layout/_macro/sidebar.swig","hash":"0c8fa20e669ff206b1a405f6897b9c0e527e4d3c","modified":1544702312545},{"_id":"themes/next/layout/_macro/wechat-subscriber.swig","hash":"7a9b687087793bf5e218cbc345214f927fa5601a","modified":1538027465521},{"_id":"themes/next/layout/_macro/post-collapse.swig","hash":"8c56dd26157cbc580ae41d97ac34b90ab48ced3f","modified":1538027465521},{"_id":"themes/next/scripts/tags/button.js","hash":"510f3711a9c9d3e2a844250647d90e8359e7d130","modified":1538027465537},{"_id":"themes/next/scripts/tags/exturl.js","hash":"83e48148d2f4f8543f6833effa8a26eb0b60f2f0","modified":1538027465537},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"4519ab8e6898f2ee90d05cde060375462b937a7d","modified":1538027465537},{"_id":"themes/next/scripts/tags/full-image.js","hash":"ef2c2985a3edb9f69740740c5bc42d4b692c86fd","modified":1538027465537},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"aface11629970a5c4ee38aaa15550d2caee59560","modified":1538027465537},{"_id":"themes/next/scripts/tags/include-raw.js","hash":"ab4a82a7246265717556c7a42f897430340b88cf","modified":1538027465537},{"_id":"themes/next/scripts/tags/label.js","hash":"bb502616bfabe85de5de903074ec6afe627f8413","modified":1538027465537},{"_id":"themes/next/scripts/tags/note.js","hash":"bd3310a5890bded1bda9ba3ad6f98ee44ecb101a","modified":1538027465537},{"_id":"themes/next/scripts/tags/tabs.js","hash":"2d257e26718d4011509fd6f530d2ea37e50e3e66","modified":1538027465537},{"_id":"themes/next/layout/_macro/post-copyright.swig","hash":"8ff97c3f4eb888207bdc50066053c97d890e0202","modified":1538027465521},{"_id":"themes/next/source/css/main.styl","hash":"2a62e2a11e9cdcc69e538d856d6f9ce228a07c93","modified":1538027465570},{"_id":"themes/next/source/images/Challestend.png","hash":"f77ecb69e448ec420da9cf8ca5d3f8979d4ea991","modified":1536902567445},{"_id":"themes/next/layout/_macro/reward.swig","hash":"56733f92352b891b0bb1baca293f68f6c8928b0b","modified":1538027465521},{"_id":"themes/next/source/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1538027465571},{"_id":"themes/next/layout/_macro/post-related.swig","hash":"e8dfb86eb62b9c2bc1435d6d1afa95d3b4c7b931","modified":1538027465521},{"_id":"themes/next/source/images/algolia_logo.svg","hash":"45eeea0b5fba833e21e38ea10ed5ab385ceb4f01","modified":1538027465571},{"_id":"themes/next/source/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1538027465571},{"_id":"themes/next/source/images/cc-by-nc-sa.svg","hash":"6f55543d1fb9cbc436c101d24f802dec7b41efc3","modified":1538027465572},{"_id":"themes/next/source/images/cc-by-nc-nd.svg","hash":"bc3588c9b2d7c68830524783120ff6cf957cf668","modified":1538027465572},{"_id":"themes/next/source/images/cc-by-sa.svg","hash":"70c1535f43e54e5ff35ca81419e77e4c0c301398","modified":1538027465573},{"_id":"themes/next/source/images/cc-by-nc.svg","hash":"6f076713fb9bf934aa2c1046bdf2cf2e37bc1eab","modified":1538027465573},{"_id":"themes/next/source/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1538027465574},{"_id":"themes/next/source/images/cc-by-nd.svg","hash":"42cd73da328077ccc92f859bb8f3cf621b3484f8","modified":1538027465573},{"_id":"themes/next/source/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1538027465574},{"_id":"themes/next/source/images/cc-by.svg","hash":"e92a33c32d1dac8ed94849b2b4e6456e887efe70","modified":1538027465573},{"_id":"themes/next/source/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1538027465575},{"_id":"themes/next/source/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1538027465574},{"_id":"themes/next/source/images/cc-zero.svg","hash":"9bfb52b2f63527a7049247bf00d44e6dc1170e7d","modified":1538027465574},{"_id":"themes/next/source/images/quote-l.svg","hash":"cd108d6f44351cadf8e6742565217f88818a0458","modified":1538027465575},{"_id":"themes/next/source/images/logo.svg","hash":"169f56fd82941591dad3abd734a50ec7259be950","modified":1538027465574},{"_id":"themes/next/source/images/quote-r.svg","hash":"2a2a250b32a87c69dcc1b1976c74b747bedbfb41","modified":1538027465575},{"_id":"themes/next/source/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1538027465575},{"_id":"themes/next/layout/_scripts/schemes/mist.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1538027465521},{"_id":"themes/next/layout/_scripts/schemes/muse.swig","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1538027465537},{"_id":"themes/next/source/css/_mixins/Mist.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1538027465564},{"_id":"themes/next/source/css/_mixins/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1538027465564},{"_id":"themes/next/source/css/_mixins/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1538027465564},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1538027465569},{"_id":"themes/next/source/css/_variables/custom.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1538027465570},{"_id":"themes/next/layout/_partials/header/index.swig","hash":"c909f6e96373c151dea325bcddfdd8c9522421b6","modified":1538027465521},{"_id":"themes/next/layout/_partials/header/menu.swig","hash":"f3ae3168801304af3d80ec3b84264e1d4201cb89","modified":1538027465521},{"_id":"themes/next/node_modules/hexo-symbols-count-time/lib/helper.js","hash":"7778e412674a2bda792130b40827d1acbfcd9e76","modified":1529948368000},{"_id":"themes/next/layout/_partials/header/brand.swig","hash":"19050627bc23b0b2c2e65e7248c0f88468eb8ea5","modified":1538027465521},{"_id":"themes/next/layout/_partials/header/sub-menu.swig","hash":"3f11ae8e9084f39628cd2006931d39a2069b9dd6","modified":1544593644383},{"_id":"themes/next/layout/_partials/search/index.swig","hash":"f6454c452b2e90a8c760321bce7e3dc6119b71fa","modified":1538027465521},{"_id":"themes/next/layout/_partials/search/localsearch.swig","hash":"b2f0d247b213e4cf8de47af6a304d98070cc7256","modified":1538027465521},{"_id":"themes/next/layout/_partials/search/swiftype.swig","hash":"a8c7f9ca7c605d039a1f3bf4e4d3183700a3dd62","modified":1538027465521},{"_id":"themes/next/layout/_partials/search/tinysou.swig","hash":"b25002a83cbd2ca0c4a5df87ad5bff26477c0457","modified":1538027465521},{"_id":"themes/next/layout/_partials/head/external-fonts.swig","hash":"f5e487b0d213ca0bd94aa30bc23b240d65081627","modified":1538027465521},{"_id":"themes/next/layout/_partials/head/head-unique.swig","hash":"0b8349710caf9691741a457aa746add35245048e","modified":1538027465521},{"_id":"themes/next/layout/_partials/share/add-this.swig","hash":"9e3d133ac5bcc6cb51702c83b2611a49811abad1","modified":1538027465521},{"_id":"themes/next/layout/_scripts/schemes/gemini.swig","hash":"c381f638315a007b1baf5fea879161001fe50cd0","modified":1538027465521},{"_id":"themes/next/layout/_scripts/schemes/pisces.swig","hash":"c381f638315a007b1baf5fea879161001fe50cd0","modified":1538027465537},{"_id":"themes/next/layout/_third-party/analytics/analytics-with-widget.swig","hash":"ff947f3561b229bc528cb1837d4ca19612219411","modified":1538027465537},{"_id":"themes/next/layout/_third-party/analytics/application-insights.swig","hash":"71397a5823e8ec8aad3b68aace13150623b3e19d","modified":1538027465537},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.swig","hash":"753d262911c27baf663fcaf199267133528656af","modified":1538027465537},{"_id":"themes/next/layout/_third-party/analytics/busuanzi-counter.swig","hash":"1ce5fa218a44cf6e620583e9013e0b674dd6a989","modified":1538027465537},{"_id":"themes/next/layout/_third-party/analytics/cnzz-analytics.swig","hash":"a10b7f19d7b5725527514622899df413a34a89db","modified":1538027465537},{"_id":"themes/next/layout/_third-party/analytics/facebook-sdk.swig","hash":"7d94845f96197d9d84a405fa5d4ede75fb81b225","modified":1538027465537},{"_id":"themes/next/layout/_third-party/analytics/firestore.swig","hash":"8ab040fccba41675bc835973515530af8a51f8bd","modified":1538027465537},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.swig","hash":"cfc932c5db04fef64cc56d3ba0b8ddf3a15a63bd","modified":1538027465537},{"_id":"themes/next/layout/_third-party/analytics/index.swig","hash":"45f3f629c2aacc381095750e1c8649041a71a84b","modified":1538027465537},{"_id":"themes/next/layout/_third-party/analytics/lean-analytics.swig","hash":"bd8382d4f12df207ed52f75f6e5fb06527970167","modified":1538027465537},{"_id":"themes/next/layout/_third-party/analytics/tencent-analytics.swig","hash":"8a399df90dadba5ad4e781445b58f4765aeb701e","modified":1538027465537},{"_id":"themes/next/layout/_third-party/analytics/tencent-mta.swig","hash":"5a8027328f060f965b3014060bebec1d7cf149c1","modified":1538027465537},{"_id":"themes/next/layout/_third-party/analytics/vkontakte-api.swig","hash":"f9a1647a8f1866deeb94052d1f87a5df99cb1e70","modified":1538027465537},{"_id":"themes/next/layout/_third-party/comments/changyan.swig","hash":"4c501ea0b9c494181eb3c607c5526a5754e7fbd8","modified":1538027465537},{"_id":"themes/next/layout/_third-party/comments/disqus.swig","hash":"2440f1e66cb8e39cc2bacfd783fb6fe904a628e9","modified":1538027465537},{"_id":"themes/next/layout/_third-party/comments/index.swig","hash":"34cc66d4dbada2d561ba6f70fd9a75207c5adbd4","modified":1538027465537},{"_id":"themes/next/layout/_third-party/comments/gitment.swig","hash":"19fd1d4d01193308a0ef530a7fc9abbae5441c34","modified":1544600765905},{"_id":"themes/next/layout/_third-party/comments/livere.swig","hash":"c49a3b10b2f2f64a7ac41fa3d436fd2c8d31cca8","modified":1538027465537},{"_id":"themes/next/layout/_third-party/comments/valine.swig","hash":"d05e70a416963023ee1978e4168d58bcfd956ed3","modified":1538027465537},{"_id":"themes/next/layout/_third-party/math/index.swig","hash":"30e9e55d9af2ced6e6b156a042026a8b480f0ab0","modified":1538027465537},{"_id":"themes/next/layout/_third-party/math/mathjax.swig","hash":"c0c2fd87e71f0beb542aa50c0bc875da5aa5c44b","modified":1538027465537},{"_id":"themes/next/layout/_third-party/search/index.swig","hash":"34599633658f3b0ffb487728b7766e1c7b551f5a","modified":1538027465537},{"_id":"themes/next/layout/_third-party/search/localsearch.swig","hash":"71c897f9b107dd0de1b7f649633cf583c206a9db","modified":1538027465537},{"_id":"themes/next/layout/_third-party/search/tinysou.swig","hash":"fe95dd3d166634c466e19aa756e65ad6e8254d3e","modified":1538027465537},{"_id":"themes/next/layout/_third-party/seo/baidu-push.swig","hash":"d8c98938719284fa06492c114d99a1904652a555","modified":1538027465537},{"_id":"themes/next/layout/_scripts/pages/post-details.swig","hash":"580e9d9c4d8783ee6200d845ae16c98979bf1ea3","modified":1538027465521},{"_id":"themes/next/layout/_macro/menu/menu-badge.swig","hash":"4eb8e222dc337211efb0d3bbdb5e29af3e6ecdb8","modified":1538027465521},{"_id":"themes/next/layout/_macro/menu/menu-item.swig","hash":"aab518204d3125e948796a9ba6b56b09cade2d92","modified":1538027465521},{"_id":"themes/next/layout/_third-party/math/katex.swig","hash":"860de4ce6fccc516d2f779a4b600a4214d8c18e2","modified":1538027465537},{"_id":"themes/next/source/css/_custom/custom.styl","hash":"3403fdd8efde1a0afd11ae8a5a97673f5903087f","modified":1542161194658},{"_id":"themes/next/source/css/_mixins/Gemini.styl","hash":"07f7da320689f828f6e36a6123807964a45157a0","modified":1538027465564},{"_id":"themes/next/source/css/_mixins/Pisces.styl","hash":"8aa98ae349908736ba43196c42498fd5bdeb780a","modified":1538027465564},{"_id":"themes/next/source/css/_mixins/base.styl","hash":"0882d76333ab409e8d3362c284b91a0f0ae761ae","modified":1538027465564},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"a25408534f8fe6e321db4bbf9dd03335d648fe17","modified":1538027465569},{"_id":"themes/next/layout/_partials/share/baidushare.swig","hash":"d9e2d9282f9be6e04eae105964abb81e512bffed","modified":1538027465521},{"_id":"themes/next/layout/_partials/share/duoshuo_share.swig","hash":"d4fbffd7fa8f2090eb32a871872665d90a885fac","modified":1538027465521},{"_id":"themes/next/source/css/_variables/base.styl","hash":"e27a1034b0cd9821bab094565e9aa9bb80c6fa3e","modified":1538027465570},{"_id":"themes/next/layout/_partials/head/head.swig","hash":"09109a5c5a301e7cc5e3c7aec32b0164739fc7d4","modified":1538027465521},{"_id":"themes/next/source/js/src/bootstrap.js","hash":"c7e2a588b679d46379124141bb2f30bc2f3210e2","modified":1538027465576},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"8d6cf29f63c90364f4d3c336f7c9bb794b4c46cc","modified":1538027465569},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"72927abd51d3a607a6ba32cf882390792b34e834","modified":1538027465570},{"_id":"themes/next/source/js/src/affix.js","hash":"ad343aa406fd8181b5f310434817ce98fc2219e3","modified":1538027465575},{"_id":"themes/next/source/js/src/motion.js","hash":"4c7f94e499743f4cc958f6cd1260a93d765d3051","modified":1544593947272},{"_id":"themes/next/source/js/src/post-details.js","hash":"7d309b771e86c7e22ce11cc25625481ef7d5985c","modified":1544593943254},{"_id":"themes/next/source/js/src/algolia-search.js","hash":"84906eeae57bd06744dd20160b93eacf658f97e2","modified":1538027465576},{"_id":"themes/next/source/js/src/scrollspy.js","hash":"68d3690152c89e7adb08bb35ec28dbda2bd93686","modified":1538027465577},{"_id":"themes/next/source/js/src/utils.js","hash":"fa3aab0ba7bc5138c6f8fac436efe5b8dcb97567","modified":1538027465578},{"_id":"themes/next/source/lib/bookmark/.eslintignore","hash":"bbd18f176a313f38aafbce58b55ad002563a689b","modified":1542155414142},{"_id":"themes/next/source/lib/bookmark/.eslintrc.js","hash":"21e561d7708a2c4884ba0d03f148ce46253b08ad","modified":1542155414142},{"_id":"themes/next/source/lib/bookmark/.gitignore","hash":"5410a1bef9807f666cd92a0d2020f700e67e4096","modified":1542155414158},{"_id":"themes/next/source/js/src/exturl.js","hash":"c48aa4b3c0e578a807fd3661e6cd4f3890777437","modified":1538027465576},{"_id":"themes/next/source/lib/bookmark/bookmark.min.js","hash":"9e525329553335c2484f6faf9e933a6bbee9ab6d","modified":1542155414158},{"_id":"themes/next/source/lib/fancybox/.bower.json","hash":"9c0e38750e26eb9e83e2b5ab9e069b66f0965ce4","modified":1544439790916},{"_id":"themes/next/source/lib/fancybox/.gitattributes","hash":"672d3b5767e0eacd83bb41b188c913f2cf754793","modified":1544439790916},{"_id":"themes/next/source/js/src/js.cookie.js","hash":"1512c751d219577d338ac0780fb2bbd9075d5298","modified":1538027465576},{"_id":"themes/next/source/js/src/scroll-cookie.js","hash":"c4867626afab749404daf321367f9b6b8e223f69","modified":1538027465577},{"_id":"themes/next/source/lib/bookmark/LICENSE","hash":"c3036598ab8f45797460e48880c9e859268d574a","modified":1542155414158},{"_id":"themes/next/source/lib/fancybox/LICENSE","hash":"7713a1753ce88f2c7e6b054ecc8e4c786df76300","modified":1544439790916},{"_id":"themes/next/source/lib/fancybox/README.md","hash":"10e4cb3bb98f6b9806bedbb8dbbc00151bad4c70","modified":1544439790916},{"_id":"themes/next/source/lib/bookmark/README.md","hash":"aef0ed533378c45cadb548e4b26b375e2501fe07","modified":1542155414158},{"_id":"themes/next/source/lib/font-awesome/.gitignore","hash":"03ddbf76c1dd1afb93eed0b670d2eee747472ef1","modified":1538027465578},{"_id":"themes/next/source/lib/font-awesome/.npmignore","hash":"c31ff06a740955e44edd4403902e653ccabfd4db","modified":1538027465579},{"_id":"themes/next/source/lib/font-awesome/bower.json","hash":"71e7183634dc1b9449f590f15ebd7201add22ca7","modified":1538027465579},{"_id":"themes/next/source/lib/font-awesome/HELP-US-OUT.txt","hash":"ee33b2798b1e714b904d663436c6b3521011d1fa","modified":1538027465579},{"_id":"themes/next/source/lib/bookmark/index.js","hash":"1364ef511550daf991177d151a5fabc6539fced4","modified":1542155414158},{"_id":"themes/next/source/lib/bookmark/package.json","hash":"e3eedf4ba6fa086743553176f9526e1bf0b44439","modified":1542155414158},{"_id":"themes/next/source/lib/font-awesome/.bower.json","hash":"b4aefc910578d76b267e86dfffdd5121c8db9aec","modified":1538027465578},{"_id":"themes/next/source/lib/pace/pace-theme-barber-shop.min.css","hash":"ee0d51446cb4ffe1bb96bd7bc8c8e046dddfcf46","modified":1544440052001},{"_id":"themes/next/source/lib/pace/README.md","hash":"ddcd2834d847f37b8ee77858bd03d31f70f55fb7","modified":1544440052001},{"_id":"themes/next/source/lib/pace/pace-theme-big-counter.min.css","hash":"5b561dc328af4c4d512e20a76fe964d113a32ba8","modified":1544440052001},{"_id":"themes/next/source/lib/pace/pace-theme-bounce.min.css","hash":"f6bdb9a785b7979dd8ec5c60e278af955ef1e585","modified":1544440052001},{"_id":"themes/next/source/lib/pace/pace-theme-center-simple.min.css","hash":"4b32bc29e02a0c714978f014b74a102695e65bce","modified":1544697360434},{"_id":"themes/next/source/lib/pace/pace-theme-fill-left.min.css","hash":"0bec1e235a4a2cccda3f993b205424e1441a44ae","modified":1544440052001},{"_id":"themes/next/source/lib/pace/pace-theme-center-atom.min.css","hash":"dcf79c24fe5350fb73d8038573a104e73639e9d3","modified":1544440052001},{"_id":"themes/next/source/lib/pace/pace-theme-center-circle.min.css","hash":"a4066769c78affbfbc5e30a600e2c7862cd532e0","modified":1544440052001},{"_id":"themes/next/source/lib/pace/pace-theme-center-radar.min.css","hash":"ab7cba998bf4c03b13df342bf43647fa4f419783","modified":1544440052001},{"_id":"themes/next/source/lib/pace/pace.min.js","hash":"8aaa675f577d5501f5f22d5ccb07c2b76310b690","modified":1544440052001},{"_id":"themes/next/source/lib/velocity/velocity.min.js","hash":"bf172816a9c57f9040e3d19c24e181a142daf92b","modified":1538027465586},{"_id":"themes/next/source/lib/pace/pace-theme-flash.min.css","hash":"13ace22c40312d7bbd8d9c1e50eff897a7a497d8","modified":1544440052001},{"_id":"themes/next/source/lib/velocity/velocity.ui.min.js","hash":"dde584994ac13dc601836e86f4cf490e418d9723","modified":1538027465587},{"_id":"themes/next/source/lib/pace/pace-theme-loading-bar.min.css","hash":"7ee28875dfc1230d76c537f6605766e8d4011e9f","modified":1544440052001},{"_id":"themes/next/source/lib/pace/pace-theme-corner-indicator.min.css","hash":"b3c64c973f31884e3d8145989476707333406b9a","modified":1544440052001},{"_id":"themes/next/source/lib/pace/pace-theme-minimal.min.css","hash":"9cd783cceb8a191f3c8b5d81f7a430ecc3e489d3","modified":1544440052001},{"_id":"themes/next/source/lib/reading_progress/.editorconfig","hash":"b1fd3a1cdad8120ed818833be00ea9b9cab2845a","modified":1542025122448},{"_id":"themes/next/source/lib/reading_progress/.gitignore","hash":"09cde1060b4213a7eee528b54560777d2d3756e8","modified":1542025122464},{"_id":"themes/next/source/lib/reading_progress/reading_progress.js","hash":"afe7024841712455762d9993f92c63582dd44969","modified":1542025122464},{"_id":"themes/next/source/lib/velocity/velocity.ui.js","hash":"dbbfb50f6502f6b81dcc9fee7b31f1e812da3464","modified":1538027465587},{"_id":"themes/next/source/lib/pace/pace-theme-mac-osx.min.css","hash":"9f2e7b51b084da407863826b25265b31150b3821","modified":1544440052001},{"_id":"themes/next/source/lib/reading_progress/reading_progress.min.js","hash":"98af8d99819882904f9b1a9254bebf40602e1843","modified":1542025122464},{"_id":"themes/next/source/lib/pace/LICENSE","hash":"336611e76f0638d3d8aeca6b1b97138d2a07523f","modified":1544440052001},{"_id":"themes/next/source/lib/jquery/index.js","hash":"17a740d68a1c330876c198b6a4d9319f379f3af2","modified":1538027465584},{"_id":"themes/next/source/lib/reading_progress/LICENSE","hash":"336611e76f0638d3d8aeca6b1b97138d2a07523f","modified":1542025122464},{"_id":"themes/next/source/lib/reading_progress/README.md","hash":"892aa722541608d334f009f8236babde866c2a9d","modified":1542025122464},{"_id":"themes/next/source/lib/reading_progress/package.json","hash":"193693c3d0de991041175777543650def85be391","modified":1542025122464},{"_id":"themes/next/layout/_third-party/search/algolia-search/assets.swig","hash":"6e076b5e183eedf425a445e99851f938789c3194","modified":1538027465537},{"_id":"themes/next/layout/_third-party/search/algolia-search/dom.swig","hash":"2530de0f3125a912756f6c0e9090cd012134a4c5","modified":1538027465537},{"_id":"themes/next/source/css/_common/outline/outline.styl","hash":"fbb6be577529c750ef7c872fe7abdc7ab0faf0f8","modified":1538027465562},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"237d185ac62ec9877e300947fa0109c44fb8db19","modified":1538027465537},{"_id":"themes/next/source/css/_common/components/buttons.styl","hash":"8b32928686c327151e13d3ab100157f9a03cd59f","modified":1538027465537},{"_id":"themes/next/source/css/_common/components/comments.styl","hash":"ff4489cd582f518bba6909a301ac1292a38b4e96","modified":1538027465537},{"_id":"themes/next/source/css/_common/components/components.styl","hash":"7ad4081466b397e2a6204141bb7768b7c01bd93c","modified":1538027465537},{"_id":"themes/next/source/css/_common/components/pagination.styl","hash":"4f2801fc4cf3f31bf2069f41db8c6ce0e3da9e39","modified":1538027465553},{"_id":"themes/next/source/css/_common/components/tag-cloud.styl","hash":"6eb4bcc3056bd279d000607e8b4dad50d368ca69","modified":1538027465559},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"4b89f955bb92ff953fa3337546a26322de5caa01","modified":1538027465562},{"_id":"themes/next/source/css/_common/scaffolding/helpers.styl","hash":"1da5c800d025345f212a3bf1be035060f4e5e6ed","modified":1538027465562},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"3f40e8a9fe8e7bd5cfc4cf4cbbbcb9539462e973","modified":1538027465563},{"_id":"themes/next/source/css/_common/scaffolding/scaffolding.styl","hash":"a17e2b871a335f290afb392a08f94fd35f59c715","modified":1538027465563},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"52bc8ba71b91d954530b35dfc63b402a02b1321d","modified":1538027465563},{"_id":"themes/next/source/css/_schemes/Mist/_base.styl","hash":"d0e9065b0dbbc01811259f0597d1790268b4881b","modified":1538027465565},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"d0bfd1bef988c76f7d7dd72d88af6f0908a8b0db","modified":1538027465565},{"_id":"themes/next/source/css/_schemes/Mist/_logo.styl","hash":"b1025c421406d2c24cc92a02ae28c1915b01e240","modified":1538027465565},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expanded.styl","hash":"fa6c00fdaf8f0ca3b690a5a556671745fb67e2c9","modified":1538027465566},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"f3aa863adf972569b72f2df6bc6a914e7daace99","modified":1538027465566},{"_id":"themes/next/source/css/_schemes/Mist/_search.styl","hash":"09c965022c13b84ed8a661fee8ac2a6d550495ae","modified":1538027465566},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"2ccb9bdc309b7c1ef183a3dbb0a4621bec54a328","modified":1538027465566},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"31127dcbf4c7b4ada53ffbf1638b5fe325b7cbc0","modified":1538027465567},{"_id":"themes/next/source/css/_schemes/Muse/_logo.styl","hash":"748dbfbf9c08e719ddc775958003c64b00d39dab","modified":1538027465567},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"8f86f694c0749a18ab3ad6f6df75466ca137a4bc","modified":1538027465537},{"_id":"themes/next/source/css/_schemes/Muse/_search.styl","hash":"09c965022c13b84ed8a661fee8ac2a6d550495ae","modified":1538027465567},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"b26f8a3394d8357a5bfd24d9f8bf62d7b4063ebb","modified":1538027465567},{"_id":"themes/next/source/css/_schemes/Pisces/_brand.styl","hash":"bce344d3a665b4c55230d2a91eac2ad16d6f32fd","modified":1538027465568},{"_id":"themes/next/source/css/_common/scaffolding/mobile.styl","hash":"ab775f23ad475efb25376b5aad752ae8b56cfd8c","modified":1538027465563},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"7e4e499964c2112d47e6f9d2b6e87c31ec8269e2","modified":1538027465565},{"_id":"themes/next/source/css/_schemes/Pisces/_posts.styl","hash":"1f6e2ce674735269599acc6d77b3ea18d31967fc","modified":1538027465568},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"3cc7646583218d16925ced7b70865e63a901d4a7","modified":1538027465567},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"ccf5a4761cb0ce451b5e994cfabf8769248a45c1","modified":1538027465568},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"a558803ca81cceae2bdc22c18ef638fcc023681b","modified":1538027465569},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"cc961108b12ab97d9216606ceb1cd1cd31ab20f0","modified":1538027465568},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"df16dc995eb9ad498df2edcfc3e20528fc9aa133","modified":1538027465569},{"_id":"themes/next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"be72740313a9a0477b8a22f62e4c8ffa6d23a2e5","modified":1538027465569},{"_id":"themes/next/source/js/src/schemes/pisces.js","hash":"6b37727883ab6f2a7211300d93289a337944838b","modified":1538027465577},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.css","hash":"f7b9796b5b50c2c267eae284fefb6456ba83d656","modified":1544439790917},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.min.css","hash":"84adea69673c392c1d34a5a316e8e5960aa348b5","modified":1544439790918},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.min.js","hash":"b9a1185936351c902a3dfa179a3fde1d81d0ae68","modified":1544439790919},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.min.css","hash":"88af80502c44cd52ca81ffe7dc7276b7eccb06cf","modified":1538027465580},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css","hash":"3655f1fdf1e584c4d8e8d39026093ca306a5a341","modified":1538027465579},{"_id":"themes/next/source/lib/font-awesome/css/font-awesome.css.map","hash":"1573904b82807abbb32c97a3632c6c6808eaac50","modified":1538027465580},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.min.js","hash":"41ea797c68dbcff2f6fb3aba1d1043a22e7cc0f6","modified":1538027465584},{"_id":"themes/next/source/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"a817b6c158cbc5bab3582713de9fe18a18a80552","modified":1538027465585},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1538027465583},{"_id":"themes/next/source/lib/velocity/velocity.js","hash":"4237c6e9d59da349639de20e559e87c2c0218cfd","modified":1538027465586},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1538027465583},{"_id":"themes/next/source/css/_common/components/footer/footer.styl","hash":"7dd247c8869fdefb5a007045d00f3ef8ceecf300","modified":1538027465537},{"_id":"themes/next/source/css/_common/components/header/header.styl","hash":"34f5ac3c1ed2dd31e9297cc4c0733e71bc2e252f","modified":1538027465537},{"_id":"themes/next/source/css/_common/components/header/menu.styl","hash":"1a0d059799a298fe17c49a44298d32cebde93785","modified":1538027465537},{"_id":"themes/next/source/css/_common/components/header/headerband.styl","hash":"d63e0cacc53dd375fcc113465a4328c59ff5f2c1","modified":1538027465537},{"_id":"themes/next/source/css/_common/components/header/site-meta.styl","hash":"0656e753f182c9f47fef7304c847b7587a85ef0d","modified":1538027465537},{"_id":"themes/next/source/css/_common/components/header/site-nav.styl","hash":"1727702eac5d326b5c81a667944a245016668231","modified":1538027465537},{"_id":"themes/next/source/css/_common/components/highlight/diff.styl","hash":"167986d0f649516671ddf7193eebba7b421cd115","modified":1538027465537},{"_id":"themes/next/source/css/_common/components/highlight/highlight.styl","hash":"835c1340571bd6c4ec263c482cf13283fb047e49","modified":1538027465537},{"_id":"themes/next/source/css/_common/components/highlight/theme.styl","hash":"7fe4d4d656e86276c17cb4e48a560cb6a4def703","modified":1538027465537},{"_id":"themes/next/source/css/_common/components/pages/archive.styl","hash":"b6f3a06a94a6ee5470c956663164d58eda818a64","modified":1538027465552},{"_id":"themes/next/source/css/_common/components/pages/breadcrumb.styl","hash":"630be616447a982413030e561bbd3a80ac14b120","modified":1538027465552},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"7fb593f90d74a99c21840679933b9ef6fdc16a61","modified":1538027465552},{"_id":"themes/next/source/css/_common/components/pages/pages.styl","hash":"ad4cae23c8e383f4fabc9a2a95bca6055020d22e","modified":1538027465553},{"_id":"themes/next/source/css/_common/components/pages/post-detail.styl","hash":"4e3838d7ac81d9ad133960f0f7ed58a44a015285","modified":1538027465553},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"8cf318644acc8b4978537c263290363e21c7f5af","modified":1538027465553},{"_id":"themes/next/source/css/_common/components/post/post-button.styl","hash":"62fbbd32cf5a99ae550c45c763a2c4813a138d01","modified":1538027465553},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"875cbe88d5c7f6248990e2beb97c9828920e7e24","modified":1538027465554},{"_id":"themes/next/source/css/_common/components/post/post-expand.styl","hash":"317c9ceda655e9dc373ce8e7b71d20b794fce9a4","modified":1538027465555},{"_id":"themes/next/source/css/_common/components/post/post-eof.styl","hash":"a200c0a1c5a895ac9dc41e0641a5dfcd766be99b","modified":1538027465554},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"cd9e214e502697f2f2db84eb721bac57a49b0fce","modified":1538027465555},{"_id":"themes/next/source/css/_common/components/post/post-meta.styl","hash":"330c8884efb5612e7eb03986d87d29e8b0651974","modified":1538027465555},{"_id":"themes/next/source/css/_common/components/post/post-copyright.styl","hash":"caf263d1928496688c0e1419801eafd7e6919ce5","modified":1538027465554},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"27deb3d3a243d30022055dac7dad851024099a8b","modified":1538027465555},{"_id":"themes/next/source/css/_common/components/post/post-reading_progress.styl","hash":"82bc7fa5d38d98e98cc25f9a73189024fda25e63","modified":1538027465555},{"_id":"themes/next/source/css/_common/components/post/post-tags.styl","hash":"5a982d8ef3b3623ea5f59e63728990f5623c1b57","modified":1538027465556},{"_id":"themes/next/source/css/_common/components/post/post-rtl.styl","hash":"b2495ae5e04dcca610aacadc47881d9e716cd440","modified":1538027465556},{"_id":"themes/next/source/css/_common/components/post/post-title.styl","hash":"adfd6d2d3b34adc4b476a0ea91e19020456a3b1a","modified":1538027465556},{"_id":"themes/next/source/css/_common/components/post/post-type.styl","hash":"01567edaea6978628aa5521a122a85434c418bfd","modified":1538027465556},{"_id":"themes/next/source/css/_common/components/post/post.styl","hash":"c4168c95d73b05b610d917778ad5b262cbfd424b","modified":1538027465556},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author-links.styl","hash":"fa57ec9a6f1943c0558856dfba2d6b8faca0cd4d","modified":1538027465557},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-blogroll.styl","hash":"8dd9a1c6f4f6baa00c2cf01837e7617120cf9660","modified":1538027465557},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-author.styl","hash":"00a504620c454287111dc0ace64c989e1ff97f54","modified":1538027465557},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-feed-link.styl","hash":"61f8cea3c01acd600e90e1bc2a07def405503748","modified":1538027465558},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-nav.styl","hash":"1153bb71edf253765145559674390e16dd67c633","modified":1538027465558},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-dimmer.styl","hash":"11c22f0fb3f6beb13e5a425ec064a4ff974c13b7","modified":1538027465558},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toc.styl","hash":"9e05a2232faabb41bcebb51d545d897a76f077da","modified":1538027465558},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar-toggle.styl","hash":"a1521d48bb06d8d703753f52a198baa197af7da2","modified":1538027465558},{"_id":"themes/next/source/css/_common/components/sidebar/sidebar.styl","hash":"94d76e6da600a36d80e2470326ebb6b3be447ccb","modified":1538027465558},{"_id":"themes/next/source/css/_common/components/sidebar/site-state.styl","hash":"e71652d3216e289c8548b1ea2357822c1476a425","modified":1538027465558},{"_id":"themes/next/source/css/_common/components/tags/blockquote-center.styl","hash":"2fe76476432b31993338cb45cdb3b29a518b6379","modified":1538027465559},{"_id":"themes/next/source/css/_common/components/tags/full-image.styl","hash":"2d58ad90f148e845bc7023751a7a13260600f8d6","modified":1538027465559},{"_id":"themes/next/source/css/_common/components/tags/group-pictures.styl","hash":"2ad1a2a9bbf6742d1b0762c4c623b68113d1e0fe","modified":1538027465559},{"_id":"themes/next/source/css/_common/components/tags/label.styl","hash":"2ab1322fe52ab5aafd49e68f5bd890e8380ee927","modified":1538027465559},{"_id":"themes/next/source/css/_common/components/header/github-banner.styl","hash":"3f3d2a43d1a326bad25b633c8ec9ddd87867224c","modified":1538027465537},{"_id":"themes/next/source/css/_common/components/tags/note.styl","hash":"9a409b798decdefdaf7a23f0b11004a8c27e82f3","modified":1538027465560},{"_id":"themes/next/source/css/_common/components/tags/tabs.styl","hash":"154a87a32d2fead480d5e909c37f6c476671c5e6","modified":1538027465560},{"_id":"themes/next/source/css/_common/components/tags/tags.styl","hash":"f1640253cbbf71d0c04c34c25bd61045894f98bc","modified":1538027465560},{"_id":"themes/next/source/css/_common/components/third-party/busuanzi-counter.styl","hash":"a6e7d698702c2e383dde3fde2abde27951679084","modified":1538027465560},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"ff50a32ae6fea5fcdf2939dc9b01e1eb76cc73f0","modified":1538027465556},{"_id":"themes/next/source/css/_common/components/third-party/han.styl","hash":"10599e16414a8b7a76c4e79e6617b5fe3d4d1adf","modified":1538027465561},{"_id":"themes/next/source/css/_common/components/third-party/localsearch.styl","hash":"16087276945fa038f199692e3eabb1c52b8ea633","modified":1538027465561},{"_id":"themes/next/source/css/_common/components/third-party/gitment.styl","hash":"874278147115601d2abf15987f5f7a84ada1ac6b","modified":1538027465561},{"_id":"themes/next/source/css/_common/components/third-party/third-party.styl","hash":"c31fbaec7e6373ecfb8588500b972d451695a6ad","modified":1538027465561},{"_id":"themes/next/source/css/_common/components/third-party/needsharebutton.styl","hash":"28825ae15fa20ae3942cdaa7bcc1f3523ce59acc","modified":1538027465561},{"_id":"themes/next/source/css/_common/components/third-party/related-posts.styl","hash":"acfdd76b1c90d2e384affb3d0006a39b524609d2","modified":1538027465561},{"_id":"themes/next/source/css/_schemes/Mist/outline/outline.styl","hash":"a07aa12cc36ac5c819670c2a3c17d07ed7a08986","modified":1538027465566},{"_id":"themes/next/source/css/_schemes/Mist/sidebar/sidebar-blogroll.styl","hash":"1f09be9bb38411f0629b58c3b23873589a6dbcaa","modified":1538027465566},{"_id":"themes/next/source/css/_schemes/Muse/sidebar/sidebar-blogroll.styl","hash":"1f09be9bb38411f0629b58c3b23873589a6dbcaa","modified":1538027465568},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"5c3141d58970a0614896b6a62fd7a8a8caf4e401","modified":1538027465556},{"_id":"themes/next/source/css/_common/components/tags/note-modern.styl","hash":"b7076e58d647265ee0ad2b461fe8ce72c9373bc5","modified":1538027465560},{"_id":"themes/next/source/css/_common/components/third-party/algolia-search.styl","hash":"f4d8144c22544bdb89787c14ab9d39578dae4b7c","modified":1538027465560},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.js","hash":"e72794707ef26fbdf5995532d91d95766173ecd4","modified":1544439790918},{"_id":"themes/next/source/lib/fancybox/source/jquery.fancybox.pack.js","hash":"e72794707ef26fbdf5995532d91d95766173ecd4","modified":1544439790920},{"_id":"themes/next/source/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1538027465582},{"_id":"public/404.html","hash":"280c1b64c61ef6bb187d7820b4527d7d494753e8","modified":1544744338653},{"_id":"public/atom.xml","hash":"57c9fb27198c7bd29d46cfa3a8c7b6f76cdce7fb","modified":1544744338658},{"_id":"public/content.json","hash":"042164e2a9cbec433db6454cdcede651e982fb1c","modified":1544744338659},{"_id":"public/search.xml","hash":"e5df7ac7b4dc51958b7cb348b4133aa280d9cbb9","modified":1544744338669},{"_id":"public/log/index.html","hash":"6cb5a76c05ec8ea78c5cf9d9a876b5b87cf648d5","modified":1544744338673},{"_id":"public/tags/index.html","hash":"1efeef3cfc8a80bb44d044fb1b492f8318177ce5","modified":1544744338673},{"_id":"public/categories/index.html","hash":"9684ae9c07af6d823d8d4a0c84612dcb2b381ee8","modified":1544744338673},{"_id":"public/about/index.html","hash":"8ec3798c028a9f8936d26b7ed8b15c80b4710ef9","modified":1544744338673},{"_id":"public/future-algorithm-ep1/index.html","hash":"f6e9852361d1ff19954a81c2976f61332ba918f6","modified":1544744338673},{"_id":"public/number-theory-learning-notes/index.html","hash":"e9d88af37d6e3f262430ff11a2c1e58d3bd972d1","modified":1544744338673},{"_id":"public/poisonous-problems/index.html","hash":"c9ceea77b42b3d16306bdfe2f1bab03a098b4b5b","modified":1544744338673},{"_id":"public/noip-2018-notes/index.html","hash":"6592880c4f9a7f10f323c7289cf2642529a23b7f","modified":1544744338673},{"_id":"public/luogu-p5009-solution/index.html","hash":"2a041e95aa9b1932bb3b71315e648cc3c9fcc3c7","modified":1544744338674},{"_id":"public/status-compression-learning-notes/index.html","hash":"12f231487974ca4e03e2412ab7cd43b9fba925e5","modified":1544744338674},{"_id":"public/chtholly-tree-learning-notes/index.html","hash":"e88686c3e4c315efd9da4f4869d9b88feb97fc1a","modified":1544744338674},{"_id":"public/luogu-p2154-solution/index.html","hash":"8b1c01503ce9f6e06c7212fee37bdd967ec97c6c","modified":1544744338674},{"_id":"public/luogu-p4900-solution/index.html","hash":"3934c472b8fd2fcf580a3f09757be993617588b0","modified":1544744338674},{"_id":"public/luogu-p3924-solution/index.html","hash":"7415e3f95be1d0c639cec7fc5d9c1ddbac4f41a8","modified":1544744338674},{"_id":"public/luogu-t47720-solution/index.html","hash":"bf60155096b8952c86693900a9575e00c529bf26","modified":1544744338674},{"_id":"public/hello-world/index.html","hash":"98e6b9f850c60eeec36df7fdbbd575e1b717b029","modified":1544744338674},{"_id":"public/archives/index.html","hash":"8f2b3b1a05f71545a9787e29d3b6db70cd1541c6","modified":1544744338674},{"_id":"public/archives/page/2/index.html","hash":"9a58d0cf5e768109b547398433ef7b3ad99523f0","modified":1544744338674},{"_id":"public/archives/2018/index.html","hash":"f2addd495e07d19074a1595a51f733e1d58a0316","modified":1544744338674},{"_id":"public/archives/2018/page/2/index.html","hash":"079beea5d7e62fe1c61de642cb475831c4123f54","modified":1544744338674},{"_id":"public/archives/2018/09/index.html","hash":"83514983e7ad4d67f143d9727612449a6addf32b","modified":1544744338674},{"_id":"public/archives/2018/10/index.html","hash":"9083d087c3ace58a37cc1a11a92834d32307d11c","modified":1544744338675},{"_id":"public/archives/2018/11/index.html","hash":"c75d7a183a5d131f53987228ee490a142b998679","modified":1544744338675},{"_id":"public/archives/2018/12/index.html","hash":"22159de86a433e2848879bfa533a9804223d7e8b","modified":1544744338675},{"_id":"public/categories/其它/index.html","hash":"c2f9276ee4ff72e2f45bcd54dcf9d7edd7827580","modified":1544744338675},{"_id":"public/categories/题解/index.html","hash":"4047f477d3b759725f09235b36038603f6c99244","modified":1544744338675},{"_id":"public/categories/学习笔记/index.html","hash":"eebffc169e66005d1635988166e990b8d8975fc3","modified":1544744338675},{"_id":"public/categories/游记/index.html","hash":"114e97f9f66a8ac1e2fe9c9c42e2e61731d5677f","modified":1544744338675},{"_id":"public/categories/未来算法/index.html","hash":"615c04f338e2eaac9f03aef0dc957750e4245a4a","modified":1544744338675},{"_id":"public/index.html","hash":"ca4b06b72e7160d13c948a1944a84d84b2c6cada","modified":1544744338675},{"_id":"public/page/2/index.html","hash":"823e5c0352f1107eaae1fe6115170677d17bf091","modified":1544744338675},{"_id":"public/tags/其它/index.html","hash":"91c00ea4fa6779fdf632997c06707da5e72ceb85","modified":1544744338675},{"_id":"public/tags/数论/index.html","hash":"12b30b0fbcb1b7fbb0d6100acfaf19bd0f6d140b","modified":1544744338675},{"_id":"public/tags/组合数学/index.html","hash":"56fc7b77c57870160393cd3b9d0369a4593f4c06","modified":1544744338675},{"_id":"public/tags/期望/index.html","hash":"9bf71366a3527c63d1a1750fe395668cd9c362ce","modified":1544744338676},{"_id":"public/tags/洛谷/index.html","hash":"9d47ad2bfe708692546fbbe8db59a4c6ea559bbb","modified":1544744338676},{"_id":"public/tags/差分/index.html","hash":"c8b81d540202c3bec13d5620b5d33ba19da859b6","modified":1544744338676},{"_id":"public/tags/SDOI/index.html","hash":"647c9b219a0faa7800fdb633fc44b0eb01ec5368","modified":1544744338676},{"_id":"public/tags/2009/index.html","hash":"24fb300f3d73c95bf7aece7abe2fcacc173df48a","modified":1544744338676},{"_id":"public/tags/离散化/index.html","hash":"5435bc096aaaea493b8013e6d27e580cc82374a1","modified":1544744338676},{"_id":"public/tags/树状数组/index.html","hash":"e9cf81ff5f107c34b4c15a50e03cbc9dae4e69c0","modified":1544744338676},{"_id":"public/tags/状态压缩/index.html","hash":"2dcf222f53d91f9c864cef2310c8b095d8ffd374","modified":1544744338676},{"_id":"public/tags/动态规划/index.html","hash":"2efb3523a0beb1962bba5ca41268b17e99b420de","modified":1544744338676},{"_id":"public/tags/NOIp/index.html","hash":"a0b2de42aa5103e38001b30432db4ab0266915a2","modified":1544744338676},{"_id":"public/tags/2018/index.html","hash":"358ac91011ca1d462b250fd1848061f508378456","modified":1544744338676},{"_id":"public/tags/珂朵莉树/index.html","hash":"deed66f857fbb8ec0c63a703dc211cf219b10981","modified":1544744338677},{"_id":"public/tags/毒瘤题/index.html","hash":"8aa86242c47bdb611d36f605adf00282bd97cea6","modified":1544744338677},{"_id":"public/tags/线段树/index.html","hash":"f5fdd2f8ae526dc18a93546e2b968f0cacb71d7f","modified":1544744338677},{"_id":"public/tags/树套树/index.html","hash":"a5ffaf7d2a2c16767885938c2004fd9b86c2e867","modified":1544744338677},{"_id":"public/tags/分块/index.html","hash":"649495d1961886a157aae7818a5c94aded4bdefe","modified":1544744338677},{"_id":"public/tags/杜教筛/index.html","hash":"451ba07371aefdc6c8c4d9ac47e45f054d8236be","modified":1544744338677},{"_id":"public/images/Challestend.png","hash":"f77ecb69e448ec420da9cf8ca5d3f8979d4ea991","modified":1544744338683},{"_id":"public/images/apple-touch-icon-next.png","hash":"2959dbc97f31c80283e67104fe0854e2369e40aa","modified":1544744338683},{"_id":"public/images/algolia_logo.svg","hash":"45eeea0b5fba833e21e38ea10ed5ab385ceb4f01","modified":1544744338683},{"_id":"public/images/avatar.gif","hash":"264082bb3a1af70d5499c7d22b0902cb454b6d12","modified":1544744338683},{"_id":"public/images/cc-by-nc-sa.svg","hash":"6f55543d1fb9cbc436c101d24f802dec7b41efc3","modified":1544744338684},{"_id":"public/images/cc-by-nc-nd.svg","hash":"bc3588c9b2d7c68830524783120ff6cf957cf668","modified":1544744338684},{"_id":"public/images/cc-by-sa.svg","hash":"70c1535f43e54e5ff35ca81419e77e4c0c301398","modified":1544744338684},{"_id":"public/images/cc-by-nc.svg","hash":"6f076713fb9bf934aa2c1046bdf2cf2e37bc1eab","modified":1544744338684},{"_id":"public/images/favicon-16x16-next.png","hash":"943a0d67a9cdf8c198109b28f9dbd42f761d11c3","modified":1544744338684},{"_id":"public/images/cc-by-nd.svg","hash":"42cd73da328077ccc92f859bb8f3cf621b3484f8","modified":1544744338684},{"_id":"public/images/loading.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1544744338684},{"_id":"public/images/cc-by.svg","hash":"e92a33c32d1dac8ed94849b2b4e6456e887efe70","modified":1544744338684},{"_id":"public/images/placeholder.gif","hash":"5fbd472222feb8a22cf5b8aa5dc5b8e13af88e2b","modified":1544744338684},{"_id":"public/images/favicon-32x32-next.png","hash":"0749d7b24b0d2fae1c8eb7f671ad4646ee1894b1","modified":1544744338684},{"_id":"public/images/cc-zero.svg","hash":"9bfb52b2f63527a7049247bf00d44e6dc1170e7d","modified":1544744338684},{"_id":"public/images/quote-l.svg","hash":"cd108d6f44351cadf8e6742565217f88818a0458","modified":1544744338684},{"_id":"public/images/logo.svg","hash":"169f56fd82941591dad3abd734a50ec7259be950","modified":1544744338684},{"_id":"public/images/quote-r.svg","hash":"2a2a250b32a87c69dcc1b1976c74b747bedbfb41","modified":1544744338684},{"_id":"public/images/searchicon.png","hash":"67727a6a969be0b2659b908518fa6706eed307b8","modified":1544744338684},{"_id":"public/lib/bookmark/LICENSE","hash":"c3036598ab8f45797460e48880c9e859268d574a","modified":1544744338684},{"_id":"public/lib/fancybox/LICENSE","hash":"7713a1753ce88f2c7e6b054ecc8e4c786df76300","modified":1544744338684},{"_id":"public/lib/font-awesome/HELP-US-OUT.txt","hash":"ee33b2798b1e714b904d663436c6b3521011d1fa","modified":1544744338685},{"_id":"public/lib/pace/LICENSE","hash":"336611e76f0638d3d8aeca6b1b97138d2a07523f","modified":1544744338685},{"_id":"public/lib/reading_progress/LICENSE","hash":"336611e76f0638d3d8aeca6b1b97138d2a07523f","modified":1544744338685},{"_id":"public/lib/font-awesome/css/font-awesome.css.map","hash":"1573904b82807abbb32c97a3632c6c6808eaac50","modified":1544744338685},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff","hash":"28b782240b3e76db824e12c02754a9731a167527","modified":1544744339095},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.woff2","hash":"d6f48cba7d076fb6f2fd6ba993a75b9dc1ecbf0c","modified":1544744339185},{"_id":"public/js/src/bootstrap.js","hash":"1c41508b83cb0c4512e64b4d63afa1be954ce8ef","modified":1544744339191},{"_id":"public/js/src/affix.js","hash":"a2aab233d99297435a5274bf512c3c753fe08e80","modified":1544744339204},{"_id":"public/js/src/post-details.js","hash":"0dde5e6d4547587662a3256317a9d5d1db507692","modified":1544744339204},{"_id":"public/js/src/algolia-search.js","hash":"1f7f10c579e7703d0f6acb8b73f3d78a07d0c623","modified":1544744339204},{"_id":"public/js/src/scrollspy.js","hash":"fa3c92968bcdbcb8d95a1729f7659d9753cbd077","modified":1544744339204},{"_id":"public/lib/bookmark/bookmark.min.js","hash":"9e525329553335c2484f6faf9e933a6bbee9ab6d","modified":1544744339204},{"_id":"public/js/src/js.cookie.js","hash":"9b37973a90fd50e71ea91682265715e45ae82c75","modified":1544744339204},{"_id":"public/js/src/exturl.js","hash":"54825acc8de4793feac415be227b965428f4e97d","modified":1544744339204},{"_id":"public/js/src/scroll-cookie.js","hash":"d07b3776708d4ae79ed2037c4c7391d5c9b06b19","modified":1544744339205},{"_id":"public/lib/font-awesome/bower.json","hash":"64394a2a9aa00f8e321d8daa5e51a420f0e96dad","modified":1544744339205},{"_id":"public/lib/bookmark/index.js","hash":"5e5cba645a1a4531ccbb4782df2f7a075626393f","modified":1544744339205},{"_id":"public/lib/bookmark/package.json","hash":"9f06f3432c12b68a2c2fe3f318455b35a965a1da","modified":1544744339205},{"_id":"public/lib/reading_progress/reading_progress.js","hash":"174678a8e2a24763e3fe8b9c25496fdf6ee0220b","modified":1544744339205},{"_id":"public/lib/reading_progress/reading_progress.min.js","hash":"98af8d99819882904f9b1a9254bebf40602e1843","modified":1544744339205},{"_id":"public/lib/reading_progress/package.json","hash":"e404a0bdf26df62eb89173c6fe5f5824345801c5","modified":1544744339205},{"_id":"public/js/src/schemes/pisces.js","hash":"58f87062210200c778eb92e20a9453bb6a5a03fa","modified":1544744339205},{"_id":"public/lib/fancybox/README.html","hash":"32a70d79d6a3590a40e742a90a34000694ad3980","modified":1544744339205},{"_id":"public/lib/bookmark/README.html","hash":"7f7eafeda0668e53fc3b99e6974f611b35829270","modified":1544744339205},{"_id":"public/lib/pace/pace-theme-barber-shop.min.css","hash":"a041cd993024acbe40dc269281919d0dbee3065d","modified":1544744339206},{"_id":"public/lib/pace/README.html","hash":"0739df73902c11eb9a95d2c0845e2d596977a4e7","modified":1544744339206},{"_id":"public/lib/pace/pace-theme-big-counter.min.css","hash":"32ea5710b36d34e140900dcab855d629585da538","modified":1544744339206},{"_id":"public/lib/pace/pace-theme-bounce.min.css","hash":"a876e260ede8d61e8420cabad17f3c9ac80afb2e","modified":1544744339206},{"_id":"public/lib/pace/pace-theme-center-simple.min.css","hash":"1f4e1eb52f4c997d86cba9321bf3fd08b0a54d4b","modified":1544744339206},{"_id":"public/lib/pace/pace-theme-fill-left.min.css","hash":"cefee3b03b33b7684b83e8ad9ca3bf31be0e1115","modified":1544744339206},{"_id":"public/lib/pace/pace-theme-center-atom.min.css","hash":"1baff04ce15f4ae4d7bbb05be5bdc1218790956c","modified":1544744339206},{"_id":"public/lib/pace/pace-theme-center-circle.min.css","hash":"1f51a66e963d37868a9409639ee07a8d29837026","modified":1544744339206},{"_id":"public/lib/pace/pace-theme-center-radar.min.css","hash":"6198442d0496c8ebf7b35b8f75cfebe0a081d274","modified":1544744339206},{"_id":"public/lib/pace/pace-theme-flash.min.css","hash":"5d7b8df3c789cd2393721fc894922d2bb4a4a584","modified":1544744339206},{"_id":"public/lib/pace/pace-theme-corner-indicator.min.css","hash":"74800b416a3f3398e9b43dd4e975e3a27bda22ae","modified":1544744339206},{"_id":"public/lib/pace/pace-theme-minimal.min.css","hash":"84a0fce9c57befd47d5128b23a6aa9cff18dcfd8","modified":1544744339206},{"_id":"public/lib/pace/pace-theme-mac-osx.min.css","hash":"b5e16bb5b2136fa26c936557ba4585b0675c0a76","modified":1544744339206},{"_id":"public/lib/reading_progress/README.html","hash":"ac0209e94caf41ca02955ec49b0989ec58cbab50","modified":1544744339206},{"_id":"public/css/main.css","hash":"8f66cf4f36b4fd0782fa83ce586144631126710c","modified":1544744339206},{"_id":"public/js/src/motion.js","hash":"b45d2c0d48f2c8e6a0621b8063845f76b89476cc","modified":1544744339209},{"_id":"public/js/src/utils.js","hash":"e437eff1d3781c4a1aec9ff2060565524a37c983","modified":1544744339219},{"_id":"public/lib/pace/pace.min.js","hash":"9944dfb7814b911090e96446cea4d36e2b487234","modified":1544744339219},{"_id":"public/lib/velocity/velocity.ui.min.js","hash":"ed5e534cd680a25d8d14429af824f38a2c7d9908","modified":1544744339220},{"_id":"public/lib/ua-parser-js/dist/ua-parser.min.js","hash":"38628e75e4412cc6f11074e03e1c6d257aae495b","modified":1544744339220},{"_id":"public/lib/ua-parser-js/dist/ua-parser.pack.js","hash":"214dad442a92d36af77ed0ca1d9092b16687f02f","modified":1544744339220},{"_id":"public/lib/pace/pace-theme-loading-bar.min.css","hash":"bb2b2f29ee5f3ab6b40683ed25b9313fe11b3784","modified":1544744339220},{"_id":"public/lib/fancybox/source/jquery.fancybox.min.css","hash":"2e7b98987216b2313b9c635102f75e29af68f59b","modified":1544744339220},{"_id":"public/lib/fancybox/source/jquery.fancybox.css","hash":"0a7d30a27885c937db8c681ff70f4c9dae1bf4df","modified":1544744339228},{"_id":"public/lib/font-awesome/fonts/fontawesome-webfont.eot","hash":"d980c2ce873dc43af460d4d572d441304499f400","modified":1544744339249},{"_id":"public/lib/font-awesome/css/font-awesome.min.css","hash":"c5eeba363293d381fb56858142c323c13b2dfd1d","modified":1544744339254},{"_id":"public/lib/velocity/velocity.min.js","hash":"2f1afadc12e4cf59ef3b405308d21baa97e739c6","modified":1544744339276},{"_id":"public/lib/velocity/velocity.ui.js","hash":"6a1d101eab3de87527bb54fcc8c7b36b79d8f0df","modified":1544744339276},{"_id":"public/lib/font-awesome/css/font-awesome.css","hash":"f8445aa243e881560b5e5b69fdf18bbc105bd143","modified":1544744339276},{"_id":"public/lib/fancybox/source/jquery.fancybox.min.js","hash":"b85b75426ff7569d54a1f69689895315e80ed85d","modified":1544744339559},{"_id":"public/lib/jquery/index.js","hash":"41b4bfbaa96be6d1440db6e78004ade1c134e276","modified":1544744339635},{"_id":"public/lib/fancybox/source/jquery.fancybox.pack.js","hash":"fec45d19179030b8f43ebd0eabc5467892c14136","modified":1544744339657},{"_id":"public/lib/fancybox/source/jquery.fancybox.js","hash":"fec45d19179030b8f43ebd0eabc5467892c14136","modified":1544744339657},{"_id":"public/lib/velocity/velocity.js","hash":"9f08181baea0cc0e906703b7e5df9111b9ef3373","modified":1544744339665}],"Category":[{"name":"其它","_id":"cjpn8w5qm0004rogudm4qsw2q"},{"name":"题解","_id":"cjpn8w5qr0009roguslzia98n"},{"name":"学习笔记","_id":"cjpn8w5sk000orogulaabypz2"},{"name":"游记","_id":"cjpn8w5sm000urogu8dwp8dj7"},{"name":"未来算法","_id":"cjpn8w603001zrogus48a0y7o"}],"Data":[],"Page":[{"comments":0,"layout":"false","_content":"<body>\n\t<div>\n\t\t<p style=\"text-align: center;\"><img src=\"https://i.loli.net/2018/10/27/5bd4705dd844f.jpg\"></p>\n\t\t<p style=\"text-align: center;\"><strong>您可能访问了错误的网址</strong></p>\n\t\t<p style=\"text-align: center;\"><a href=\"https://challestend.github.io\" target=\"_self\"><strong>回到博客主页</strong></a></p>\n\t</div>\n</html>\n","source":"404.html","raw":"---\ncomments: false\nlayout: false\n---\n<body>\n\t<div>\n\t\t<p style=\"text-align: center;\"><img src=\"https://i.loli.net/2018/10/27/5bd4705dd844f.jpg\"></p>\n\t\t<p style=\"text-align: center;\"><strong>您可能访问了错误的网址</strong></p>\n\t\t<p style=\"text-align: center;\"><a href=\"https://challestend.github.io\" target=\"_self\"><strong>回到博客主页</strong></a></p>\n\t</div>\n</html>\n","date":"2018-12-13T13:55:58.098Z","updated":"2018-12-13T13:55:58.098Z","path":"404.html","title":"","_id":"cjpn8w5nu0000rogu2mlpc6rc","content":"<body>\n\t<div>\n\t\t<p style=\"text-align: center;\"><img src=\"https://i.loli.net/2018/10/27/5bd4705dd844f.jpg\"></p>\n\t\t<p style=\"text-align: center;\"><strong>您可能访问了错误的网址</strong></p>\n\t\t<p style=\"text-align: center;\"><a href=\"https://challestend.github.io\" target=\"_self\"><strong>回到博客主页</strong></a></p>\n\t</div>\n\n</body>","site":{"data":{}},"excerpt":"","more":"<body>\n\t<div>\n\t\t<p style=\"text-align: center;\"><img src=\"https://i.loli.net/2018/10/27/5bd4705dd844f.jpg\"></p>\n\t\t<p style=\"text-align: center;\"><strong>您可能访问了错误的网址</strong></p>\n\t\t<p style=\"text-align: center;\"><a href=\"https://challestend.github.io\" target=\"_self\"><strong>回到博客主页</strong></a></p>\n\t</div>\n\n</body>"},{"title":"日志","date":"2018-12-12T11:47:51.000Z","mathjax":true,"_content":"直角，这是这篇blog的更新日志。\n\n不过我不是一个考虑周全的人，之前$9$月份搭起博客时，我并没有考虑到这些。因而，之前的很多更新的具体时间已经无从知晓。\n\n- $\\text{2018-09-27}$\n  - 建站。\n- （略）\n- $\\text{2018-12-13}$\n  - 令`theme-next-pace`的加载进度条的颜色温和了一点。（`#000`->`#222`）\n  - 将`hexo-symbols-count-time`的字数和时间统计替换成了精确数值。\n  - 减少了侧边栏和网易云外链的宽度。（$400$->$320$；$320$->$280$）\n- $\\text{2018-12-14}$\n  - 修复了在$404$页面点击「回到博客主页」会打开新标签页的问题。\n- $\\text{To Be Continued}$\n\n本页面不关闭评论，如果各位dalao有啥想说的，比如说对这个blog现状的看法，或者是对未来的期望，都可以来扯两句。\n\n话说会有dalao来看这个blog吗（","source":"log/index.md","raw":"---\ntitle: 日志\ndate: 2018-12-12 19:47:51\nmathjax: true\n---\n直角，这是这篇blog的更新日志。\n\n不过我不是一个考虑周全的人，之前$9$月份搭起博客时，我并没有考虑到这些。因而，之前的很多更新的具体时间已经无从知晓。\n\n- $\\text{2018-09-27}$\n  - 建站。\n- （略）\n- $\\text{2018-12-13}$\n  - 令`theme-next-pace`的加载进度条的颜色温和了一点。（`#000`->`#222`）\n  - 将`hexo-symbols-count-time`的字数和时间统计替换成了精确数值。\n  - 减少了侧边栏和网易云外链的宽度。（$400$->$320$；$320$->$280$）\n- $\\text{2018-12-14}$\n  - 修复了在$404$页面点击「回到博客主页」会打开新标签页的问题。\n- $\\text{To Be Continued}$\n\n本页面不关闭评论，如果各位dalao有啥想说的，比如说对这个blog现状的看法，或者是对未来的期望，都可以来扯两句。\n\n话说会有dalao来看这个blog吗（","updated":"2018-12-13T23:38:11.222Z","path":"log/index.html","comments":1,"layout":"page","_id":"cjpn8w5qk0002rogup8ws1xh3","content":"<p>直角，这是这篇blog的更新日志。</p>\n<p>不过我不是一个考虑周全的人，之前$9$月份搭起博客时，我并没有考虑到这些。因而，之前的很多更新的具体时间已经无从知晓。</p>\n<ul>\n<li>$\\text{2018-09-27}$<ul>\n<li>建站。</li>\n</ul>\n</li>\n<li>（略）</li>\n<li>$\\text{2018-12-13}$<ul>\n<li>令<code>theme-next-pace</code>的加载进度条的颜色温和了一点。（<code>#000</code>-&gt;<code>#222</code>）</li>\n<li>将<code>hexo-symbols-count-time</code>的字数和时间统计替换成了精确数值。</li>\n<li>减少了侧边栏和网易云外链的宽度。（$400$-&gt;$320$；$320$-&gt;$280$）</li>\n</ul>\n</li>\n<li>$\\text{2018-12-14}$<ul>\n<li>修复了在$404$页面点击「回到博客主页」会打开新标签页的问题。</li>\n</ul>\n</li>\n<li>$\\text{To Be Continued}$</li>\n</ul>\n<p>本页面不关闭评论，如果各位dalao有啥想说的，比如说对这个blog现状的看法，或者是对未来的期望，都可以来扯两句。</p>\n<p>话说会有dalao来看这个blog吗（</p>\n","site":{"data":{}},"excerpt":"","more":"<p>直角，这是这篇blog的更新日志。</p>\n<p>不过我不是一个考虑周全的人，之前$9$月份搭起博客时，我并没有考虑到这些。因而，之前的很多更新的具体时间已经无从知晓。</p>\n<ul>\n<li>$\\text{2018-09-27}$<ul>\n<li>建站。</li>\n</ul>\n</li>\n<li>（略）</li>\n<li>$\\text{2018-12-13}$<ul>\n<li>令<code>theme-next-pace</code>的加载进度条的颜色温和了一点。（<code>#000</code>-&gt;<code>#222</code>）</li>\n<li>将<code>hexo-symbols-count-time</code>的字数和时间统计替换成了精确数值。</li>\n<li>减少了侧边栏和网易云外链的宽度。（$400$-&gt;$320$；$320$-&gt;$280$）</li>\n</ul>\n</li>\n<li>$\\text{2018-12-14}$<ul>\n<li>修复了在$404$页面点击「回到博客主页」会打开新标签页的问题。</li>\n</ul>\n</li>\n<li>$\\text{To Be Continued}$</li>\n</ul>\n<p>本页面不关闭评论，如果各位dalao有啥想说的，比如说对这个blog现状的看法，或者是对未来的期望，都可以来扯两句。</p>\n<p>话说会有dalao来看这个blog吗（</p>\n"},{"title":"标签","date":"2018-10-09T01:57:40.000Z","type":"tags","comments":0,"_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ndate: 2018-10-09 09:57:40\ntype: \"tags\"\ncomments: false\n---\n","updated":"2018-12-12T11:50:44.607Z","path":"tags/index.html","layout":"page","_id":"cjpn8w5tk001lrogubavew69n","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"分类","date":"2018-10-11T00:14:04.000Z","type":"categories","comments":0,"_content":"\n","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2018-10-11 08:14:04\ntype: \"categories\"\ncomments: false\n---\n\n","updated":"2018-12-12T11:50:34.445Z","path":"categories/index.html","layout":"page","_id":"cjpn8w5tm001nrogu5ojnperi","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"关于","date":"2018-12-12T11:50:25.678Z","comments":0,"_content":"A juruo OIer from SD province.\n\nStudying in SLYZ.\n\nFind me on\n\n- [Luogu](https://www.luogu.org/space/show?uid=63352)\n- [LibreOJ](https://loj.ac/user/6666)\n- [NowCoder](https://www.nowcoder.com/profile/514705863)\n- [CodeForces](http://codeforces.com/profile/CLT)\n- [GitHub](https://github.com/Challestend)\n","source":"about/index.md","raw":"---\ntitle: 关于\ndate: Undefined\ncomments: false\n---\nA juruo OIer from SD province.\n\nStudying in SLYZ.\n\nFind me on\n\n- [Luogu](https://www.luogu.org/space/show?uid=63352)\n- [LibreOJ](https://loj.ac/user/6666)\n- [NowCoder](https://www.nowcoder.com/profile/514705863)\n- [CodeForces](http://codeforces.com/profile/CLT)\n- [GitHub](https://github.com/Challestend)\n","updated":"2018-12-12T11:50:25.678Z","path":"about/index.html","layout":"page","_id":"cjpn8w5zj001sroguzpi6qd6g","content":"<p>A juruo OIer from SD province.</p>\n<p>Studying in SLYZ.</p>\n<p>Find me on</p>\n<ul>\n<li><a href=\"https://www.luogu.org/space/show?uid=63352\" target=\"_blank\" rel=\"noopener\">Luogu</a></li>\n<li><a href=\"https://loj.ac/user/6666\" target=\"_blank\" rel=\"noopener\">LibreOJ</a></li>\n<li><a href=\"https://www.nowcoder.com/profile/514705863\" target=\"_blank\" rel=\"noopener\">NowCoder</a></li>\n<li><a href=\"http://codeforces.com/profile/CLT\" target=\"_blank\" rel=\"noopener\">CodeForces</a></li>\n<li><a href=\"https://github.com/Challestend\">GitHub</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p>A juruo OIer from SD province.</p>\n<p>Studying in SLYZ.</p>\n<p>Find me on</p>\n<ul>\n<li><a href=\"https://www.luogu.org/space/show?uid=63352\" target=\"_blank\" rel=\"noopener\">Luogu</a></li>\n<li><a href=\"https://loj.ac/user/6666\" target=\"_blank\" rel=\"noopener\">LibreOJ</a></li>\n<li><a href=\"https://www.nowcoder.com/profile/514705863\" target=\"_blank\" rel=\"noopener\">NowCoder</a></li>\n<li><a href=\"http://codeforces.com/profile/CLT\" target=\"_blank\" rel=\"noopener\">CodeForces</a></li>\n<li><a href=\"https://github.com/Challestend\">GitHub</a></li>\n</ul>\n"}],"Post":[{"title":"Hello World","date":"2018-09-27T05:41:19.000Z","mathjax":true,"_content":"总算是搞出来了一个自己觉得海星的blog……\n","source":"_posts/2018-09-27-hello-world.md","raw":"---\ntitle: Hello World\ndate: 2018-09-27 13:41:19\ntags:\n  - 其它\ncategories:\n  - 其它\nmathjax: true\n---\n总算是搞出来了一个自己觉得海星的blog……\n","slug":"hello-world","published":1,"updated":"2018-12-12T02:02:47.401Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjpn8w5qh0001rogukfpdh6zm","content":"<p>总算是搞出来了一个自己觉得海星的blog……</p>\n","site":{"data":{}},"excerpt":"","more":"<p>总算是搞出来了一个自己觉得海星的blog……</p>\n"},{"title":"「Luogu-T47720」孤立元","date":"2018-09-27T06:29:56.000Z","mathjax":true,"_content":"[传送门](https://www.luogu.org/problemnew/show/T47720)\n\n<!-- more -->\n\n自己出的第一道~~毒瘤~~数论题。\n\n对于每一个$i(1<i<n)$，如果它成为了孤立元，那么一定有$i-1\\notin B$且$i+1\\notin B$，而其他$n-3$个数无论怎样都无法阻止$i$对所有孤立元的和产生贡献，此时，其他$n-3$个数中有且仅有$m-1$个属于$B$，其总方案数为$C_{n-3}^{m-1}$。而对于$1$和$n$来说，它们只有$1$个相邻的元素，因此方案数为$C_{n-2}^{m-1}$。本题答案即为\n\n$$\\frac{\\sum_{i=2}^{n-1}iC_{n-3}^{m-1}+(n+1)C_{n-2}^{m-1}}{C_{n}^{m}}$$\n\n将这个式子进行一系列惨无人道的化简与整理后，我们得到如下形式\n\n$$\\frac{m(n+1)(n-m)(n-m-1)}{2n(n-1)}+\\frac{m(n+1)(n-m)}{n(n-1)}$$\n\n> $\\text{Updated on 2018-10-10}$：\n> \n> 之前公式写错了，分子上的$m$全都漏掉了（\n> \n> 以及，我们还可以将上式继续整理：\n> \n> $$\\frac{m(n+1)(n-m)(n-m+1)}{2n(n-1)}$$\n> \n> ~~以及，顺便测试了一下新的快读板子，然后发现`#ifdef`真没用也可能是我太菜了（~~\n> \n> > $\\text{Updated on 2018-10-16}$：\n> > \n> > 好吧我当时并不会用`#ifdef`（\n> \n> 以及，标程经过一系列~~丧心病狂的~~卡常卡到了$1861\\text{ms}$，最慢的一个点只跑了$300\\text{ms}$不到。截至本日，另外两个切掉这道题的$\\text{dalao}$最慢的一个点也只跑了$400\\text{ms}$上下。我要不要考虑加强一波数据或者缩一波时限呢？~~所以说为什么我当初在本地测的时候平均每个点$500\\text{ms}$，是我们机房的电脑太菜了吗（~~\n\n于是做法就有了，先$O(n)$预处理一遍，然后单次询问即可$O(1)$解决。\n\n但是常数好像会很大，我原计划是要将数据范围开到$10^{7}$级别的，然而自己写的标程都跑不过，于是只能一路削到现在的$10^{6}$……\n","source":"_posts/2018-09-27-luogu-t47720-solution.md","raw":"---\ntitle: 「Luogu-T47720」孤立元\ndate: 2018-09-27 14:29:56\ntags:\n  - 数论\n  - 组合数学\n  - 期望\ncategories:\n  - 题解\nmathjax: true\n---\n[传送门](https://www.luogu.org/problemnew/show/T47720)\n\n<!-- more -->\n\n自己出的第一道~~毒瘤~~数论题。\n\n对于每一个$i(1<i<n)$，如果它成为了孤立元，那么一定有$i-1\\notin B$且$i+1\\notin B$，而其他$n-3$个数无论怎样都无法阻止$i$对所有孤立元的和产生贡献，此时，其他$n-3$个数中有且仅有$m-1$个属于$B$，其总方案数为$C_{n-3}^{m-1}$。而对于$1$和$n$来说，它们只有$1$个相邻的元素，因此方案数为$C_{n-2}^{m-1}$。本题答案即为\n\n$$\\frac{\\sum_{i=2}^{n-1}iC_{n-3}^{m-1}+(n+1)C_{n-2}^{m-1}}{C_{n}^{m}}$$\n\n将这个式子进行一系列惨无人道的化简与整理后，我们得到如下形式\n\n$$\\frac{m(n+1)(n-m)(n-m-1)}{2n(n-1)}+\\frac{m(n+1)(n-m)}{n(n-1)}$$\n\n> $\\text{Updated on 2018-10-10}$：\n> \n> 之前公式写错了，分子上的$m$全都漏掉了（\n> \n> 以及，我们还可以将上式继续整理：\n> \n> $$\\frac{m(n+1)(n-m)(n-m+1)}{2n(n-1)}$$\n> \n> ~~以及，顺便测试了一下新的快读板子，然后发现`#ifdef`真没用也可能是我太菜了（~~\n> \n> > $\\text{Updated on 2018-10-16}$：\n> > \n> > 好吧我当时并不会用`#ifdef`（\n> \n> 以及，标程经过一系列~~丧心病狂的~~卡常卡到了$1861\\text{ms}$，最慢的一个点只跑了$300\\text{ms}$不到。截至本日，另外两个切掉这道题的$\\text{dalao}$最慢的一个点也只跑了$400\\text{ms}$上下。我要不要考虑加强一波数据或者缩一波时限呢？~~所以说为什么我当初在本地测的时候平均每个点$500\\text{ms}$，是我们机房的电脑太菜了吗（~~\n\n于是做法就有了，先$O(n)$预处理一遍，然后单次询问即可$O(1)$解决。\n\n但是常数好像会很大，我原计划是要将数据范围开到$10^{7}$级别的，然而自己写的标程都跑不过，于是只能一路削到现在的$10^{6}$……\n","slug":"luogu-t47720-solution","published":1,"updated":"2018-12-12T02:05:26.495Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjpn8w5ql0003roguntequ2fa","content":"<p><a href=\"https://www.luogu.org/problemnew/show/T47720\" target=\"_blank\" rel=\"noopener\">传送门</a></p>\n<a id=\"more\"></a>\n<p>自己出的第一道<del>毒瘤</del>数论题。</p>\n<p>对于每一个$i(1&lt;i&lt;n)$，如果它成为了孤立元，那么一定有$i-1\\notin B$且$i+1\\notin B$，而其他$n-3$个数无论怎样都无法阻止$i$对所有孤立元的和产生贡献，此时，其他$n-3$个数中有且仅有$m-1$个属于$B$，其总方案数为$C_{n-3}^{m-1}$。而对于$1$和$n$来说，它们只有$1$个相邻的元素，因此方案数为$C_{n-2}^{m-1}$。本题答案即为</p>\n<script type=\"math/tex; mode=display\">\\frac{\\sum_{i=2}^{n-1}iC_{n-3}^{m-1}+(n+1)C_{n-2}^{m-1}}{C_{n}^{m}}</script><p>将这个式子进行一系列惨无人道的化简与整理后，我们得到如下形式</p>\n<script type=\"math/tex; mode=display\">\\frac{m(n+1)(n-m)(n-m-1)}{2n(n-1)}+\\frac{m(n+1)(n-m)}{n(n-1)}</script><blockquote>\n<p>$\\text{Updated on 2018-10-10}$：</p>\n<p>之前公式写错了，分子上的$m$全都漏掉了（</p>\n<p>以及，我们还可以将上式继续整理：</p>\n<script type=\"math/tex; mode=display\">\\frac{m(n+1)(n-m)(n-m+1)}{2n(n-1)}</script><p><del>以及，顺便测试了一下新的快读板子，然后发现<code>#ifdef</code>真没用也可能是我太菜了（</del></p>\n<blockquote>\n<p>$\\text{Updated on 2018-10-16}$：</p>\n<p>好吧我当时并不会用<code>#ifdef</code>（</p>\n</blockquote>\n<p>以及，标程经过一系列<del>丧心病狂的</del>卡常卡到了$1861\\text{ms}$，最慢的一个点只跑了$300\\text{ms}$不到。截至本日，另外两个切掉这道题的$\\text{dalao}$最慢的一个点也只跑了$400\\text{ms}$上下。我要不要考虑加强一波数据或者缩一波时限呢？<del>所以说为什么我当初在本地测的时候平均每个点$500\\text{ms}$，是我们机房的电脑太菜了吗（</del></p>\n</blockquote>\n<p>于是做法就有了，先$O(n)$预处理一遍，然后单次询问即可$O(1)$解决。</p>\n<p>但是常数好像会很大，我原计划是要将数据范围开到$10^{7}$级别的，然而自己写的标程都跑不过，于是只能一路削到现在的$10^{6}$……</p>\n","site":{"data":{}},"excerpt":"<p><a href=\"https://www.luogu.org/problemnew/show/T47720\" target=\"_blank\" rel=\"noopener\">传送门</a></p>","more":"<p>自己出的第一道<del>毒瘤</del>数论题。</p>\n<p>对于每一个$i(1&lt;i&lt;n)$，如果它成为了孤立元，那么一定有$i-1\\notin B$且$i+1\\notin B$，而其他$n-3$个数无论怎样都无法阻止$i$对所有孤立元的和产生贡献，此时，其他$n-3$个数中有且仅有$m-1$个属于$B$，其总方案数为$C_{n-3}^{m-1}$。而对于$1$和$n$来说，它们只有$1$个相邻的元素，因此方案数为$C_{n-2}^{m-1}$。本题答案即为</p>\n<script type=\"math/tex; mode=display\">\\frac{\\sum_{i=2}^{n-1}iC_{n-3}^{m-1}+(n+1)C_{n-2}^{m-1}}{C_{n}^{m}}</script><p>将这个式子进行一系列惨无人道的化简与整理后，我们得到如下形式</p>\n<script type=\"math/tex; mode=display\">\\frac{m(n+1)(n-m)(n-m-1)}{2n(n-1)}+\\frac{m(n+1)(n-m)}{n(n-1)}</script><blockquote>\n<p>$\\text{Updated on 2018-10-10}$：</p>\n<p>之前公式写错了，分子上的$m$全都漏掉了（</p>\n<p>以及，我们还可以将上式继续整理：</p>\n<script type=\"math/tex; mode=display\">\\frac{m(n+1)(n-m)(n-m+1)}{2n(n-1)}</script><p><del>以及，顺便测试了一下新的快读板子，然后发现<code>#ifdef</code>真没用也可能是我太菜了（</del></p>\n<blockquote>\n<p>$\\text{Updated on 2018-10-16}$：</p>\n<p>好吧我当时并不会用<code>#ifdef</code>（</p>\n</blockquote>\n<p>以及，标程经过一系列<del>丧心病狂的</del>卡常卡到了$1861\\text{ms}$，最慢的一个点只跑了$300\\text{ms}$不到。截至本日，另外两个切掉这道题的$\\text{dalao}$最慢的一个点也只跑了$400\\text{ms}$上下。我要不要考虑加强一波数据或者缩一波时限呢？<del>所以说为什么我当初在本地测的时候平均每个点$500\\text{ms}$，是我们机房的电脑太菜了吗（</del></p>\n</blockquote>\n<p>于是做法就有了，先$O(n)$预处理一遍，然后单次询问即可$O(1)$解决。</p>\n<p>但是常数好像会很大，我原计划是要将数据范围开到$10^{7}$级别的，然而自己写的标程都跑不过，于是只能一路削到现在的$10^{6}$……</p>"},{"title":"「Luogu-P3924」康娜的线段树","date":"2018-09-29T08:20:16.000Z","mathjax":true,"_content":"[传送门](https://www.luogu.org/problemnew/show/P3924)\n\n<!-- more -->\n\n读完题目以后，首先一种简单的想法就是建一颗线段树然后模拟，每个节点维护它所管理的区间内所有数的和以及他自身被访问的概率，以及它和它的子树内所有节点的前两个属性的乘积之和。然后你再一看数据范围：\n\n> 对于$70\\%$的数据，保证$1\\leqslant n,m\\leqslant 10^{5}$。\n> \n> 对于$100\\%$的数据，保证$1\\leqslant n,m\\leqslant 10^{6}$。\n\n~~也就是说，上述做法__最多__只能拿$70$分。为什么说「最多」呢？因为这道题在中间运算过程中需要使用浮点数，而浮点数是自带大常数的，如果你的程序写得再丑一点常数再大一点，说不定$70$分都拿不到了。~~\n\n> $\\text{Updated on 2018-10-09}$：\n> \n> 不好意思时间复杂度算错了我太菜了。\n> \n> 但反正线段树需要卡常才能过（\n\n我们来想办法优化。考虑到，对于线段树的每一个非叶子节点，它所维护的区间和也只是原序列中某一段数字的和，如果我们能把这些节点被访问的概率下推到它的每一个叶子节点，也许就能达到优化的目的。\n\n定义$E_i$为叶子节点$[i,i]$对答案的贡献，$c_i$为其所有祖先节点被访问的概率之和，不难发现$c_ia_i=E_i$。我们只要预处理出$c_i$，计算出$\\prod_{i=1}^{n}c_ia_i$，然后处理出$c_i$的前缀和，每次操作直接查询操作区间内$c_i$的和，再乘以他给的那个数，累加到答案上就可以了。\n\n稍加分析，我们不难得出如下结论。设根节点深度为$0$，则任意一个节点，就比如说$x$，被访问的概率为$2^{-dep[x]}$，其中$dep[x]$表示$x$的深度。而对于$x$子树内的每一个叶子节点$[i,i]$，我们执行一次$c_i+=2^{-dep[x]}$即可。我们可以用一次类似于树形$DP$的$DFS$来完成这一过程。需要注意的是，我们肯定不能暴力枚举所有叶子节点，在$DFS$时，我们实际上修改的是$c$数组的差分数组，$DFS$结束后再还原出$c$数组即可。\n\n以及，最后一句话。\n\n这道题卡精度。","source":"_posts/2018-09-29-luogu-p3924-solution.md","raw":"---\ntitle: 「Luogu-P3924」康娜的线段树\ndate: 2018-09-29 16:20:16\ntags:\n  - 洛谷\n  - 差分\ncategories:\n  - 题解\nmathjax: true\n---\n[传送门](https://www.luogu.org/problemnew/show/P3924)\n\n<!-- more -->\n\n读完题目以后，首先一种简单的想法就是建一颗线段树然后模拟，每个节点维护它所管理的区间内所有数的和以及他自身被访问的概率，以及它和它的子树内所有节点的前两个属性的乘积之和。然后你再一看数据范围：\n\n> 对于$70\\%$的数据，保证$1\\leqslant n,m\\leqslant 10^{5}$。\n> \n> 对于$100\\%$的数据，保证$1\\leqslant n,m\\leqslant 10^{6}$。\n\n~~也就是说，上述做法__最多__只能拿$70$分。为什么说「最多」呢？因为这道题在中间运算过程中需要使用浮点数，而浮点数是自带大常数的，如果你的程序写得再丑一点常数再大一点，说不定$70$分都拿不到了。~~\n\n> $\\text{Updated on 2018-10-09}$：\n> \n> 不好意思时间复杂度算错了我太菜了。\n> \n> 但反正线段树需要卡常才能过（\n\n我们来想办法优化。考虑到，对于线段树的每一个非叶子节点，它所维护的区间和也只是原序列中某一段数字的和，如果我们能把这些节点被访问的概率下推到它的每一个叶子节点，也许就能达到优化的目的。\n\n定义$E_i$为叶子节点$[i,i]$对答案的贡献，$c_i$为其所有祖先节点被访问的概率之和，不难发现$c_ia_i=E_i$。我们只要预处理出$c_i$，计算出$\\prod_{i=1}^{n}c_ia_i$，然后处理出$c_i$的前缀和，每次操作直接查询操作区间内$c_i$的和，再乘以他给的那个数，累加到答案上就可以了。\n\n稍加分析，我们不难得出如下结论。设根节点深度为$0$，则任意一个节点，就比如说$x$，被访问的概率为$2^{-dep[x]}$，其中$dep[x]$表示$x$的深度。而对于$x$子树内的每一个叶子节点$[i,i]$，我们执行一次$c_i+=2^{-dep[x]}$即可。我们可以用一次类似于树形$DP$的$DFS$来完成这一过程。需要注意的是，我们肯定不能暴力枚举所有叶子节点，在$DFS$时，我们实际上修改的是$c$数组的差分数组，$DFS$结束后再还原出$c$数组即可。\n\n以及，最后一句话。\n\n这道题卡精度。","slug":"luogu-p3924-solution","published":1,"updated":"2018-12-12T02:04:08.006Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjpn8w5qo0006roguumr2uug0","content":"<p><a href=\"https://www.luogu.org/problemnew/show/P3924\" target=\"_blank\" rel=\"noopener\">传送门</a></p>\n<a id=\"more\"></a>\n<p>读完题目以后，首先一种简单的想法就是建一颗线段树然后模拟，每个节点维护它所管理的区间内所有数的和以及他自身被访问的概率，以及它和它的子树内所有节点的前两个属性的乘积之和。然后你再一看数据范围：</p>\n<blockquote>\n<p>对于$70\\%$的数据，保证$1\\leqslant n,m\\leqslant 10^{5}$。</p>\n<p>对于$100\\%$的数据，保证$1\\leqslant n,m\\leqslant 10^{6}$。</p>\n</blockquote>\n<p><del>也就是说，上述做法<strong>最多</strong>只能拿$70$分。为什么说「最多」呢？因为这道题在中间运算过程中需要使用浮点数，而浮点数是自带大常数的，如果你的程序写得再丑一点常数再大一点，说不定$70$分都拿不到了。</del></p>\n<blockquote>\n<p>$\\text{Updated on 2018-10-09}$：</p>\n<p>不好意思时间复杂度算错了我太菜了。</p>\n<p>但反正线段树需要卡常才能过（</p>\n</blockquote>\n<p>我们来想办法优化。考虑到，对于线段树的每一个非叶子节点，它所维护的区间和也只是原序列中某一段数字的和，如果我们能把这些节点被访问的概率下推到它的每一个叶子节点，也许就能达到优化的目的。</p>\n<p>定义$E_i$为叶子节点$[i,i]$对答案的贡献，$c_i$为其所有祖先节点被访问的概率之和，不难发现$c_ia_i=E_i$。我们只要预处理出$c_i$，计算出$\\prod_{i=1}^{n}c_ia_i$，然后处理出$c_i$的前缀和，每次操作直接查询操作区间内$c_i$的和，再乘以他给的那个数，累加到答案上就可以了。</p>\n<p>稍加分析，我们不难得出如下结论。设根节点深度为$0$，则任意一个节点，就比如说$x$，被访问的概率为$2^{-dep[x]}$，其中$dep[x]$表示$x$的深度。而对于$x$子树内的每一个叶子节点$[i,i]$，我们执行一次$c_i+=2^{-dep[x]}$即可。我们可以用一次类似于树形$DP$的$DFS$来完成这一过程。需要注意的是，我们肯定不能暴力枚举所有叶子节点，在$DFS$时，我们实际上修改的是$c$数组的差分数组，$DFS$结束后再还原出$c$数组即可。</p>\n<p>以及，最后一句话。</p>\n<p>这道题卡精度。</p>\n","site":{"data":{}},"excerpt":"<p><a href=\"https://www.luogu.org/problemnew/show/P3924\" target=\"_blank\" rel=\"noopener\">传送门</a></p>","more":"<p>读完题目以后，首先一种简单的想法就是建一颗线段树然后模拟，每个节点维护它所管理的区间内所有数的和以及他自身被访问的概率，以及它和它的子树内所有节点的前两个属性的乘积之和。然后你再一看数据范围：</p>\n<blockquote>\n<p>对于$70\\%$的数据，保证$1\\leqslant n,m\\leqslant 10^{5}$。</p>\n<p>对于$100\\%$的数据，保证$1\\leqslant n,m\\leqslant 10^{6}$。</p>\n</blockquote>\n<p><del>也就是说，上述做法<strong>最多</strong>只能拿$70$分。为什么说「最多」呢？因为这道题在中间运算过程中需要使用浮点数，而浮点数是自带大常数的，如果你的程序写得再丑一点常数再大一点，说不定$70$分都拿不到了。</del></p>\n<blockquote>\n<p>$\\text{Updated on 2018-10-09}$：</p>\n<p>不好意思时间复杂度算错了我太菜了。</p>\n<p>但反正线段树需要卡常才能过（</p>\n</blockquote>\n<p>我们来想办法优化。考虑到，对于线段树的每一个非叶子节点，它所维护的区间和也只是原序列中某一段数字的和，如果我们能把这些节点被访问的概率下推到它的每一个叶子节点，也许就能达到优化的目的。</p>\n<p>定义$E_i$为叶子节点$[i,i]$对答案的贡献，$c_i$为其所有祖先节点被访问的概率之和，不难发现$c_ia_i=E_i$。我们只要预处理出$c_i$，计算出$\\prod_{i=1}^{n}c_ia_i$，然后处理出$c_i$的前缀和，每次操作直接查询操作区间内$c_i$的和，再乘以他给的那个数，累加到答案上就可以了。</p>\n<p>稍加分析，我们不难得出如下结论。设根节点深度为$0$，则任意一个节点，就比如说$x$，被访问的概率为$2^{-dep[x]}$，其中$dep[x]$表示$x$的深度。而对于$x$子树内的每一个叶子节点$[i,i]$，我们执行一次$c_i+=2^{-dep[x]}$即可。我们可以用一次类似于树形$DP$的$DFS$来完成这一过程。需要注意的是，我们肯定不能暴力枚举所有叶子节点，在$DFS$时，我们实际上修改的是$c$数组的差分数组，$DFS$结束后再还原出$c$数组即可。</p>\n<p>以及，最后一句话。</p>\n<p>这道题卡精度。</p>"},{"title":"「Luogu-P4900」食堂","date":"2018-10-04T04:11:18.000Z","mathjax":true,"_content":"[传送门](https://www.luogu.org/problemnew/show/P4900)\n\n<!-- more -->\n\n~~闲着没事写篇题解（~~\n\n简单来说，就是要求\n\n$$\\sum\\limits_{i=A}^{B}\\sum\\limits_{j=1}^{i}\\lbrace\\frac{i}{j}\\rbrace\\pmod{998244353}$$\n\n其中$\\lbrace x\\rbrace$表示取$x$的小数部分。\n\n稍加思索，我们不难发现\n\n$$\\begin{aligned}\n&\\sum\\limits_{i=A}^{B}\\sum\\limits_{j=1}^{i}\\lbrace\\frac{i}{j}\\rbrace\\\\\n\\equiv&\\sum\\limits_{i=A}^{B}\\sum\\limits_{j=1}^{i}i\\%j\\times j^{-1}\\\\\n\\equiv&\\sum\\limits_{i=1}^{B}\\sum\\limits_{j=1}^{i}i\\%j\\times j^{-1}-\\sum\\limits_{i=1}^{A-1}\\sum\\limits_{j=1}^{i}i\\%j\\times j^{-1}\n\\pmod{998244353}\n\\end{aligned}$$\n\n因此，我们只需要关注下式的值\n\n$$\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{i}i\\%j\\times j^{-1}\\pmod{998244353}$$\n\n我们可以参考一下[这道题](https://www.luogu.org/problemnew/show/P3708)\n\n在这道题中，我们定义了\n\n$$f(x)=\\sum\\limits_{i=1}^{n}x\\%i$$\n\n首先，如果不考虑$x\\%i=0$的情况，我们有\n\n$$x\\%i=(x-1)\\%i+1$$\n\n$$f(x)=f(x-1)+n$$\n\n如果$x\\%i=0$，我们需要从$f(x)$中减去$i$，而所有满足该条件的$i$的和就是$x$的约数和，因此\n\n$$f(x)=f(x-1)+n-\\sigma(x)$$\n\n我们可以类似地定义\n\n$$g(x)=\\sum\\limits_{i=1}^{n}x\\%i\\times i^{-1}\\pmod{998244353}$$\n\n$$h(x)=\\sum\\limits_{i\\mid x}i\\times i^{-1}\\equiv\\sum\\limits_{i\\mid x}1\\equiv d(x)\\pmod{998244353}$$\n\n从而我们有\n\n$$g(x)\\equiv g(x-1)+\\sum\\limits_{i=1}^{n}i^{-1}-d(x)\\pmod{998244353}$$\n\n然而我们需要的是\n\n$$\\sum\\limits_{i=1}^{n}ans(i)\\pmod{998244353}$$\n\n其中\n\n$$ans(x)=\\sum\\limits_{i=1}^{x}x\\%i\\times i^{-1}\\pmod{998244353}$$\n\n不难发现当$i<j$时$i\\%j=i$，从而\n\n$$\\begin{aligned}\n&g(x)-ans(x)\\\\\n\\equiv&\\sum\\limits_{i=x+1}^{n}x\\%i\\times i^{-1}\\\\\n\\equiv&\\sum\\limits_{i=x+1}^{n}x\\times i^{-1}\n\\pmod{998244353}\n\\end{aligned}$$\n\n最终，我们得到\n\n$$ans(x)\\equiv g(x)-x\\sum\\limits_{i=x+1}^{n}i^{-1}$$\n\n$$\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{i}i\\%j\\times j^{-1}\\equiv\\sum\\limits_{i=1}^{n}ans(i)\\pmod{998244353}$$\n\n把上面这一坨东西预处理出来，我们就可以$O(1)$地处理所有询问了。","source":"_posts/2018-10-04-luogu-p4900-solution.md","raw":"---\ntitle: 「Luogu-P4900」食堂\ndate: 2018-10-04 12:11:18\ntags:\n  - 洛谷\n  - 数论\ncategories:\n  - 题解\nmathjax: true\n---\n[传送门](https://www.luogu.org/problemnew/show/P4900)\n\n<!-- more -->\n\n~~闲着没事写篇题解（~~\n\n简单来说，就是要求\n\n$$\\sum\\limits_{i=A}^{B}\\sum\\limits_{j=1}^{i}\\lbrace\\frac{i}{j}\\rbrace\\pmod{998244353}$$\n\n其中$\\lbrace x\\rbrace$表示取$x$的小数部分。\n\n稍加思索，我们不难发现\n\n$$\\begin{aligned}\n&\\sum\\limits_{i=A}^{B}\\sum\\limits_{j=1}^{i}\\lbrace\\frac{i}{j}\\rbrace\\\\\n\\equiv&\\sum\\limits_{i=A}^{B}\\sum\\limits_{j=1}^{i}i\\%j\\times j^{-1}\\\\\n\\equiv&\\sum\\limits_{i=1}^{B}\\sum\\limits_{j=1}^{i}i\\%j\\times j^{-1}-\\sum\\limits_{i=1}^{A-1}\\sum\\limits_{j=1}^{i}i\\%j\\times j^{-1}\n\\pmod{998244353}\n\\end{aligned}$$\n\n因此，我们只需要关注下式的值\n\n$$\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{i}i\\%j\\times j^{-1}\\pmod{998244353}$$\n\n我们可以参考一下[这道题](https://www.luogu.org/problemnew/show/P3708)\n\n在这道题中，我们定义了\n\n$$f(x)=\\sum\\limits_{i=1}^{n}x\\%i$$\n\n首先，如果不考虑$x\\%i=0$的情况，我们有\n\n$$x\\%i=(x-1)\\%i+1$$\n\n$$f(x)=f(x-1)+n$$\n\n如果$x\\%i=0$，我们需要从$f(x)$中减去$i$，而所有满足该条件的$i$的和就是$x$的约数和，因此\n\n$$f(x)=f(x-1)+n-\\sigma(x)$$\n\n我们可以类似地定义\n\n$$g(x)=\\sum\\limits_{i=1}^{n}x\\%i\\times i^{-1}\\pmod{998244353}$$\n\n$$h(x)=\\sum\\limits_{i\\mid x}i\\times i^{-1}\\equiv\\sum\\limits_{i\\mid x}1\\equiv d(x)\\pmod{998244353}$$\n\n从而我们有\n\n$$g(x)\\equiv g(x-1)+\\sum\\limits_{i=1}^{n}i^{-1}-d(x)\\pmod{998244353}$$\n\n然而我们需要的是\n\n$$\\sum\\limits_{i=1}^{n}ans(i)\\pmod{998244353}$$\n\n其中\n\n$$ans(x)=\\sum\\limits_{i=1}^{x}x\\%i\\times i^{-1}\\pmod{998244353}$$\n\n不难发现当$i<j$时$i\\%j=i$，从而\n\n$$\\begin{aligned}\n&g(x)-ans(x)\\\\\n\\equiv&\\sum\\limits_{i=x+1}^{n}x\\%i\\times i^{-1}\\\\\n\\equiv&\\sum\\limits_{i=x+1}^{n}x\\times i^{-1}\n\\pmod{998244353}\n\\end{aligned}$$\n\n最终，我们得到\n\n$$ans(x)\\equiv g(x)-x\\sum\\limits_{i=x+1}^{n}i^{-1}$$\n\n$$\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{i}i\\%j\\times j^{-1}\\equiv\\sum\\limits_{i=1}^{n}ans(i)\\pmod{998244353}$$\n\n把上面这一坨东西预处理出来，我们就可以$O(1)$地处理所有询问了。","slug":"luogu-p4900-solution","published":1,"updated":"2018-12-12T02:04:37.245Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjpn8w5qp0007roguuvouxbeu","content":"<p><a href=\"https://www.luogu.org/problemnew/show/P4900\" target=\"_blank\" rel=\"noopener\">传送门</a></p>\n<a id=\"more\"></a>\n<p><del>闲着没事写篇题解（</del></p>\n<p>简单来说，就是要求</p>\n<script type=\"math/tex; mode=display\">\\sum\\limits_{i=A}^{B}\\sum\\limits_{j=1}^{i}\\lbrace\\frac{i}{j}\\rbrace\\pmod{998244353}</script><p>其中$\\lbrace x\\rbrace$表示取$x$的小数部分。</p>\n<p>稍加思索，我们不难发现</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\n&\\sum\\limits_{i=A}^{B}\\sum\\limits_{j=1}^{i}\\lbrace\\frac{i}{j}\\rbrace\\\\\n\\equiv&\\sum\\limits_{i=A}^{B}\\sum\\limits_{j=1}^{i}i\\%j\\times j^{-1}\\\\\n\\equiv&\\sum\\limits_{i=1}^{B}\\sum\\limits_{j=1}^{i}i\\%j\\times j^{-1}-\\sum\\limits_{i=1}^{A-1}\\sum\\limits_{j=1}^{i}i\\%j\\times j^{-1}\n\\pmod{998244353}\n\\end{aligned}</script><p>因此，我们只需要关注下式的值</p>\n<script type=\"math/tex; mode=display\">\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{i}i\\%j\\times j^{-1}\\pmod{998244353}</script><p>我们可以参考一下<a href=\"https://www.luogu.org/problemnew/show/P3708\" target=\"_blank\" rel=\"noopener\">这道题</a></p>\n<p>在这道题中，我们定义了</p>\n<script type=\"math/tex; mode=display\">f(x)=\\sum\\limits_{i=1}^{n}x\\%i</script><p>首先，如果不考虑$x\\%i=0$的情况，我们有</p>\n<script type=\"math/tex; mode=display\">x\\%i=(x-1)\\%i+1</script><script type=\"math/tex; mode=display\">f(x)=f(x-1)+n</script><p>如果$x\\%i=0$，我们需要从$f(x)$中减去$i$，而所有满足该条件的$i$的和就是$x$的约数和，因此</p>\n<script type=\"math/tex; mode=display\">f(x)=f(x-1)+n-\\sigma(x)</script><p>我们可以类似地定义</p>\n<script type=\"math/tex; mode=display\">g(x)=\\sum\\limits_{i=1}^{n}x\\%i\\times i^{-1}\\pmod{998244353}</script><script type=\"math/tex; mode=display\">h(x)=\\sum\\limits_{i\\mid x}i\\times i^{-1}\\equiv\\sum\\limits_{i\\mid x}1\\equiv d(x)\\pmod{998244353}</script><p>从而我们有</p>\n<script type=\"math/tex; mode=display\">g(x)\\equiv g(x-1)+\\sum\\limits_{i=1}^{n}i^{-1}-d(x)\\pmod{998244353}</script><p>然而我们需要的是</p>\n<script type=\"math/tex; mode=display\">\\sum\\limits_{i=1}^{n}ans(i)\\pmod{998244353}</script><p>其中</p>\n<script type=\"math/tex; mode=display\">ans(x)=\\sum\\limits_{i=1}^{x}x\\%i\\times i^{-1}\\pmod{998244353}</script><p>不难发现当$i&lt;j$时$i\\%j=i$，从而</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\n&g(x)-ans(x)\\\\\n\\equiv&\\sum\\limits_{i=x+1}^{n}x\\%i\\times i^{-1}\\\\\n\\equiv&\\sum\\limits_{i=x+1}^{n}x\\times i^{-1}\n\\pmod{998244353}\n\\end{aligned}</script><p>最终，我们得到</p>\n<script type=\"math/tex; mode=display\">ans(x)\\equiv g(x)-x\\sum\\limits_{i=x+1}^{n}i^{-1}</script><script type=\"math/tex; mode=display\">\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{i}i\\%j\\times j^{-1}\\equiv\\sum\\limits_{i=1}^{n}ans(i)\\pmod{998244353}</script><p>把上面这一坨东西预处理出来，我们就可以$O(1)$地处理所有询问了。</p>\n","site":{"data":{}},"excerpt":"<p><a href=\"https://www.luogu.org/problemnew/show/P4900\" target=\"_blank\" rel=\"noopener\">传送门</a></p>","more":"<p><del>闲着没事写篇题解（</del></p>\n<p>简单来说，就是要求</p>\n<script type=\"math/tex; mode=display\">\\sum\\limits_{i=A}^{B}\\sum\\limits_{j=1}^{i}\\lbrace\\frac{i}{j}\\rbrace\\pmod{998244353}</script><p>其中$\\lbrace x\\rbrace$表示取$x$的小数部分。</p>\n<p>稍加思索，我们不难发现</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\n&\\sum\\limits_{i=A}^{B}\\sum\\limits_{j=1}^{i}\\lbrace\\frac{i}{j}\\rbrace\\\\\n\\equiv&\\sum\\limits_{i=A}^{B}\\sum\\limits_{j=1}^{i}i\\%j\\times j^{-1}\\\\\n\\equiv&\\sum\\limits_{i=1}^{B}\\sum\\limits_{j=1}^{i}i\\%j\\times j^{-1}-\\sum\\limits_{i=1}^{A-1}\\sum\\limits_{j=1}^{i}i\\%j\\times j^{-1}\n\\pmod{998244353}\n\\end{aligned}</script><p>因此，我们只需要关注下式的值</p>\n<script type=\"math/tex; mode=display\">\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{i}i\\%j\\times j^{-1}\\pmod{998244353}</script><p>我们可以参考一下<a href=\"https://www.luogu.org/problemnew/show/P3708\" target=\"_blank\" rel=\"noopener\">这道题</a></p>\n<p>在这道题中，我们定义了</p>\n<script type=\"math/tex; mode=display\">f(x)=\\sum\\limits_{i=1}^{n}x\\%i</script><p>首先，如果不考虑$x\\%i=0$的情况，我们有</p>\n<script type=\"math/tex; mode=display\">x\\%i=(x-1)\\%i+1</script><script type=\"math/tex; mode=display\">f(x)=f(x-1)+n</script><p>如果$x\\%i=0$，我们需要从$f(x)$中减去$i$，而所有满足该条件的$i$的和就是$x$的约数和，因此</p>\n<script type=\"math/tex; mode=display\">f(x)=f(x-1)+n-\\sigma(x)</script><p>我们可以类似地定义</p>\n<script type=\"math/tex; mode=display\">g(x)=\\sum\\limits_{i=1}^{n}x\\%i\\times i^{-1}\\pmod{998244353}</script><script type=\"math/tex; mode=display\">h(x)=\\sum\\limits_{i\\mid x}i\\times i^{-1}\\equiv\\sum\\limits_{i\\mid x}1\\equiv d(x)\\pmod{998244353}</script><p>从而我们有</p>\n<script type=\"math/tex; mode=display\">g(x)\\equiv g(x-1)+\\sum\\limits_{i=1}^{n}i^{-1}-d(x)\\pmod{998244353}</script><p>然而我们需要的是</p>\n<script type=\"math/tex; mode=display\">\\sum\\limits_{i=1}^{n}ans(i)\\pmod{998244353}</script><p>其中</p>\n<script type=\"math/tex; mode=display\">ans(x)=\\sum\\limits_{i=1}^{x}x\\%i\\times i^{-1}\\pmod{998244353}</script><p>不难发现当$i&lt;j$时$i\\%j=i$，从而</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\n&g(x)-ans(x)\\\\\n\\equiv&\\sum\\limits_{i=x+1}^{n}x\\%i\\times i^{-1}\\\\\n\\equiv&\\sum\\limits_{i=x+1}^{n}x\\times i^{-1}\n\\pmod{998244353}\n\\end{aligned}</script><p>最终，我们得到</p>\n<script type=\"math/tex; mode=display\">ans(x)\\equiv g(x)-x\\sum\\limits_{i=x+1}^{n}i^{-1}</script><script type=\"math/tex; mode=display\">\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{i}i\\%j\\times j^{-1}\\equiv\\sum\\limits_{i=1}^{n}ans(i)\\pmod{998244353}</script><p>把上面这一坨东西预处理出来，我们就可以$O(1)$地处理所有询问了。</p>"},{"title":"「SDOI2009」虔诚的墓主人","date":"2018-10-12T03:28:50.000Z","mathjax":true,"_content":"[传送门](https://www.luogu.org/problemnew/show/P2154)\n\n<!-- more -->\n\n几个月前某学姐给我推荐的~~毒瘤~~题之一。然而我直到现在也只切掉两道~~，我真是太菜了~~。\n\n首先，为了方便，我们将题目中所给的坐标系顺时针旋转一下，令正下为$x$轴正方向。我们先考虑单独一块墓地的虔诚度的计算。设其往左数有$L$棵常青树，往右数有$R$棵常青树，往上数有$U$棵常青树，往下数有$D$棵常青树，其虔诚度就是\n\n$$C_{L}^{k}C_{R}^{k}C_{U}^{k}C_{D}^{k}$$\n\n考虑到墓地不能和常青树重合，又有$k\\geqslant 1$，虔诚度为正的，也就是会对答案产生有效贡献的墓地，一定是在某几棵常青树之间。我们在读入时就可以统计出第$x$行，第$y$列上有多少棵常青树，分别记为$sumx[x]$，$sumy[y]$。然后我们令$x$坐标为第一关键字，$y$坐标为第二关键字，将所有常青树按坐标从小到大排序，然后按顺序遍历一遍。假设我们遍历到了第$i$棵常青树，记$cntx[x]$为前$i-1$棵常青树中第$x$行上有多少棵常青树，$cnty[y]$为前$i-1$棵常青树中第$y$列上有多少棵常青树，当前常青树坐标为$(x[i],y[i])$。如果$x[i]=x[i-1]$，则第$i$棵常青树与第$i-1$棵常青树之间就有可能有虔诚度为正的墓地。具体地，它们的虔诚度之和为\n\n$$C_{cntx[x[i]]}^{k}C_{sumx[x[i]]-cntx[x[i]]}^{k}(\\sum\\limits_{i=y[i-1]+1}^{y[i]-1}C_{cnty[i]}^{k}C_{sumy[i]-cnty[i]}^{k})$$\n\n怎么快速地查询与修改后面那个$\\Sigma$所涉及到的值？树状数组啊~~当然如果您非要写些乱七八糟的数据结构也没人拦着您~~。\n\n坐标范围很大，因此我们需要离散化。而且很明显地，没有常青树的行与列是不需要考虑的。\n\n```cpp\n#include<cstdio>\n\nstruct NOIp{\n    unsigned long long RP,score;\n};\nNOIp NOIp2018;\n\nint main(){\n    for(;;){\n        NOIp2018.RP++;\n        NOIp2018.score++;\n    }\n    return 0;\n}\n```\n\n以及，明天就是NOIp初赛了，在那之后三周就是复赛，我还不想退役啊~~但是我实在是太菜了~~qaq。","source":"_posts/2018-10-12-luogu-p2154-solution.md","raw":"---\ntitle: 「SDOI2009」虔诚的墓主人\ndate: 2018-10-12 11:28:50\ntags:\n  - SDOI\n  - 2009\n  - 离散化\n  - 树状数组\n  - 组合数学\ncategories:\n  - 题解\nmathjax: true\n---\n[传送门](https://www.luogu.org/problemnew/show/P2154)\n\n<!-- more -->\n\n几个月前某学姐给我推荐的~~毒瘤~~题之一。然而我直到现在也只切掉两道~~，我真是太菜了~~。\n\n首先，为了方便，我们将题目中所给的坐标系顺时针旋转一下，令正下为$x$轴正方向。我们先考虑单独一块墓地的虔诚度的计算。设其往左数有$L$棵常青树，往右数有$R$棵常青树，往上数有$U$棵常青树，往下数有$D$棵常青树，其虔诚度就是\n\n$$C_{L}^{k}C_{R}^{k}C_{U}^{k}C_{D}^{k}$$\n\n考虑到墓地不能和常青树重合，又有$k\\geqslant 1$，虔诚度为正的，也就是会对答案产生有效贡献的墓地，一定是在某几棵常青树之间。我们在读入时就可以统计出第$x$行，第$y$列上有多少棵常青树，分别记为$sumx[x]$，$sumy[y]$。然后我们令$x$坐标为第一关键字，$y$坐标为第二关键字，将所有常青树按坐标从小到大排序，然后按顺序遍历一遍。假设我们遍历到了第$i$棵常青树，记$cntx[x]$为前$i-1$棵常青树中第$x$行上有多少棵常青树，$cnty[y]$为前$i-1$棵常青树中第$y$列上有多少棵常青树，当前常青树坐标为$(x[i],y[i])$。如果$x[i]=x[i-1]$，则第$i$棵常青树与第$i-1$棵常青树之间就有可能有虔诚度为正的墓地。具体地，它们的虔诚度之和为\n\n$$C_{cntx[x[i]]}^{k}C_{sumx[x[i]]-cntx[x[i]]}^{k}(\\sum\\limits_{i=y[i-1]+1}^{y[i]-1}C_{cnty[i]}^{k}C_{sumy[i]-cnty[i]}^{k})$$\n\n怎么快速地查询与修改后面那个$\\Sigma$所涉及到的值？树状数组啊~~当然如果您非要写些乱七八糟的数据结构也没人拦着您~~。\n\n坐标范围很大，因此我们需要离散化。而且很明显地，没有常青树的行与列是不需要考虑的。\n\n```cpp\n#include<cstdio>\n\nstruct NOIp{\n    unsigned long long RP,score;\n};\nNOIp NOIp2018;\n\nint main(){\n    for(;;){\n        NOIp2018.RP++;\n        NOIp2018.score++;\n    }\n    return 0;\n}\n```\n\n以及，明天就是NOIp初赛了，在那之后三周就是复赛，我还不想退役啊~~但是我实在是太菜了~~qaq。","slug":"luogu-p2154-solution","published":1,"updated":"2018-12-12T02:06:49.568Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjpn8w5qr0008roguzuzyuq0u","content":"<p><a href=\"https://www.luogu.org/problemnew/show/P2154\" target=\"_blank\" rel=\"noopener\">传送门</a></p>\n<a id=\"more\"></a>\n<p>几个月前某学姐给我推荐的<del>毒瘤</del>题之一。然而我直到现在也只切掉两道<del>，我真是太菜了</del>。</p>\n<p>首先，为了方便，我们将题目中所给的坐标系顺时针旋转一下，令正下为$x$轴正方向。我们先考虑单独一块墓地的虔诚度的计算。设其往左数有$L$棵常青树，往右数有$R$棵常青树，往上数有$U$棵常青树，往下数有$D$棵常青树，其虔诚度就是</p>\n<script type=\"math/tex; mode=display\">C_{L}^{k}C_{R}^{k}C_{U}^{k}C_{D}^{k}</script><p>考虑到墓地不能和常青树重合，又有$k\\geqslant 1$，虔诚度为正的，也就是会对答案产生有效贡献的墓地，一定是在某几棵常青树之间。我们在读入时就可以统计出第$x$行，第$y$列上有多少棵常青树，分别记为$sumx[x]$，$sumy[y]$。然后我们令$x$坐标为第一关键字，$y$坐标为第二关键字，将所有常青树按坐标从小到大排序，然后按顺序遍历一遍。假设我们遍历到了第$i$棵常青树，记$cntx[x]$为前$i-1$棵常青树中第$x$行上有多少棵常青树，$cnty[y]$为前$i-1$棵常青树中第$y$列上有多少棵常青树，当前常青树坐标为$(x[i],y[i])$。如果$x[i]=x[i-1]$，则第$i$棵常青树与第$i-1$棵常青树之间就有可能有虔诚度为正的墓地。具体地，它们的虔诚度之和为</p>\n<script type=\"math/tex; mode=display\">C_{cntx[x[i]]}^{k}C_{sumx[x[i]]-cntx[x[i]]}^{k}(\\sum\\limits_{i=y[i-1]+1}^{y[i]-1}C_{cnty[i]}^{k}C_{sumy[i]-cnty[i]}^{k})</script><p>怎么快速地查询与修改后面那个$\\Sigma$所涉及到的值？树状数组啊<del>当然如果您非要写些乱七八糟的数据结构也没人拦着您</del>。</p>\n<p>坐标范围很大，因此我们需要离散化。而且很明显地，没有常青树的行与列是不需要考虑的。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">NOIp</span>&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> RP,score;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">NOIp NOIp2018;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(;;)&#123;</span><br><span class=\"line\">        NOIp2018.RP++;</span><br><span class=\"line\">        NOIp2018.score++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>以及，明天就是NOIp初赛了，在那之后三周就是复赛，我还不想退役啊<del>但是我实在是太菜了</del>qaq。</p>\n","site":{"data":{}},"excerpt":"<p><a href=\"https://www.luogu.org/problemnew/show/P2154\" target=\"_blank\" rel=\"noopener\">传送门</a></p>","more":"<p>几个月前某学姐给我推荐的<del>毒瘤</del>题之一。然而我直到现在也只切掉两道<del>，我真是太菜了</del>。</p>\n<p>首先，为了方便，我们将题目中所给的坐标系顺时针旋转一下，令正下为$x$轴正方向。我们先考虑单独一块墓地的虔诚度的计算。设其往左数有$L$棵常青树，往右数有$R$棵常青树，往上数有$U$棵常青树，往下数有$D$棵常青树，其虔诚度就是</p>\n<script type=\"math/tex; mode=display\">C_{L}^{k}C_{R}^{k}C_{U}^{k}C_{D}^{k}</script><p>考虑到墓地不能和常青树重合，又有$k\\geqslant 1$，虔诚度为正的，也就是会对答案产生有效贡献的墓地，一定是在某几棵常青树之间。我们在读入时就可以统计出第$x$行，第$y$列上有多少棵常青树，分别记为$sumx[x]$，$sumy[y]$。然后我们令$x$坐标为第一关键字，$y$坐标为第二关键字，将所有常青树按坐标从小到大排序，然后按顺序遍历一遍。假设我们遍历到了第$i$棵常青树，记$cntx[x]$为前$i-1$棵常青树中第$x$行上有多少棵常青树，$cnty[y]$为前$i-1$棵常青树中第$y$列上有多少棵常青树，当前常青树坐标为$(x[i],y[i])$。如果$x[i]=x[i-1]$，则第$i$棵常青树与第$i-1$棵常青树之间就有可能有虔诚度为正的墓地。具体地，它们的虔诚度之和为</p>\n<script type=\"math/tex; mode=display\">C_{cntx[x[i]]}^{k}C_{sumx[x[i]]-cntx[x[i]]}^{k}(\\sum\\limits_{i=y[i-1]+1}^{y[i]-1}C_{cnty[i]}^{k}C_{sumy[i]-cnty[i]}^{k})</script><p>怎么快速地查询与修改后面那个$\\Sigma$所涉及到的值？树状数组啊<del>当然如果您非要写些乱七八糟的数据结构也没人拦着您</del>。</p>\n<p>坐标范围很大，因此我们需要离散化。而且很明显地，没有常青树的行与列是不需要考虑的。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">NOIp</span>&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> RP,score;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">NOIp NOIp2018;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(;;)&#123;</span><br><span class=\"line\">        NOIp2018.RP++;</span><br><span class=\"line\">        NOIp2018.score++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>以及，明天就是NOIp初赛了，在那之后三周就是复赛，我还不想退役啊<del>但是我实在是太菜了</del>qaq。</p>"},{"title":"状态压缩动态规划学习笔记","date":"2018-10-24T13:24:05.000Z","mathjax":true,"_content":"~~把标签和分类连在一起读就是标题了（~~\n\n~~好像上一篇珂朵莉树学习笔记也是这样（~~\n\n~~马上就要复赛了，但反正我已经退役预定了来颓blog吧。~~\n\n<!-- more -->\n\n首先我们来看一道例题，[「USACO06NOV」玉米田Corn Fields](https://www.luogu.org/problemnew/show/P1879)。\n\n首先，我们想到定义`f[i][...]`表示当前处理到第$i$行，然后blablabla一堆状态的总方案数。既然任意两块草地之间不能有公共边，我们肯定需要记录第$i$行哪些地方种了草，哪些地方没种草。那么我们记录的状态就是……`f[i][0/1]...(省略10个[0/1])...[0/1]`，后面$12$维状态中第$j+1$维表示的是第$i$行第$j$列是否种草。\n\n但是等等……$13$维的状态……\n\n![](https://i.loli.net/2018/10/24/5bd07656b885a.jpg)\n\n注意到，后面$12$维状态只有$0$和$1$，于是我们就有了这么一个想法：把后$12$维状态看成一个$2$进制数，其中从右往左第$i$位表示当前行第$i$列是否种草，$1$表示种，$0$表示不种。在这一过程中，我们将后$12$维状态「压缩」成了一个$2$进制数，这也正是「状态压缩」这个名字的含义。\n\n于是，现在我们定义`f[i][S]`表示当前处理到第$i$行，其中第$i$行的状态是$S$的总方案数。在转移时，我们还需要判断状态是否合法，我们可以定义`a[i]`表示第$i$行哪些格子能种草，$1$表示能，$0$表示不能。`valid[S]`表示如果不考虑某些格子不能种草，状态$S$是否合法，也就是是否不存在两个相邻的$1$。`a[i]`在读入时就可以处理出来，至于`valid[S]`，我们可以通过这样的一个循环处理出来：\n\n```cpp\nfor(re int i=1;i<(1<<m);++i)\n    valid[i]=valid[i>>1]&(~(i&(i>>1)&1));\n```\n\n用人话来讲就是`[S是否合法]=[S>>1是否合法]&[S与S>>1的最后一位是否不同为1]`。\n\n在转移时，我们认为当前枚举到的状态是合法的当且仅当它只在能种草的格子上种草，并且不与上一行的状态冲突，也就是`(S|a[i])==a[i]&&valid[S]&&(S&S')==0`。\n\n```cpp\nfor(re int i=0;i<(1<<m);++i)\n    if((i|a[1])==a[1]&&valid[i])\n        f[1][i]=1;\nfor(re int i=2;i<=n;++i)\n    for(re int j=0;j<(1<<m);++j)\n        if((j|a[i])==a[i]&&valid[j])\n            for(re int k=0;k<(1<<m);++k)\n                if((k|a[i-1])==a[i-1]&&valid[k]&&(k&j)==0)\n                    (f[i][j]+=f[i-1][k])%=mod;\n```\n\n粗略计算的话，时间复杂度差不多是$O(n4^m)$，最坏情况下差不多是$12\\times 4^{12}=201326592$，看着很吓人，然而实际上，其中大部分状态都是不合法的，会被我们的两个`if`剪掉，因而实际运行跑得比谁都快（\n\n为了更好地体会状压的复杂度的神奇之处，我们再来看一下这道题，[「NOI2001」炮兵阵地](https://www.luogu.org/problemnew/show/P2704)。\n\n因为一个炮兵部队的攻击范围能够上下扩展两行，我们在记录状态时，需要记录之前两行的状态，也就是用`f[i][S1][S2]`表示当前处理到第$i$行，第$i-1$行状态为$S1$，第$i$状态为$S2$时最多能放多少个炮兵部队。我们自然也需要记录`a[i]`和`valid[S]`，不过，这次`valid[s]`的预处理过程差不多是这样：\n\n```cpp\nfor(re int i=1;i<(1<<m);++i){\n    valid[i]=(i&1)?valid[i>>3]&((~i)>>2)&((~i)>>1):valid[i>>1];\n```\n\n![](https://i.loli.net/2018/10/25/5bd124f4cdbb9.jpg)\n\n~~看起来~~有些~~非常~~复杂，用人话来讲就是……诶我当时是不是写错了（\n\n……不好像又没写错……\n\n好吧没写错。\n\n如果$S$的最后一位是$1$，则`[S是否合法]=[S>>3是否合法]&[S的倒数第2位和倒数第3位是否都为0]`，否则`[S是否合法]=[S>>1是否合法]`。\n\n因为我们要求的是最多能放多少个炮兵部队，我们还需要知道某个状态放了多少个炮兵部队，也就是某个状态$S$在二进制下$1$的个数，我们可以这样处理：\n\n```cpp\nfor(re int i=1;i<(1<<m);++i)\n    cnt[i]=cnt[i>>1]+(i&1);\n```\n\n转移过程如下：\n\n```cpp\nfor(re int i=0;i<(1<<m);++i)\n    if((i|a[1])==a[1]&&valid[i])\n        for(re int j=0;j<(1<<m);++j)\n            if((j|a[2])==a[2]&&valid[j]&&(i&j)==0)\n                    f[2][i][j]=cnt[i]+cnt[j];\nfor(re int i=3;i<=n;++i)\n    for(re int j=0;j<(1<<m);++j)\n        if((j|a[i-2])==a[i-2]&&valid[j])\n            for(re int k=0;k<(1<<m);++k)\n                if((k|a[i-1])==a[i-1]&&valid[k]&&(j&k)==0)\n                    for(re int l=0;l<(1<<m);++l)\n                        if((l|a[i])==a[i]&&valid[l]&&(l&j)==0&&(l&k)==0)\n                            f[i][k][l]=max(f[i][k][l],f[i-1][j][k]+cnt[l]);\n```\n\n时间复杂度差不多是$O(n8^m)$，最坏情况下差不多是$100\\times 8^{10}=107374182400$，然而由于转移过程中的大量剪枝，实际时间复杂度差不多是$O(\\text{won't TLE})$（\n\n我们再来看一个状压的应用，[「SP3953」MMINPAID - Paid Roads](https://www.spoj.com/problems/MMINPAID/)，或者您也可以~~反正我就是~~在[洛谷](https://www.luogu.org/problemnew/show/SP3953)上提交。\n\n大概是一道最短路，然而与一般的最短路不同的是，在这道题中，经过某条边之前所经过的节点集合如果不同，可能会导致花费的不同。这样一来，我们一般的最短路算法就会有后效性。解决方法也很简单，就是把经过节点集合压缩到一个$2$进制数内。定义`dis[u][S]`为只经过$S$内的节点的前提下，从$1$到$u$的最小花费。对于$u$发出的所有边的终点$v$，`dis[v][S|(1<<(v-1))]=min(dis[v][S|(1<<(v-1))],dis[u][S]+cost)`，其中$cost$表示经过从$u$到$v$这条边的花费，当然这需要分情况讨论。\n\n这样一来，我们只需要写一个可重复入队的堆优化$Dijkstra$就可以了。需要注意的是，我们需要把节点与经过节点集合看成是一个整体，或者说，将它们联系在一起然后抽象成一个「点」。\n\n~~我是不会说我把$\\text{impossible}$打成$\\text{Impossible}$然后交上去$\\text{WA}$了一发的（~~\n\n一般情况下，如果一道题数据范围很小，但是爆搜过不去，比如说$n\\leqslant 20$，就很有可能是状压题~~或者也有可能是神仙剪枝题~~。大部分状压的时间复杂度都不会直接是一个$O(2^n)$，$O(n2^n)$或者说$O(n^22^n)$大概比较常见，当然我比较菜，做过的题比较少，所以这一段基本是瞎扯。\n\n![](https://i.loli.net/2018/10/25/5bd13984b8601.jpg)\n\n以上，我觉得我的状压讲的差不多了（","source":"_posts/2018-10-24-status-compression-learning-notes.md","raw":"---\ntitle: 状态压缩动态规划学习笔记\ndate: 2018-10-24 21:24:05\ntags:\n  - 状态压缩\n  - 动态规划\ncategories:\n  - 学习笔记\nmathjax: true\n---\n~~把标签和分类连在一起读就是标题了（~~\n\n~~好像上一篇珂朵莉树学习笔记也是这样（~~\n\n~~马上就要复赛了，但反正我已经退役预定了来颓blog吧。~~\n\n<!-- more -->\n\n首先我们来看一道例题，[「USACO06NOV」玉米田Corn Fields](https://www.luogu.org/problemnew/show/P1879)。\n\n首先，我们想到定义`f[i][...]`表示当前处理到第$i$行，然后blablabla一堆状态的总方案数。既然任意两块草地之间不能有公共边，我们肯定需要记录第$i$行哪些地方种了草，哪些地方没种草。那么我们记录的状态就是……`f[i][0/1]...(省略10个[0/1])...[0/1]`，后面$12$维状态中第$j+1$维表示的是第$i$行第$j$列是否种草。\n\n但是等等……$13$维的状态……\n\n![](https://i.loli.net/2018/10/24/5bd07656b885a.jpg)\n\n注意到，后面$12$维状态只有$0$和$1$，于是我们就有了这么一个想法：把后$12$维状态看成一个$2$进制数，其中从右往左第$i$位表示当前行第$i$列是否种草，$1$表示种，$0$表示不种。在这一过程中，我们将后$12$维状态「压缩」成了一个$2$进制数，这也正是「状态压缩」这个名字的含义。\n\n于是，现在我们定义`f[i][S]`表示当前处理到第$i$行，其中第$i$行的状态是$S$的总方案数。在转移时，我们还需要判断状态是否合法，我们可以定义`a[i]`表示第$i$行哪些格子能种草，$1$表示能，$0$表示不能。`valid[S]`表示如果不考虑某些格子不能种草，状态$S$是否合法，也就是是否不存在两个相邻的$1$。`a[i]`在读入时就可以处理出来，至于`valid[S]`，我们可以通过这样的一个循环处理出来：\n\n```cpp\nfor(re int i=1;i<(1<<m);++i)\n    valid[i]=valid[i>>1]&(~(i&(i>>1)&1));\n```\n\n用人话来讲就是`[S是否合法]=[S>>1是否合法]&[S与S>>1的最后一位是否不同为1]`。\n\n在转移时，我们认为当前枚举到的状态是合法的当且仅当它只在能种草的格子上种草，并且不与上一行的状态冲突，也就是`(S|a[i])==a[i]&&valid[S]&&(S&S')==0`。\n\n```cpp\nfor(re int i=0;i<(1<<m);++i)\n    if((i|a[1])==a[1]&&valid[i])\n        f[1][i]=1;\nfor(re int i=2;i<=n;++i)\n    for(re int j=0;j<(1<<m);++j)\n        if((j|a[i])==a[i]&&valid[j])\n            for(re int k=0;k<(1<<m);++k)\n                if((k|a[i-1])==a[i-1]&&valid[k]&&(k&j)==0)\n                    (f[i][j]+=f[i-1][k])%=mod;\n```\n\n粗略计算的话，时间复杂度差不多是$O(n4^m)$，最坏情况下差不多是$12\\times 4^{12}=201326592$，看着很吓人，然而实际上，其中大部分状态都是不合法的，会被我们的两个`if`剪掉，因而实际运行跑得比谁都快（\n\n为了更好地体会状压的复杂度的神奇之处，我们再来看一下这道题，[「NOI2001」炮兵阵地](https://www.luogu.org/problemnew/show/P2704)。\n\n因为一个炮兵部队的攻击范围能够上下扩展两行，我们在记录状态时，需要记录之前两行的状态，也就是用`f[i][S1][S2]`表示当前处理到第$i$行，第$i-1$行状态为$S1$，第$i$状态为$S2$时最多能放多少个炮兵部队。我们自然也需要记录`a[i]`和`valid[S]`，不过，这次`valid[s]`的预处理过程差不多是这样：\n\n```cpp\nfor(re int i=1;i<(1<<m);++i){\n    valid[i]=(i&1)?valid[i>>3]&((~i)>>2)&((~i)>>1):valid[i>>1];\n```\n\n![](https://i.loli.net/2018/10/25/5bd124f4cdbb9.jpg)\n\n~~看起来~~有些~~非常~~复杂，用人话来讲就是……诶我当时是不是写错了（\n\n……不好像又没写错……\n\n好吧没写错。\n\n如果$S$的最后一位是$1$，则`[S是否合法]=[S>>3是否合法]&[S的倒数第2位和倒数第3位是否都为0]`，否则`[S是否合法]=[S>>1是否合法]`。\n\n因为我们要求的是最多能放多少个炮兵部队，我们还需要知道某个状态放了多少个炮兵部队，也就是某个状态$S$在二进制下$1$的个数，我们可以这样处理：\n\n```cpp\nfor(re int i=1;i<(1<<m);++i)\n    cnt[i]=cnt[i>>1]+(i&1);\n```\n\n转移过程如下：\n\n```cpp\nfor(re int i=0;i<(1<<m);++i)\n    if((i|a[1])==a[1]&&valid[i])\n        for(re int j=0;j<(1<<m);++j)\n            if((j|a[2])==a[2]&&valid[j]&&(i&j)==0)\n                    f[2][i][j]=cnt[i]+cnt[j];\nfor(re int i=3;i<=n;++i)\n    for(re int j=0;j<(1<<m);++j)\n        if((j|a[i-2])==a[i-2]&&valid[j])\n            for(re int k=0;k<(1<<m);++k)\n                if((k|a[i-1])==a[i-1]&&valid[k]&&(j&k)==0)\n                    for(re int l=0;l<(1<<m);++l)\n                        if((l|a[i])==a[i]&&valid[l]&&(l&j)==0&&(l&k)==0)\n                            f[i][k][l]=max(f[i][k][l],f[i-1][j][k]+cnt[l]);\n```\n\n时间复杂度差不多是$O(n8^m)$，最坏情况下差不多是$100\\times 8^{10}=107374182400$，然而由于转移过程中的大量剪枝，实际时间复杂度差不多是$O(\\text{won't TLE})$（\n\n我们再来看一个状压的应用，[「SP3953」MMINPAID - Paid Roads](https://www.spoj.com/problems/MMINPAID/)，或者您也可以~~反正我就是~~在[洛谷](https://www.luogu.org/problemnew/show/SP3953)上提交。\n\n大概是一道最短路，然而与一般的最短路不同的是，在这道题中，经过某条边之前所经过的节点集合如果不同，可能会导致花费的不同。这样一来，我们一般的最短路算法就会有后效性。解决方法也很简单，就是把经过节点集合压缩到一个$2$进制数内。定义`dis[u][S]`为只经过$S$内的节点的前提下，从$1$到$u$的最小花费。对于$u$发出的所有边的终点$v$，`dis[v][S|(1<<(v-1))]=min(dis[v][S|(1<<(v-1))],dis[u][S]+cost)`，其中$cost$表示经过从$u$到$v$这条边的花费，当然这需要分情况讨论。\n\n这样一来，我们只需要写一个可重复入队的堆优化$Dijkstra$就可以了。需要注意的是，我们需要把节点与经过节点集合看成是一个整体，或者说，将它们联系在一起然后抽象成一个「点」。\n\n~~我是不会说我把$\\text{impossible}$打成$\\text{Impossible}$然后交上去$\\text{WA}$了一发的（~~\n\n一般情况下，如果一道题数据范围很小，但是爆搜过不去，比如说$n\\leqslant 20$，就很有可能是状压题~~或者也有可能是神仙剪枝题~~。大部分状压的时间复杂度都不会直接是一个$O(2^n)$，$O(n2^n)$或者说$O(n^22^n)$大概比较常见，当然我比较菜，做过的题比较少，所以这一段基本是瞎扯。\n\n![](https://i.loli.net/2018/10/25/5bd13984b8601.jpg)\n\n以上，我觉得我的状压讲的差不多了（","slug":"status-compression-learning-notes","published":1,"updated":"2018-12-12T02:08:35.601Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjpn8w5qs000crogulr5amtmz","content":"<p><del>把标签和分类连在一起读就是标题了（</del></p>\n<p><del>好像上一篇珂朵莉树学习笔记也是这样（</del></p>\n<p><del>马上就要复赛了，但反正我已经退役预定了来颓blog吧。</del></p>\n<a id=\"more\"></a>\n<p>首先我们来看一道例题，<a href=\"https://www.luogu.org/problemnew/show/P1879\" target=\"_blank\" rel=\"noopener\">「USACO06NOV」玉米田Corn Fields</a>。</p>\n<p>首先，我们想到定义<code>f[i][...]</code>表示当前处理到第$i$行，然后blablabla一堆状态的总方案数。既然任意两块草地之间不能有公共边，我们肯定需要记录第$i$行哪些地方种了草，哪些地方没种草。那么我们记录的状态就是……<code>f[i][0/1]...(省略10个[0/1])...[0/1]</code>，后面$12$维状态中第$j+1$维表示的是第$i$行第$j$列是否种草。</p>\n<p>但是等等……$13$维的状态……</p>\n<p><img src=\"https://i.loli.net/2018/10/24/5bd07656b885a.jpg\" alt=\"\"></p>\n<p>注意到，后面$12$维状态只有$0$和$1$，于是我们就有了这么一个想法：把后$12$维状态看成一个$2$进制数，其中从右往左第$i$位表示当前行第$i$列是否种草，$1$表示种，$0$表示不种。在这一过程中，我们将后$12$维状态「压缩」成了一个$2$进制数，这也正是「状态压缩」这个名字的含义。</p>\n<p>于是，现在我们定义<code>f[i][S]</code>表示当前处理到第$i$行，其中第$i$行的状态是$S$的总方案数。在转移时，我们还需要判断状态是否合法，我们可以定义<code>a[i]</code>表示第$i$行哪些格子能种草，$1$表示能，$0$表示不能。<code>valid[S]</code>表示如果不考虑某些格子不能种草，状态$S$是否合法，也就是是否不存在两个相邻的$1$。<code>a[i]</code>在读入时就可以处理出来，至于<code>valid[S]</code>，我们可以通过这样的一个循环处理出来：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;(<span class=\"number\">1</span>&lt;&lt;m);++i)</span><br><span class=\"line\">    valid[i]=valid[i&gt;&gt;<span class=\"number\">1</span>]&amp;(~(i&amp;(i&gt;&gt;<span class=\"number\">1</span>)&amp;<span class=\"number\">1</span>));</span><br></pre></td></tr></table></figure>\n<p>用人话来讲就是<code>[S是否合法]=[S&gt;&gt;1是否合法]&amp;[S与S&gt;&gt;1的最后一位是否不同为1]</code>。</p>\n<p>在转移时，我们认为当前枚举到的状态是合法的当且仅当它只在能种草的格子上种草，并且不与上一行的状态冲突，也就是<code>(S|a[i])==a[i]&amp;&amp;valid[S]&amp;&amp;(S&amp;S&#39;)==0</code>。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&lt;(<span class=\"number\">1</span>&lt;&lt;m);++i)</span><br><span class=\"line\">    <span class=\"keyword\">if</span>((i|a[<span class=\"number\">1</span>])==a[<span class=\"number\">1</span>]&amp;&amp;valid[i])</span><br><span class=\"line\">        f[<span class=\"number\">1</span>][i]=<span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">2</span>;i&lt;=n;++i)</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=<span class=\"number\">0</span>;j&lt;(<span class=\"number\">1</span>&lt;&lt;m);++j)</span><br><span class=\"line\">        <span class=\"keyword\">if</span>((j|a[i])==a[i]&amp;&amp;valid[j])</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> k=<span class=\"number\">0</span>;k&lt;(<span class=\"number\">1</span>&lt;&lt;m);++k)</span><br><span class=\"line\">                <span class=\"keyword\">if</span>((k|a[i<span class=\"number\">-1</span>])==a[i<span class=\"number\">-1</span>]&amp;&amp;valid[k]&amp;&amp;(k&amp;j)==<span class=\"number\">0</span>)</span><br><span class=\"line\">                    (f[i][j]+=f[i<span class=\"number\">-1</span>][k])%=mod;</span><br></pre></td></tr></table></figure>\n<p>粗略计算的话，时间复杂度差不多是$O(n4^m)$，最坏情况下差不多是$12\\times 4^{12}=201326592$，看着很吓人，然而实际上，其中大部分状态都是不合法的，会被我们的两个<code>if</code>剪掉，因而实际运行跑得比谁都快（</p>\n<p>为了更好地体会状压的复杂度的神奇之处，我们再来看一下这道题，<a href=\"https://www.luogu.org/problemnew/show/P2704\" target=\"_blank\" rel=\"noopener\">「NOI2001」炮兵阵地</a>。</p>\n<p>因为一个炮兵部队的攻击范围能够上下扩展两行，我们在记录状态时，需要记录之前两行的状态，也就是用<code>f[i][S1][S2]</code>表示当前处理到第$i$行，第$i-1$行状态为$S1$，第$i$状态为$S2$时最多能放多少个炮兵部队。我们自然也需要记录<code>a[i]</code>和<code>valid[S]</code>，不过，这次<code>valid[s]</code>的预处理过程差不多是这样：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;(<span class=\"number\">1</span>&lt;&lt;m);++i)&#123;</span><br><span class=\"line\">    valid[i]=(i&amp;<span class=\"number\">1</span>)?valid[i&gt;&gt;<span class=\"number\">3</span>]&amp;((~i)&gt;&gt;<span class=\"number\">2</span>)&amp;((~i)&gt;&gt;<span class=\"number\">1</span>):valid[i&gt;&gt;<span class=\"number\">1</span>];</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://i.loli.net/2018/10/25/5bd124f4cdbb9.jpg\" alt=\"\"></p>\n<p><del>看起来</del>有些<del>非常</del>复杂，用人话来讲就是……诶我当时是不是写错了（</p>\n<p>……不好像又没写错……</p>\n<p>好吧没写错。</p>\n<p>如果$S$的最后一位是$1$，则<code>[S是否合法]=[S&gt;&gt;3是否合法]&amp;[S的倒数第2位和倒数第3位是否都为0]</code>，否则<code>[S是否合法]=[S&gt;&gt;1是否合法]</code>。</p>\n<p>因为我们要求的是最多能放多少个炮兵部队，我们还需要知道某个状态放了多少个炮兵部队，也就是某个状态$S$在二进制下$1$的个数，我们可以这样处理：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;(<span class=\"number\">1</span>&lt;&lt;m);++i)</span><br><span class=\"line\">    cnt[i]=cnt[i&gt;&gt;<span class=\"number\">1</span>]+(i&amp;<span class=\"number\">1</span>);</span><br></pre></td></tr></table></figure>\n<p>转移过程如下：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&lt;(<span class=\"number\">1</span>&lt;&lt;m);++i)</span><br><span class=\"line\">    <span class=\"keyword\">if</span>((i|a[<span class=\"number\">1</span>])==a[<span class=\"number\">1</span>]&amp;&amp;valid[i])</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=<span class=\"number\">0</span>;j&lt;(<span class=\"number\">1</span>&lt;&lt;m);++j)</span><br><span class=\"line\">            <span class=\"keyword\">if</span>((j|a[<span class=\"number\">2</span>])==a[<span class=\"number\">2</span>]&amp;&amp;valid[j]&amp;&amp;(i&amp;j)==<span class=\"number\">0</span>)</span><br><span class=\"line\">                    f[<span class=\"number\">2</span>][i][j]=cnt[i]+cnt[j];</span><br><span class=\"line\"><span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">3</span>;i&lt;=n;++i)</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=<span class=\"number\">0</span>;j&lt;(<span class=\"number\">1</span>&lt;&lt;m);++j)</span><br><span class=\"line\">        <span class=\"keyword\">if</span>((j|a[i<span class=\"number\">-2</span>])==a[i<span class=\"number\">-2</span>]&amp;&amp;valid[j])</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> k=<span class=\"number\">0</span>;k&lt;(<span class=\"number\">1</span>&lt;&lt;m);++k)</span><br><span class=\"line\">                <span class=\"keyword\">if</span>((k|a[i<span class=\"number\">-1</span>])==a[i<span class=\"number\">-1</span>]&amp;&amp;valid[k]&amp;&amp;(j&amp;k)==<span class=\"number\">0</span>)</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> l=<span class=\"number\">0</span>;l&lt;(<span class=\"number\">1</span>&lt;&lt;m);++l)</span><br><span class=\"line\">                        <span class=\"keyword\">if</span>((l|a[i])==a[i]&amp;&amp;valid[l]&amp;&amp;(l&amp;j)==<span class=\"number\">0</span>&amp;&amp;(l&amp;k)==<span class=\"number\">0</span>)</span><br><span class=\"line\">                            f[i][k][l]=max(f[i][k][l],f[i<span class=\"number\">-1</span>][j][k]+cnt[l]);</span><br></pre></td></tr></table></figure>\n<p>时间复杂度差不多是$O(n8^m)$，最坏情况下差不多是$100\\times 8^{10}=107374182400$，然而由于转移过程中的大量剪枝，实际时间复杂度差不多是$O(\\text{won’t TLE})$（</p>\n<p>我们再来看一个状压的应用，<a href=\"https://www.spoj.com/problems/MMINPAID/\" target=\"_blank\" rel=\"noopener\">「SP3953」MMINPAID - Paid Roads</a>，或者您也可以<del>反正我就是</del>在<a href=\"https://www.luogu.org/problemnew/show/SP3953\" target=\"_blank\" rel=\"noopener\">洛谷</a>上提交。</p>\n<p>大概是一道最短路，然而与一般的最短路不同的是，在这道题中，经过某条边之前所经过的节点集合如果不同，可能会导致花费的不同。这样一来，我们一般的最短路算法就会有后效性。解决方法也很简单，就是把经过节点集合压缩到一个$2$进制数内。定义<code>dis[u][S]</code>为只经过$S$内的节点的前提下，从$1$到$u$的最小花费。对于$u$发出的所有边的终点$v$，<code>dis[v][S|(1&lt;&lt;(v-1))]=min(dis[v][S|(1&lt;&lt;(v-1))],dis[u][S]+cost)</code>，其中$cost$表示经过从$u$到$v$这条边的花费，当然这需要分情况讨论。</p>\n<p>这样一来，我们只需要写一个可重复入队的堆优化$Dijkstra$就可以了。需要注意的是，我们需要把节点与经过节点集合看成是一个整体，或者说，将它们联系在一起然后抽象成一个「点」。</p>\n<p><del>我是不会说我把$\\text{impossible}$打成$\\text{Impossible}$然后交上去$\\text{WA}$了一发的（</del></p>\n<p>一般情况下，如果一道题数据范围很小，但是爆搜过不去，比如说$n\\leqslant 20$，就很有可能是状压题<del>或者也有可能是神仙剪枝题</del>。大部分状压的时间复杂度都不会直接是一个$O(2^n)$，$O(n2^n)$或者说$O(n^22^n)$大概比较常见，当然我比较菜，做过的题比较少，所以这一段基本是瞎扯。</p>\n<p><img src=\"https://i.loli.net/2018/10/25/5bd13984b8601.jpg\" alt=\"\"></p>\n<p>以上，我觉得我的状压讲的差不多了（</p>\n","site":{"data":{}},"excerpt":"<p><del>把标签和分类连在一起读就是标题了（</del></p>\n<p><del>好像上一篇珂朵莉树学习笔记也是这样（</del></p>\n<p><del>马上就要复赛了，但反正我已经退役预定了来颓blog吧。</del></p>","more":"<p>首先我们来看一道例题，<a href=\"https://www.luogu.org/problemnew/show/P1879\" target=\"_blank\" rel=\"noopener\">「USACO06NOV」玉米田Corn Fields</a>。</p>\n<p>首先，我们想到定义<code>f[i][...]</code>表示当前处理到第$i$行，然后blablabla一堆状态的总方案数。既然任意两块草地之间不能有公共边，我们肯定需要记录第$i$行哪些地方种了草，哪些地方没种草。那么我们记录的状态就是……<code>f[i][0/1]...(省略10个[0/1])...[0/1]</code>，后面$12$维状态中第$j+1$维表示的是第$i$行第$j$列是否种草。</p>\n<p>但是等等……$13$维的状态……</p>\n<p><img src=\"https://i.loli.net/2018/10/24/5bd07656b885a.jpg\" alt=\"\"></p>\n<p>注意到，后面$12$维状态只有$0$和$1$，于是我们就有了这么一个想法：把后$12$维状态看成一个$2$进制数，其中从右往左第$i$位表示当前行第$i$列是否种草，$1$表示种，$0$表示不种。在这一过程中，我们将后$12$维状态「压缩」成了一个$2$进制数，这也正是「状态压缩」这个名字的含义。</p>\n<p>于是，现在我们定义<code>f[i][S]</code>表示当前处理到第$i$行，其中第$i$行的状态是$S$的总方案数。在转移时，我们还需要判断状态是否合法，我们可以定义<code>a[i]</code>表示第$i$行哪些格子能种草，$1$表示能，$0$表示不能。<code>valid[S]</code>表示如果不考虑某些格子不能种草，状态$S$是否合法，也就是是否不存在两个相邻的$1$。<code>a[i]</code>在读入时就可以处理出来，至于<code>valid[S]</code>，我们可以通过这样的一个循环处理出来：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;(<span class=\"number\">1</span>&lt;&lt;m);++i)</span><br><span class=\"line\">    valid[i]=valid[i&gt;&gt;<span class=\"number\">1</span>]&amp;(~(i&amp;(i&gt;&gt;<span class=\"number\">1</span>)&amp;<span class=\"number\">1</span>));</span><br></pre></td></tr></table></figure>\n<p>用人话来讲就是<code>[S是否合法]=[S&gt;&gt;1是否合法]&amp;[S与S&gt;&gt;1的最后一位是否不同为1]</code>。</p>\n<p>在转移时，我们认为当前枚举到的状态是合法的当且仅当它只在能种草的格子上种草，并且不与上一行的状态冲突，也就是<code>(S|a[i])==a[i]&amp;&amp;valid[S]&amp;&amp;(S&amp;S&#39;)==0</code>。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&lt;(<span class=\"number\">1</span>&lt;&lt;m);++i)</span><br><span class=\"line\">    <span class=\"keyword\">if</span>((i|a[<span class=\"number\">1</span>])==a[<span class=\"number\">1</span>]&amp;&amp;valid[i])</span><br><span class=\"line\">        f[<span class=\"number\">1</span>][i]=<span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">2</span>;i&lt;=n;++i)</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=<span class=\"number\">0</span>;j&lt;(<span class=\"number\">1</span>&lt;&lt;m);++j)</span><br><span class=\"line\">        <span class=\"keyword\">if</span>((j|a[i])==a[i]&amp;&amp;valid[j])</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> k=<span class=\"number\">0</span>;k&lt;(<span class=\"number\">1</span>&lt;&lt;m);++k)</span><br><span class=\"line\">                <span class=\"keyword\">if</span>((k|a[i<span class=\"number\">-1</span>])==a[i<span class=\"number\">-1</span>]&amp;&amp;valid[k]&amp;&amp;(k&amp;j)==<span class=\"number\">0</span>)</span><br><span class=\"line\">                    (f[i][j]+=f[i<span class=\"number\">-1</span>][k])%=mod;</span><br></pre></td></tr></table></figure>\n<p>粗略计算的话，时间复杂度差不多是$O(n4^m)$，最坏情况下差不多是$12\\times 4^{12}=201326592$，看着很吓人，然而实际上，其中大部分状态都是不合法的，会被我们的两个<code>if</code>剪掉，因而实际运行跑得比谁都快（</p>\n<p>为了更好地体会状压的复杂度的神奇之处，我们再来看一下这道题，<a href=\"https://www.luogu.org/problemnew/show/P2704\" target=\"_blank\" rel=\"noopener\">「NOI2001」炮兵阵地</a>。</p>\n<p>因为一个炮兵部队的攻击范围能够上下扩展两行，我们在记录状态时，需要记录之前两行的状态，也就是用<code>f[i][S1][S2]</code>表示当前处理到第$i$行，第$i-1$行状态为$S1$，第$i$状态为$S2$时最多能放多少个炮兵部队。我们自然也需要记录<code>a[i]</code>和<code>valid[S]</code>，不过，这次<code>valid[s]</code>的预处理过程差不多是这样：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;(<span class=\"number\">1</span>&lt;&lt;m);++i)&#123;</span><br><span class=\"line\">    valid[i]=(i&amp;<span class=\"number\">1</span>)?valid[i&gt;&gt;<span class=\"number\">3</span>]&amp;((~i)&gt;&gt;<span class=\"number\">2</span>)&amp;((~i)&gt;&gt;<span class=\"number\">1</span>):valid[i&gt;&gt;<span class=\"number\">1</span>];</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://i.loli.net/2018/10/25/5bd124f4cdbb9.jpg\" alt=\"\"></p>\n<p><del>看起来</del>有些<del>非常</del>复杂，用人话来讲就是……诶我当时是不是写错了（</p>\n<p>……不好像又没写错……</p>\n<p>好吧没写错。</p>\n<p>如果$S$的最后一位是$1$，则<code>[S是否合法]=[S&gt;&gt;3是否合法]&amp;[S的倒数第2位和倒数第3位是否都为0]</code>，否则<code>[S是否合法]=[S&gt;&gt;1是否合法]</code>。</p>\n<p>因为我们要求的是最多能放多少个炮兵部队，我们还需要知道某个状态放了多少个炮兵部队，也就是某个状态$S$在二进制下$1$的个数，我们可以这样处理：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;(<span class=\"number\">1</span>&lt;&lt;m);++i)</span><br><span class=\"line\">    cnt[i]=cnt[i&gt;&gt;<span class=\"number\">1</span>]+(i&amp;<span class=\"number\">1</span>);</span><br></pre></td></tr></table></figure>\n<p>转移过程如下：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">0</span>;i&lt;(<span class=\"number\">1</span>&lt;&lt;m);++i)</span><br><span class=\"line\">    <span class=\"keyword\">if</span>((i|a[<span class=\"number\">1</span>])==a[<span class=\"number\">1</span>]&amp;&amp;valid[i])</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=<span class=\"number\">0</span>;j&lt;(<span class=\"number\">1</span>&lt;&lt;m);++j)</span><br><span class=\"line\">            <span class=\"keyword\">if</span>((j|a[<span class=\"number\">2</span>])==a[<span class=\"number\">2</span>]&amp;&amp;valid[j]&amp;&amp;(i&amp;j)==<span class=\"number\">0</span>)</span><br><span class=\"line\">                    f[<span class=\"number\">2</span>][i][j]=cnt[i]+cnt[j];</span><br><span class=\"line\"><span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">3</span>;i&lt;=n;++i)</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=<span class=\"number\">0</span>;j&lt;(<span class=\"number\">1</span>&lt;&lt;m);++j)</span><br><span class=\"line\">        <span class=\"keyword\">if</span>((j|a[i<span class=\"number\">-2</span>])==a[i<span class=\"number\">-2</span>]&amp;&amp;valid[j])</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> k=<span class=\"number\">0</span>;k&lt;(<span class=\"number\">1</span>&lt;&lt;m);++k)</span><br><span class=\"line\">                <span class=\"keyword\">if</span>((k|a[i<span class=\"number\">-1</span>])==a[i<span class=\"number\">-1</span>]&amp;&amp;valid[k]&amp;&amp;(j&amp;k)==<span class=\"number\">0</span>)</span><br><span class=\"line\">                    <span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> l=<span class=\"number\">0</span>;l&lt;(<span class=\"number\">1</span>&lt;&lt;m);++l)</span><br><span class=\"line\">                        <span class=\"keyword\">if</span>((l|a[i])==a[i]&amp;&amp;valid[l]&amp;&amp;(l&amp;j)==<span class=\"number\">0</span>&amp;&amp;(l&amp;k)==<span class=\"number\">0</span>)</span><br><span class=\"line\">                            f[i][k][l]=max(f[i][k][l],f[i<span class=\"number\">-1</span>][j][k]+cnt[l]);</span><br></pre></td></tr></table></figure>\n<p>时间复杂度差不多是$O(n8^m)$，最坏情况下差不多是$100\\times 8^{10}=107374182400$，然而由于转移过程中的大量剪枝，实际时间复杂度差不多是$O(\\text{won’t TLE})$（</p>\n<p>我们再来看一个状压的应用，<a href=\"https://www.spoj.com/problems/MMINPAID/\" target=\"_blank\" rel=\"noopener\">「SP3953」MMINPAID - Paid Roads</a>，或者您也可以<del>反正我就是</del>在<a href=\"https://www.luogu.org/problemnew/show/SP3953\" target=\"_blank\" rel=\"noopener\">洛谷</a>上提交。</p>\n<p>大概是一道最短路，然而与一般的最短路不同的是，在这道题中，经过某条边之前所经过的节点集合如果不同，可能会导致花费的不同。这样一来，我们一般的最短路算法就会有后效性。解决方法也很简单，就是把经过节点集合压缩到一个$2$进制数内。定义<code>dis[u][S]</code>为只经过$S$内的节点的前提下，从$1$到$u$的最小花费。对于$u$发出的所有边的终点$v$，<code>dis[v][S|(1&lt;&lt;(v-1))]=min(dis[v][S|(1&lt;&lt;(v-1))],dis[u][S]+cost)</code>，其中$cost$表示经过从$u$到$v$这条边的花费，当然这需要分情况讨论。</p>\n<p>这样一来，我们只需要写一个可重复入队的堆优化$Dijkstra$就可以了。需要注意的是，我们需要把节点与经过节点集合看成是一个整体，或者说，将它们联系在一起然后抽象成一个「点」。</p>\n<p><del>我是不会说我把$\\text{impossible}$打成$\\text{Impossible}$然后交上去$\\text{WA}$了一发的（</del></p>\n<p>一般情况下，如果一道题数据范围很小，但是爆搜过不去，比如说$n\\leqslant 20$，就很有可能是状压题<del>或者也有可能是神仙剪枝题</del>。大部分状压的时间复杂度都不会直接是一个$O(2^n)$，$O(n2^n)$或者说$O(n^22^n)$大概比较常见，当然我比较菜，做过的题比较少，所以这一段基本是瞎扯。</p>\n<p><img src=\"https://i.loli.net/2018/10/25/5bd13984b8601.jpg\" alt=\"\"></p>\n<p>以上，我觉得我的状压讲的差不多了（</p>"},{"title":"「NOIp2018游记」夢の終わるところ","date":"2018-11-09T01:40:45.000Z","mathjax":true,"_content":"~~€€£：禁赛警告。~~\n\n<!-- more -->\n\n# Day 0\n\n自从一周前放假回来以后，我就开始一颓不振：\n\n![](https://i.loli.net/2018/11/09/5be4e6d8c122f.png)\n\n明天就是NOIp2018复赛了，大概算是我人生中的第四场NOIp了。上午我和平时一样在颓废~~，同时看着其他dalao随手切神仙题~~。然后我看到yemdalao写了一篇[NOIp2018~~禁赛记~~游记](https://www.cnblogs.com/taduro/p/9933329.html)~~，想着禁赛真有趣~~，我就写下了这篇游记。\n\n> 其他dalao都在机房补文化课而我在颓blog（\n> \n> 于是，此处以下，$\\text{Updated on 2018-11-12}$。\n> \n> > $\\text{Updated on 2018-11-14}$：\n> > \n> > 看了其他dalao的blog发现自己写得实在是太菜了，于是大改一波。\n> > \n> > 但就算这样好像也没什么可写的。看到其他dalao用了大段文字来描写自己做题时的心理活动，但是……今年的题都是简单的想一想就会了，难的看一眼就能明白谁打正解谁退役，能有什么心理活动啊（逃\n\n中午去超市随便买了点吃的就走了，然后上了车直接就睡过去了，到了CYYZ大概15点了。\n\n然后一抽考场发现是外校，赛前先`rp--`。\n\n然后和wzxdalao分到了一个宿舍。听说他被mhr学长奶了一路，我大概是被传染了吧（\n\n下午一直在换宿舍，理由都差不多，就是其他学校的同一个学校的想住在同一个宿舍，莫名感觉rp被补回来了（\n\n除那之外就没啥了，算是颓了一个下午。\n\n晚上试机，庆幸自己用的是Win7，然后对面机房就是XP，下午的rp看来补得有效（\n\n试机就xjb打了个st表，还有我平时用的快读板子，当时是都存到E盘了，说不定明天会用得上。\n\n反正板子是不可能打炸的，这辈子都不可能的。\n\n因为某些原因，试机时间被推迟了，回来已经过了10点，就直接睡了。\n\n# Day 1\n\n早上懒得吃早饭了，就一个人在宿舍里发呆，想着自己肯定什么东西都带全了，结果一到考场发现准考证没带，尴尬.jpg。不过还好，我被允许先进考场了。\n\n然后一打开E盘发现被清了，只有题目。\n\nDay1的解压密码是不是就我一个人不懂啊（\n\n那么于是，到了8：30，我点开今天的题目，定神一看……\n\n## [T1](https://www.luogu.org/problemnew/show/P5019)\n\n智障单调栈，有不开数组的做法，不过我懒得细想了，反正`score+=100`。\n\n## [T2](https://www.luogu.org/problemnew/show/P5020)\n\n稍微想一想不难想到完全背包，`score+=100`。\n\n## [T3](https://www.luogu.org/problemnew/show/P5021)\n\n神仙树上操作……切不动切不动。我就打了$m=1$的20分和树是一条链中的5分。\n\n估分100+100+25=225。\n\n出考场后……啥啥啥，今天考了三道原题？爆破！把NOIp爆破掉，并从此以后不再接受CCF的公开赛！（\n\n前两题没什么意外的。不过，是不是是个人T3就能骗到55分啊（\n\n那我可真是太菜了（\n\n下午日常发呆，然后晚上是快乐的颓废时间。\n\n中午买的零食一个下午就全吃完了（\n\n# Day 2\n\n早上莫名起不来，然后就没吃早饭。\n\n这次我东西是真的带全了（\n\nDay2的解压密码依然不懂，然后是今天的题目：\n\n## [T1](https://www.luogu.org/problemnew/show/P5022)\n\nNOIp开始考基环树了么……不过还算简单，找到环以后暴力断边然后dfs即可。听crydalao说有$O(n)$的做法，不过他调了两个小时还是放弃了。\n\n现在回想起来，我当时用了个什么智障存图方法啊……先开个邻接表，对每个点`std::sort`一遍。然后维护一个邻接矩阵处理断边（\n\n为什么不直接用邻接矩阵呢（\n\n## [T2](https://www.luogu.org/problemnew/show/P5023)\n\n神仙结论题……切不动切不动。随便打了个爆搜找到了$n=2$和$n=3$时的规律。虽然说$n=1$时规律很明显，然而我当时智障忘判断了（\n\n## [T3](https://www.luogu.org/problemnew/show/P5024)\n\n究极神仙题，读完题yy出ddp，然而不会，只拿了$O(nm)$的44分。\n\n估分100+65+44=204（不存在的，肯定比这个低）。\n\n这么两天算下来，乐观估计的话，差不多有100+100+25+100+65+44=434分，保守估计应该不会掉到400分以下，应该算是稳了吧……\n\n不不不不存在的，我一定会六道题全部写炸然后华丽爆零并退役（\n\n好像其他dalao们都有这样那样乱七八糟的地方出锅了啊……\n\n下午请假回家开心地颓废。\n\n# Extra Notes\n\n果然是等到NOIp结束后才更新的。\n\n以及，我比较菜，第一次写游记，写的~~可能~~一定很菜，所以……算了，告辞。\n\n> $\\text{Updated on 2018-11-26}$：\n> \n> 好像有些晚的更新。\n> \n> 出正式成绩之后被教练赶回教室补了一段时间文化课，感觉刚刚度过了人生中最长的一星期（\n> \n> 具体成绩差不多是100+100+20+100+65+36=421。\n> \n> 以上。","source":"_posts/2018-11-09-noip-2018-notes.md","raw":"---\ntitle: 「NOIp2018游记」夢の終わるところ\ndate: 2018-11-09 09:40:45\ntags:\n  - NOIp\n  - 2018\ncategories:\n  - 游记\nmathjax: true\n---\n~~€€£：禁赛警告。~~\n\n<!-- more -->\n\n# Day 0\n\n自从一周前放假回来以后，我就开始一颓不振：\n\n![](https://i.loli.net/2018/11/09/5be4e6d8c122f.png)\n\n明天就是NOIp2018复赛了，大概算是我人生中的第四场NOIp了。上午我和平时一样在颓废~~，同时看着其他dalao随手切神仙题~~。然后我看到yemdalao写了一篇[NOIp2018~~禁赛记~~游记](https://www.cnblogs.com/taduro/p/9933329.html)~~，想着禁赛真有趣~~，我就写下了这篇游记。\n\n> 其他dalao都在机房补文化课而我在颓blog（\n> \n> 于是，此处以下，$\\text{Updated on 2018-11-12}$。\n> \n> > $\\text{Updated on 2018-11-14}$：\n> > \n> > 看了其他dalao的blog发现自己写得实在是太菜了，于是大改一波。\n> > \n> > 但就算这样好像也没什么可写的。看到其他dalao用了大段文字来描写自己做题时的心理活动，但是……今年的题都是简单的想一想就会了，难的看一眼就能明白谁打正解谁退役，能有什么心理活动啊（逃\n\n中午去超市随便买了点吃的就走了，然后上了车直接就睡过去了，到了CYYZ大概15点了。\n\n然后一抽考场发现是外校，赛前先`rp--`。\n\n然后和wzxdalao分到了一个宿舍。听说他被mhr学长奶了一路，我大概是被传染了吧（\n\n下午一直在换宿舍，理由都差不多，就是其他学校的同一个学校的想住在同一个宿舍，莫名感觉rp被补回来了（\n\n除那之外就没啥了，算是颓了一个下午。\n\n晚上试机，庆幸自己用的是Win7，然后对面机房就是XP，下午的rp看来补得有效（\n\n试机就xjb打了个st表，还有我平时用的快读板子，当时是都存到E盘了，说不定明天会用得上。\n\n反正板子是不可能打炸的，这辈子都不可能的。\n\n因为某些原因，试机时间被推迟了，回来已经过了10点，就直接睡了。\n\n# Day 1\n\n早上懒得吃早饭了，就一个人在宿舍里发呆，想着自己肯定什么东西都带全了，结果一到考场发现准考证没带，尴尬.jpg。不过还好，我被允许先进考场了。\n\n然后一打开E盘发现被清了，只有题目。\n\nDay1的解压密码是不是就我一个人不懂啊（\n\n那么于是，到了8：30，我点开今天的题目，定神一看……\n\n## [T1](https://www.luogu.org/problemnew/show/P5019)\n\n智障单调栈，有不开数组的做法，不过我懒得细想了，反正`score+=100`。\n\n## [T2](https://www.luogu.org/problemnew/show/P5020)\n\n稍微想一想不难想到完全背包，`score+=100`。\n\n## [T3](https://www.luogu.org/problemnew/show/P5021)\n\n神仙树上操作……切不动切不动。我就打了$m=1$的20分和树是一条链中的5分。\n\n估分100+100+25=225。\n\n出考场后……啥啥啥，今天考了三道原题？爆破！把NOIp爆破掉，并从此以后不再接受CCF的公开赛！（\n\n前两题没什么意外的。不过，是不是是个人T3就能骗到55分啊（\n\n那我可真是太菜了（\n\n下午日常发呆，然后晚上是快乐的颓废时间。\n\n中午买的零食一个下午就全吃完了（\n\n# Day 2\n\n早上莫名起不来，然后就没吃早饭。\n\n这次我东西是真的带全了（\n\nDay2的解压密码依然不懂，然后是今天的题目：\n\n## [T1](https://www.luogu.org/problemnew/show/P5022)\n\nNOIp开始考基环树了么……不过还算简单，找到环以后暴力断边然后dfs即可。听crydalao说有$O(n)$的做法，不过他调了两个小时还是放弃了。\n\n现在回想起来，我当时用了个什么智障存图方法啊……先开个邻接表，对每个点`std::sort`一遍。然后维护一个邻接矩阵处理断边（\n\n为什么不直接用邻接矩阵呢（\n\n## [T2](https://www.luogu.org/problemnew/show/P5023)\n\n神仙结论题……切不动切不动。随便打了个爆搜找到了$n=2$和$n=3$时的规律。虽然说$n=1$时规律很明显，然而我当时智障忘判断了（\n\n## [T3](https://www.luogu.org/problemnew/show/P5024)\n\n究极神仙题，读完题yy出ddp，然而不会，只拿了$O(nm)$的44分。\n\n估分100+65+44=204（不存在的，肯定比这个低）。\n\n这么两天算下来，乐观估计的话，差不多有100+100+25+100+65+44=434分，保守估计应该不会掉到400分以下，应该算是稳了吧……\n\n不不不不存在的，我一定会六道题全部写炸然后华丽爆零并退役（\n\n好像其他dalao们都有这样那样乱七八糟的地方出锅了啊……\n\n下午请假回家开心地颓废。\n\n# Extra Notes\n\n果然是等到NOIp结束后才更新的。\n\n以及，我比较菜，第一次写游记，写的~~可能~~一定很菜，所以……算了，告辞。\n\n> $\\text{Updated on 2018-11-26}$：\n> \n> 好像有些晚的更新。\n> \n> 出正式成绩之后被教练赶回教室补了一段时间文化课，感觉刚刚度过了人生中最长的一星期（\n> \n> 具体成绩差不多是100+100+20+100+65+36=421。\n> \n> 以上。","slug":"noip-2018-notes","published":1,"updated":"2018-12-12T02:06:21.728Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjpn8w5rz000drogu7b7swr15","content":"<p><del>€€£：禁赛警告。</del></p>\n<a id=\"more\"></a>\n<h1 id=\"Day-0\"><a href=\"#Day-0\" class=\"headerlink\" title=\"Day 0\"></a>Day 0</h1><p>自从一周前放假回来以后，我就开始一颓不振：</p>\n<p><img src=\"https://i.loli.net/2018/11/09/5be4e6d8c122f.png\" alt=\"\"></p>\n<p>明天就是NOIp2018复赛了，大概算是我人生中的第四场NOIp了。上午我和平时一样在颓废<del>，同时看着其他dalao随手切神仙题</del>。然后我看到yemdalao写了一篇<a href=\"https://www.cnblogs.com/taduro/p/9933329.html\" target=\"_blank\" rel=\"noopener\">NOIp2018<del>禁赛记</del>游记</a><del>，想着禁赛真有趣</del>，我就写下了这篇游记。</p>\n<blockquote>\n<p>其他dalao都在机房补文化课而我在颓blog（</p>\n<p>于是，此处以下，$\\text{Updated on 2018-11-12}$。</p>\n<blockquote>\n<p>$\\text{Updated on 2018-11-14}$：</p>\n<p>看了其他dalao的blog发现自己写得实在是太菜了，于是大改一波。</p>\n<p>但就算这样好像也没什么可写的。看到其他dalao用了大段文字来描写自己做题时的心理活动，但是……今年的题都是简单的想一想就会了，难的看一眼就能明白谁打正解谁退役，能有什么心理活动啊（逃</p>\n</blockquote>\n</blockquote>\n<p>中午去超市随便买了点吃的就走了，然后上了车直接就睡过去了，到了CYYZ大概15点了。</p>\n<p>然后一抽考场发现是外校，赛前先<code>rp--</code>。</p>\n<p>然后和wzxdalao分到了一个宿舍。听说他被mhr学长奶了一路，我大概是被传染了吧（</p>\n<p>下午一直在换宿舍，理由都差不多，就是其他学校的同一个学校的想住在同一个宿舍，莫名感觉rp被补回来了（</p>\n<p>除那之外就没啥了，算是颓了一个下午。</p>\n<p>晚上试机，庆幸自己用的是Win7，然后对面机房就是XP，下午的rp看来补得有效（</p>\n<p>试机就xjb打了个st表，还有我平时用的快读板子，当时是都存到E盘了，说不定明天会用得上。</p>\n<p>反正板子是不可能打炸的，这辈子都不可能的。</p>\n<p>因为某些原因，试机时间被推迟了，回来已经过了10点，就直接睡了。</p>\n<h1 id=\"Day-1\"><a href=\"#Day-1\" class=\"headerlink\" title=\"Day 1\"></a>Day 1</h1><p>早上懒得吃早饭了，就一个人在宿舍里发呆，想着自己肯定什么东西都带全了，结果一到考场发现准考证没带，尴尬.jpg。不过还好，我被允许先进考场了。</p>\n<p>然后一打开E盘发现被清了，只有题目。</p>\n<p>Day1的解压密码是不是就我一个人不懂啊（</p>\n<p>那么于是，到了8：30，我点开今天的题目，定神一看……</p>\n<h2 id=\"T1\"><a href=\"#T1\" class=\"headerlink\" title=\"T1\"></a><a href=\"https://www.luogu.org/problemnew/show/P5019\" target=\"_blank\" rel=\"noopener\">T1</a></h2><p>智障单调栈，有不开数组的做法，不过我懒得细想了，反正<code>score+=100</code>。</p>\n<h2 id=\"T2\"><a href=\"#T2\" class=\"headerlink\" title=\"T2\"></a><a href=\"https://www.luogu.org/problemnew/show/P5020\" target=\"_blank\" rel=\"noopener\">T2</a></h2><p>稍微想一想不难想到完全背包，<code>score+=100</code>。</p>\n<h2 id=\"T3\"><a href=\"#T3\" class=\"headerlink\" title=\"T3\"></a><a href=\"https://www.luogu.org/problemnew/show/P5021\" target=\"_blank\" rel=\"noopener\">T3</a></h2><p>神仙树上操作……切不动切不动。我就打了$m=1$的20分和树是一条链中的5分。</p>\n<p>估分100+100+25=225。</p>\n<p>出考场后……啥啥啥，今天考了三道原题？爆破！把NOIp爆破掉，并从此以后不再接受CCF的公开赛！（</p>\n<p>前两题没什么意外的。不过，是不是是个人T3就能骗到55分啊（</p>\n<p>那我可真是太菜了（</p>\n<p>下午日常发呆，然后晚上是快乐的颓废时间。</p>\n<p>中午买的零食一个下午就全吃完了（</p>\n<h1 id=\"Day-2\"><a href=\"#Day-2\" class=\"headerlink\" title=\"Day 2\"></a>Day 2</h1><p>早上莫名起不来，然后就没吃早饭。</p>\n<p>这次我东西是真的带全了（</p>\n<p>Day2的解压密码依然不懂，然后是今天的题目：</p>\n<h2 id=\"T1-1\"><a href=\"#T1-1\" class=\"headerlink\" title=\"T1\"></a><a href=\"https://www.luogu.org/problemnew/show/P5022\" target=\"_blank\" rel=\"noopener\">T1</a></h2><p>NOIp开始考基环树了么……不过还算简单，找到环以后暴力断边然后dfs即可。听crydalao说有$O(n)$的做法，不过他调了两个小时还是放弃了。</p>\n<p>现在回想起来，我当时用了个什么智障存图方法啊……先开个邻接表，对每个点<code>std::sort</code>一遍。然后维护一个邻接矩阵处理断边（</p>\n<p>为什么不直接用邻接矩阵呢（</p>\n<h2 id=\"T2-1\"><a href=\"#T2-1\" class=\"headerlink\" title=\"T2\"></a><a href=\"https://www.luogu.org/problemnew/show/P5023\" target=\"_blank\" rel=\"noopener\">T2</a></h2><p>神仙结论题……切不动切不动。随便打了个爆搜找到了$n=2$和$n=3$时的规律。虽然说$n=1$时规律很明显，然而我当时智障忘判断了（</p>\n<h2 id=\"T3-1\"><a href=\"#T3-1\" class=\"headerlink\" title=\"T3\"></a><a href=\"https://www.luogu.org/problemnew/show/P5024\" target=\"_blank\" rel=\"noopener\">T3</a></h2><p>究极神仙题，读完题yy出ddp，然而不会，只拿了$O(nm)$的44分。</p>\n<p>估分100+65+44=204（不存在的，肯定比这个低）。</p>\n<p>这么两天算下来，乐观估计的话，差不多有100+100+25+100+65+44=434分，保守估计应该不会掉到400分以下，应该算是稳了吧……</p>\n<p>不不不不存在的，我一定会六道题全部写炸然后华丽爆零并退役（</p>\n<p>好像其他dalao们都有这样那样乱七八糟的地方出锅了啊……</p>\n<p>下午请假回家开心地颓废。</p>\n<h1 id=\"Extra-Notes\"><a href=\"#Extra-Notes\" class=\"headerlink\" title=\"Extra Notes\"></a>Extra Notes</h1><p>果然是等到NOIp结束后才更新的。</p>\n<p>以及，我比较菜，第一次写游记，写的<del>可能</del>一定很菜，所以……算了，告辞。</p>\n<blockquote>\n<p>$\\text{Updated on 2018-11-26}$：</p>\n<p>好像有些晚的更新。</p>\n<p>出正式成绩之后被教练赶回教室补了一段时间文化课，感觉刚刚度过了人生中最长的一星期（</p>\n<p>具体成绩差不多是100+100+20+100+65+36=421。</p>\n<p>以上。</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p><del>€€£：禁赛警告。</del></p>","more":"<h1 id=\"Day-0\"><a href=\"#Day-0\" class=\"headerlink\" title=\"Day 0\"></a>Day 0</h1><p>自从一周前放假回来以后，我就开始一颓不振：</p>\n<p><img src=\"https://i.loli.net/2018/11/09/5be4e6d8c122f.png\" alt=\"\"></p>\n<p>明天就是NOIp2018复赛了，大概算是我人生中的第四场NOIp了。上午我和平时一样在颓废<del>，同时看着其他dalao随手切神仙题</del>。然后我看到yemdalao写了一篇<a href=\"https://www.cnblogs.com/taduro/p/9933329.html\" target=\"_blank\" rel=\"noopener\">NOIp2018<del>禁赛记</del>游记</a><del>，想着禁赛真有趣</del>，我就写下了这篇游记。</p>\n<blockquote>\n<p>其他dalao都在机房补文化课而我在颓blog（</p>\n<p>于是，此处以下，$\\text{Updated on 2018-11-12}$。</p>\n<blockquote>\n<p>$\\text{Updated on 2018-11-14}$：</p>\n<p>看了其他dalao的blog发现自己写得实在是太菜了，于是大改一波。</p>\n<p>但就算这样好像也没什么可写的。看到其他dalao用了大段文字来描写自己做题时的心理活动，但是……今年的题都是简单的想一想就会了，难的看一眼就能明白谁打正解谁退役，能有什么心理活动啊（逃</p>\n</blockquote>\n</blockquote>\n<p>中午去超市随便买了点吃的就走了，然后上了车直接就睡过去了，到了CYYZ大概15点了。</p>\n<p>然后一抽考场发现是外校，赛前先<code>rp--</code>。</p>\n<p>然后和wzxdalao分到了一个宿舍。听说他被mhr学长奶了一路，我大概是被传染了吧（</p>\n<p>下午一直在换宿舍，理由都差不多，就是其他学校的同一个学校的想住在同一个宿舍，莫名感觉rp被补回来了（</p>\n<p>除那之外就没啥了，算是颓了一个下午。</p>\n<p>晚上试机，庆幸自己用的是Win7，然后对面机房就是XP，下午的rp看来补得有效（</p>\n<p>试机就xjb打了个st表，还有我平时用的快读板子，当时是都存到E盘了，说不定明天会用得上。</p>\n<p>反正板子是不可能打炸的，这辈子都不可能的。</p>\n<p>因为某些原因，试机时间被推迟了，回来已经过了10点，就直接睡了。</p>\n<h1 id=\"Day-1\"><a href=\"#Day-1\" class=\"headerlink\" title=\"Day 1\"></a>Day 1</h1><p>早上懒得吃早饭了，就一个人在宿舍里发呆，想着自己肯定什么东西都带全了，结果一到考场发现准考证没带，尴尬.jpg。不过还好，我被允许先进考场了。</p>\n<p>然后一打开E盘发现被清了，只有题目。</p>\n<p>Day1的解压密码是不是就我一个人不懂啊（</p>\n<p>那么于是，到了8：30，我点开今天的题目，定神一看……</p>\n<h2 id=\"T1\"><a href=\"#T1\" class=\"headerlink\" title=\"T1\"></a><a href=\"https://www.luogu.org/problemnew/show/P5019\" target=\"_blank\" rel=\"noopener\">T1</a></h2><p>智障单调栈，有不开数组的做法，不过我懒得细想了，反正<code>score+=100</code>。</p>\n<h2 id=\"T2\"><a href=\"#T2\" class=\"headerlink\" title=\"T2\"></a><a href=\"https://www.luogu.org/problemnew/show/P5020\" target=\"_blank\" rel=\"noopener\">T2</a></h2><p>稍微想一想不难想到完全背包，<code>score+=100</code>。</p>\n<h2 id=\"T3\"><a href=\"#T3\" class=\"headerlink\" title=\"T3\"></a><a href=\"https://www.luogu.org/problemnew/show/P5021\" target=\"_blank\" rel=\"noopener\">T3</a></h2><p>神仙树上操作……切不动切不动。我就打了$m=1$的20分和树是一条链中的5分。</p>\n<p>估分100+100+25=225。</p>\n<p>出考场后……啥啥啥，今天考了三道原题？爆破！把NOIp爆破掉，并从此以后不再接受CCF的公开赛！（</p>\n<p>前两题没什么意外的。不过，是不是是个人T3就能骗到55分啊（</p>\n<p>那我可真是太菜了（</p>\n<p>下午日常发呆，然后晚上是快乐的颓废时间。</p>\n<p>中午买的零食一个下午就全吃完了（</p>\n<h1 id=\"Day-2\"><a href=\"#Day-2\" class=\"headerlink\" title=\"Day 2\"></a>Day 2</h1><p>早上莫名起不来，然后就没吃早饭。</p>\n<p>这次我东西是真的带全了（</p>\n<p>Day2的解压密码依然不懂，然后是今天的题目：</p>\n<h2 id=\"T1-1\"><a href=\"#T1-1\" class=\"headerlink\" title=\"T1\"></a><a href=\"https://www.luogu.org/problemnew/show/P5022\" target=\"_blank\" rel=\"noopener\">T1</a></h2><p>NOIp开始考基环树了么……不过还算简单，找到环以后暴力断边然后dfs即可。听crydalao说有$O(n)$的做法，不过他调了两个小时还是放弃了。</p>\n<p>现在回想起来，我当时用了个什么智障存图方法啊……先开个邻接表，对每个点<code>std::sort</code>一遍。然后维护一个邻接矩阵处理断边（</p>\n<p>为什么不直接用邻接矩阵呢（</p>\n<h2 id=\"T2-1\"><a href=\"#T2-1\" class=\"headerlink\" title=\"T2\"></a><a href=\"https://www.luogu.org/problemnew/show/P5023\" target=\"_blank\" rel=\"noopener\">T2</a></h2><p>神仙结论题……切不动切不动。随便打了个爆搜找到了$n=2$和$n=3$时的规律。虽然说$n=1$时规律很明显，然而我当时智障忘判断了（</p>\n<h2 id=\"T3-1\"><a href=\"#T3-1\" class=\"headerlink\" title=\"T3\"></a><a href=\"https://www.luogu.org/problemnew/show/P5024\" target=\"_blank\" rel=\"noopener\">T3</a></h2><p>究极神仙题，读完题yy出ddp，然而不会，只拿了$O(nm)$的44分。</p>\n<p>估分100+65+44=204（不存在的，肯定比这个低）。</p>\n<p>这么两天算下来，乐观估计的话，差不多有100+100+25+100+65+44=434分，保守估计应该不会掉到400分以下，应该算是稳了吧……</p>\n<p>不不不不存在的，我一定会六道题全部写炸然后华丽爆零并退役（</p>\n<p>好像其他dalao们都有这样那样乱七八糟的地方出锅了啊……</p>\n<p>下午请假回家开心地颓废。</p>\n<h1 id=\"Extra-Notes\"><a href=\"#Extra-Notes\" class=\"headerlink\" title=\"Extra Notes\"></a>Extra Notes</h1><p>果然是等到NOIp结束后才更新的。</p>\n<p>以及，我比较菜，第一次写游记，写的<del>可能</del>一定很菜，所以……算了，告辞。</p>\n<blockquote>\n<p>$\\text{Updated on 2018-11-26}$：</p>\n<p>好像有些晚的更新。</p>\n<p>出正式成绩之后被教练赶回教室补了一段时间文化课，感觉刚刚度过了人生中最长的一星期（</p>\n<p>具体成绩差不多是100+100+20+100+65+36=421。</p>\n<p>以上。</p>\n</blockquote>"},{"title":"珂朵莉树学习笔记","date":"2018-10-13T13:13:09.000Z","mathjax":true,"_content":"~~还有三周就是NOIp复赛了，我还在这学些乱七八糟的东西怕不是要凉。~~\n\n~~话说上面那个数字是3你们看的出来吗，反正我在我的编辑器内看不出来。~~\n\n总之就是，我们机房的一位珂学家突然沉迷数据结构并不知道从哪翻出来的毒瘤数据结构。\n\n<!--more -->\n\n我们先来看一道~~毒瘤~~例题，[「CF896C」Willem, Chtholly and Seniorious](http://codeforces.com/contest/896/problem/C)。\n\n如果只看前三个操作的话~~，虽然我不会写也没写过~~，我觉得分块大概是可以做的。然而操作四是个什么鬼？区间$10^{9}$次方和？认真的？\n\n这种时候我们就需要用到珂朵莉树了。珂朵莉树的英文名叫$\\text{Old Driver Tree}$，简称$\\text{ODT}$。当然您也可以叫它$\\text{Chtholly Tree}$。从本质上来讲，珂朵莉树是一种基于`std::set`的暴力数据结构~~，虽然您也可以手写一颗平衡树~~，它的高效几乎全部建立在数据的完全随机上。如果您看过一些其他的珂朵莉树的学习笔记或者是题解的话，您应该总是会看到这样一句话：\n\n> 珂朵莉树的核心操作在于推平一段区间，使一整段区间内的东西变得一样。\n\n那么怎么推平呢？不急，我们慢慢讲。\n\n珂朵莉树存储的是区间，而且每个区间内的所有值都相同，也就是说，我们需要存储的是一个区间的左右端点和值。我们可以写一个结构体：\n\n```cpp\nstruct node{\n    int l,r;\n    mutable long long val;\n    //这里的mutable是为了让我们在之后的修改过程中可以修改val的值\n\n    node(int _l,int _r=-1,long long _val=-1){\n    //调用时_r或_val不填的话默认-1，为了后面split时方便\n        l=_l;\n        r=_r;\n        val=_val;\n    }\n};\nstd::set<node> s;\n\ninline bool operator<(node p,node q){\n    return p.l<q.l;\n}\n```\n\n然后我们就可以初始化了。对于这道题，我们可以像这样初始化：\n\n```cpp\nfor(re int i=1;i<=n;++i)\n    s.insert(node(i,i,rnd()%maxval+1));\n```\n\n初始化完了？\n\n初始化完了。\n\n然后就是珂朵莉树的核心操作~~之一~~，\n\n```cpp\nstd::<set>::iterator split(int pos)\n```\n\n作用是分离出一个左端点为`pos`的区间并返回它的迭代器。它的具体实现如下：\n\n```cpp\n#define _it std::set<node>::iterator\n//上面这句手打非常麻烦，建议宏定义\ninline _it split(int pos){\n    _it it=std::lower_bound(s.begin(),s.end(),node(pos));\n    //找第一个左端点大于等于pos的区间\n    if(it!=s.end()&&it->l==pos)\n        return it;\n    //如果找到了一个左端点恰好为pos的区间，我们就不用split了，直接返回它的迭代器\n    --it;\n    //否则当前区间的左端点一定大于pos，pos这个位置一定在前一个区间内\n    int l=it->l,r=it->r;\n    long long val=it->val;\n    s.erase(it);\n    s.insert(node(l,pos-1,val));\n    return s.insert(node(pos,r,val)).first;\n    //将区间[l,r]删除，并插入区间[l,pos)和[pos,r]\n}\n```\n\n虽然只是把一个区间砍成两半又放回去了，但我们并不是在做无用功，因为我们把原区间与操作无关的部分分离开了。\n\n`insert`函数的返回值类型是`std::pair<std::_Rb_tree_const_iterator<node>,bool>`~~，别问我啥意思我也不懂，我只是从它的错误报告里抄过来了~~，因此我们需要加个`.first`。\n\n`std::set`内部是用红黑树实现的，虽然我没写过，不过据说，它每次操作的时间复杂度都是近似$O(\\operatorname{log}n)$的。\n\n然后是一个同样很核心的操作，\n\n```cpp\nvoid assign(int l,int r,int x)\n```\n\n将区间$[l,r]$推平，全部赋成$x$。它的具体实现如下：\n\n```cpp\ninline void assign(int l,int r,int x){\n    _it itr=split(r+1),itl=split(l);\n    //注意一定要先split(r+1)再split(l)，因为如果l与r+1一开始恰好在同一区间内\n    //后split(r+1)~~大概~~会修改树中左端点为l的区间的迭代器\n    s.erase(itl,itr);\n    //将[itl,itr)内所有区间删除\n    s.insert(node(l,r,x));\n    //用一个大区间取代它们\n}\n```\n\n这就完了？\n\n这就完了。\n\n`assign`操作保证了珂朵莉树的时间复杂度，在数据随机的情况下，会使得`set`的大小迅速减小，并最终趋于$\\operatorname{log}n$。本题的操作二就只需调用一次`assign(l,r,x)`即可。\n\n然后是剩下的三个操作~~，一个比一个暴力~~。\n\n操作一，一个一个区间地拿出来加。\n\n```cpp\ninline void IntervalAdd(int l,int r,int x){\n    _it itr=split(r+1),itl=split(l);\n    for(re _it p=itl;p!=itr;++p)\n        p->val+=x;\n}\n```\n\n就这么几行？\n\n就这么几行。\n\n操作三，把所有区间取出来，然后直接调用`std::sort`。\n\n```cpp\ninline long long IntervalXth(int l,int r,int x){\n    _it itr=split(r+1),itl=split(l);\n    vec.clear();\n    for(re _it p=itl;p!=itr;++p)\n        vec.push_back(std::make_pair(p->val,p->r-p->l+1));\n    std::sort(vec.begin(),vec.end());\n    for(re unsigned i=0;i<vec.size();++i){\n        x-=vec[i].second;\n        if(x<=0)\n            return vec[i].first;\n    }\n    return 0;\n}\n```\n\n操作四，暴力快速幂。\n\n```cpp\ninline int IntervalXpow(int l,int r,int x,int y){\n    _it itr=split(r+1),itl=split(l);\n    int res=0;\n    for(re _it p=itl;p!=itr;++p)\n        res=(1LL*res+1LL*(p->r-p->l+1)*cltpow(p->val%y,x,y)%y)%y;\n    return res;\n}\n```\n\n您可能会想，这么暴力的东西，时间复杂度确定不会动不动原地起爆？\n\n这是我在$\\text{CodeForces}$上的提交记录：\n\n![](https://i.loli.net/2018/10/14/5bc28b1443ea5.png)\n\n这是我之前提到的那位~~不愿意透露姓名的~~珂学家的跑得最快的一次提交记录：\n\n![](https://i.loli.net/2018/10/14/5bc28c7ecfe96.png)\n\n![](https://i.loli.net/2018/10/14/5bc28bc4eed79.jpg)\n\n珂幻.jpg\n\n因为珂朵莉树的高效几乎全部建立在数据的完全随机上，能用珂朵莉树做的题并没有多少，大部分是在做正解是线段树之类的题想不出正解时骗分用。就比如说，我在学习珂朵莉树时参考的一篇题解提到了[「CF915E」Physical Education Lessons](http://codeforces.com/contest/915/problem/E)，然而……\n\n![](https://i.loli.net/2018/10/14/5bc297890bbc6.png)\n\n> $\\text{Updated on 2018-11-01}$：\n> \n> 后来我卡了卡常数过了……\n> \n> 以及，删掉了某些内容（\n\n于是，接下来是珂朵莉树的完整板子。\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n#include<vector>\n#include<set>\n#define re register\n#define maxn 100000\n#define _it std::set<node>::iterator\n\nnamespace cltstream{\n    #ifdef ONLINE_JUDGE\n        #define size 1048576\n        char str[size+1],*head=str,*tail=str;\n        inline char gc(){\n            if(head==tail){\n                tail=(head=str)+fread(str,1,size,stdin);\n                if(head==tail)\n                    return EOF;\n            }\n            return *head++;\n        }\n        #undef size\n    #else\n        #define gc getchar\n    #endif\n\n    template <typename _tp>\n    inline void read(_tp& x){\n        int sn=1;\n        char c=gc();\n        for(;c!=45&&(c<48||c>57)&&c!=EOF;c=gc());\n        if(c==45&&c!=EOF)\n            sn=-1,c=gc();\n        for(x=0;c>=48&&c<=57&&c!=EOF;x=(x<<3)+(x<<1)+(c^48),c=gc());\n        x*=sn;\n    }\n\n    template <typename _tp>\n    inline void write(_tp x,char text=' '){\n        if(x<0)\n            putchar(45),x=-x;\n        if(!x)\n            putchar(48);\n        else{\n            int digit[20];\n            for(digit[0]=0;x;digit[++digit[0]]=x%10,x/=10);\n            for(;digit[0];putchar(digit[digit[0]--]^48));\n        }\n        putchar(text);\n    }\n}\n\nint n,m,seed,maxval;\nstruct node{\n    int l,r;\n    mutable long long val;\n\n    node(int _l,int _r=-1,long long _val=-1){\n        l=_l;\n        r=_r;\n        val=_val;\n    }\n};\nstd::set<node> s;\nstd::vector<std::pair<long long,int> > vec;\n\ninline int rnd(){\n    int res=seed;\n    seed=(7LL*seed+13)%1000000007;\n    return res;\n}\n\ninline void swap(int& l,int& r){\n    int tmp=l;\n    l=r;\n    r=tmp;\n}\n\nint cltpow(int x,int y,int mod){\n    if(y==1)\n        return x;\n    int res=cltpow(x,y>>1,mod);\n    res=1LL*res*res%mod;\n    if(y&1)\n        res=1LL*res*x%mod;\n    return res;\n}\n\ninline bool operator<(node p,node q){\n    return p.l<q.l;\n}\n\ninline _it split(int pos){\n    _it it=std::lower_bound(s.begin(),s.end(),node(pos));\n    if(it!=s.end()&&it->l==pos)\n        return it;\n    --it;\n    int l=it->l,r=it->r;\n    long long val=it->val;\n    s.erase(it);\n    s.insert(node(l,pos-1,val));\n    return s.insert(node(pos,r,val)).first;\n}\n\ninline void IntervalAdd(int l,int r,int x){\n    _it itr=split(r+1),itl=split(l);\n    for(re _it p=itl;p!=itr;++p)\n        p->val+=x;\n}\n\ninline void IntervalAssign(int l,int r,int x){\n//就是之前提到的assign\n    _it itr=split(r+1),itl=split(l);\n    s.erase(itl,itr);\n    s.insert(node(l,r,x));\n}\n\ninline long long IntervalXth(int l,int r,int x){\n    _it itr=split(r+1),itl=split(l);\n    vec.clear();\n    for(re _it p=itl;p!=itr;++p)\n        vec.push_back(std::make_pair(p->val,p->r-p->l+1));\n    std::sort(vec.begin(),vec.end());\n    for(re unsigned i=0;i<vec.size();++i){\n        x-=vec[i].second;\n        if(x<=0)\n            return vec[i].first;\n    }\n    return 0;\n}\n\ninline int IntervalXpow(int l,int r,int x,int y){\n    _it itr=split(r+1),itl=split(l);\n    int res=0;\n    for(re _it p=itl;p!=itr;++p)\n        res=(1LL*res+1LL*(p->r-p->l+1)*cltpow(p->val%y,x,y)%y)%y;\n    return res;\n}\n\nint main(){\n    cltstream::read(n);\n    cltstream::read(m);\n    cltstream::read(seed);\n    cltstream::read(maxval);\n    for(re int i=1;i<=n;++i)\n        s.insert(node(i,i,rnd()%maxval+1));\n    for(re int i=1;i<=m;++i){\n        int opt=rnd()%4+1,l=rnd()%n+1,r=rnd()%n+1,x,y;\n        if(l>r)\n            swap(l,r);\n        switch(opt){\n            case 1:\n                x=rnd()%maxval+1;\n                IntervalAdd(l,r,x);\n                break;\n            case 2:\n                x=rnd()%maxval+1;\n                IntervalAssign(l,r,x);\n                break;\n            case 3:\n                x=rnd()%(r-l+1)+1;\n                cltstream::write(IntervalXth(l,r,x),'\\n');\n                break;\n            case 4:\n                x=rnd()%maxval+1;\n                y=rnd()%maxval+1;\n                cltstream::write(IntervalXpow(l,r,x,y),'\\n');\n                break;\n        }\n    }\n    return 0;\n}\n```\n\n以上。\n","source":"_posts/2018-10-13-chtholly-tree-learning-notes.md","raw":"---\ntitle: 珂朵莉树学习笔记\ndate: 2018-10-13 21:13:09\ntags:\n  - 珂朵莉树\ncategories:\n  - 学习笔记\nmathjax: true\n---\n~~还有三周就是NOIp复赛了，我还在这学些乱七八糟的东西怕不是要凉。~~\n\n~~话说上面那个数字是3你们看的出来吗，反正我在我的编辑器内看不出来。~~\n\n总之就是，我们机房的一位珂学家突然沉迷数据结构并不知道从哪翻出来的毒瘤数据结构。\n\n<!--more -->\n\n我们先来看一道~~毒瘤~~例题，[「CF896C」Willem, Chtholly and Seniorious](http://codeforces.com/contest/896/problem/C)。\n\n如果只看前三个操作的话~~，虽然我不会写也没写过~~，我觉得分块大概是可以做的。然而操作四是个什么鬼？区间$10^{9}$次方和？认真的？\n\n这种时候我们就需要用到珂朵莉树了。珂朵莉树的英文名叫$\\text{Old Driver Tree}$，简称$\\text{ODT}$。当然您也可以叫它$\\text{Chtholly Tree}$。从本质上来讲，珂朵莉树是一种基于`std::set`的暴力数据结构~~，虽然您也可以手写一颗平衡树~~，它的高效几乎全部建立在数据的完全随机上。如果您看过一些其他的珂朵莉树的学习笔记或者是题解的话，您应该总是会看到这样一句话：\n\n> 珂朵莉树的核心操作在于推平一段区间，使一整段区间内的东西变得一样。\n\n那么怎么推平呢？不急，我们慢慢讲。\n\n珂朵莉树存储的是区间，而且每个区间内的所有值都相同，也就是说，我们需要存储的是一个区间的左右端点和值。我们可以写一个结构体：\n\n```cpp\nstruct node{\n    int l,r;\n    mutable long long val;\n    //这里的mutable是为了让我们在之后的修改过程中可以修改val的值\n\n    node(int _l,int _r=-1,long long _val=-1){\n    //调用时_r或_val不填的话默认-1，为了后面split时方便\n        l=_l;\n        r=_r;\n        val=_val;\n    }\n};\nstd::set<node> s;\n\ninline bool operator<(node p,node q){\n    return p.l<q.l;\n}\n```\n\n然后我们就可以初始化了。对于这道题，我们可以像这样初始化：\n\n```cpp\nfor(re int i=1;i<=n;++i)\n    s.insert(node(i,i,rnd()%maxval+1));\n```\n\n初始化完了？\n\n初始化完了。\n\n然后就是珂朵莉树的核心操作~~之一~~，\n\n```cpp\nstd::<set>::iterator split(int pos)\n```\n\n作用是分离出一个左端点为`pos`的区间并返回它的迭代器。它的具体实现如下：\n\n```cpp\n#define _it std::set<node>::iterator\n//上面这句手打非常麻烦，建议宏定义\ninline _it split(int pos){\n    _it it=std::lower_bound(s.begin(),s.end(),node(pos));\n    //找第一个左端点大于等于pos的区间\n    if(it!=s.end()&&it->l==pos)\n        return it;\n    //如果找到了一个左端点恰好为pos的区间，我们就不用split了，直接返回它的迭代器\n    --it;\n    //否则当前区间的左端点一定大于pos，pos这个位置一定在前一个区间内\n    int l=it->l,r=it->r;\n    long long val=it->val;\n    s.erase(it);\n    s.insert(node(l,pos-1,val));\n    return s.insert(node(pos,r,val)).first;\n    //将区间[l,r]删除，并插入区间[l,pos)和[pos,r]\n}\n```\n\n虽然只是把一个区间砍成两半又放回去了，但我们并不是在做无用功，因为我们把原区间与操作无关的部分分离开了。\n\n`insert`函数的返回值类型是`std::pair<std::_Rb_tree_const_iterator<node>,bool>`~~，别问我啥意思我也不懂，我只是从它的错误报告里抄过来了~~，因此我们需要加个`.first`。\n\n`std::set`内部是用红黑树实现的，虽然我没写过，不过据说，它每次操作的时间复杂度都是近似$O(\\operatorname{log}n)$的。\n\n然后是一个同样很核心的操作，\n\n```cpp\nvoid assign(int l,int r,int x)\n```\n\n将区间$[l,r]$推平，全部赋成$x$。它的具体实现如下：\n\n```cpp\ninline void assign(int l,int r,int x){\n    _it itr=split(r+1),itl=split(l);\n    //注意一定要先split(r+1)再split(l)，因为如果l与r+1一开始恰好在同一区间内\n    //后split(r+1)~~大概~~会修改树中左端点为l的区间的迭代器\n    s.erase(itl,itr);\n    //将[itl,itr)内所有区间删除\n    s.insert(node(l,r,x));\n    //用一个大区间取代它们\n}\n```\n\n这就完了？\n\n这就完了。\n\n`assign`操作保证了珂朵莉树的时间复杂度，在数据随机的情况下，会使得`set`的大小迅速减小，并最终趋于$\\operatorname{log}n$。本题的操作二就只需调用一次`assign(l,r,x)`即可。\n\n然后是剩下的三个操作~~，一个比一个暴力~~。\n\n操作一，一个一个区间地拿出来加。\n\n```cpp\ninline void IntervalAdd(int l,int r,int x){\n    _it itr=split(r+1),itl=split(l);\n    for(re _it p=itl;p!=itr;++p)\n        p->val+=x;\n}\n```\n\n就这么几行？\n\n就这么几行。\n\n操作三，把所有区间取出来，然后直接调用`std::sort`。\n\n```cpp\ninline long long IntervalXth(int l,int r,int x){\n    _it itr=split(r+1),itl=split(l);\n    vec.clear();\n    for(re _it p=itl;p!=itr;++p)\n        vec.push_back(std::make_pair(p->val,p->r-p->l+1));\n    std::sort(vec.begin(),vec.end());\n    for(re unsigned i=0;i<vec.size();++i){\n        x-=vec[i].second;\n        if(x<=0)\n            return vec[i].first;\n    }\n    return 0;\n}\n```\n\n操作四，暴力快速幂。\n\n```cpp\ninline int IntervalXpow(int l,int r,int x,int y){\n    _it itr=split(r+1),itl=split(l);\n    int res=0;\n    for(re _it p=itl;p!=itr;++p)\n        res=(1LL*res+1LL*(p->r-p->l+1)*cltpow(p->val%y,x,y)%y)%y;\n    return res;\n}\n```\n\n您可能会想，这么暴力的东西，时间复杂度确定不会动不动原地起爆？\n\n这是我在$\\text{CodeForces}$上的提交记录：\n\n![](https://i.loli.net/2018/10/14/5bc28b1443ea5.png)\n\n这是我之前提到的那位~~不愿意透露姓名的~~珂学家的跑得最快的一次提交记录：\n\n![](https://i.loli.net/2018/10/14/5bc28c7ecfe96.png)\n\n![](https://i.loli.net/2018/10/14/5bc28bc4eed79.jpg)\n\n珂幻.jpg\n\n因为珂朵莉树的高效几乎全部建立在数据的完全随机上，能用珂朵莉树做的题并没有多少，大部分是在做正解是线段树之类的题想不出正解时骗分用。就比如说，我在学习珂朵莉树时参考的一篇题解提到了[「CF915E」Physical Education Lessons](http://codeforces.com/contest/915/problem/E)，然而……\n\n![](https://i.loli.net/2018/10/14/5bc297890bbc6.png)\n\n> $\\text{Updated on 2018-11-01}$：\n> \n> 后来我卡了卡常数过了……\n> \n> 以及，删掉了某些内容（\n\n于是，接下来是珂朵莉树的完整板子。\n\n```cpp\n#include<cstdio>\n#include<algorithm>\n#include<vector>\n#include<set>\n#define re register\n#define maxn 100000\n#define _it std::set<node>::iterator\n\nnamespace cltstream{\n    #ifdef ONLINE_JUDGE\n        #define size 1048576\n        char str[size+1],*head=str,*tail=str;\n        inline char gc(){\n            if(head==tail){\n                tail=(head=str)+fread(str,1,size,stdin);\n                if(head==tail)\n                    return EOF;\n            }\n            return *head++;\n        }\n        #undef size\n    #else\n        #define gc getchar\n    #endif\n\n    template <typename _tp>\n    inline void read(_tp& x){\n        int sn=1;\n        char c=gc();\n        for(;c!=45&&(c<48||c>57)&&c!=EOF;c=gc());\n        if(c==45&&c!=EOF)\n            sn=-1,c=gc();\n        for(x=0;c>=48&&c<=57&&c!=EOF;x=(x<<3)+(x<<1)+(c^48),c=gc());\n        x*=sn;\n    }\n\n    template <typename _tp>\n    inline void write(_tp x,char text=' '){\n        if(x<0)\n            putchar(45),x=-x;\n        if(!x)\n            putchar(48);\n        else{\n            int digit[20];\n            for(digit[0]=0;x;digit[++digit[0]]=x%10,x/=10);\n            for(;digit[0];putchar(digit[digit[0]--]^48));\n        }\n        putchar(text);\n    }\n}\n\nint n,m,seed,maxval;\nstruct node{\n    int l,r;\n    mutable long long val;\n\n    node(int _l,int _r=-1,long long _val=-1){\n        l=_l;\n        r=_r;\n        val=_val;\n    }\n};\nstd::set<node> s;\nstd::vector<std::pair<long long,int> > vec;\n\ninline int rnd(){\n    int res=seed;\n    seed=(7LL*seed+13)%1000000007;\n    return res;\n}\n\ninline void swap(int& l,int& r){\n    int tmp=l;\n    l=r;\n    r=tmp;\n}\n\nint cltpow(int x,int y,int mod){\n    if(y==1)\n        return x;\n    int res=cltpow(x,y>>1,mod);\n    res=1LL*res*res%mod;\n    if(y&1)\n        res=1LL*res*x%mod;\n    return res;\n}\n\ninline bool operator<(node p,node q){\n    return p.l<q.l;\n}\n\ninline _it split(int pos){\n    _it it=std::lower_bound(s.begin(),s.end(),node(pos));\n    if(it!=s.end()&&it->l==pos)\n        return it;\n    --it;\n    int l=it->l,r=it->r;\n    long long val=it->val;\n    s.erase(it);\n    s.insert(node(l,pos-1,val));\n    return s.insert(node(pos,r,val)).first;\n}\n\ninline void IntervalAdd(int l,int r,int x){\n    _it itr=split(r+1),itl=split(l);\n    for(re _it p=itl;p!=itr;++p)\n        p->val+=x;\n}\n\ninline void IntervalAssign(int l,int r,int x){\n//就是之前提到的assign\n    _it itr=split(r+1),itl=split(l);\n    s.erase(itl,itr);\n    s.insert(node(l,r,x));\n}\n\ninline long long IntervalXth(int l,int r,int x){\n    _it itr=split(r+1),itl=split(l);\n    vec.clear();\n    for(re _it p=itl;p!=itr;++p)\n        vec.push_back(std::make_pair(p->val,p->r-p->l+1));\n    std::sort(vec.begin(),vec.end());\n    for(re unsigned i=0;i<vec.size();++i){\n        x-=vec[i].second;\n        if(x<=0)\n            return vec[i].first;\n    }\n    return 0;\n}\n\ninline int IntervalXpow(int l,int r,int x,int y){\n    _it itr=split(r+1),itl=split(l);\n    int res=0;\n    for(re _it p=itl;p!=itr;++p)\n        res=(1LL*res+1LL*(p->r-p->l+1)*cltpow(p->val%y,x,y)%y)%y;\n    return res;\n}\n\nint main(){\n    cltstream::read(n);\n    cltstream::read(m);\n    cltstream::read(seed);\n    cltstream::read(maxval);\n    for(re int i=1;i<=n;++i)\n        s.insert(node(i,i,rnd()%maxval+1));\n    for(re int i=1;i<=m;++i){\n        int opt=rnd()%4+1,l=rnd()%n+1,r=rnd()%n+1,x,y;\n        if(l>r)\n            swap(l,r);\n        switch(opt){\n            case 1:\n                x=rnd()%maxval+1;\n                IntervalAdd(l,r,x);\n                break;\n            case 2:\n                x=rnd()%maxval+1;\n                IntervalAssign(l,r,x);\n                break;\n            case 3:\n                x=rnd()%(r-l+1)+1;\n                cltstream::write(IntervalXth(l,r,x),'\\n');\n                break;\n            case 4:\n                x=rnd()%maxval+1;\n                y=rnd()%maxval+1;\n                cltstream::write(IntervalXpow(l,r,x,y),'\\n');\n                break;\n        }\n    }\n    return 0;\n}\n```\n\n以上。\n","slug":"chtholly-tree-learning-notes","published":1,"updated":"2018-12-12T02:01:58.259Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjpn8w5tl001mroguyff9y10z","content":"<p><del>还有三周就是NOIp复赛了，我还在这学些乱七八糟的东西怕不是要凉。</del></p>\n<p><del>话说上面那个数字是3你们看的出来吗，反正我在我的编辑器内看不出来。</del></p>\n<p>总之就是，我们机房的一位珂学家突然沉迷数据结构并不知道从哪翻出来的毒瘤数据结构。</p>\n<a id=\"more\"></a>\n<p>我们先来看一道<del>毒瘤</del>例题，<a href=\"http://codeforces.com/contest/896/problem/C\" target=\"_blank\" rel=\"noopener\">「CF896C」Willem, Chtholly and Seniorious</a>。</p>\n<p>如果只看前三个操作的话<del>，虽然我不会写也没写过</del>，我觉得分块大概是可以做的。然而操作四是个什么鬼？区间$10^{9}$次方和？认真的？</p>\n<p>这种时候我们就需要用到珂朵莉树了。珂朵莉树的英文名叫$\\text{Old Driver Tree}$，简称$\\text{ODT}$。当然您也可以叫它$\\text{Chtholly Tree}$。从本质上来讲，珂朵莉树是一种基于<code>std::set</code>的暴力数据结构<del>，虽然您也可以手写一颗平衡树</del>，它的高效几乎全部建立在数据的完全随机上。如果您看过一些其他的珂朵莉树的学习笔记或者是题解的话，您应该总是会看到这样一句话：</p>\n<blockquote>\n<p>珂朵莉树的核心操作在于推平一段区间，使一整段区间内的东西变得一样。</p>\n</blockquote>\n<p>那么怎么推平呢？不急，我们慢慢讲。</p>\n<p>珂朵莉树存储的是区间，而且每个区间内的所有值都相同，也就是说，我们需要存储的是一个区间的左右端点和值。我们可以写一个结构体：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">node</span>&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> l,r;</span><br><span class=\"line\">    <span class=\"keyword\">mutable</span> <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> val;</span><br><span class=\"line\">    <span class=\"comment\">//这里的mutable是为了让我们在之后的修改过程中可以修改val的值</span></span><br><span class=\"line\"></span><br><span class=\"line\">    node(<span class=\"keyword\">int</span> _l,<span class=\"keyword\">int</span> _r=<span class=\"number\">-1</span>,<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> _val=<span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//调用时_r或_val不填的话默认-1，为了后面split时方便</span></span><br><span class=\"line\">        l=_l;</span><br><span class=\"line\">        r=_r;</span><br><span class=\"line\">        val=_val;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">std</span>::<span class=\"built_in\">set</span>&lt;node&gt; s;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">inline</span> <span class=\"keyword\">bool</span> <span class=\"keyword\">operator</span>&lt;(node p,node q)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> p.l&lt;q.l;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>然后我们就可以初始化了。对于这道题，我们可以像这样初始化：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;++i)</span><br><span class=\"line\">    s.insert(node(i,i,rnd()%maxval+<span class=\"number\">1</span>));</span><br></pre></td></tr></table></figure>\n<p>初始化完了？</p>\n<p>初始化完了。</p>\n<p>然后就是珂朵莉树的核心操作<del>之一</del>，</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">std</span>::&lt;<span class=\"built_in\">set</span>&gt;::<span class=\"function\">iterator <span class=\"title\">split</span><span class=\"params\">(<span class=\"keyword\">int</span> pos)</span></span></span><br></pre></td></tr></table></figure>\n<p>作用是分离出一个左端点为<code>pos</code>的区间并返回它的迭代器。它的具体实现如下：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> _it std::set<span class=\"meta-string\">&lt;node&gt;::iterator</span></span></span><br><span class=\"line\"><span class=\"comment\">//上面这句手打非常麻烦，建议宏定义</span></span><br><span class=\"line\"><span class=\"keyword\">inline</span> _<span class=\"function\">it <span class=\"title\">split</span><span class=\"params\">(<span class=\"keyword\">int</span> pos)</span></span>&#123;</span><br><span class=\"line\">    _it it=<span class=\"built_in\">std</span>::lower_bound(s.begin(),s.end(),node(pos));</span><br><span class=\"line\">    <span class=\"comment\">//找第一个左端点大于等于pos的区间</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(it!=s.end()&amp;&amp;it-&gt;l==pos)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> it;</span><br><span class=\"line\">    <span class=\"comment\">//如果找到了一个左端点恰好为pos的区间，我们就不用split了，直接返回它的迭代器</span></span><br><span class=\"line\">    --it;</span><br><span class=\"line\">    <span class=\"comment\">//否则当前区间的左端点一定大于pos，pos这个位置一定在前一个区间内</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> l=it-&gt;l,r=it-&gt;r;</span><br><span class=\"line\">    <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> val=it-&gt;val;</span><br><span class=\"line\">    s.erase(it);</span><br><span class=\"line\">    s.insert(node(l,pos<span class=\"number\">-1</span>,val));</span><br><span class=\"line\">    <span class=\"keyword\">return</span> s.insert(node(pos,r,val)).first;</span><br><span class=\"line\">    <span class=\"comment\">//将区间[l,r]删除，并插入区间[l,pos)和[pos,r]</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>虽然只是把一个区间砍成两半又放回去了，但我们并不是在做无用功，因为我们把原区间与操作无关的部分分离开了。</p>\n<p><code>insert</code>函数的返回值类型是<code>std::pair&lt;std::_Rb_tree_const_iterator&lt;node&gt;,bool&gt;</code><del>，别问我啥意思我也不懂，我只是从它的错误报告里抄过来了</del>，因此我们需要加个<code>.first</code>。</p>\n<p><code>std::set</code>内部是用红黑树实现的，虽然我没写过，不过据说，它每次操作的时间复杂度都是近似$O(\\operatorname{log}n)$的。</p>\n<p>然后是一个同样很核心的操作，</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">assign</span><span class=\"params\">(<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r,<span class=\"keyword\">int</span> x)</span></span></span><br></pre></td></tr></table></figure>\n<p>将区间$[l,r]$推平，全部赋成$x$。它的具体实现如下：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">assign</span><span class=\"params\">(<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r,<span class=\"keyword\">int</span> x)</span></span>&#123;</span><br><span class=\"line\">    _it itr=split(r+<span class=\"number\">1</span>),itl=split(l);</span><br><span class=\"line\">    <span class=\"comment\">//注意一定要先split(r+1)再split(l)，因为如果l与r+1一开始恰好在同一区间内</span></span><br><span class=\"line\">    <span class=\"comment\">//后split(r+1)~~大概~~会修改树中左端点为l的区间的迭代器</span></span><br><span class=\"line\">    s.erase(itl,itr);</span><br><span class=\"line\">    <span class=\"comment\">//将[itl,itr)内所有区间删除</span></span><br><span class=\"line\">    s.insert(node(l,r,x));</span><br><span class=\"line\">    <span class=\"comment\">//用一个大区间取代它们</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这就完了？</p>\n<p>这就完了。</p>\n<p><code>assign</code>操作保证了珂朵莉树的时间复杂度，在数据随机的情况下，会使得<code>set</code>的大小迅速减小，并最终趋于$\\operatorname{log}n$。本题的操作二就只需调用一次<code>assign(l,r,x)</code>即可。</p>\n<p>然后是剩下的三个操作<del>，一个比一个暴力</del>。</p>\n<p>操作一，一个一个区间地拿出来加。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">IntervalAdd</span><span class=\"params\">(<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r,<span class=\"keyword\">int</span> x)</span></span>&#123;</span><br><span class=\"line\">    _it itr=split(r+<span class=\"number\">1</span>),itl=split(l);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re _it p=itl;p!=itr;++p)</span><br><span class=\"line\">        p-&gt;val+=x;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>就这么几行？</p>\n<p>就这么几行。</p>\n<p>操作三，把所有区间取出来，然后直接调用<code>std::sort</code>。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> <span class=\"title\">IntervalXth</span><span class=\"params\">(<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r,<span class=\"keyword\">int</span> x)</span></span>&#123;</span><br><span class=\"line\">    _it itr=split(r+<span class=\"number\">1</span>),itl=split(l);</span><br><span class=\"line\">    vec.clear();</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re _it p=itl;p!=itr;++p)</span><br><span class=\"line\">        vec.push_back(<span class=\"built_in\">std</span>::make_pair(p-&gt;val,p-&gt;r-p-&gt;l+<span class=\"number\">1</span>));</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::sort(vec.begin(),vec.end());</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re <span class=\"keyword\">unsigned</span> i=<span class=\"number\">0</span>;i&lt;vec.size();++i)&#123;</span><br><span class=\"line\">        x-=vec[i].second;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x&lt;=<span class=\"number\">0</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> vec[i].first;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>操作四，暴力快速幂。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">int</span> <span class=\"title\">IntervalXpow</span><span class=\"params\">(<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r,<span class=\"keyword\">int</span> x,<span class=\"keyword\">int</span> y)</span></span>&#123;</span><br><span class=\"line\">    _it itr=split(r+<span class=\"number\">1</span>),itl=split(l);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> res=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re _it p=itl;p!=itr;++p)</span><br><span class=\"line\">        res=(<span class=\"number\">1L</span>L*res+<span class=\"number\">1L</span>L*(p-&gt;r-p-&gt;l+<span class=\"number\">1</span>)*cltpow(p-&gt;val%y,x,y)%y)%y;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>您可能会想，这么暴力的东西，时间复杂度确定不会动不动原地起爆？</p>\n<p>这是我在$\\text{CodeForces}$上的提交记录：</p>\n<p><img src=\"https://i.loli.net/2018/10/14/5bc28b1443ea5.png\" alt=\"\"></p>\n<p>这是我之前提到的那位<del>不愿意透露姓名的</del>珂学家的跑得最快的一次提交记录：</p>\n<p><img src=\"https://i.loli.net/2018/10/14/5bc28c7ecfe96.png\" alt=\"\"></p>\n<p><img src=\"https://i.loli.net/2018/10/14/5bc28bc4eed79.jpg\" alt=\"\"></p>\n<p>珂幻.jpg</p>\n<p>因为珂朵莉树的高效几乎全部建立在数据的完全随机上，能用珂朵莉树做的题并没有多少，大部分是在做正解是线段树之类的题想不出正解时骗分用。就比如说，我在学习珂朵莉树时参考的一篇题解提到了<a href=\"http://codeforces.com/contest/915/problem/E\" target=\"_blank\" rel=\"noopener\">「CF915E」Physical Education Lessons</a>，然而……</p>\n<p><img src=\"https://i.loli.net/2018/10/14/5bc297890bbc6.png\" alt=\"\"></p>\n<blockquote>\n<p>$\\text{Updated on 2018-11-01}$：</p>\n<p>后来我卡了卡常数过了……</p>\n<p>以及，删掉了某些内容（</p>\n</blockquote>\n<p>于是，接下来是珂朵莉树的完整板子。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;set&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> re register</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> maxn 100000</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> _it std::set<span class=\"meta-string\">&lt;node&gt;::iterator</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> cltstream&#123;</span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"meta-keyword\">ifdef</span> ONLINE_JUDGE</span></span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"meta-keyword\">define</span> size 1048576</span></span><br><span class=\"line\">        <span class=\"keyword\">char</span> str[size+<span class=\"number\">1</span>],*head=str,*tail=str;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">char</span> <span class=\"title\">gc</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(head==tail)&#123;</span><br><span class=\"line\">                tail=(head=str)+fread(str,<span class=\"number\">1</span>,size,<span class=\"built_in\">stdin</span>);</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(head==tail)</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> EOF;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> *head++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"meta-keyword\">undef</span> size</span></span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"meta-keyword\">define</span> gc getchar</span></span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> _tp&gt;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">read</span><span class=\"params\">(_tp&amp; x)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> sn=<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">char</span> c=gc();</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(;c!=<span class=\"number\">45</span>&amp;&amp;(c&lt;<span class=\"number\">48</span>||c&gt;<span class=\"number\">57</span>)&amp;&amp;c!=EOF;c=gc());</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(c==<span class=\"number\">45</span>&amp;&amp;c!=EOF)</span><br><span class=\"line\">            sn=<span class=\"number\">-1</span>,c=gc();</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(x=<span class=\"number\">0</span>;c&gt;=<span class=\"number\">48</span>&amp;&amp;c&lt;=<span class=\"number\">57</span>&amp;&amp;c!=EOF;x=(x&lt;&lt;<span class=\"number\">3</span>)+(x&lt;&lt;<span class=\"number\">1</span>)+(c^<span class=\"number\">48</span>),c=gc());</span><br><span class=\"line\">        x*=sn;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> _tp&gt;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">write</span><span class=\"params\">(_tp x,<span class=\"keyword\">char</span> text=<span class=\"string\">' '</span>)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x&lt;<span class=\"number\">0</span>)</span><br><span class=\"line\">            <span class=\"built_in\">putchar</span>(<span class=\"number\">45</span>),x=-x;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!x)</span><br><span class=\"line\">            <span class=\"built_in\">putchar</span>(<span class=\"number\">48</span>);</span><br><span class=\"line\">        <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> digit[<span class=\"number\">20</span>];</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(digit[<span class=\"number\">0</span>]=<span class=\"number\">0</span>;x;digit[++digit[<span class=\"number\">0</span>]]=x%<span class=\"number\">10</span>,x/=<span class=\"number\">10</span>);</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(;digit[<span class=\"number\">0</span>];<span class=\"built_in\">putchar</span>(digit[digit[<span class=\"number\">0</span>]--]^<span class=\"number\">48</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">putchar</span>(text);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> n,m,seed,maxval;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">node</span>&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> l,r;</span><br><span class=\"line\">    <span class=\"keyword\">mutable</span> <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> val;</span><br><span class=\"line\"></span><br><span class=\"line\">    node(<span class=\"keyword\">int</span> _l,<span class=\"keyword\">int</span> _r=<span class=\"number\">-1</span>,<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> _val=<span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">        l=_l;</span><br><span class=\"line\">        r=_r;</span><br><span class=\"line\">        val=_val;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">std</span>::<span class=\"built_in\">set</span>&lt;node&gt; s;</span><br><span class=\"line\"><span class=\"built_in\">std</span>::<span class=\"built_in\">vector</span>&lt;<span class=\"built_in\">std</span>::pair&lt;<span class=\"keyword\">long</span> <span class=\"keyword\">long</span>,<span class=\"keyword\">int</span>&gt; &gt; vec;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">int</span> <span class=\"title\">rnd</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> res=seed;</span><br><span class=\"line\">    seed=(<span class=\"number\">7L</span>L*seed+<span class=\"number\">13</span>)%<span class=\"number\">1000000007</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">swap</span><span class=\"params\">(<span class=\"keyword\">int</span>&amp; l,<span class=\"keyword\">int</span>&amp; r)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> tmp=l;</span><br><span class=\"line\">    l=r;</span><br><span class=\"line\">    r=tmp;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">cltpow</span><span class=\"params\">(<span class=\"keyword\">int</span> x,<span class=\"keyword\">int</span> y,<span class=\"keyword\">int</span> mod)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(y==<span class=\"number\">1</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> res=cltpow(x,y&gt;&gt;<span class=\"number\">1</span>,mod);</span><br><span class=\"line\">    res=<span class=\"number\">1L</span>L*res*res%mod;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(y&amp;<span class=\"number\">1</span>)</span><br><span class=\"line\">        res=<span class=\"number\">1L</span>L*res*x%mod;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">inline</span> <span class=\"keyword\">bool</span> <span class=\"keyword\">operator</span>&lt;(node p,node q)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> p.l&lt;q.l;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">inline</span> _<span class=\"function\">it <span class=\"title\">split</span><span class=\"params\">(<span class=\"keyword\">int</span> pos)</span></span>&#123;</span><br><span class=\"line\">    _it it=<span class=\"built_in\">std</span>::lower_bound(s.begin(),s.end(),node(pos));</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(it!=s.end()&amp;&amp;it-&gt;l==pos)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> it;</span><br><span class=\"line\">    --it;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> l=it-&gt;l,r=it-&gt;r;</span><br><span class=\"line\">    <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> val=it-&gt;val;</span><br><span class=\"line\">    s.erase(it);</span><br><span class=\"line\">    s.insert(node(l,pos<span class=\"number\">-1</span>,val));</span><br><span class=\"line\">    <span class=\"keyword\">return</span> s.insert(node(pos,r,val)).first;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">IntervalAdd</span><span class=\"params\">(<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r,<span class=\"keyword\">int</span> x)</span></span>&#123;</span><br><span class=\"line\">    _it itr=split(r+<span class=\"number\">1</span>),itl=split(l);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re _it p=itl;p!=itr;++p)</span><br><span class=\"line\">        p-&gt;val+=x;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">IntervalAssign</span><span class=\"params\">(<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r,<span class=\"keyword\">int</span> x)</span></span>&#123;</span><br><span class=\"line\"><span class=\"comment\">//就是之前提到的assign</span></span><br><span class=\"line\">    _it itr=split(r+<span class=\"number\">1</span>),itl=split(l);</span><br><span class=\"line\">    s.erase(itl,itr);</span><br><span class=\"line\">    s.insert(node(l,r,x));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> <span class=\"title\">IntervalXth</span><span class=\"params\">(<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r,<span class=\"keyword\">int</span> x)</span></span>&#123;</span><br><span class=\"line\">    _it itr=split(r+<span class=\"number\">1</span>),itl=split(l);</span><br><span class=\"line\">    vec.clear();</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re _it p=itl;p!=itr;++p)</span><br><span class=\"line\">        vec.push_back(<span class=\"built_in\">std</span>::make_pair(p-&gt;val,p-&gt;r-p-&gt;l+<span class=\"number\">1</span>));</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::sort(vec.begin(),vec.end());</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re <span class=\"keyword\">unsigned</span> i=<span class=\"number\">0</span>;i&lt;vec.size();++i)&#123;</span><br><span class=\"line\">        x-=vec[i].second;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x&lt;=<span class=\"number\">0</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> vec[i].first;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">int</span> <span class=\"title\">IntervalXpow</span><span class=\"params\">(<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r,<span class=\"keyword\">int</span> x,<span class=\"keyword\">int</span> y)</span></span>&#123;</span><br><span class=\"line\">    _it itr=split(r+<span class=\"number\">1</span>),itl=split(l);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> res=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re _it p=itl;p!=itr;++p)</span><br><span class=\"line\">        res=(<span class=\"number\">1L</span>L*res+<span class=\"number\">1L</span>L*(p-&gt;r-p-&gt;l+<span class=\"number\">1</span>)*cltpow(p-&gt;val%y,x,y)%y)%y;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    cltstream::read(n);</span><br><span class=\"line\">    cltstream::read(m);</span><br><span class=\"line\">    cltstream::read(seed);</span><br><span class=\"line\">    cltstream::read(maxval);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;++i)</span><br><span class=\"line\">        s.insert(node(i,i,rnd()%maxval+<span class=\"number\">1</span>));</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=m;++i)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> opt=rnd()%<span class=\"number\">4</span>+<span class=\"number\">1</span>,l=rnd()%n+<span class=\"number\">1</span>,r=rnd()%n+<span class=\"number\">1</span>,x,y;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(l&gt;r)</span><br><span class=\"line\">            swap(l,r);</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(opt)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                x=rnd()%maxval+<span class=\"number\">1</span>;</span><br><span class=\"line\">                IntervalAdd(l,r,x);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                x=rnd()%maxval+<span class=\"number\">1</span>;</span><br><span class=\"line\">                IntervalAssign(l,r,x);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">                x=rnd()%(r-l+<span class=\"number\">1</span>)+<span class=\"number\">1</span>;</span><br><span class=\"line\">                cltstream::write(IntervalXth(l,r,x),<span class=\"string\">'\\n'</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">                x=rnd()%maxval+<span class=\"number\">1</span>;</span><br><span class=\"line\">                y=rnd()%maxval+<span class=\"number\">1</span>;</span><br><span class=\"line\">                cltstream::write(IntervalXpow(l,r,x,y),<span class=\"string\">'\\n'</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>以上。</p>\n","site":{"data":{}},"excerpt":"<p><del>还有三周就是NOIp复赛了，我还在这学些乱七八糟的东西怕不是要凉。</del></p>\n<p><del>话说上面那个数字是3你们看的出来吗，反正我在我的编辑器内看不出来。</del></p>\n<p>总之就是，我们机房的一位珂学家突然沉迷数据结构并不知道从哪翻出来的毒瘤数据结构。</p>","more":"<p>我们先来看一道<del>毒瘤</del>例题，<a href=\"http://codeforces.com/contest/896/problem/C\" target=\"_blank\" rel=\"noopener\">「CF896C」Willem, Chtholly and Seniorious</a>。</p>\n<p>如果只看前三个操作的话<del>，虽然我不会写也没写过</del>，我觉得分块大概是可以做的。然而操作四是个什么鬼？区间$10^{9}$次方和？认真的？</p>\n<p>这种时候我们就需要用到珂朵莉树了。珂朵莉树的英文名叫$\\text{Old Driver Tree}$，简称$\\text{ODT}$。当然您也可以叫它$\\text{Chtholly Tree}$。从本质上来讲，珂朵莉树是一种基于<code>std::set</code>的暴力数据结构<del>，虽然您也可以手写一颗平衡树</del>，它的高效几乎全部建立在数据的完全随机上。如果您看过一些其他的珂朵莉树的学习笔记或者是题解的话，您应该总是会看到这样一句话：</p>\n<blockquote>\n<p>珂朵莉树的核心操作在于推平一段区间，使一整段区间内的东西变得一样。</p>\n</blockquote>\n<p>那么怎么推平呢？不急，我们慢慢讲。</p>\n<p>珂朵莉树存储的是区间，而且每个区间内的所有值都相同，也就是说，我们需要存储的是一个区间的左右端点和值。我们可以写一个结构体：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">node</span>&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> l,r;</span><br><span class=\"line\">    <span class=\"keyword\">mutable</span> <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> val;</span><br><span class=\"line\">    <span class=\"comment\">//这里的mutable是为了让我们在之后的修改过程中可以修改val的值</span></span><br><span class=\"line\"></span><br><span class=\"line\">    node(<span class=\"keyword\">int</span> _l,<span class=\"keyword\">int</span> _r=<span class=\"number\">-1</span>,<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> _val=<span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">    <span class=\"comment\">//调用时_r或_val不填的话默认-1，为了后面split时方便</span></span><br><span class=\"line\">        l=_l;</span><br><span class=\"line\">        r=_r;</span><br><span class=\"line\">        val=_val;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">std</span>::<span class=\"built_in\">set</span>&lt;node&gt; s;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">inline</span> <span class=\"keyword\">bool</span> <span class=\"keyword\">operator</span>&lt;(node p,node q)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> p.l&lt;q.l;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>然后我们就可以初始化了。对于这道题，我们可以像这样初始化：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;++i)</span><br><span class=\"line\">    s.insert(node(i,i,rnd()%maxval+<span class=\"number\">1</span>));</span><br></pre></td></tr></table></figure>\n<p>初始化完了？</p>\n<p>初始化完了。</p>\n<p>然后就是珂朵莉树的核心操作<del>之一</del>，</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">std</span>::&lt;<span class=\"built_in\">set</span>&gt;::<span class=\"function\">iterator <span class=\"title\">split</span><span class=\"params\">(<span class=\"keyword\">int</span> pos)</span></span></span><br></pre></td></tr></table></figure>\n<p>作用是分离出一个左端点为<code>pos</code>的区间并返回它的迭代器。它的具体实现如下：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> _it std::set<span class=\"meta-string\">&lt;node&gt;::iterator</span></span></span><br><span class=\"line\"><span class=\"comment\">//上面这句手打非常麻烦，建议宏定义</span></span><br><span class=\"line\"><span class=\"keyword\">inline</span> _<span class=\"function\">it <span class=\"title\">split</span><span class=\"params\">(<span class=\"keyword\">int</span> pos)</span></span>&#123;</span><br><span class=\"line\">    _it it=<span class=\"built_in\">std</span>::lower_bound(s.begin(),s.end(),node(pos));</span><br><span class=\"line\">    <span class=\"comment\">//找第一个左端点大于等于pos的区间</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(it!=s.end()&amp;&amp;it-&gt;l==pos)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> it;</span><br><span class=\"line\">    <span class=\"comment\">//如果找到了一个左端点恰好为pos的区间，我们就不用split了，直接返回它的迭代器</span></span><br><span class=\"line\">    --it;</span><br><span class=\"line\">    <span class=\"comment\">//否则当前区间的左端点一定大于pos，pos这个位置一定在前一个区间内</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> l=it-&gt;l,r=it-&gt;r;</span><br><span class=\"line\">    <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> val=it-&gt;val;</span><br><span class=\"line\">    s.erase(it);</span><br><span class=\"line\">    s.insert(node(l,pos<span class=\"number\">-1</span>,val));</span><br><span class=\"line\">    <span class=\"keyword\">return</span> s.insert(node(pos,r,val)).first;</span><br><span class=\"line\">    <span class=\"comment\">//将区间[l,r]删除，并插入区间[l,pos)和[pos,r]</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>虽然只是把一个区间砍成两半又放回去了，但我们并不是在做无用功，因为我们把原区间与操作无关的部分分离开了。</p>\n<p><code>insert</code>函数的返回值类型是<code>std::pair&lt;std::_Rb_tree_const_iterator&lt;node&gt;,bool&gt;</code><del>，别问我啥意思我也不懂，我只是从它的错误报告里抄过来了</del>，因此我们需要加个<code>.first</code>。</p>\n<p><code>std::set</code>内部是用红黑树实现的，虽然我没写过，不过据说，它每次操作的时间复杂度都是近似$O(\\operatorname{log}n)$的。</p>\n<p>然后是一个同样很核心的操作，</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">assign</span><span class=\"params\">(<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r,<span class=\"keyword\">int</span> x)</span></span></span><br></pre></td></tr></table></figure>\n<p>将区间$[l,r]$推平，全部赋成$x$。它的具体实现如下：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">assign</span><span class=\"params\">(<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r,<span class=\"keyword\">int</span> x)</span></span>&#123;</span><br><span class=\"line\">    _it itr=split(r+<span class=\"number\">1</span>),itl=split(l);</span><br><span class=\"line\">    <span class=\"comment\">//注意一定要先split(r+1)再split(l)，因为如果l与r+1一开始恰好在同一区间内</span></span><br><span class=\"line\">    <span class=\"comment\">//后split(r+1)~~大概~~会修改树中左端点为l的区间的迭代器</span></span><br><span class=\"line\">    s.erase(itl,itr);</span><br><span class=\"line\">    <span class=\"comment\">//将[itl,itr)内所有区间删除</span></span><br><span class=\"line\">    s.insert(node(l,r,x));</span><br><span class=\"line\">    <span class=\"comment\">//用一个大区间取代它们</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这就完了？</p>\n<p>这就完了。</p>\n<p><code>assign</code>操作保证了珂朵莉树的时间复杂度，在数据随机的情况下，会使得<code>set</code>的大小迅速减小，并最终趋于$\\operatorname{log}n$。本题的操作二就只需调用一次<code>assign(l,r,x)</code>即可。</p>\n<p>然后是剩下的三个操作<del>，一个比一个暴力</del>。</p>\n<p>操作一，一个一个区间地拿出来加。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">IntervalAdd</span><span class=\"params\">(<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r,<span class=\"keyword\">int</span> x)</span></span>&#123;</span><br><span class=\"line\">    _it itr=split(r+<span class=\"number\">1</span>),itl=split(l);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re _it p=itl;p!=itr;++p)</span><br><span class=\"line\">        p-&gt;val+=x;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>就这么几行？</p>\n<p>就这么几行。</p>\n<p>操作三，把所有区间取出来，然后直接调用<code>std::sort</code>。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> <span class=\"title\">IntervalXth</span><span class=\"params\">(<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r,<span class=\"keyword\">int</span> x)</span></span>&#123;</span><br><span class=\"line\">    _it itr=split(r+<span class=\"number\">1</span>),itl=split(l);</span><br><span class=\"line\">    vec.clear();</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re _it p=itl;p!=itr;++p)</span><br><span class=\"line\">        vec.push_back(<span class=\"built_in\">std</span>::make_pair(p-&gt;val,p-&gt;r-p-&gt;l+<span class=\"number\">1</span>));</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::sort(vec.begin(),vec.end());</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re <span class=\"keyword\">unsigned</span> i=<span class=\"number\">0</span>;i&lt;vec.size();++i)&#123;</span><br><span class=\"line\">        x-=vec[i].second;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x&lt;=<span class=\"number\">0</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> vec[i].first;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>操作四，暴力快速幂。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">int</span> <span class=\"title\">IntervalXpow</span><span class=\"params\">(<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r,<span class=\"keyword\">int</span> x,<span class=\"keyword\">int</span> y)</span></span>&#123;</span><br><span class=\"line\">    _it itr=split(r+<span class=\"number\">1</span>),itl=split(l);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> res=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re _it p=itl;p!=itr;++p)</span><br><span class=\"line\">        res=(<span class=\"number\">1L</span>L*res+<span class=\"number\">1L</span>L*(p-&gt;r-p-&gt;l+<span class=\"number\">1</span>)*cltpow(p-&gt;val%y,x,y)%y)%y;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>您可能会想，这么暴力的东西，时间复杂度确定不会动不动原地起爆？</p>\n<p>这是我在$\\text{CodeForces}$上的提交记录：</p>\n<p><img src=\"https://i.loli.net/2018/10/14/5bc28b1443ea5.png\" alt=\"\"></p>\n<p>这是我之前提到的那位<del>不愿意透露姓名的</del>珂学家的跑得最快的一次提交记录：</p>\n<p><img src=\"https://i.loli.net/2018/10/14/5bc28c7ecfe96.png\" alt=\"\"></p>\n<p><img src=\"https://i.loli.net/2018/10/14/5bc28bc4eed79.jpg\" alt=\"\"></p>\n<p>珂幻.jpg</p>\n<p>因为珂朵莉树的高效几乎全部建立在数据的完全随机上，能用珂朵莉树做的题并没有多少，大部分是在做正解是线段树之类的题想不出正解时骗分用。就比如说，我在学习珂朵莉树时参考的一篇题解提到了<a href=\"http://codeforces.com/contest/915/problem/E\" target=\"_blank\" rel=\"noopener\">「CF915E」Physical Education Lessons</a>，然而……</p>\n<p><img src=\"https://i.loli.net/2018/10/14/5bc297890bbc6.png\" alt=\"\"></p>\n<blockquote>\n<p>$\\text{Updated on 2018-11-01}$：</p>\n<p>后来我卡了卡常数过了……</p>\n<p>以及，删掉了某些内容（</p>\n</blockquote>\n<p>于是，接下来是珂朵莉树的完整板子。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;vector&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;set&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> re register</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> maxn 100000</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> _it std::set<span class=\"meta-string\">&lt;node&gt;::iterator</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> cltstream&#123;</span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"meta-keyword\">ifdef</span> ONLINE_JUDGE</span></span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"meta-keyword\">define</span> size 1048576</span></span><br><span class=\"line\">        <span class=\"keyword\">char</span> str[size+<span class=\"number\">1</span>],*head=str,*tail=str;</span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">char</span> <span class=\"title\">gc</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(head==tail)&#123;</span><br><span class=\"line\">                tail=(head=str)+fread(str,<span class=\"number\">1</span>,size,<span class=\"built_in\">stdin</span>);</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(head==tail)</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> EOF;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> *head++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"meta-keyword\">undef</span> size</span></span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></span><br><span class=\"line\">        <span class=\"meta\">#<span class=\"meta-keyword\">define</span> gc getchar</span></span><br><span class=\"line\">    <span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> _tp&gt;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">read</span><span class=\"params\">(_tp&amp; x)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> sn=<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">char</span> c=gc();</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(;c!=<span class=\"number\">45</span>&amp;&amp;(c&lt;<span class=\"number\">48</span>||c&gt;<span class=\"number\">57</span>)&amp;&amp;c!=EOF;c=gc());</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(c==<span class=\"number\">45</span>&amp;&amp;c!=EOF)</span><br><span class=\"line\">            sn=<span class=\"number\">-1</span>,c=gc();</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(x=<span class=\"number\">0</span>;c&gt;=<span class=\"number\">48</span>&amp;&amp;c&lt;=<span class=\"number\">57</span>&amp;&amp;c!=EOF;x=(x&lt;&lt;<span class=\"number\">3</span>)+(x&lt;&lt;<span class=\"number\">1</span>)+(c^<span class=\"number\">48</span>),c=gc());</span><br><span class=\"line\">        x*=sn;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> _tp&gt;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">write</span><span class=\"params\">(_tp x,<span class=\"keyword\">char</span> text=<span class=\"string\">' '</span>)</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x&lt;<span class=\"number\">0</span>)</span><br><span class=\"line\">            <span class=\"built_in\">putchar</span>(<span class=\"number\">45</span>),x=-x;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!x)</span><br><span class=\"line\">            <span class=\"built_in\">putchar</span>(<span class=\"number\">48</span>);</span><br><span class=\"line\">        <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">int</span> digit[<span class=\"number\">20</span>];</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(digit[<span class=\"number\">0</span>]=<span class=\"number\">0</span>;x;digit[++digit[<span class=\"number\">0</span>]]=x%<span class=\"number\">10</span>,x/=<span class=\"number\">10</span>);</span><br><span class=\"line\">            <span class=\"keyword\">for</span>(;digit[<span class=\"number\">0</span>];<span class=\"built_in\">putchar</span>(digit[digit[<span class=\"number\">0</span>]--]^<span class=\"number\">48</span>));</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">putchar</span>(text);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> n,m,seed,maxval;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">node</span>&#123;</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> l,r;</span><br><span class=\"line\">    <span class=\"keyword\">mutable</span> <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> val;</span><br><span class=\"line\"></span><br><span class=\"line\">    node(<span class=\"keyword\">int</span> _l,<span class=\"keyword\">int</span> _r=<span class=\"number\">-1</span>,<span class=\"keyword\">long</span> <span class=\"keyword\">long</span> _val=<span class=\"number\">-1</span>)&#123;</span><br><span class=\"line\">        l=_l;</span><br><span class=\"line\">        r=_r;</span><br><span class=\"line\">        val=_val;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"built_in\">std</span>::<span class=\"built_in\">set</span>&lt;node&gt; s;</span><br><span class=\"line\"><span class=\"built_in\">std</span>::<span class=\"built_in\">vector</span>&lt;<span class=\"built_in\">std</span>::pair&lt;<span class=\"keyword\">long</span> <span class=\"keyword\">long</span>,<span class=\"keyword\">int</span>&gt; &gt; vec;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">int</span> <span class=\"title\">rnd</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> res=seed;</span><br><span class=\"line\">    seed=(<span class=\"number\">7L</span>L*seed+<span class=\"number\">13</span>)%<span class=\"number\">1000000007</span>;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">swap</span><span class=\"params\">(<span class=\"keyword\">int</span>&amp; l,<span class=\"keyword\">int</span>&amp; r)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> tmp=l;</span><br><span class=\"line\">    l=r;</span><br><span class=\"line\">    r=tmp;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">cltpow</span><span class=\"params\">(<span class=\"keyword\">int</span> x,<span class=\"keyword\">int</span> y,<span class=\"keyword\">int</span> mod)</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(y==<span class=\"number\">1</span>)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> x;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> res=cltpow(x,y&gt;&gt;<span class=\"number\">1</span>,mod);</span><br><span class=\"line\">    res=<span class=\"number\">1L</span>L*res*res%mod;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(y&amp;<span class=\"number\">1</span>)</span><br><span class=\"line\">        res=<span class=\"number\">1L</span>L*res*x%mod;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">inline</span> <span class=\"keyword\">bool</span> <span class=\"keyword\">operator</span>&lt;(node p,node q)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> p.l&lt;q.l;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">inline</span> _<span class=\"function\">it <span class=\"title\">split</span><span class=\"params\">(<span class=\"keyword\">int</span> pos)</span></span>&#123;</span><br><span class=\"line\">    _it it=<span class=\"built_in\">std</span>::lower_bound(s.begin(),s.end(),node(pos));</span><br><span class=\"line\">    <span class=\"keyword\">if</span>(it!=s.end()&amp;&amp;it-&gt;l==pos)</span><br><span class=\"line\">        <span class=\"keyword\">return</span> it;</span><br><span class=\"line\">    --it;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> l=it-&gt;l,r=it-&gt;r;</span><br><span class=\"line\">    <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> val=it-&gt;val;</span><br><span class=\"line\">    s.erase(it);</span><br><span class=\"line\">    s.insert(node(l,pos<span class=\"number\">-1</span>,val));</span><br><span class=\"line\">    <span class=\"keyword\">return</span> s.insert(node(pos,r,val)).first;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">IntervalAdd</span><span class=\"params\">(<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r,<span class=\"keyword\">int</span> x)</span></span>&#123;</span><br><span class=\"line\">    _it itr=split(r+<span class=\"number\">1</span>),itl=split(l);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re _it p=itl;p!=itr;++p)</span><br><span class=\"line\">        p-&gt;val+=x;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">IntervalAssign</span><span class=\"params\">(<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r,<span class=\"keyword\">int</span> x)</span></span>&#123;</span><br><span class=\"line\"><span class=\"comment\">//就是之前提到的assign</span></span><br><span class=\"line\">    _it itr=split(r+<span class=\"number\">1</span>),itl=split(l);</span><br><span class=\"line\">    s.erase(itl,itr);</span><br><span class=\"line\">    s.insert(node(l,r,x));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> <span class=\"title\">IntervalXth</span><span class=\"params\">(<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r,<span class=\"keyword\">int</span> x)</span></span>&#123;</span><br><span class=\"line\">    _it itr=split(r+<span class=\"number\">1</span>),itl=split(l);</span><br><span class=\"line\">    vec.clear();</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re _it p=itl;p!=itr;++p)</span><br><span class=\"line\">        vec.push_back(<span class=\"built_in\">std</span>::make_pair(p-&gt;val,p-&gt;r-p-&gt;l+<span class=\"number\">1</span>));</span><br><span class=\"line\">    <span class=\"built_in\">std</span>::sort(vec.begin(),vec.end());</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re <span class=\"keyword\">unsigned</span> i=<span class=\"number\">0</span>;i&lt;vec.size();++i)&#123;</span><br><span class=\"line\">        x-=vec[i].second;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(x&lt;=<span class=\"number\">0</span>)</span><br><span class=\"line\">            <span class=\"keyword\">return</span> vec[i].first;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">int</span> <span class=\"title\">IntervalXpow</span><span class=\"params\">(<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r,<span class=\"keyword\">int</span> x,<span class=\"keyword\">int</span> y)</span></span>&#123;</span><br><span class=\"line\">    _it itr=split(r+<span class=\"number\">1</span>),itl=split(l);</span><br><span class=\"line\">    <span class=\"keyword\">int</span> res=<span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re _it p=itl;p!=itr;++p)</span><br><span class=\"line\">        res=(<span class=\"number\">1L</span>L*res+<span class=\"number\">1L</span>L*(p-&gt;r-p-&gt;l+<span class=\"number\">1</span>)*cltpow(p-&gt;val%y,x,y)%y)%y;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">    cltstream::read(n);</span><br><span class=\"line\">    cltstream::read(m);</span><br><span class=\"line\">    cltstream::read(seed);</span><br><span class=\"line\">    cltstream::read(maxval);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;++i)</span><br><span class=\"line\">        s.insert(node(i,i,rnd()%maxval+<span class=\"number\">1</span>));</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=m;++i)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">int</span> opt=rnd()%<span class=\"number\">4</span>+<span class=\"number\">1</span>,l=rnd()%n+<span class=\"number\">1</span>,r=rnd()%n+<span class=\"number\">1</span>,x,y;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(l&gt;r)</span><br><span class=\"line\">            swap(l,r);</span><br><span class=\"line\">        <span class=\"keyword\">switch</span>(opt)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">                x=rnd()%maxval+<span class=\"number\">1</span>;</span><br><span class=\"line\">                IntervalAdd(l,r,x);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">                x=rnd()%maxval+<span class=\"number\">1</span>;</span><br><span class=\"line\">                IntervalAssign(l,r,x);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">                x=rnd()%(r-l+<span class=\"number\">1</span>)+<span class=\"number\">1</span>;</span><br><span class=\"line\">                cltstream::write(IntervalXth(l,r,x),<span class=\"string\">'\\n'</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">                x=rnd()%maxval+<span class=\"number\">1</span>;</span><br><span class=\"line\">                y=rnd()%maxval+<span class=\"number\">1</span>;</span><br><span class=\"line\">                cltstream::write(IntervalXpow(l,r,x,y),<span class=\"string\">'\\n'</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>以上。</p>"},{"title":"自己的一些大胆的想法（持续更新）","date":"2018-11-14T03:02:21.000Z","mathjax":true,"top":1,"_content":"自己闲得没事搞出来的一些毒瘤题。\n\n~~不保证有解（~~\n\n<!-- more -->\n\n# Problem 1\n\n## Description\n\n定义一个从序列到序列的映射$\\text{LIS()}$。我们认为$\\text{LIS}(\\{ a_n\\})=\\{ f_n\\}$，当且仅当\n\n$$\\forall 1\\leqslant i\\leqslant n\\;\\; f_i=\\begin{cases}&1&(i=1\\vee \\forall 1\\leqslant j<i\\;\\; a_j\\geqslant a_i)\\\\&\\max\\limits_{1\\leqslant j<i\\wedge a_j<a_i}f_j+1&(\\text{Otherwise})\\\\\\end{cases}$$\n\n给你一个长度为$n$的序列$\\{ f_n\\}$，你需要求出满足\n\n$$\\text{LIS}(\\{ a_n\\})=\\{ f_n\\}\\wedge\\forall 1\\leqslant i\\leqslant n\\;\\; a_i\\in [1,m]\\cap\\mathbb{Z}$$\n\n的$\\{ a_n\\}$的数量，对$998244353$取模。\n\n## Solution\n\n很明显地，我们有\n\n$$\\forall 1\\leqslant i<j\\leqslant n\\wedge f_i=f_j\\;\\;a_i\\geqslant a_j$$\n\n$$\\forall 1\\leqslant i,j\\leqslant n\\wedge f_i<f_j\\;\\;a_i<a_j$$\n\n我们可以考虑将$\\{ f_n\\}$中最大的数记为$k$，数$x$的出现次数记为$cnt_x$。然后将$[1,m]$划分成$k$个独立区间$[1,x_1],[x_1+1,x_2],\\cdots,[x_{k-1}+1,m]$，在第$i$个区间内独立地选出$cnt_i$个数并统计组成的所有不上升序列的数量。\n\n我们定义$\\text{nisc}(\\text{Non-Increasing Sequence Count})(n,m)$表示在$n$个互不相等且具有大小关系的元素中选出$m$个元素（没有必要互不相同）组成的本质不同的不上升序列的数量。\n\n考虑$m=1$时的情况。此时每个元素被选中都可以组成不上升序列。我们令$f[i][j]$表示$m=i$且第一次选中的元素是$j$时的总方案数。很明显地，我们有\n\n$$\\forall 1\\leqslant i\\leqslant n\\;\\;f[1][i]=1$$\n\n$$\\text{nisc}(n,1)=\\sum\\limits_{i=1}^nf[1][i]=n$$\n\n现在考虑$m=2$。假设我们在第一次选择前再选一次。如果我们在这一次选择了$j$，下一次可能的选项有$1,2,\\cdots,j$，所以\n\n$$f[2][j]=\\sum\\limits_{k=1}^jf[1][k]$$\n\n将这个公式进一步推广，我们得到\n\n$$f[i][j]=\\sum\\limits_{k=1}^jf[i-1][k]$$\n\n$$\\text{nisc}(n,m)=\\sum_{i=1}^nf[m][i]=f[m+1][n]$$\n\n考虑对一个只有$1$的数组进行$m$次前缀和，然后询问第$n$个位置上的数是多少。虽然我不会证，不过我通过人力打表得出\n\n$$\\text{nisc}(n,m)=\\frac1{m!}\\prod\\limits_{i=1}^{m}(n+i-1)$$\n\n考虑一种naive的$\\text{DP}$。定义$g[i][j]$表示将$[1,i]$分成$j$段，第$j$段中选$cnt_j$个元素组成不上升序列，这样的总方案数。我们有\n\n$$g[n][m]=\\sum\\limits_{i=m-1}^{n-1}g[i][m-1]\\text{nisc}(n-i,cnt_m)$$\n\n然而很遗憾，这个方程是错的。\n\n就比如说，考虑这样一组数据：\n\n```plaintext\n3 3\n1 2 1\n```\n\n手动模拟一下，我们发现答案是$4$。但如果直接暴力地套上面的方程，我们会得到$5$。\n\n从本质上来讲，上面的方程会把$[1,3]$划分成$\\{[1,1],[2,3]\\}$和$\\{[1,2],[3,3]\\}$。对于第一种，我们可以得到$\\{\\{1,2,1\\},\\{1,3,1\\}\\}$。对于第二种，我们可以得到$\\{\\{1,3,1\\},\\{1,3,2\\},\\{2,3,2\\}\\}$。注意到$\\{1,3,1\\}$出现了两次，这正是这种做法的错误所在。\n","source":"_posts/2018-11-14-poisonous-problems.md","raw":"---\ntitle: 自己的一些大胆的想法（持续更新）\ndate: 2018-11-14 11:02:21\ntags:\n  - 毒瘤题\ncategories:\n  - 其它\nmathjax: true\ntop: 1\n---\n自己闲得没事搞出来的一些毒瘤题。\n\n~~不保证有解（~~\n\n<!-- more -->\n\n# Problem 1\n\n## Description\n\n定义一个从序列到序列的映射$\\text{LIS()}$。我们认为$\\text{LIS}(\\{ a_n\\})=\\{ f_n\\}$，当且仅当\n\n$$\\forall 1\\leqslant i\\leqslant n\\;\\; f_i=\\begin{cases}&1&(i=1\\vee \\forall 1\\leqslant j<i\\;\\; a_j\\geqslant a_i)\\\\&\\max\\limits_{1\\leqslant j<i\\wedge a_j<a_i}f_j+1&(\\text{Otherwise})\\\\\\end{cases}$$\n\n给你一个长度为$n$的序列$\\{ f_n\\}$，你需要求出满足\n\n$$\\text{LIS}(\\{ a_n\\})=\\{ f_n\\}\\wedge\\forall 1\\leqslant i\\leqslant n\\;\\; a_i\\in [1,m]\\cap\\mathbb{Z}$$\n\n的$\\{ a_n\\}$的数量，对$998244353$取模。\n\n## Solution\n\n很明显地，我们有\n\n$$\\forall 1\\leqslant i<j\\leqslant n\\wedge f_i=f_j\\;\\;a_i\\geqslant a_j$$\n\n$$\\forall 1\\leqslant i,j\\leqslant n\\wedge f_i<f_j\\;\\;a_i<a_j$$\n\n我们可以考虑将$\\{ f_n\\}$中最大的数记为$k$，数$x$的出现次数记为$cnt_x$。然后将$[1,m]$划分成$k$个独立区间$[1,x_1],[x_1+1,x_2],\\cdots,[x_{k-1}+1,m]$，在第$i$个区间内独立地选出$cnt_i$个数并统计组成的所有不上升序列的数量。\n\n我们定义$\\text{nisc}(\\text{Non-Increasing Sequence Count})(n,m)$表示在$n$个互不相等且具有大小关系的元素中选出$m$个元素（没有必要互不相同）组成的本质不同的不上升序列的数量。\n\n考虑$m=1$时的情况。此时每个元素被选中都可以组成不上升序列。我们令$f[i][j]$表示$m=i$且第一次选中的元素是$j$时的总方案数。很明显地，我们有\n\n$$\\forall 1\\leqslant i\\leqslant n\\;\\;f[1][i]=1$$\n\n$$\\text{nisc}(n,1)=\\sum\\limits_{i=1}^nf[1][i]=n$$\n\n现在考虑$m=2$。假设我们在第一次选择前再选一次。如果我们在这一次选择了$j$，下一次可能的选项有$1,2,\\cdots,j$，所以\n\n$$f[2][j]=\\sum\\limits_{k=1}^jf[1][k]$$\n\n将这个公式进一步推广，我们得到\n\n$$f[i][j]=\\sum\\limits_{k=1}^jf[i-1][k]$$\n\n$$\\text{nisc}(n,m)=\\sum_{i=1}^nf[m][i]=f[m+1][n]$$\n\n考虑对一个只有$1$的数组进行$m$次前缀和，然后询问第$n$个位置上的数是多少。虽然我不会证，不过我通过人力打表得出\n\n$$\\text{nisc}(n,m)=\\frac1{m!}\\prod\\limits_{i=1}^{m}(n+i-1)$$\n\n考虑一种naive的$\\text{DP}$。定义$g[i][j]$表示将$[1,i]$分成$j$段，第$j$段中选$cnt_j$个元素组成不上升序列，这样的总方案数。我们有\n\n$$g[n][m]=\\sum\\limits_{i=m-1}^{n-1}g[i][m-1]\\text{nisc}(n-i,cnt_m)$$\n\n然而很遗憾，这个方程是错的。\n\n就比如说，考虑这样一组数据：\n\n```plaintext\n3 3\n1 2 1\n```\n\n手动模拟一下，我们发现答案是$4$。但如果直接暴力地套上面的方程，我们会得到$5$。\n\n从本质上来讲，上面的方程会把$[1,3]$划分成$\\{[1,1],[2,3]\\}$和$\\{[1,2],[3,3]\\}$。对于第一种，我们可以得到$\\{\\{1,2,1\\},\\{1,3,1\\}\\}$。对于第二种，我们可以得到$\\{\\{1,3,1\\},\\{1,3,2\\},\\{2,3,2\\}\\}$。注意到$\\{1,3,1\\}$出现了两次，这正是这种做法的错误所在。\n","slug":"poisonous-problems","published":1,"updated":"2018-12-12T07:49:27.217Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjpn8w5zj001rroguoopprye2","content":"<p>自己闲得没事搞出来的一些毒瘤题。</p>\n<p><del>不保证有解（</del></p>\n<a id=\"more\"></a>\n<h1 id=\"Problem-1\"><a href=\"#Problem-1\" class=\"headerlink\" title=\"Problem 1\"></a>Problem 1</h1><h2 id=\"Description\"><a href=\"#Description\" class=\"headerlink\" title=\"Description\"></a>Description</h2><p>定义一个从序列到序列的映射$\\text{LIS()}$。我们认为$\\text{LIS}(\\{ a_n\\})=\\{ f_n\\}$，当且仅当</p>\n<script type=\"math/tex; mode=display\">\\forall 1\\leqslant i\\leqslant n\\;\\; f_i=\\begin{cases}&1&(i=1\\vee \\forall 1\\leqslant j<i\\;\\; a_j\\geqslant a_i)\\\\&\\max\\limits_{1\\leqslant j<i\\wedge a_j<a_i}f_j+1&(\\text{Otherwise})\\\\\\end{cases}</script><p>给你一个长度为$n$的序列$\\{ f_n\\}$，你需要求出满足</p>\n<script type=\"math/tex; mode=display\">\\text{LIS}(\\{ a_n\\})=\\{ f_n\\}\\wedge\\forall 1\\leqslant i\\leqslant n\\;\\; a_i\\in [1,m]\\cap\\mathbb{Z}</script><p>的$\\{ a_n\\}$的数量，对$998244353$取模。</p>\n<h2 id=\"Solution\"><a href=\"#Solution\" class=\"headerlink\" title=\"Solution\"></a>Solution</h2><p>很明显地，我们有</p>\n<script type=\"math/tex; mode=display\">\\forall 1\\leqslant i<j\\leqslant n\\wedge f_i=f_j\\;\\;a_i\\geqslant a_j</script><script type=\"math/tex; mode=display\">\\forall 1\\leqslant i,j\\leqslant n\\wedge f_i<f_j\\;\\;a_i<a_j</script><p>我们可以考虑将$\\{ f_n\\}$中最大的数记为$k$，数$x$的出现次数记为$cnt_x$。然后将$[1,m]$划分成$k$个独立区间$[1,x_1],[x_1+1,x_2],\\cdots,[x_{k-1}+1,m]$，在第$i$个区间内独立地选出$cnt_i$个数并统计组成的所有不上升序列的数量。</p>\n<p>我们定义$\\text{nisc}(\\text{Non-Increasing Sequence Count})(n,m)$表示在$n$个互不相等且具有大小关系的元素中选出$m$个元素（没有必要互不相同）组成的本质不同的不上升序列的数量。</p>\n<p>考虑$m=1$时的情况。此时每个元素被选中都可以组成不上升序列。我们令$f[i][j]$表示$m=i$且第一次选中的元素是$j$时的总方案数。很明显地，我们有</p>\n<script type=\"math/tex; mode=display\">\\forall 1\\leqslant i\\leqslant n\\;\\;f[1][i]=1</script><script type=\"math/tex; mode=display\">\\text{nisc}(n,1)=\\sum\\limits_{i=1}^nf[1][i]=n</script><p>现在考虑$m=2$。假设我们在第一次选择前再选一次。如果我们在这一次选择了$j$，下一次可能的选项有$1,2,\\cdots,j$，所以</p>\n<script type=\"math/tex; mode=display\">f[2][j]=\\sum\\limits_{k=1}^jf[1][k]</script><p>将这个公式进一步推广，我们得到</p>\n<script type=\"math/tex; mode=display\">f[i][j]=\\sum\\limits_{k=1}^jf[i-1][k]</script><script type=\"math/tex; mode=display\">\\text{nisc}(n,m)=\\sum_{i=1}^nf[m][i]=f[m+1][n]</script><p>考虑对一个只有$1$的数组进行$m$次前缀和，然后询问第$n$个位置上的数是多少。虽然我不会证，不过我通过人力打表得出</p>\n<script type=\"math/tex; mode=display\">\\text{nisc}(n,m)=\\frac1{m!}\\prod\\limits_{i=1}^{m}(n+i-1)</script><p>考虑一种naive的$\\text{DP}$。定义$g[i][j]$表示将$[1,i]$分成$j$段，第$j$段中选$cnt_j$个元素组成不上升序列，这样的总方案数。我们有</p>\n<script type=\"math/tex; mode=display\">g[n][m]=\\sum\\limits_{i=m-1}^{n-1}g[i][m-1]\\text{nisc}(n-i,cnt_m)</script><p>然而很遗憾，这个方程是错的。</p>\n<p>就比如说，考虑这样一组数据：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">3 3</span><br><span class=\"line\">1 2 1</span><br></pre></td></tr></table></figure>\n<p>手动模拟一下，我们发现答案是$4$。但如果直接暴力地套上面的方程，我们会得到$5$。</p>\n<p>从本质上来讲，上面的方程会把$[1,3]$划分成$\\{[1,1],[2,3]\\}$和$\\{[1,2],[3,3]\\}$。对于第一种，我们可以得到$\\{\\{1,2,1\\},\\{1,3,1\\}\\}$。对于第二种，我们可以得到$\\{\\{1,3,1\\},\\{1,3,2\\},\\{2,3,2\\}\\}$。注意到$\\{1,3,1\\}$出现了两次，这正是这种做法的错误所在。</p>\n","site":{"data":{}},"excerpt":"<p>自己闲得没事搞出来的一些毒瘤题。</p>\n<p><del>不保证有解（</del></p>","more":"<h1 id=\"Problem-1\"><a href=\"#Problem-1\" class=\"headerlink\" title=\"Problem 1\"></a>Problem 1</h1><h2 id=\"Description\"><a href=\"#Description\" class=\"headerlink\" title=\"Description\"></a>Description</h2><p>定义一个从序列到序列的映射$\\text{LIS()}$。我们认为$\\text{LIS}(\\{ a_n\\})=\\{ f_n\\}$，当且仅当</p>\n<script type=\"math/tex; mode=display\">\\forall 1\\leqslant i\\leqslant n\\;\\; f_i=\\begin{cases}&1&(i=1\\vee \\forall 1\\leqslant j<i\\;\\; a_j\\geqslant a_i)\\\\&\\max\\limits_{1\\leqslant j<i\\wedge a_j<a_i}f_j+1&(\\text{Otherwise})\\\\\\end{cases}</script><p>给你一个长度为$n$的序列$\\{ f_n\\}$，你需要求出满足</p>\n<script type=\"math/tex; mode=display\">\\text{LIS}(\\{ a_n\\})=\\{ f_n\\}\\wedge\\forall 1\\leqslant i\\leqslant n\\;\\; a_i\\in [1,m]\\cap\\mathbb{Z}</script><p>的$\\{ a_n\\}$的数量，对$998244353$取模。</p>\n<h2 id=\"Solution\"><a href=\"#Solution\" class=\"headerlink\" title=\"Solution\"></a>Solution</h2><p>很明显地，我们有</p>\n<script type=\"math/tex; mode=display\">\\forall 1\\leqslant i<j\\leqslant n\\wedge f_i=f_j\\;\\;a_i\\geqslant a_j</script><script type=\"math/tex; mode=display\">\\forall 1\\leqslant i,j\\leqslant n\\wedge f_i<f_j\\;\\;a_i<a_j</script><p>我们可以考虑将$\\{ f_n\\}$中最大的数记为$k$，数$x$的出现次数记为$cnt_x$。然后将$[1,m]$划分成$k$个独立区间$[1,x_1],[x_1+1,x_2],\\cdots,[x_{k-1}+1,m]$，在第$i$个区间内独立地选出$cnt_i$个数并统计组成的所有不上升序列的数量。</p>\n<p>我们定义$\\text{nisc}(\\text{Non-Increasing Sequence Count})(n,m)$表示在$n$个互不相等且具有大小关系的元素中选出$m$个元素（没有必要互不相同）组成的本质不同的不上升序列的数量。</p>\n<p>考虑$m=1$时的情况。此时每个元素被选中都可以组成不上升序列。我们令$f[i][j]$表示$m=i$且第一次选中的元素是$j$时的总方案数。很明显地，我们有</p>\n<script type=\"math/tex; mode=display\">\\forall 1\\leqslant i\\leqslant n\\;\\;f[1][i]=1</script><script type=\"math/tex; mode=display\">\\text{nisc}(n,1)=\\sum\\limits_{i=1}^nf[1][i]=n</script><p>现在考虑$m=2$。假设我们在第一次选择前再选一次。如果我们在这一次选择了$j$，下一次可能的选项有$1,2,\\cdots,j$，所以</p>\n<script type=\"math/tex; mode=display\">f[2][j]=\\sum\\limits_{k=1}^jf[1][k]</script><p>将这个公式进一步推广，我们得到</p>\n<script type=\"math/tex; mode=display\">f[i][j]=\\sum\\limits_{k=1}^jf[i-1][k]</script><script type=\"math/tex; mode=display\">\\text{nisc}(n,m)=\\sum_{i=1}^nf[m][i]=f[m+1][n]</script><p>考虑对一个只有$1$的数组进行$m$次前缀和，然后询问第$n$个位置上的数是多少。虽然我不会证，不过我通过人力打表得出</p>\n<script type=\"math/tex; mode=display\">\\text{nisc}(n,m)=\\frac1{m!}\\prod\\limits_{i=1}^{m}(n+i-1)</script><p>考虑一种naive的$\\text{DP}$。定义$g[i][j]$表示将$[1,i]$分成$j$段，第$j$段中选$cnt_j$个元素组成不上升序列，这样的总方案数。我们有</p>\n<script type=\"math/tex; mode=display\">g[n][m]=\\sum\\limits_{i=m-1}^{n-1}g[i][m-1]\\text{nisc}(n-i,cnt_m)</script><p>然而很遗憾，这个方程是错的。</p>\n<p>就比如说，考虑这样一组数据：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">3 3</span><br><span class=\"line\">1 2 1</span><br></pre></td></tr></table></figure>\n<p>手动模拟一下，我们发现答案是$4$。但如果直接暴力地套上面的方程，我们会得到$5$。</p>\n<p>从本质上来讲，上面的方程会把$[1,3]$划分成$\\{[1,1],[2,3]\\}$和$\\{[1,2],[3,3]\\}$。对于第一种，我们可以得到$\\{\\{1,2,1\\},\\{1,3,1\\}\\}$。对于第二种，我们可以得到$\\{\\{1,3,1\\},\\{1,3,2\\},\\{2,3,2\\}\\}$。注意到$\\{1,3,1\\}$出现了两次，这正是这种做法的错误所在。</p>"},{"title":"「Luogu-P5009」毒瘤分块题","date":"2018-11-08T00:04:22.000Z","mathjax":true,"_content":"[传送门](https://www.luogu.org/problemnew/show/P5009)\n\n<!-- more -->\n\n从来没做过这么毒瘤的题qaq\n\n就算看了题解现在还是一脸懵逼qaq\n\n首先，题目带了分块，我们可以先考虑分块。但是我太菜了不知道分块怎么写，所以我写的线段树qaq\n\n对$v$的修改相对来说比较简单，我们来重点看对$a$和$b$的修改。假设在某个时刻$t_1$，我们将某个$a_i$加上了$x$，然后又在某个时刻$t_2(t_2>t_1)$，我们要查询之前那个位置上的值，很明显地，答案应该是$v_i+t_1a_ib_i+(t_2-t_1)(a_i+x)b_i$。但是如果真的像这样计算，每次修改就要在这个表达式后面加上一项，很难有效地维护大量的修改。考虑到对$v$的修改比较简单，我们可以通过修改$v$将表达式维持在一个较为简单的形式。形式化地，我们可以找到一个$v_i^\\prime$使得$v_i^\\prime+t_1(a_i+x)b_i=v+t_1a_ib_i$，并将$v_i$修改至$v_i^\\prime$，然后查询的时候我们就可以直接返回$v_i^\\prime+t_2(a_i+x)b_i$了。不难发现$v_i^\\prime=v_i-t_1xb_i$。\n\n需要注意的是，因为我们要使用线段树维护，必然会遇到同一个区间被连续修改多次的情况。假设有这样一个区间，区间内$a$的总修改值是$x$，$b$的总修改值是$y$，那么在某一时刻$t$，该区间内所有值的和应该是$\\Sigma v_i+t\\Sigma (a_i+x)(b_i+y)$。现在我们考虑将$a$加上$z$，此时$\\Sigma v_i^\\prime+t\\Sigma (a_i+x+z)(b_i+y)=\\Sigma v_i+t\\Sigma (a_i+x)(b_i+y)$，即$\\Sigma v_i^\\prime=\\Sigma v_i-tz\\Sigma (b_i+y)$。\n\n不过，上式中$tz\\Sigma (b_i+y)$的$(b_i+y)$指的是修改后的$b_i$的值，我们是肯定不能在下推标记时存储每一个历史版本的$b_i$的。我们考虑拆括号，将上式拆成$tz\\Sigma b_i+tzy$，其中$tzy$是一个常数，我们可以直接累加入标记。而至于$tz\\Sigma b_i$，考虑到每层节点的$\\Sigma b_i$都不同，我们可以维护一个$B$，意思是$\\Sigma v_i+=B\\Sigma b_i$，每次修改时$B+=tz$。当然，我们还需要一个标记来记录对$a$自身的修改。对$b$的修改也是类似的。\n\n然后是毒瘤的下推标记。\n\n```cpp\naddv[son]+=A[father]*suma[son]+B[father]*sumb[son]+addv[father];\n//就是上面这句qaq现在还是一脸懵逼qaq\nA[son]+=A[father];\nB[son]+=B[father];\nadda[son]+=adda[father];\naddb[son]+=addf[father];\n```\n\n其实我也不知道我上面在扯些啥，所以以下是代码~~，反正应该没人能看懂我的清奇写法（~~\n\n```cpp\n#include<cstdio>\n#define re register\n#define maxn 200005\n#define maxm 200005\n#define mod 100000007\n\nnamespace cltstream{\n\t#define size 1048576\n\tchar cltin[size+1],*ih=cltin,*it=cltin;\n\tinline char gc(){\n\t\t#ifdef ONLINE_JUDGE\n\t\t\tif(ih==it){\n\t\t\t\tit=(ih=cltin)+fread(cltin,1,size,stdin);\n\t\t\t\tif(ih==it)\n\t\t\t\t\treturn EOF;\n\t\t\t}\n\t\t\treturn *ih++;\n\t\t#else\n\t\t\treturn getchar();\n\t\t#endif\n\t}\n\n\tchar cltout[size+1],*oh=cltout,*ot=cltout+size;\n\tinline void pc(char c){\n\t\tif(oh==ot){\n\t\t\tfwrite(cltout,1,size,stdout);\n\t\t\toh=cltout;\n\t\t}\n\t\t*oh++=c;\n\t}\n\t#define clop() fwrite(cltstream::cltout,1,cltstream::oh-cltstream::cltout,stdout)\n\t#undef size\n\n\ttemplate <typename _tp>\n\tinline void read(_tp& x){\n\t\tint sn=1;\n\t\tchar c=gc();\n\t\tfor(;c!=45&&(c<48||c>57)&&c!=EOF;c=gc());\n\t\tif(c==45&&c!=EOF)\n\t\t\tsn=-1,c=gc();\n\t\tfor(x=0;c>=48&&c<=57&&c!=EOF;x=(x<<3)+(x<<1)+(c^48),c=gc());\n\t\tx*=sn;\n\t}\n\n\ttemplate <typename _tp>\n\tinline void write(_tp x,char text=-1){\n\t\tif(x<0)\n\t\t\tpc(45),x=-x;\n\t\tif(!x)\n\t\t\tpc(48);\n\t\telse{\n\t\t\tint digit[22];\n\t\t\tfor(digit[0]=0;x;digit[++digit[0]]=x%10,x/=10);\n\t\t\tfor(;digit[0];pc(digit[digit[0]--]^48));\n\t\t}\n\t\tif(text>=0)\n\t\t\tpc(text);\n\t}\n}\n\nint n,m;\nint sumv[(maxn<<2)+1],suma[(maxn<<2)+1],sumb[(maxn<<2)+1],sump[(maxn<<2)+1];\nint A[(maxn<<2)+1],B[(maxn<<2)+1];\nint addv[(maxn<<2)+1],adda[(maxn<<2)+1],addb[(maxn<<2)+1];\n\ninline void pushDown(int cur,int ln,int rn){\n\tsumv[cur<<1]=(sumv[cur<<1]+1LL*A[cur]*suma[cur<<1]%mod)%mod;\n\tsumv[cur<<1]=(sumv[cur<<1]+1LL*B[cur]*sumb[cur<<1]%mod)%mod;\n\tsumv[cur<<1]=(sumv[cur<<1]+1LL*ln*addv[cur]%mod)%mod;\n\tsump[cur<<1]=(sump[cur<<1]+1LL*adda[cur]*sumb[cur<<1]%mod)%mod;\n\tsump[cur<<1]=(sump[cur<<1]+1LL*addb[cur]*suma[cur<<1]%mod)%mod;\n\tsump[cur<<1]=(sump[cur<<1]+1LL*adda[cur]*addb[cur]%mod*ln%mod)%mod;\n\tsuma[cur<<1]=(suma[cur<<1]+1LL*ln*adda[cur]%mod)%mod;\n\tsumb[cur<<1]=(sumb[cur<<1]+1LL*ln*addb[cur]%mod)%mod;\n\taddv[cur<<1]=(addv[cur<<1]+1LL*A[cur]*adda[cur<<1]%mod)%mod;\n\taddv[cur<<1]=(addv[cur<<1]+1LL*B[cur]*addb[cur<<1]%mod)%mod;\n\taddv[cur<<1]=(addv[cur<<1]+addv[cur])%mod;\n\tA[cur<<1]=(A[cur<<1]+A[cur])%mod;\n\tB[cur<<1]=(B[cur<<1]+B[cur])%mod;\n\tadda[cur<<1]=(adda[cur<<1]+adda[cur])%mod;\n\taddb[cur<<1]=(addb[cur<<1]+addb[cur])%mod;\n\tsumv[cur<<1|1]=(sumv[cur<<1|1]+1LL*A[cur]*suma[cur<<1|1]%mod)%mod;\n\tsumv[cur<<1|1]=(sumv[cur<<1|1]+1LL*B[cur]*sumb[cur<<1|1]%mod)%mod;\n\tsumv[cur<<1|1]=(sumv[cur<<1|1]+1LL*rn*addv[cur]%mod)%mod;\n\tsump[cur<<1|1]=(sump[cur<<1|1]+1LL*adda[cur]*sumb[cur<<1|1]%mod)%mod;\n\tsump[cur<<1|1]=(sump[cur<<1|1]+1LL*addb[cur]*suma[cur<<1|1]%mod)%mod;\n\tsump[cur<<1|1]=(sump[cur<<1|1]+1LL*adda[cur]*addb[cur]%mod*rn%mod)%mod;\n\tsuma[cur<<1|1]=(suma[cur<<1|1]+1LL*rn*adda[cur]%mod)%mod;\n\tsumb[cur<<1|1]=(sumb[cur<<1|1]+1LL*rn*addb[cur]%mod)%mod;\n\taddv[cur<<1|1]=(addv[cur<<1|1]+1LL*A[cur]*adda[cur<<1|1]%mod)%mod;\n\taddv[cur<<1|1]=(addv[cur<<1|1]+1LL*B[cur]*addb[cur<<1|1]%mod)%mod;\n\taddv[cur<<1|1]=(addv[cur<<1|1]+addv[cur])%mod;\n\tA[cur<<1|1]=(A[cur<<1|1]+A[cur])%mod;\n\tB[cur<<1|1]=(B[cur<<1|1]+B[cur])%mod;\n\tadda[cur<<1|1]=(adda[cur<<1|1]+adda[cur])%mod;\n\taddb[cur<<1|1]=(addb[cur<<1|1]+addb[cur])%mod;\n\tA[cur]=B[cur]=addv[cur]=adda[cur]=addb[cur]=0;\n}\n\ninline void pushUp(int cur){\n\tsumv[cur]=(sumv[cur<<1]+sumv[cur<<1|1])%mod;\n\tsuma[cur]=(suma[cur<<1]+suma[cur<<1|1])%mod;\n\tsumb[cur]=(sumb[cur<<1]+sumb[cur<<1|1])%mod;\n\tsump[cur]=(sump[cur<<1]+sump[cur<<1|1])%mod;\n}\n\nvoid build(int cur,int l,int r){\n\tif(l==r){\n\t\tcltstream::read(sumv[cur]);\n\t\tcltstream::read(suma[cur]);\n\t\tcltstream::read(sumb[cur]);\n\t\tsumv[cur]=(sumv[cur]%mod+mod)%mod;\n\t\tsuma[cur]=(suma[cur]%mod+mod)%mod;\n\t\tsumb[cur]=(sumb[cur]%mod+mod)%mod;\n\t\tsump[cur]=1LL*suma[cur]*sumb[cur]%mod;\n\t}\n\telse{\n\t\tint mid=(l+r)>>1;\n\t\tbuild(cur<<1,l,mid);\n\t\tbuild(cur<<1|1,mid+1,r);\n\t\tpushUp(cur);\n\t}\n}\n\nint query(int L,int R,int t,int cur,int l,int r){\n\tif(l>=L&&r<=R)\n\t\treturn (sumv[cur]+1LL*t*sump[cur]%mod)%mod;\n\telse{\n\t\tint mid=(l+r)>>1,res=0;\n\t\tpushDown(cur,mid-l+1,r-mid);\n\t\tif(L<=mid)\n\t\t\tres=(res+query(L,R,t,cur<<1,l,mid))%mod;\n\t\tif(R>mid)\n\t\t\tres=(res+query(L,R,t,cur<<1|1,mid+1,r))%mod;\n\t\treturn res;\n\t}\n}\n\nvoid modifyV(int L,int R,int x,int cur,int l,int r){\n\tif(l>=L&&r<=R){\n\t\tsumv[cur]=(sumv[cur]+1LL*(r-l+1)*x%mod)%mod;\n\t\taddv[cur]=(addv[cur]+x)%mod;\n\t}\n\telse{\n\t\tint mid=(l+r)>>1;\n\t\tpushDown(cur,mid-l+1,r-mid);\n\t\tif(L<=mid)\n\t\t\tmodifyV(L,R,x,cur<<1,l,mid);\n\t\tif(R>mid)\n\t\t\tmodifyV(L,R,x,cur<<1|1,mid+1,r);\n\t\tpushUp(cur);\n\t}\n}\n\nvoid modifyA(int L,int R,int t,int x,int cur,int l,int r){\n\tif(l>=L&&r<=R){\n\t\tsumv[cur]=(sumv[cur]+(-1LL*x*t%mod*sumb[cur]%mod+mod)%mod)%mod;\n\t\tsuma[cur]=(suma[cur]+1LL*(r-l+1)*x%mod)%mod;\n\t\tsump[cur]=(sump[cur]+1LL*sumb[cur]*x%mod)%mod;\n\t\tB[cur]=(B[cur]+(-1LL*x*t%mod+mod)%mod)%mod;\n\t\taddv[cur]=(addv[cur]+(-1LL*x*t%mod*addb[cur]%mod+mod)%mod)%mod;\n\t\tadda[cur]=(adda[cur]+x)%mod;\n\t}\n\telse{\n\t\tint mid=(l+r)>>1;\n\t\tpushDown(cur,mid-l+1,r-mid);\n\t\tif(L<=mid)\n\t\t\tmodifyA(L,R,t,x,cur<<1,l,mid);\n\t\tif(R>mid)\n\t\t\tmodifyA(L,R,t,x,cur<<1|1,mid+1,r);\n\t\tpushUp(cur);\n\t}\n}\n\nvoid modifyB(int L,int R,int t,int x,int cur,int l,int r){\n\tif(l>=L&&r<=R){\n\t\tsumv[cur]=(sumv[cur]+(-1LL*x*t%mod*suma[cur]%mod+mod)%mod)%mod;\n\t\tsumb[cur]=(sumb[cur]+1LL*(r-l+1)*x%mod)%mod;\n\t\tsump[cur]=(sump[cur]+1LL*suma[cur]*x%mod)%mod;\n\t\tA[cur]=(A[cur]+(-1LL*x*t%mod+mod)%mod)%mod;\n\t\taddv[cur]=(addv[cur]+(-1LL*x*t%mod*adda[cur]%mod+mod)%mod)%mod;\n\t\taddb[cur]=(addb[cur]+x)%mod;\n\t}\n\telse{\n\t\tint mid=(l+r)>>1;\n\t\tpushDown(cur,mid-l+1,r-mid);\n\t\tif(L<=mid)\n\t\t\tmodifyB(L,R,t,x,cur<<1,l,mid);\n\t\tif(R>mid)\n\t\t\tmodifyB(L,R,t,x,cur<<1|1,mid+1,r);\n\t\tpushUp(cur);\n\t}\n}\n\nint main(){\n\tcltstream::read(n);\n\tcltstream::read(m);\n\tbuild(1,1,n);\n\tfor(re int i=1;i<=m;++i){\n\t\tint opt,t,l,r,x;\n\t\tcltstream::read(opt);\n\t\tcltstream::read(t);\n\t\tcltstream::read(l);\n\t\tcltstream::read(r);\n\t\tswitch(opt){\n\t\t\tcase 1:\n\t\t\t\tcltstream::write(query(l,r,t,1,1,n),10);\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tcltstream::read(x);\n\t\t\t\tmodifyA(l,r,t,(x%mod+mod)%mod,1,1,n);\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tcltstream::read(x);\n\t\t\t\tmodifyB(l,r,t,(x%mod+mod)%mod,1,1,n);\n\t\t\t\tbreak;\n\t\t\tcase 4:\n\t\t\t\tcltstream::read(x);\n\t\t\t\tmodifyV(l,r,(x%mod+mod)%mod,1,1,n);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\tclop();\n\treturn 0;\n}\n```\n\n大概是我太菜了不适合做这种毒瘤题吧qaq\n\n![](https://i.loli.net/2018/11/08/5be38edf529ca.jpg)\n\n距 __在NOIp2018爆零__ 还剩 __1 天__。","source":"_posts/2018-11-08-luogu-p5009-solution.md","raw":"---\ntitle: 「Luogu-P5009」毒瘤分块题\ndate: 2018-11-08 08:04:22\ntags:\n  - 洛谷\n  - 线段树\ncategories:\n  - 题解\nmathjax: true\n---\n[传送门](https://www.luogu.org/problemnew/show/P5009)\n\n<!-- more -->\n\n从来没做过这么毒瘤的题qaq\n\n就算看了题解现在还是一脸懵逼qaq\n\n首先，题目带了分块，我们可以先考虑分块。但是我太菜了不知道分块怎么写，所以我写的线段树qaq\n\n对$v$的修改相对来说比较简单，我们来重点看对$a$和$b$的修改。假设在某个时刻$t_1$，我们将某个$a_i$加上了$x$，然后又在某个时刻$t_2(t_2>t_1)$，我们要查询之前那个位置上的值，很明显地，答案应该是$v_i+t_1a_ib_i+(t_2-t_1)(a_i+x)b_i$。但是如果真的像这样计算，每次修改就要在这个表达式后面加上一项，很难有效地维护大量的修改。考虑到对$v$的修改比较简单，我们可以通过修改$v$将表达式维持在一个较为简单的形式。形式化地，我们可以找到一个$v_i^\\prime$使得$v_i^\\prime+t_1(a_i+x)b_i=v+t_1a_ib_i$，并将$v_i$修改至$v_i^\\prime$，然后查询的时候我们就可以直接返回$v_i^\\prime+t_2(a_i+x)b_i$了。不难发现$v_i^\\prime=v_i-t_1xb_i$。\n\n需要注意的是，因为我们要使用线段树维护，必然会遇到同一个区间被连续修改多次的情况。假设有这样一个区间，区间内$a$的总修改值是$x$，$b$的总修改值是$y$，那么在某一时刻$t$，该区间内所有值的和应该是$\\Sigma v_i+t\\Sigma (a_i+x)(b_i+y)$。现在我们考虑将$a$加上$z$，此时$\\Sigma v_i^\\prime+t\\Sigma (a_i+x+z)(b_i+y)=\\Sigma v_i+t\\Sigma (a_i+x)(b_i+y)$，即$\\Sigma v_i^\\prime=\\Sigma v_i-tz\\Sigma (b_i+y)$。\n\n不过，上式中$tz\\Sigma (b_i+y)$的$(b_i+y)$指的是修改后的$b_i$的值，我们是肯定不能在下推标记时存储每一个历史版本的$b_i$的。我们考虑拆括号，将上式拆成$tz\\Sigma b_i+tzy$，其中$tzy$是一个常数，我们可以直接累加入标记。而至于$tz\\Sigma b_i$，考虑到每层节点的$\\Sigma b_i$都不同，我们可以维护一个$B$，意思是$\\Sigma v_i+=B\\Sigma b_i$，每次修改时$B+=tz$。当然，我们还需要一个标记来记录对$a$自身的修改。对$b$的修改也是类似的。\n\n然后是毒瘤的下推标记。\n\n```cpp\naddv[son]+=A[father]*suma[son]+B[father]*sumb[son]+addv[father];\n//就是上面这句qaq现在还是一脸懵逼qaq\nA[son]+=A[father];\nB[son]+=B[father];\nadda[son]+=adda[father];\naddb[son]+=addf[father];\n```\n\n其实我也不知道我上面在扯些啥，所以以下是代码~~，反正应该没人能看懂我的清奇写法（~~\n\n```cpp\n#include<cstdio>\n#define re register\n#define maxn 200005\n#define maxm 200005\n#define mod 100000007\n\nnamespace cltstream{\n\t#define size 1048576\n\tchar cltin[size+1],*ih=cltin,*it=cltin;\n\tinline char gc(){\n\t\t#ifdef ONLINE_JUDGE\n\t\t\tif(ih==it){\n\t\t\t\tit=(ih=cltin)+fread(cltin,1,size,stdin);\n\t\t\t\tif(ih==it)\n\t\t\t\t\treturn EOF;\n\t\t\t}\n\t\t\treturn *ih++;\n\t\t#else\n\t\t\treturn getchar();\n\t\t#endif\n\t}\n\n\tchar cltout[size+1],*oh=cltout,*ot=cltout+size;\n\tinline void pc(char c){\n\t\tif(oh==ot){\n\t\t\tfwrite(cltout,1,size,stdout);\n\t\t\toh=cltout;\n\t\t}\n\t\t*oh++=c;\n\t}\n\t#define clop() fwrite(cltstream::cltout,1,cltstream::oh-cltstream::cltout,stdout)\n\t#undef size\n\n\ttemplate <typename _tp>\n\tinline void read(_tp& x){\n\t\tint sn=1;\n\t\tchar c=gc();\n\t\tfor(;c!=45&&(c<48||c>57)&&c!=EOF;c=gc());\n\t\tif(c==45&&c!=EOF)\n\t\t\tsn=-1,c=gc();\n\t\tfor(x=0;c>=48&&c<=57&&c!=EOF;x=(x<<3)+(x<<1)+(c^48),c=gc());\n\t\tx*=sn;\n\t}\n\n\ttemplate <typename _tp>\n\tinline void write(_tp x,char text=-1){\n\t\tif(x<0)\n\t\t\tpc(45),x=-x;\n\t\tif(!x)\n\t\t\tpc(48);\n\t\telse{\n\t\t\tint digit[22];\n\t\t\tfor(digit[0]=0;x;digit[++digit[0]]=x%10,x/=10);\n\t\t\tfor(;digit[0];pc(digit[digit[0]--]^48));\n\t\t}\n\t\tif(text>=0)\n\t\t\tpc(text);\n\t}\n}\n\nint n,m;\nint sumv[(maxn<<2)+1],suma[(maxn<<2)+1],sumb[(maxn<<2)+1],sump[(maxn<<2)+1];\nint A[(maxn<<2)+1],B[(maxn<<2)+1];\nint addv[(maxn<<2)+1],adda[(maxn<<2)+1],addb[(maxn<<2)+1];\n\ninline void pushDown(int cur,int ln,int rn){\n\tsumv[cur<<1]=(sumv[cur<<1]+1LL*A[cur]*suma[cur<<1]%mod)%mod;\n\tsumv[cur<<1]=(sumv[cur<<1]+1LL*B[cur]*sumb[cur<<1]%mod)%mod;\n\tsumv[cur<<1]=(sumv[cur<<1]+1LL*ln*addv[cur]%mod)%mod;\n\tsump[cur<<1]=(sump[cur<<1]+1LL*adda[cur]*sumb[cur<<1]%mod)%mod;\n\tsump[cur<<1]=(sump[cur<<1]+1LL*addb[cur]*suma[cur<<1]%mod)%mod;\n\tsump[cur<<1]=(sump[cur<<1]+1LL*adda[cur]*addb[cur]%mod*ln%mod)%mod;\n\tsuma[cur<<1]=(suma[cur<<1]+1LL*ln*adda[cur]%mod)%mod;\n\tsumb[cur<<1]=(sumb[cur<<1]+1LL*ln*addb[cur]%mod)%mod;\n\taddv[cur<<1]=(addv[cur<<1]+1LL*A[cur]*adda[cur<<1]%mod)%mod;\n\taddv[cur<<1]=(addv[cur<<1]+1LL*B[cur]*addb[cur<<1]%mod)%mod;\n\taddv[cur<<1]=(addv[cur<<1]+addv[cur])%mod;\n\tA[cur<<1]=(A[cur<<1]+A[cur])%mod;\n\tB[cur<<1]=(B[cur<<1]+B[cur])%mod;\n\tadda[cur<<1]=(adda[cur<<1]+adda[cur])%mod;\n\taddb[cur<<1]=(addb[cur<<1]+addb[cur])%mod;\n\tsumv[cur<<1|1]=(sumv[cur<<1|1]+1LL*A[cur]*suma[cur<<1|1]%mod)%mod;\n\tsumv[cur<<1|1]=(sumv[cur<<1|1]+1LL*B[cur]*sumb[cur<<1|1]%mod)%mod;\n\tsumv[cur<<1|1]=(sumv[cur<<1|1]+1LL*rn*addv[cur]%mod)%mod;\n\tsump[cur<<1|1]=(sump[cur<<1|1]+1LL*adda[cur]*sumb[cur<<1|1]%mod)%mod;\n\tsump[cur<<1|1]=(sump[cur<<1|1]+1LL*addb[cur]*suma[cur<<1|1]%mod)%mod;\n\tsump[cur<<1|1]=(sump[cur<<1|1]+1LL*adda[cur]*addb[cur]%mod*rn%mod)%mod;\n\tsuma[cur<<1|1]=(suma[cur<<1|1]+1LL*rn*adda[cur]%mod)%mod;\n\tsumb[cur<<1|1]=(sumb[cur<<1|1]+1LL*rn*addb[cur]%mod)%mod;\n\taddv[cur<<1|1]=(addv[cur<<1|1]+1LL*A[cur]*adda[cur<<1|1]%mod)%mod;\n\taddv[cur<<1|1]=(addv[cur<<1|1]+1LL*B[cur]*addb[cur<<1|1]%mod)%mod;\n\taddv[cur<<1|1]=(addv[cur<<1|1]+addv[cur])%mod;\n\tA[cur<<1|1]=(A[cur<<1|1]+A[cur])%mod;\n\tB[cur<<1|1]=(B[cur<<1|1]+B[cur])%mod;\n\tadda[cur<<1|1]=(adda[cur<<1|1]+adda[cur])%mod;\n\taddb[cur<<1|1]=(addb[cur<<1|1]+addb[cur])%mod;\n\tA[cur]=B[cur]=addv[cur]=adda[cur]=addb[cur]=0;\n}\n\ninline void pushUp(int cur){\n\tsumv[cur]=(sumv[cur<<1]+sumv[cur<<1|1])%mod;\n\tsuma[cur]=(suma[cur<<1]+suma[cur<<1|1])%mod;\n\tsumb[cur]=(sumb[cur<<1]+sumb[cur<<1|1])%mod;\n\tsump[cur]=(sump[cur<<1]+sump[cur<<1|1])%mod;\n}\n\nvoid build(int cur,int l,int r){\n\tif(l==r){\n\t\tcltstream::read(sumv[cur]);\n\t\tcltstream::read(suma[cur]);\n\t\tcltstream::read(sumb[cur]);\n\t\tsumv[cur]=(sumv[cur]%mod+mod)%mod;\n\t\tsuma[cur]=(suma[cur]%mod+mod)%mod;\n\t\tsumb[cur]=(sumb[cur]%mod+mod)%mod;\n\t\tsump[cur]=1LL*suma[cur]*sumb[cur]%mod;\n\t}\n\telse{\n\t\tint mid=(l+r)>>1;\n\t\tbuild(cur<<1,l,mid);\n\t\tbuild(cur<<1|1,mid+1,r);\n\t\tpushUp(cur);\n\t}\n}\n\nint query(int L,int R,int t,int cur,int l,int r){\n\tif(l>=L&&r<=R)\n\t\treturn (sumv[cur]+1LL*t*sump[cur]%mod)%mod;\n\telse{\n\t\tint mid=(l+r)>>1,res=0;\n\t\tpushDown(cur,mid-l+1,r-mid);\n\t\tif(L<=mid)\n\t\t\tres=(res+query(L,R,t,cur<<1,l,mid))%mod;\n\t\tif(R>mid)\n\t\t\tres=(res+query(L,R,t,cur<<1|1,mid+1,r))%mod;\n\t\treturn res;\n\t}\n}\n\nvoid modifyV(int L,int R,int x,int cur,int l,int r){\n\tif(l>=L&&r<=R){\n\t\tsumv[cur]=(sumv[cur]+1LL*(r-l+1)*x%mod)%mod;\n\t\taddv[cur]=(addv[cur]+x)%mod;\n\t}\n\telse{\n\t\tint mid=(l+r)>>1;\n\t\tpushDown(cur,mid-l+1,r-mid);\n\t\tif(L<=mid)\n\t\t\tmodifyV(L,R,x,cur<<1,l,mid);\n\t\tif(R>mid)\n\t\t\tmodifyV(L,R,x,cur<<1|1,mid+1,r);\n\t\tpushUp(cur);\n\t}\n}\n\nvoid modifyA(int L,int R,int t,int x,int cur,int l,int r){\n\tif(l>=L&&r<=R){\n\t\tsumv[cur]=(sumv[cur]+(-1LL*x*t%mod*sumb[cur]%mod+mod)%mod)%mod;\n\t\tsuma[cur]=(suma[cur]+1LL*(r-l+1)*x%mod)%mod;\n\t\tsump[cur]=(sump[cur]+1LL*sumb[cur]*x%mod)%mod;\n\t\tB[cur]=(B[cur]+(-1LL*x*t%mod+mod)%mod)%mod;\n\t\taddv[cur]=(addv[cur]+(-1LL*x*t%mod*addb[cur]%mod+mod)%mod)%mod;\n\t\tadda[cur]=(adda[cur]+x)%mod;\n\t}\n\telse{\n\t\tint mid=(l+r)>>1;\n\t\tpushDown(cur,mid-l+1,r-mid);\n\t\tif(L<=mid)\n\t\t\tmodifyA(L,R,t,x,cur<<1,l,mid);\n\t\tif(R>mid)\n\t\t\tmodifyA(L,R,t,x,cur<<1|1,mid+1,r);\n\t\tpushUp(cur);\n\t}\n}\n\nvoid modifyB(int L,int R,int t,int x,int cur,int l,int r){\n\tif(l>=L&&r<=R){\n\t\tsumv[cur]=(sumv[cur]+(-1LL*x*t%mod*suma[cur]%mod+mod)%mod)%mod;\n\t\tsumb[cur]=(sumb[cur]+1LL*(r-l+1)*x%mod)%mod;\n\t\tsump[cur]=(sump[cur]+1LL*suma[cur]*x%mod)%mod;\n\t\tA[cur]=(A[cur]+(-1LL*x*t%mod+mod)%mod)%mod;\n\t\taddv[cur]=(addv[cur]+(-1LL*x*t%mod*adda[cur]%mod+mod)%mod)%mod;\n\t\taddb[cur]=(addb[cur]+x)%mod;\n\t}\n\telse{\n\t\tint mid=(l+r)>>1;\n\t\tpushDown(cur,mid-l+1,r-mid);\n\t\tif(L<=mid)\n\t\t\tmodifyB(L,R,t,x,cur<<1,l,mid);\n\t\tif(R>mid)\n\t\t\tmodifyB(L,R,t,x,cur<<1|1,mid+1,r);\n\t\tpushUp(cur);\n\t}\n}\n\nint main(){\n\tcltstream::read(n);\n\tcltstream::read(m);\n\tbuild(1,1,n);\n\tfor(re int i=1;i<=m;++i){\n\t\tint opt,t,l,r,x;\n\t\tcltstream::read(opt);\n\t\tcltstream::read(t);\n\t\tcltstream::read(l);\n\t\tcltstream::read(r);\n\t\tswitch(opt){\n\t\t\tcase 1:\n\t\t\t\tcltstream::write(query(l,r,t,1,1,n),10);\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tcltstream::read(x);\n\t\t\t\tmodifyA(l,r,t,(x%mod+mod)%mod,1,1,n);\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tcltstream::read(x);\n\t\t\t\tmodifyB(l,r,t,(x%mod+mod)%mod,1,1,n);\n\t\t\t\tbreak;\n\t\t\tcase 4:\n\t\t\t\tcltstream::read(x);\n\t\t\t\tmodifyV(l,r,(x%mod+mod)%mod,1,1,n);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\tclop();\n\treturn 0;\n}\n```\n\n大概是我太菜了不适合做这种毒瘤题吧qaq\n\n![](https://i.loli.net/2018/11/08/5be38edf529ca.jpg)\n\n距 __在NOIp2018爆零__ 还剩 __1 天__。","slug":"luogu-p5009-solution","published":1,"updated":"2018-12-12T02:05:04.885Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjpn8w5zz001wrogusvj1og8f","content":"<p><a href=\"https://www.luogu.org/problemnew/show/P5009\" target=\"_blank\" rel=\"noopener\">传送门</a></p>\n<a id=\"more\"></a>\n<p>从来没做过这么毒瘤的题qaq</p>\n<p>就算看了题解现在还是一脸懵逼qaq</p>\n<p>首先，题目带了分块，我们可以先考虑分块。但是我太菜了不知道分块怎么写，所以我写的线段树qaq</p>\n<p>对$v$的修改相对来说比较简单，我们来重点看对$a$和$b$的修改。假设在某个时刻$t_1$，我们将某个$a_i$加上了$x$，然后又在某个时刻$t_2(t_2&gt;t_1)$，我们要查询之前那个位置上的值，很明显地，答案应该是$v_i+t_1a_ib_i+(t_2-t_1)(a_i+x)b_i$。但是如果真的像这样计算，每次修改就要在这个表达式后面加上一项，很难有效地维护大量的修改。考虑到对$v$的修改比较简单，我们可以通过修改$v$将表达式维持在一个较为简单的形式。形式化地，我们可以找到一个$v_i^\\prime$使得$v_i^\\prime+t_1(a_i+x)b_i=v+t_1a_ib_i$，并将$v_i$修改至$v_i^\\prime$，然后查询的时候我们就可以直接返回$v_i^\\prime+t_2(a_i+x)b_i$了。不难发现$v_i^\\prime=v_i-t_1xb_i$。</p>\n<p>需要注意的是，因为我们要使用线段树维护，必然会遇到同一个区间被连续修改多次的情况。假设有这样一个区间，区间内$a$的总修改值是$x$，$b$的总修改值是$y$，那么在某一时刻$t$，该区间内所有值的和应该是$\\Sigma v_i+t\\Sigma (a_i+x)(b_i+y)$。现在我们考虑将$a$加上$z$，此时$\\Sigma v_i^\\prime+t\\Sigma (a_i+x+z)(b_i+y)=\\Sigma v_i+t\\Sigma (a_i+x)(b_i+y)$，即$\\Sigma v_i^\\prime=\\Sigma v_i-tz\\Sigma (b_i+y)$。</p>\n<p>不过，上式中$tz\\Sigma (b_i+y)$的$(b_i+y)$指的是修改后的$b_i$的值，我们是肯定不能在下推标记时存储每一个历史版本的$b_i$的。我们考虑拆括号，将上式拆成$tz\\Sigma b_i+tzy$，其中$tzy$是一个常数，我们可以直接累加入标记。而至于$tz\\Sigma b_i$，考虑到每层节点的$\\Sigma b_i$都不同，我们可以维护一个$B$，意思是$\\Sigma v_i+=B\\Sigma b_i$，每次修改时$B+=tz$。当然，我们还需要一个标记来记录对$a$自身的修改。对$b$的修改也是类似的。</p>\n<p>然后是毒瘤的下推标记。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">addv[son]+=A[father]*suma[son]+B[father]*sumb[son]+addv[father];</span><br><span class=\"line\"><span class=\"comment\">//就是上面这句qaq现在还是一脸懵逼qaq</span></span><br><span class=\"line\">A[son]+=A[father];</span><br><span class=\"line\">B[son]+=B[father];</span><br><span class=\"line\">adda[son]+=adda[father];</span><br><span class=\"line\">addb[son]+=addf[father];</span><br></pre></td></tr></table></figure>\n<p>其实我也不知道我上面在扯些啥，所以以下是代码<del>，反正应该没人能看懂我的清奇写法（</del></p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> re register</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> maxn 200005</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> maxm 200005</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> mod 100000007</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> cltstream&#123;</span><br><span class=\"line\">\t<span class=\"meta\">#<span class=\"meta-keyword\">define</span> size 1048576</span></span><br><span class=\"line\">\t<span class=\"keyword\">char</span> cltin[size+<span class=\"number\">1</span>],*ih=cltin,*it=cltin;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">char</span> <span class=\"title\">gc</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"meta\">#<span class=\"meta-keyword\">ifdef</span> ONLINE_JUDGE</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(ih==it)&#123;</span><br><span class=\"line\">\t\t\t\tit=(ih=cltin)+fread(cltin,<span class=\"number\">1</span>,size,<span class=\"built_in\">stdin</span>);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(ih==it)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> EOF;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> *ih++;</span><br><span class=\"line\">\t\t<span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> getchar();</span><br><span class=\"line\">\t\t<span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">char</span> cltout[size+<span class=\"number\">1</span>],*oh=cltout,*ot=cltout+size;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">pc</span><span class=\"params\">(<span class=\"keyword\">char</span> c)</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(oh==ot)&#123;</span><br><span class=\"line\">\t\t\tfwrite(cltout,<span class=\"number\">1</span>,size,<span class=\"built_in\">stdout</span>);</span><br><span class=\"line\">\t\t\toh=cltout;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t*oh++=c;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"meta\">#<span class=\"meta-keyword\">define</span> clop() fwrite(cltstream::cltout,1,cltstream::oh-cltstream::cltout,stdout)</span></span><br><span class=\"line\">\t<span class=\"meta\">#<span class=\"meta-keyword\">undef</span> size</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> _tp&gt;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">read</span><span class=\"params\">(_tp&amp; x)</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> sn=<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">char</span> c=gc();</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(;c!=<span class=\"number\">45</span>&amp;&amp;(c&lt;<span class=\"number\">48</span>||c&gt;<span class=\"number\">57</span>)&amp;&amp;c!=EOF;c=gc());</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(c==<span class=\"number\">45</span>&amp;&amp;c!=EOF)</span><br><span class=\"line\">\t\t\tsn=<span class=\"number\">-1</span>,c=gc();</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(x=<span class=\"number\">0</span>;c&gt;=<span class=\"number\">48</span>&amp;&amp;c&lt;=<span class=\"number\">57</span>&amp;&amp;c!=EOF;x=(x&lt;&lt;<span class=\"number\">3</span>)+(x&lt;&lt;<span class=\"number\">1</span>)+(c^<span class=\"number\">48</span>),c=gc());</span><br><span class=\"line\">\t\tx*=sn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> _tp&gt;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">write</span><span class=\"params\">(_tp x,<span class=\"keyword\">char</span> text=<span class=\"number\">-1</span>)</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(x&lt;<span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\tpc(<span class=\"number\">45</span>),x=-x;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(!x)</span><br><span class=\"line\">\t\t\tpc(<span class=\"number\">48</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">int</span> digit[<span class=\"number\">22</span>];</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span>(digit[<span class=\"number\">0</span>]=<span class=\"number\">0</span>;x;digit[++digit[<span class=\"number\">0</span>]]=x%<span class=\"number\">10</span>,x/=<span class=\"number\">10</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span>(;digit[<span class=\"number\">0</span>];pc(digit[digit[<span class=\"number\">0</span>]--]^<span class=\"number\">48</span>));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(text&gt;=<span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\tpc(text);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> n,m;</span><br><span class=\"line\"><span class=\"keyword\">int</span> sumv[(maxn&lt;&lt;<span class=\"number\">2</span>)+<span class=\"number\">1</span>],suma[(maxn&lt;&lt;<span class=\"number\">2</span>)+<span class=\"number\">1</span>],sumb[(maxn&lt;&lt;<span class=\"number\">2</span>)+<span class=\"number\">1</span>],sump[(maxn&lt;&lt;<span class=\"number\">2</span>)+<span class=\"number\">1</span>];</span><br><span class=\"line\"><span class=\"keyword\">int</span> A[(maxn&lt;&lt;<span class=\"number\">2</span>)+<span class=\"number\">1</span>],B[(maxn&lt;&lt;<span class=\"number\">2</span>)+<span class=\"number\">1</span>];</span><br><span class=\"line\"><span class=\"keyword\">int</span> addv[(maxn&lt;&lt;<span class=\"number\">2</span>)+<span class=\"number\">1</span>],adda[(maxn&lt;&lt;<span class=\"number\">2</span>)+<span class=\"number\">1</span>],addb[(maxn&lt;&lt;<span class=\"number\">2</span>)+<span class=\"number\">1</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">pushDown</span><span class=\"params\">(<span class=\"keyword\">int</span> cur,<span class=\"keyword\">int</span> ln,<span class=\"keyword\">int</span> rn)</span></span>&#123;</span><br><span class=\"line\">\tsumv[cur&lt;&lt;<span class=\"number\">1</span>]=(sumv[cur&lt;&lt;<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*A[cur]*suma[cur&lt;&lt;<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\tsumv[cur&lt;&lt;<span class=\"number\">1</span>]=(sumv[cur&lt;&lt;<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*B[cur]*sumb[cur&lt;&lt;<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\tsumv[cur&lt;&lt;<span class=\"number\">1</span>]=(sumv[cur&lt;&lt;<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*ln*addv[cur]%mod)%mod;</span><br><span class=\"line\">\tsump[cur&lt;&lt;<span class=\"number\">1</span>]=(sump[cur&lt;&lt;<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*adda[cur]*sumb[cur&lt;&lt;<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\tsump[cur&lt;&lt;<span class=\"number\">1</span>]=(sump[cur&lt;&lt;<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*addb[cur]*suma[cur&lt;&lt;<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\tsump[cur&lt;&lt;<span class=\"number\">1</span>]=(sump[cur&lt;&lt;<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*adda[cur]*addb[cur]%mod*ln%mod)%mod;</span><br><span class=\"line\">\tsuma[cur&lt;&lt;<span class=\"number\">1</span>]=(suma[cur&lt;&lt;<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*ln*adda[cur]%mod)%mod;</span><br><span class=\"line\">\tsumb[cur&lt;&lt;<span class=\"number\">1</span>]=(sumb[cur&lt;&lt;<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*ln*addb[cur]%mod)%mod;</span><br><span class=\"line\">\taddv[cur&lt;&lt;<span class=\"number\">1</span>]=(addv[cur&lt;&lt;<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*A[cur]*adda[cur&lt;&lt;<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\taddv[cur&lt;&lt;<span class=\"number\">1</span>]=(addv[cur&lt;&lt;<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*B[cur]*addb[cur&lt;&lt;<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\taddv[cur&lt;&lt;<span class=\"number\">1</span>]=(addv[cur&lt;&lt;<span class=\"number\">1</span>]+addv[cur])%mod;</span><br><span class=\"line\">\tA[cur&lt;&lt;<span class=\"number\">1</span>]=(A[cur&lt;&lt;<span class=\"number\">1</span>]+A[cur])%mod;</span><br><span class=\"line\">\tB[cur&lt;&lt;<span class=\"number\">1</span>]=(B[cur&lt;&lt;<span class=\"number\">1</span>]+B[cur])%mod;</span><br><span class=\"line\">\tadda[cur&lt;&lt;<span class=\"number\">1</span>]=(adda[cur&lt;&lt;<span class=\"number\">1</span>]+adda[cur])%mod;</span><br><span class=\"line\">\taddb[cur&lt;&lt;<span class=\"number\">1</span>]=(addb[cur&lt;&lt;<span class=\"number\">1</span>]+addb[cur])%mod;</span><br><span class=\"line\">\tsumv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(sumv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*A[cur]*suma[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\tsumv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(sumv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*B[cur]*sumb[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\tsumv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(sumv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*rn*addv[cur]%mod)%mod;</span><br><span class=\"line\">\tsump[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(sump[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*adda[cur]*sumb[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\tsump[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(sump[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*addb[cur]*suma[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\tsump[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(sump[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*adda[cur]*addb[cur]%mod*rn%mod)%mod;</span><br><span class=\"line\">\tsuma[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(suma[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*rn*adda[cur]%mod)%mod;</span><br><span class=\"line\">\tsumb[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(sumb[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*rn*addb[cur]%mod)%mod;</span><br><span class=\"line\">\taddv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(addv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*A[cur]*adda[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\taddv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(addv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*B[cur]*addb[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\taddv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(addv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+addv[cur])%mod;</span><br><span class=\"line\">\tA[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(A[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+A[cur])%mod;</span><br><span class=\"line\">\tB[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(B[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+B[cur])%mod;</span><br><span class=\"line\">\tadda[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(adda[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+adda[cur])%mod;</span><br><span class=\"line\">\taddb[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(addb[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+addb[cur])%mod;</span><br><span class=\"line\">\tA[cur]=B[cur]=addv[cur]=adda[cur]=addb[cur]=<span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">pushUp</span><span class=\"params\">(<span class=\"keyword\">int</span> cur)</span></span>&#123;</span><br><span class=\"line\">\tsumv[cur]=(sumv[cur&lt;&lt;<span class=\"number\">1</span>]+sumv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>])%mod;</span><br><span class=\"line\">\tsuma[cur]=(suma[cur&lt;&lt;<span class=\"number\">1</span>]+suma[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>])%mod;</span><br><span class=\"line\">\tsumb[cur]=(sumb[cur&lt;&lt;<span class=\"number\">1</span>]+sumb[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>])%mod;</span><br><span class=\"line\">\tsump[cur]=(sump[cur&lt;&lt;<span class=\"number\">1</span>]+sump[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>])%mod;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">build</span><span class=\"params\">(<span class=\"keyword\">int</span> cur,<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(l==r)&#123;</span><br><span class=\"line\">\t\tcltstream::read(sumv[cur]);</span><br><span class=\"line\">\t\tcltstream::read(suma[cur]);</span><br><span class=\"line\">\t\tcltstream::read(sumb[cur]);</span><br><span class=\"line\">\t\tsumv[cur]=(sumv[cur]%mod+mod)%mod;</span><br><span class=\"line\">\t\tsuma[cur]=(suma[cur]%mod+mod)%mod;</span><br><span class=\"line\">\t\tsumb[cur]=(sumb[cur]%mod+mod)%mod;</span><br><span class=\"line\">\t\tsump[cur]=<span class=\"number\">1L</span>L*suma[cur]*sumb[cur]%mod;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> mid=(l+r)&gt;&gt;<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\tbuild(cur&lt;&lt;<span class=\"number\">1</span>,l,mid);</span><br><span class=\"line\">\t\tbuild(cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>,mid+<span class=\"number\">1</span>,r);</span><br><span class=\"line\">\t\tpushUp(cur);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">query</span><span class=\"params\">(<span class=\"keyword\">int</span> L,<span class=\"keyword\">int</span> R,<span class=\"keyword\">int</span> t,<span class=\"keyword\">int</span> cur,<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(l&gt;=L&amp;&amp;r&lt;=R)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> (sumv[cur]+<span class=\"number\">1L</span>L*t*sump[cur]%mod)%mod;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> mid=(l+r)&gt;&gt;<span class=\"number\">1</span>,res=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t\tpushDown(cur,mid-l+<span class=\"number\">1</span>,r-mid);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(L&lt;=mid)</span><br><span class=\"line\">\t\t\tres=(res+query(L,R,t,cur&lt;&lt;<span class=\"number\">1</span>,l,mid))%mod;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(R&gt;mid)</span><br><span class=\"line\">\t\t\tres=(res+query(L,R,t,cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>,mid+<span class=\"number\">1</span>,r))%mod;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> res;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">modifyV</span><span class=\"params\">(<span class=\"keyword\">int</span> L,<span class=\"keyword\">int</span> R,<span class=\"keyword\">int</span> x,<span class=\"keyword\">int</span> cur,<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(l&gt;=L&amp;&amp;r&lt;=R)&#123;</span><br><span class=\"line\">\t\tsumv[cur]=(sumv[cur]+<span class=\"number\">1L</span>L*(r-l+<span class=\"number\">1</span>)*x%mod)%mod;</span><br><span class=\"line\">\t\taddv[cur]=(addv[cur]+x)%mod;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> mid=(l+r)&gt;&gt;<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\tpushDown(cur,mid-l+<span class=\"number\">1</span>,r-mid);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(L&lt;=mid)</span><br><span class=\"line\">\t\t\tmodifyV(L,R,x,cur&lt;&lt;<span class=\"number\">1</span>,l,mid);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(R&gt;mid)</span><br><span class=\"line\">\t\t\tmodifyV(L,R,x,cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>,mid+<span class=\"number\">1</span>,r);</span><br><span class=\"line\">\t\tpushUp(cur);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">modifyA</span><span class=\"params\">(<span class=\"keyword\">int</span> L,<span class=\"keyword\">int</span> R,<span class=\"keyword\">int</span> t,<span class=\"keyword\">int</span> x,<span class=\"keyword\">int</span> cur,<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(l&gt;=L&amp;&amp;r&lt;=R)&#123;</span><br><span class=\"line\">\t\tsumv[cur]=(sumv[cur]+(<span class=\"number\">-1L</span>L*x*t%mod*sumb[cur]%mod+mod)%mod)%mod;</span><br><span class=\"line\">\t\tsuma[cur]=(suma[cur]+<span class=\"number\">1L</span>L*(r-l+<span class=\"number\">1</span>)*x%mod)%mod;</span><br><span class=\"line\">\t\tsump[cur]=(sump[cur]+<span class=\"number\">1L</span>L*sumb[cur]*x%mod)%mod;</span><br><span class=\"line\">\t\tB[cur]=(B[cur]+(<span class=\"number\">-1L</span>L*x*t%mod+mod)%mod)%mod;</span><br><span class=\"line\">\t\taddv[cur]=(addv[cur]+(<span class=\"number\">-1L</span>L*x*t%mod*addb[cur]%mod+mod)%mod)%mod;</span><br><span class=\"line\">\t\tadda[cur]=(adda[cur]+x)%mod;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> mid=(l+r)&gt;&gt;<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\tpushDown(cur,mid-l+<span class=\"number\">1</span>,r-mid);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(L&lt;=mid)</span><br><span class=\"line\">\t\t\tmodifyA(L,R,t,x,cur&lt;&lt;<span class=\"number\">1</span>,l,mid);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(R&gt;mid)</span><br><span class=\"line\">\t\t\tmodifyA(L,R,t,x,cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>,mid+<span class=\"number\">1</span>,r);</span><br><span class=\"line\">\t\tpushUp(cur);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">modifyB</span><span class=\"params\">(<span class=\"keyword\">int</span> L,<span class=\"keyword\">int</span> R,<span class=\"keyword\">int</span> t,<span class=\"keyword\">int</span> x,<span class=\"keyword\">int</span> cur,<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(l&gt;=L&amp;&amp;r&lt;=R)&#123;</span><br><span class=\"line\">\t\tsumv[cur]=(sumv[cur]+(<span class=\"number\">-1L</span>L*x*t%mod*suma[cur]%mod+mod)%mod)%mod;</span><br><span class=\"line\">\t\tsumb[cur]=(sumb[cur]+<span class=\"number\">1L</span>L*(r-l+<span class=\"number\">1</span>)*x%mod)%mod;</span><br><span class=\"line\">\t\tsump[cur]=(sump[cur]+<span class=\"number\">1L</span>L*suma[cur]*x%mod)%mod;</span><br><span class=\"line\">\t\tA[cur]=(A[cur]+(<span class=\"number\">-1L</span>L*x*t%mod+mod)%mod)%mod;</span><br><span class=\"line\">\t\taddv[cur]=(addv[cur]+(<span class=\"number\">-1L</span>L*x*t%mod*adda[cur]%mod+mod)%mod)%mod;</span><br><span class=\"line\">\t\taddb[cur]=(addb[cur]+x)%mod;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> mid=(l+r)&gt;&gt;<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\tpushDown(cur,mid-l+<span class=\"number\">1</span>,r-mid);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(L&lt;=mid)</span><br><span class=\"line\">\t\t\tmodifyB(L,R,t,x,cur&lt;&lt;<span class=\"number\">1</span>,l,mid);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(R&gt;mid)</span><br><span class=\"line\">\t\t\tmodifyB(L,R,t,x,cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>,mid+<span class=\"number\">1</span>,r);</span><br><span class=\"line\">\t\tpushUp(cur);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\tcltstream::read(n);</span><br><span class=\"line\">\tcltstream::read(m);</span><br><span class=\"line\">\tbuild(<span class=\"number\">1</span>,<span class=\"number\">1</span>,n);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=m;++i)&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> opt,t,l,r,x;</span><br><span class=\"line\">\t\tcltstream::read(opt);</span><br><span class=\"line\">\t\tcltstream::read(t);</span><br><span class=\"line\">\t\tcltstream::read(l);</span><br><span class=\"line\">\t\tcltstream::read(r);</span><br><span class=\"line\">\t\t<span class=\"keyword\">switch</span>(opt)&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">\t\t\t\tcltstream::write(query(l,r,t,<span class=\"number\">1</span>,<span class=\"number\">1</span>,n),<span class=\"number\">10</span>);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">\t\t\t\tcltstream::read(x);</span><br><span class=\"line\">\t\t\t\tmodifyA(l,r,t,(x%mod+mod)%mod,<span class=\"number\">1</span>,<span class=\"number\">1</span>,n);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">\t\t\t\tcltstream::read(x);</span><br><span class=\"line\">\t\t\t\tmodifyB(l,r,t,(x%mod+mod)%mod,<span class=\"number\">1</span>,<span class=\"number\">1</span>,n);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">\t\t\t\tcltstream::read(x);</span><br><span class=\"line\">\t\t\t\tmodifyV(l,r,(x%mod+mod)%mod,<span class=\"number\">1</span>,<span class=\"number\">1</span>,n);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tclop();</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>大概是我太菜了不适合做这种毒瘤题吧qaq</p>\n<p><img src=\"https://i.loli.net/2018/11/08/5be38edf529ca.jpg\" alt=\"\"></p>\n<p>距 <strong>在NOIp2018爆零</strong> 还剩 <strong>1 天</strong>。</p>\n","site":{"data":{}},"excerpt":"<p><a href=\"https://www.luogu.org/problemnew/show/P5009\" target=\"_blank\" rel=\"noopener\">传送门</a></p>","more":"<p>从来没做过这么毒瘤的题qaq</p>\n<p>就算看了题解现在还是一脸懵逼qaq</p>\n<p>首先，题目带了分块，我们可以先考虑分块。但是我太菜了不知道分块怎么写，所以我写的线段树qaq</p>\n<p>对$v$的修改相对来说比较简单，我们来重点看对$a$和$b$的修改。假设在某个时刻$t_1$，我们将某个$a_i$加上了$x$，然后又在某个时刻$t_2(t_2&gt;t_1)$，我们要查询之前那个位置上的值，很明显地，答案应该是$v_i+t_1a_ib_i+(t_2-t_1)(a_i+x)b_i$。但是如果真的像这样计算，每次修改就要在这个表达式后面加上一项，很难有效地维护大量的修改。考虑到对$v$的修改比较简单，我们可以通过修改$v$将表达式维持在一个较为简单的形式。形式化地，我们可以找到一个$v_i^\\prime$使得$v_i^\\prime+t_1(a_i+x)b_i=v+t_1a_ib_i$，并将$v_i$修改至$v_i^\\prime$，然后查询的时候我们就可以直接返回$v_i^\\prime+t_2(a_i+x)b_i$了。不难发现$v_i^\\prime=v_i-t_1xb_i$。</p>\n<p>需要注意的是，因为我们要使用线段树维护，必然会遇到同一个区间被连续修改多次的情况。假设有这样一个区间，区间内$a$的总修改值是$x$，$b$的总修改值是$y$，那么在某一时刻$t$，该区间内所有值的和应该是$\\Sigma v_i+t\\Sigma (a_i+x)(b_i+y)$。现在我们考虑将$a$加上$z$，此时$\\Sigma v_i^\\prime+t\\Sigma (a_i+x+z)(b_i+y)=\\Sigma v_i+t\\Sigma (a_i+x)(b_i+y)$，即$\\Sigma v_i^\\prime=\\Sigma v_i-tz\\Sigma (b_i+y)$。</p>\n<p>不过，上式中$tz\\Sigma (b_i+y)$的$(b_i+y)$指的是修改后的$b_i$的值，我们是肯定不能在下推标记时存储每一个历史版本的$b_i$的。我们考虑拆括号，将上式拆成$tz\\Sigma b_i+tzy$，其中$tzy$是一个常数，我们可以直接累加入标记。而至于$tz\\Sigma b_i$，考虑到每层节点的$\\Sigma b_i$都不同，我们可以维护一个$B$，意思是$\\Sigma v_i+=B\\Sigma b_i$，每次修改时$B+=tz$。当然，我们还需要一个标记来记录对$a$自身的修改。对$b$的修改也是类似的。</p>\n<p>然后是毒瘤的下推标记。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">addv[son]+=A[father]*suma[son]+B[father]*sumb[son]+addv[father];</span><br><span class=\"line\"><span class=\"comment\">//就是上面这句qaq现在还是一脸懵逼qaq</span></span><br><span class=\"line\">A[son]+=A[father];</span><br><span class=\"line\">B[son]+=B[father];</span><br><span class=\"line\">adda[son]+=adda[father];</span><br><span class=\"line\">addb[son]+=addf[father];</span><br></pre></td></tr></table></figure>\n<p>其实我也不知道我上面在扯些啥，所以以下是代码<del>，反正应该没人能看懂我的清奇写法（</del></p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> re register</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> maxn 200005</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> maxm 200005</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> mod 100000007</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> cltstream&#123;</span><br><span class=\"line\">\t<span class=\"meta\">#<span class=\"meta-keyword\">define</span> size 1048576</span></span><br><span class=\"line\">\t<span class=\"keyword\">char</span> cltin[size+<span class=\"number\">1</span>],*ih=cltin,*it=cltin;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">char</span> <span class=\"title\">gc</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"meta\">#<span class=\"meta-keyword\">ifdef</span> ONLINE_JUDGE</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(ih==it)&#123;</span><br><span class=\"line\">\t\t\t\tit=(ih=cltin)+fread(cltin,<span class=\"number\">1</span>,size,<span class=\"built_in\">stdin</span>);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(ih==it)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> EOF;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> *ih++;</span><br><span class=\"line\">\t\t<span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> getchar();</span><br><span class=\"line\">\t\t<span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">char</span> cltout[size+<span class=\"number\">1</span>],*oh=cltout,*ot=cltout+size;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">pc</span><span class=\"params\">(<span class=\"keyword\">char</span> c)</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(oh==ot)&#123;</span><br><span class=\"line\">\t\t\tfwrite(cltout,<span class=\"number\">1</span>,size,<span class=\"built_in\">stdout</span>);</span><br><span class=\"line\">\t\t\toh=cltout;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t*oh++=c;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"meta\">#<span class=\"meta-keyword\">define</span> clop() fwrite(cltstream::cltout,1,cltstream::oh-cltstream::cltout,stdout)</span></span><br><span class=\"line\">\t<span class=\"meta\">#<span class=\"meta-keyword\">undef</span> size</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> _tp&gt;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">read</span><span class=\"params\">(_tp&amp; x)</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> sn=<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">char</span> c=gc();</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(;c!=<span class=\"number\">45</span>&amp;&amp;(c&lt;<span class=\"number\">48</span>||c&gt;<span class=\"number\">57</span>)&amp;&amp;c!=EOF;c=gc());</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(c==<span class=\"number\">45</span>&amp;&amp;c!=EOF)</span><br><span class=\"line\">\t\t\tsn=<span class=\"number\">-1</span>,c=gc();</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(x=<span class=\"number\">0</span>;c&gt;=<span class=\"number\">48</span>&amp;&amp;c&lt;=<span class=\"number\">57</span>&amp;&amp;c!=EOF;x=(x&lt;&lt;<span class=\"number\">3</span>)+(x&lt;&lt;<span class=\"number\">1</span>)+(c^<span class=\"number\">48</span>),c=gc());</span><br><span class=\"line\">\t\tx*=sn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> _tp&gt;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">write</span><span class=\"params\">(_tp x,<span class=\"keyword\">char</span> text=<span class=\"number\">-1</span>)</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(x&lt;<span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\tpc(<span class=\"number\">45</span>),x=-x;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(!x)</span><br><span class=\"line\">\t\t\tpc(<span class=\"number\">48</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">int</span> digit[<span class=\"number\">22</span>];</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span>(digit[<span class=\"number\">0</span>]=<span class=\"number\">0</span>;x;digit[++digit[<span class=\"number\">0</span>]]=x%<span class=\"number\">10</span>,x/=<span class=\"number\">10</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span>(;digit[<span class=\"number\">0</span>];pc(digit[digit[<span class=\"number\">0</span>]--]^<span class=\"number\">48</span>));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(text&gt;=<span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\tpc(text);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> n,m;</span><br><span class=\"line\"><span class=\"keyword\">int</span> sumv[(maxn&lt;&lt;<span class=\"number\">2</span>)+<span class=\"number\">1</span>],suma[(maxn&lt;&lt;<span class=\"number\">2</span>)+<span class=\"number\">1</span>],sumb[(maxn&lt;&lt;<span class=\"number\">2</span>)+<span class=\"number\">1</span>],sump[(maxn&lt;&lt;<span class=\"number\">2</span>)+<span class=\"number\">1</span>];</span><br><span class=\"line\"><span class=\"keyword\">int</span> A[(maxn&lt;&lt;<span class=\"number\">2</span>)+<span class=\"number\">1</span>],B[(maxn&lt;&lt;<span class=\"number\">2</span>)+<span class=\"number\">1</span>];</span><br><span class=\"line\"><span class=\"keyword\">int</span> addv[(maxn&lt;&lt;<span class=\"number\">2</span>)+<span class=\"number\">1</span>],adda[(maxn&lt;&lt;<span class=\"number\">2</span>)+<span class=\"number\">1</span>],addb[(maxn&lt;&lt;<span class=\"number\">2</span>)+<span class=\"number\">1</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">pushDown</span><span class=\"params\">(<span class=\"keyword\">int</span> cur,<span class=\"keyword\">int</span> ln,<span class=\"keyword\">int</span> rn)</span></span>&#123;</span><br><span class=\"line\">\tsumv[cur&lt;&lt;<span class=\"number\">1</span>]=(sumv[cur&lt;&lt;<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*A[cur]*suma[cur&lt;&lt;<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\tsumv[cur&lt;&lt;<span class=\"number\">1</span>]=(sumv[cur&lt;&lt;<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*B[cur]*sumb[cur&lt;&lt;<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\tsumv[cur&lt;&lt;<span class=\"number\">1</span>]=(sumv[cur&lt;&lt;<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*ln*addv[cur]%mod)%mod;</span><br><span class=\"line\">\tsump[cur&lt;&lt;<span class=\"number\">1</span>]=(sump[cur&lt;&lt;<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*adda[cur]*sumb[cur&lt;&lt;<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\tsump[cur&lt;&lt;<span class=\"number\">1</span>]=(sump[cur&lt;&lt;<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*addb[cur]*suma[cur&lt;&lt;<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\tsump[cur&lt;&lt;<span class=\"number\">1</span>]=(sump[cur&lt;&lt;<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*adda[cur]*addb[cur]%mod*ln%mod)%mod;</span><br><span class=\"line\">\tsuma[cur&lt;&lt;<span class=\"number\">1</span>]=(suma[cur&lt;&lt;<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*ln*adda[cur]%mod)%mod;</span><br><span class=\"line\">\tsumb[cur&lt;&lt;<span class=\"number\">1</span>]=(sumb[cur&lt;&lt;<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*ln*addb[cur]%mod)%mod;</span><br><span class=\"line\">\taddv[cur&lt;&lt;<span class=\"number\">1</span>]=(addv[cur&lt;&lt;<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*A[cur]*adda[cur&lt;&lt;<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\taddv[cur&lt;&lt;<span class=\"number\">1</span>]=(addv[cur&lt;&lt;<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*B[cur]*addb[cur&lt;&lt;<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\taddv[cur&lt;&lt;<span class=\"number\">1</span>]=(addv[cur&lt;&lt;<span class=\"number\">1</span>]+addv[cur])%mod;</span><br><span class=\"line\">\tA[cur&lt;&lt;<span class=\"number\">1</span>]=(A[cur&lt;&lt;<span class=\"number\">1</span>]+A[cur])%mod;</span><br><span class=\"line\">\tB[cur&lt;&lt;<span class=\"number\">1</span>]=(B[cur&lt;&lt;<span class=\"number\">1</span>]+B[cur])%mod;</span><br><span class=\"line\">\tadda[cur&lt;&lt;<span class=\"number\">1</span>]=(adda[cur&lt;&lt;<span class=\"number\">1</span>]+adda[cur])%mod;</span><br><span class=\"line\">\taddb[cur&lt;&lt;<span class=\"number\">1</span>]=(addb[cur&lt;&lt;<span class=\"number\">1</span>]+addb[cur])%mod;</span><br><span class=\"line\">\tsumv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(sumv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*A[cur]*suma[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\tsumv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(sumv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*B[cur]*sumb[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\tsumv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(sumv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*rn*addv[cur]%mod)%mod;</span><br><span class=\"line\">\tsump[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(sump[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*adda[cur]*sumb[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\tsump[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(sump[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*addb[cur]*suma[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\tsump[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(sump[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*adda[cur]*addb[cur]%mod*rn%mod)%mod;</span><br><span class=\"line\">\tsuma[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(suma[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*rn*adda[cur]%mod)%mod;</span><br><span class=\"line\">\tsumb[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(sumb[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*rn*addb[cur]%mod)%mod;</span><br><span class=\"line\">\taddv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(addv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*A[cur]*adda[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\taddv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(addv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+<span class=\"number\">1L</span>L*B[cur]*addb[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]%mod)%mod;</span><br><span class=\"line\">\taddv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(addv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+addv[cur])%mod;</span><br><span class=\"line\">\tA[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(A[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+A[cur])%mod;</span><br><span class=\"line\">\tB[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(B[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+B[cur])%mod;</span><br><span class=\"line\">\tadda[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(adda[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+adda[cur])%mod;</span><br><span class=\"line\">\taddb[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]=(addb[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>]+addb[cur])%mod;</span><br><span class=\"line\">\tA[cur]=B[cur]=addv[cur]=adda[cur]=addb[cur]=<span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">pushUp</span><span class=\"params\">(<span class=\"keyword\">int</span> cur)</span></span>&#123;</span><br><span class=\"line\">\tsumv[cur]=(sumv[cur&lt;&lt;<span class=\"number\">1</span>]+sumv[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>])%mod;</span><br><span class=\"line\">\tsuma[cur]=(suma[cur&lt;&lt;<span class=\"number\">1</span>]+suma[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>])%mod;</span><br><span class=\"line\">\tsumb[cur]=(sumb[cur&lt;&lt;<span class=\"number\">1</span>]+sumb[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>])%mod;</span><br><span class=\"line\">\tsump[cur]=(sump[cur&lt;&lt;<span class=\"number\">1</span>]+sump[cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>])%mod;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">build</span><span class=\"params\">(<span class=\"keyword\">int</span> cur,<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(l==r)&#123;</span><br><span class=\"line\">\t\tcltstream::read(sumv[cur]);</span><br><span class=\"line\">\t\tcltstream::read(suma[cur]);</span><br><span class=\"line\">\t\tcltstream::read(sumb[cur]);</span><br><span class=\"line\">\t\tsumv[cur]=(sumv[cur]%mod+mod)%mod;</span><br><span class=\"line\">\t\tsuma[cur]=(suma[cur]%mod+mod)%mod;</span><br><span class=\"line\">\t\tsumb[cur]=(sumb[cur]%mod+mod)%mod;</span><br><span class=\"line\">\t\tsump[cur]=<span class=\"number\">1L</span>L*suma[cur]*sumb[cur]%mod;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> mid=(l+r)&gt;&gt;<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\tbuild(cur&lt;&lt;<span class=\"number\">1</span>,l,mid);</span><br><span class=\"line\">\t\tbuild(cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>,mid+<span class=\"number\">1</span>,r);</span><br><span class=\"line\">\t\tpushUp(cur);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">query</span><span class=\"params\">(<span class=\"keyword\">int</span> L,<span class=\"keyword\">int</span> R,<span class=\"keyword\">int</span> t,<span class=\"keyword\">int</span> cur,<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(l&gt;=L&amp;&amp;r&lt;=R)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> (sumv[cur]+<span class=\"number\">1L</span>L*t*sump[cur]%mod)%mod;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> mid=(l+r)&gt;&gt;<span class=\"number\">1</span>,res=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t\tpushDown(cur,mid-l+<span class=\"number\">1</span>,r-mid);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(L&lt;=mid)</span><br><span class=\"line\">\t\t\tres=(res+query(L,R,t,cur&lt;&lt;<span class=\"number\">1</span>,l,mid))%mod;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(R&gt;mid)</span><br><span class=\"line\">\t\t\tres=(res+query(L,R,t,cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>,mid+<span class=\"number\">1</span>,r))%mod;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> res;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">modifyV</span><span class=\"params\">(<span class=\"keyword\">int</span> L,<span class=\"keyword\">int</span> R,<span class=\"keyword\">int</span> x,<span class=\"keyword\">int</span> cur,<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(l&gt;=L&amp;&amp;r&lt;=R)&#123;</span><br><span class=\"line\">\t\tsumv[cur]=(sumv[cur]+<span class=\"number\">1L</span>L*(r-l+<span class=\"number\">1</span>)*x%mod)%mod;</span><br><span class=\"line\">\t\taddv[cur]=(addv[cur]+x)%mod;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> mid=(l+r)&gt;&gt;<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\tpushDown(cur,mid-l+<span class=\"number\">1</span>,r-mid);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(L&lt;=mid)</span><br><span class=\"line\">\t\t\tmodifyV(L,R,x,cur&lt;&lt;<span class=\"number\">1</span>,l,mid);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(R&gt;mid)</span><br><span class=\"line\">\t\t\tmodifyV(L,R,x,cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>,mid+<span class=\"number\">1</span>,r);</span><br><span class=\"line\">\t\tpushUp(cur);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">modifyA</span><span class=\"params\">(<span class=\"keyword\">int</span> L,<span class=\"keyword\">int</span> R,<span class=\"keyword\">int</span> t,<span class=\"keyword\">int</span> x,<span class=\"keyword\">int</span> cur,<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(l&gt;=L&amp;&amp;r&lt;=R)&#123;</span><br><span class=\"line\">\t\tsumv[cur]=(sumv[cur]+(<span class=\"number\">-1L</span>L*x*t%mod*sumb[cur]%mod+mod)%mod)%mod;</span><br><span class=\"line\">\t\tsuma[cur]=(suma[cur]+<span class=\"number\">1L</span>L*(r-l+<span class=\"number\">1</span>)*x%mod)%mod;</span><br><span class=\"line\">\t\tsump[cur]=(sump[cur]+<span class=\"number\">1L</span>L*sumb[cur]*x%mod)%mod;</span><br><span class=\"line\">\t\tB[cur]=(B[cur]+(<span class=\"number\">-1L</span>L*x*t%mod+mod)%mod)%mod;</span><br><span class=\"line\">\t\taddv[cur]=(addv[cur]+(<span class=\"number\">-1L</span>L*x*t%mod*addb[cur]%mod+mod)%mod)%mod;</span><br><span class=\"line\">\t\tadda[cur]=(adda[cur]+x)%mod;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> mid=(l+r)&gt;&gt;<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\tpushDown(cur,mid-l+<span class=\"number\">1</span>,r-mid);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(L&lt;=mid)</span><br><span class=\"line\">\t\t\tmodifyA(L,R,t,x,cur&lt;&lt;<span class=\"number\">1</span>,l,mid);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(R&gt;mid)</span><br><span class=\"line\">\t\t\tmodifyA(L,R,t,x,cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>,mid+<span class=\"number\">1</span>,r);</span><br><span class=\"line\">\t\tpushUp(cur);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">modifyB</span><span class=\"params\">(<span class=\"keyword\">int</span> L,<span class=\"keyword\">int</span> R,<span class=\"keyword\">int</span> t,<span class=\"keyword\">int</span> x,<span class=\"keyword\">int</span> cur,<span class=\"keyword\">int</span> l,<span class=\"keyword\">int</span> r)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(l&gt;=L&amp;&amp;r&lt;=R)&#123;</span><br><span class=\"line\">\t\tsumv[cur]=(sumv[cur]+(<span class=\"number\">-1L</span>L*x*t%mod*suma[cur]%mod+mod)%mod)%mod;</span><br><span class=\"line\">\t\tsumb[cur]=(sumb[cur]+<span class=\"number\">1L</span>L*(r-l+<span class=\"number\">1</span>)*x%mod)%mod;</span><br><span class=\"line\">\t\tsump[cur]=(sump[cur]+<span class=\"number\">1L</span>L*suma[cur]*x%mod)%mod;</span><br><span class=\"line\">\t\tA[cur]=(A[cur]+(<span class=\"number\">-1L</span>L*x*t%mod+mod)%mod)%mod;</span><br><span class=\"line\">\t\taddv[cur]=(addv[cur]+(<span class=\"number\">-1L</span>L*x*t%mod*adda[cur]%mod+mod)%mod)%mod;</span><br><span class=\"line\">\t\taddb[cur]=(addb[cur]+x)%mod;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> mid=(l+r)&gt;&gt;<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\tpushDown(cur,mid-l+<span class=\"number\">1</span>,r-mid);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(L&lt;=mid)</span><br><span class=\"line\">\t\t\tmodifyB(L,R,t,x,cur&lt;&lt;<span class=\"number\">1</span>,l,mid);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(R&gt;mid)</span><br><span class=\"line\">\t\t\tmodifyB(L,R,t,x,cur&lt;&lt;<span class=\"number\">1</span>|<span class=\"number\">1</span>,mid+<span class=\"number\">1</span>,r);</span><br><span class=\"line\">\t\tpushUp(cur);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\tcltstream::read(n);</span><br><span class=\"line\">\tcltstream::read(m);</span><br><span class=\"line\">\tbuild(<span class=\"number\">1</span>,<span class=\"number\">1</span>,n);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=m;++i)&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> opt,t,l,r,x;</span><br><span class=\"line\">\t\tcltstream::read(opt);</span><br><span class=\"line\">\t\tcltstream::read(t);</span><br><span class=\"line\">\t\tcltstream::read(l);</span><br><span class=\"line\">\t\tcltstream::read(r);</span><br><span class=\"line\">\t\t<span class=\"keyword\">switch</span>(opt)&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">\t\t\t\tcltstream::write(query(l,r,t,<span class=\"number\">1</span>,<span class=\"number\">1</span>,n),<span class=\"number\">10</span>);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">\t\t\t\tcltstream::read(x);</span><br><span class=\"line\">\t\t\t\tmodifyA(l,r,t,(x%mod+mod)%mod,<span class=\"number\">1</span>,<span class=\"number\">1</span>,n);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">\t\t\t\tcltstream::read(x);</span><br><span class=\"line\">\t\t\t\tmodifyB(l,r,t,(x%mod+mod)%mod,<span class=\"number\">1</span>,<span class=\"number\">1</span>,n);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">\t\t\t\tcltstream::read(x);</span><br><span class=\"line\">\t\t\t\tmodifyV(l,r,(x%mod+mod)%mod,<span class=\"number\">1</span>,<span class=\"number\">1</span>,n);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tclop();</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>大概是我太菜了不适合做这种毒瘤题吧qaq</p>\n<p><img src=\"https://i.loli.net/2018/11/08/5be38edf529ca.jpg\" alt=\"\"></p>\n<p>距 <strong>在NOIp2018爆零</strong> 还剩 <strong>1 天</strong>。</p>"},{"title":"「未来算法Episode I」严格根号分块实现树套树","date":"2018-12-08T11:55:00.000Z","mathjax":true,"_content":"分块天下第一！！！！！！！！！\n\n<!-- more -->\n\n我也不知道我为什么要写这个玩意，大概是我真的被这个外挂一般的东西吓到了吧。\n\n[![](https://i.loli.net/2018/12/08/5c0bb272768cf.png)](https://www.luogu.org/record/show?rid=14518116)\n\n![](https://i.loli.net/2018/12/08/5c0bb2c767fda.jpg)\n\n我们从头说起。点开上面的那个评测记录，我们可以看到一道树套树的模板题。\n\n先退一步来说，假如说我们去掉操作$3$，剩下的操作都可以用主席树来完成。\n\n然而麻烦的是，我们在树上存的是前缀和。想要修改的话，暴力的复杂度是单次$O(n\\text{log}n)$的。\n\n那我们就在外层套个树状数组，把修改$O(n\\text{log}n)$查询$O(\\text{log}n)$均摊成全部$O(\\text{log}^{2}n)$。\n\n然而，很遗憾，我不会树套树，一点都不会，就连上面的这段文字也是我瞎扯出来的。\n\n考虑~~无敌的~~分块。\n\n一般我们想到的分块就是在块内维护`std::set`。这样操作$3$可以做到$O(\\text{log}\\sqrt{n})$，操作$1$、$4$、$5$可以做到$O(\\sqrt{n}\\text{log}\\sqrt{n})$。至于操作$2$，我们在外层套一个二分，然后检查二分到的数的排名是不是$k$，时间复杂度$O(\\text{log}10^{9}\\sqrt{n}\\text{log}\\sqrt{n})$。\n\n然而很明显的，这样做的效率十分低下，除了实现复杂度相对树套树小了一点以外没有任何优势。\n\n我们来看一下[__Shadowice1984__](https://www.luogu.org/space/show?uid=56384)dalao在他的[另一篇题解](https://www.luogu.org/blog/ShadowassIIXVIIIIV/solution-p4119)中做出的评价：\n\n> 这其实是一个误区。主席树之所以采取了二分的思路来解决问题是因为我们要求回答单次询问做到$O(\\text{log}n)$的复杂度，这时候唯一的可行思路就是二分否则我们无法将复杂度控制在一个$\\text{log}$之内。\n> \n> 但是我们现在是使用分块解决问题。分块是有自己复杂度的，就是$O(\\sqrt{n})$而不是$O(\\text{log}n)$，这意味着分块其实和$\\text{log}$的数据结构以及二分法并不是很搭（因为分块的结构本质上就不支持二分）。如果我们需要强行嵌入$\\text{log}$的数据结构的话在绝大部分情况下都会使复杂度凭空多出个$\\text{log}$来，这在强调常数的根号算法中绝对是致命的。\n\n我也是从这位dalao的[blog](https://www.luogu.org/blog/ShadowassIIXVIIIIV/solution-p3380)里看到了严格根号分块实现树套树这种未来算法。\n\n主要思想其实不难理解，既然分块和$\\text{log}$不适合放在一起，我们就再套个分块，或者说，把值域也分成块。\n\n定义`cnt1[i][j]`表示前$i$个块内有多少个元素的值在第$j$个块内，`cnt2[i][j]`表示前$i$个块内有多少个$j$（当然是离散化后的）。不难发现预处理出这两个数组的时间复杂度是$O((n+m)\\sqrt{n})$的。\n\n然后我们来分析每个操作该怎么实现：\n\n1. 首先考虑序列中的整块。从头开始扫一遍值域块，一直扫到给定数所在块的前一个块，然后再在给定数所在块内从头扫到给定数的前一个，查询扫过的值有多少落在这些整块内。剩下的边角块自然地暴力判断。\n2. 还是从头扫一遍值域块，看看每个值域块内有多少数落在给定区间内，大概判断出答案在哪个值域块内。然后在这个值域块内再扫一遍即可。需要注意的是我们需要再开两个数组`tmp1`和`tmp2`来保存边角块的信息。\n3. 直接$O(\\sqrt{n})$暴力重构两个`cnt`就好。\n4. 需要两个类似于操作$2$的临时数组，存储的信息也是类似的。首先在给定数所在值域块内__从后往前扫__，找到答案直接退出。否则还是__从后往前扫所有值域块__，找到第一个非空的块然后进去找。\n5. 操作$4$换个方向即可。\n\n综上所述，该算法的时间复杂度为$O((n+m)\\sqrt{n}+m\\sqrt{n+m})$。当$n$，$m$取到极限值时，差不多是$38172068$，相比之下$O(m\\text{log}^{2}n)\\approx 12183043$。看起来好像比不过树套树，实际上开个$\\text{O}2$跑得比谁都快，正如一开始那张图所示。\n\n不过代码写出来有点长的：\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#define re register\n#define maxn 50000\n#define maxm 50000\n#define maxs 230\n#define max(a,b) ((a)>=(b)?(a):(b))\n#define min(a,b) ((a)<=(b)?(a):(b))\n#define lowbit(a) ((a)&(-(a)))\n\nnamespace cltstream{\n\t#define size 1048576\n\tchar cltin[size+1],*ih=cltin,*it=cltin;\n\tinline char gc(){\n\t\t#ifdef ONLINE_JUDGE\n\t\t\tif(ih==it){\n\t\t\t\tit=(ih=cltin)+fread(cltin,1,size,stdin);\n\t\t\t\tif(ih==it)\n\t\t\t\t\treturn EOF;\n\t\t\t}\n\t\t\treturn *ih++;\n\t\t#else\n\t\t\treturn getchar();\n\t\t#endif\n\t}\n\n\tchar cltout[size+1],*oh=cltout,*ot=cltout+size;\n\tinline void pc(char c){\n\t\tif(oh==ot){\n\t\t\tfwrite(cltout,1,size,stdout);\n\t\t\toh=cltout;\n\t\t}\n\t\t*oh++=c;\n\t}\n\t#define clop() fwrite(cltstream::cltout,1,cltstream::oh-cltstream::cltout,stdout)\n\t#undef size\n\n\ttemplate <typename _tp>\n\tinline void read(_tp& x){\n\t\tint sn=1;\n\t\tchar c=gc();\n\t\tfor(;c!=45&&(c<48||c>57)&&c!=EOF;c=gc());\n\t\tif(c==45&&c!=EOF)\n\t\t\tsn=-1,c=gc();\n\t\tfor(x=0;c>=48&&c<=57&&c!=EOF;x=(x<<3)+(x<<1)+(c^48),c=gc());\n\t\tx*=sn;\n\t}\n\n\ttemplate <typename _tp>\n\tinline void write(_tp x,char text=-1){\n\t\tif(x<0)\n\t\t\tpc(45),x=-x;\n\t\tif(!x)\n\t\t\tpc(48);\n\t\telse{\n\t\t\tint digit[22];\n\t\t\tfor(digit[0]=0;x;digit[++digit[0]]=x%10,x/=10);\n\t\t\tfor(;digit[0];pc(digit[digit[0]--]^48));\n\t\t}\n\t\tif(text>=0)\n\t\t\tpc(text);\n\t}\n}\n\nint n,m,sq1,sq2;\nint id1[maxn+1],id2[maxn+maxm+1],p[maxn+maxm+1];\nint a[maxn+1],opt[maxm+1][4];\nint cnt1[maxs+1][(maxs<<1)+1],cnt2[maxs+1][maxn+maxm+1],tmp1[(maxs<<1)+1],tmp2[maxn+maxm+1];\n\nint main(){\n\tcltstream::read(n);\n\tcltstream::read(m);\n\tfor(;(sq1+1)*(sq1+1)<=n;++sq1);\n\tfor(re int i=1;i<=n;++i){\n\t\tid1[i]=(i-1)/sq1+1;\n\t\tcltstream::read(a[i]);\n\t\tp[++p[0]]=a[i];\n\t}\n\tfor(re int i=1;i<=m;++i){\n\t\tcltstream::read(opt[i][0]);\n\t\tcltstream::read(opt[i][1]);\n\t\tcltstream::read(opt[i][2]);\n\t\tif(opt[i][0]!=3)\n\t\t\tcltstream::read(opt[i][3]);\n\t\telse\n\t\t\tp[++p[0]]=opt[i][2];\n\t}\n\tstd::sort(p+1,p+p[0]+1);\n\tp[0]=std::unique(p+1,p+p[0]+1)-p-1;\n\tfor(;(sq2+1)*(sq2+1)<=p[0];++sq2);\n\tfor(re int i=1;i<=p[0];++i)\n\t\tid2[i]=(i-1)/sq2+1;\n\tfor(re int i=1;i<=n;++i){\n\t\ta[i]=std::lower_bound(p+1,p+p[0]+1,a[i])-p;\n\t\t++cnt1[id1[i]][id2[a[i]]];\n\t\t++cnt2[id1[i]][a[i]];\n\t}\n\tfor(re int i=1;i<=id1[n];++i){\n\t\tfor(re int j=1;j<=id2[p[0]];++j)\n\t\t\tcnt1[i][j]+=cnt1[i-1][j];\n\t\tfor(re int j=1;j<=p[0];++j)\n\t\t\tcnt2[i][j]+=cnt2[i-1][j];\n\t}\n\tfor(re int i=1;i<=m;++i){\n\t\tre int l,r,x,ans=0;\n\t\tswitch(opt[i][0]){\n\t\t\tcase 1:\n\t\t\t\tl=opt[i][1],r=opt[i][2],x=std::lower_bound(p+1,p+p[0]+1,opt[i][3])-p;\n\t\t\t\tif(id1[l]<id1[r]){\n\t\t\t\t\tfor(re int j=l;j<=id1[l]*sq1;++j)\n\t\t\t\t\t\tans+=(a[j]<x);\n\t\t\t\t\tfor(re int j=(id1[r]-1)*sq1+1;j<=r;++j)\n\t\t\t\t\t\tans+=(a[j]<x);\n\t\t\t\t\tfor(re int j=1;j<id2[x];++j)\n\t\t\t\t\t\tans+=cnt1[id1[r]-1][j]-cnt1[id1[l]][j];\n\t\t\t\t\tfor(re int j=(id2[x]-1)*sq2+1;j<x;++j)\n\t\t\t\t\t\tans+=cnt2[id1[r]-1][j]-cnt2[id1[l]][j];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tfor(re int j=l;j<=r;++j)\n\t\t\t\t\t\tans+=(a[j]<x);\n\t\t\t\tcltstream::write(ans+1,10);\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tl=opt[i][1],r=opt[i][2],x=opt[i][3];\n\t\t\t\tif(id1[l]<id1[r]){\n\t\t\t\t\tfor(re int j=l;j<=id1[l]*sq1;++j){\n\t\t\t\t\t\t++tmp1[id2[a[j]]];\n\t\t\t\t\t\t++tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=(id1[r]-1)*sq1+1;j<=r;++j){\n\t\t\t\t\t\t++tmp1[id2[a[j]]];\n\t\t\t\t\t\t++tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=1;;++j)\n\t\t\t\t\t\tif(x>cnt1[id1[r]-1][j]-cnt1[id1[l]][j]+tmp1[j])\n\t\t\t\t\t\t\tx-=cnt1[id1[r]-1][j]-cnt1[id1[l]][j]+tmp1[j];\n\t\t\t\t\t\telse{\n\t\t\t\t\t\t\tfor(re int k=(j-1)*sq2+1;k<=j*sq2;++k)\n\t\t\t\t\t\t\t\tif(x>cnt2[id1[r]-1][k]-cnt2[id1[l]][k]+tmp2[k])\n\t\t\t\t\t\t\t\t\tx-=cnt2[id1[r]-1][k]-cnt2[id1[l]][k]+tmp2[k];\n\t\t\t\t\t\t\t\telse{\n\t\t\t\t\t\t\t\t\tcltstream::write(p[k],10);\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=l;j<=id1[l]*sq1;++j){\n\t\t\t\t\t\t--tmp1[id2[a[j]]];\n\t\t\t\t\t\t--tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=(id1[r]-1)*sq1+1;j<=r;++j){\n\t\t\t\t\t\t--tmp1[id2[a[j]]];\n\t\t\t\t\t\t--tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tfor(re int j=l;j<=r;++j){\n\t\t\t\t\t\t++tmp1[id2[a[j]]];\n\t\t\t\t\t\t++tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=1;;++j)\n\t\t\t\t\t\tif(x>tmp1[j])\n\t\t\t\t\t\t\tx-=tmp1[j];\n\t\t\t\t\t\telse{\n\t\t\t\t\t\t\tfor(re int k=(j-1)*sq2+1;k<=j*sq2;++k)\n\t\t\t\t\t\t\t\tif(x>tmp2[k])\n\t\t\t\t\t\t\t\t\tx-=tmp2[k];\n\t\t\t\t\t\t\t\telse{\n\t\t\t\t\t\t\t\t\tcltstream::write(p[k],10);\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=l;j<=r;++j){\n\t\t\t\t\t\t--tmp1[id2[a[j]]];\n\t\t\t\t\t\t--tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tl=opt[i][1],x=std::lower_bound(p+1,p+p[0]+1,opt[i][2])-p;\n\t\t\t\tfor(re int j=id1[l];j<=id1[n];++j){\n\t\t\t\t\t--cnt1[j][id2[a[l]]];\n\t\t\t\t\t++cnt1[j][id2[x]];\n\t\t\t\t\t--cnt2[j][a[l]];\n\t\t\t\t\t++cnt2[j][x];\n\t\t\t\t}\n\t\t\t\ta[l]=x;\n\t\t\t\tbreak;\n\t\t\tcase 4:\n\t\t\t\tl=opt[i][1],r=opt[i][2],x=std::lower_bound(p+1,p+p[0]+1,opt[i][3])-p;\n\t\t\t\tif(id1[l]<id1[r]){\n\t\t\t\t\tfor(re int j=l;j<=id1[l]*sq1;++j){\n\t\t\t\t\t\t++tmp1[id2[a[j]]];\n\t\t\t\t\t\t++tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=(id1[r]-1)*sq1+1;j<=r;++j){\n\t\t\t\t\t\t++tmp1[id2[a[j]]];\n\t\t\t\t\t\t++tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=x-1;j>=(id2[x]-1)*sq2+1&&!ans;--j)\n\t\t\t\t\t\tif(cnt2[id1[r]-1][j]-cnt2[id1[l]][j]+tmp2[j])\n\t\t\t\t\t\t\tans=j;\n\t\t\t\t\tfor(re int j=id2[x]-1;j>=1&&!ans;--j)\n\t\t\t\t\t\tif(cnt1[id1[r]-1][j]-cnt1[id1[l]][j]+tmp1[j])\n\t\t\t\t\t\t\tfor(re int k=j*sq2;k>=(j-1)*sq2+1&&!ans;--k)\n\t\t\t\t\t\t\t\tif(cnt2[id1[r]-1][k]-cnt2[id1[l]][k]+tmp2[k])\n\t\t\t\t\t\t\t\t\tans=k;\n\t\t\t\t\tfor(re int j=l;j<=id1[l]*sq1;++j){\n\t\t\t\t\t\t--tmp1[id2[a[j]]];\n\t\t\t\t\t\t--tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=(id1[r]-1)*sq1+1;j<=r;++j){\n\t\t\t\t\t\t--tmp1[id2[a[j]]];\n\t\t\t\t\t\t--tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tfor(re int j=l;j<=r;++j){\n\t\t\t\t\t\t++tmp1[id2[a[j]]];\n\t\t\t\t\t\t++tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=x-1;j>=(id2[x]-1)*sq2+1&&!ans;--j)\n\t\t\t\t\t\tif(tmp2[j])\n\t\t\t\t\t\t\tans=j;\n\t\t\t\t\tfor(re int j=id2[x]-1;j>=1&&!ans;--j)\n\t\t\t\t\t\tif(tmp1[j])\n\t\t\t\t\t\t\tfor(re int k=j*sq2;k>=(j-1)*sq2+1&&!ans;--k)\n\t\t\t\t\t\t\t\tif(tmp2[k])\n\t\t\t\t\t\t\t\t\tans=k;\n\t\t\t\t\tfor(re int j=l;j<=r;++j){\n\t\t\t\t\t\t--tmp1[id2[a[j]]];\n\t\t\t\t\t\t--tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcltstream::write(ans?p[ans]:-2147483647,10);\n\t\t\t\tbreak;\n\t\t\tcase 5:\n\t\t\t\tl=opt[i][1],r=opt[i][2],x=std::upper_bound(p+1,p+p[0]+1,opt[i][3])-p-1;\n\t\t\t\tif(id1[l]<id1[r]){\n\t\t\t\t\tfor(re int j=l;j<=id1[l]*sq1;++j){\n\t\t\t\t\t\t++tmp1[id2[a[j]]];\n\t\t\t\t\t\t++tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=(id1[r]-1)*sq1+1;j<=r;++j){\n\t\t\t\t\t\t++tmp1[id2[a[j]]];\n\t\t\t\t\t\t++tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=x+1;j<=id2[x]*sq2&&!ans;++j)\n\t\t\t\t\t\tif(cnt2[id1[r]-1][j]-cnt2[id1[l]][j]+tmp2[j])\n\t\t\t\t\t\t\tans=j;\n\t\t\t\t\tfor(re int j=id2[x]+1;j<=id2[p[0]]&&!ans;++j)\n\t\t\t\t\t\tif(cnt1[id1[r]-1][j]-cnt1[id1[l]][j]+tmp1[j])\n\t\t\t\t\t\t\tfor(re int k=(j-1)*sq2+1;k<=j*sq2&&!ans;++k)\n\t\t\t\t\t\t\t\tif(cnt2[id1[r]-1][k]-cnt2[id1[l]][k]+tmp2[k])\n\t\t\t\t\t\t\t\t\tans=k;\n\t\t\t\t\tfor(re int j=l;j<=id1[l]*sq1;++j){\n\t\t\t\t\t\t--tmp1[id2[a[j]]];\n\t\t\t\t\t\t--tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=(id1[r]-1)*sq1+1;j<=r;++j){\n\t\t\t\t\t\t--tmp1[id2[a[j]]];\n\t\t\t\t\t\t--tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tfor(re int j=l;j<=r;++j){\n\t\t\t\t\t\t++tmp1[id2[a[j]]];\n\t\t\t\t\t\t++tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=x+1;j<=id2[x]*sq2&&!ans;++j)\n\t\t\t\t\t\tif(tmp2[j])\n\t\t\t\t\t\t\tans=j;\n\t\t\t\t\tfor(re int j=id2[x]+1;j<=id2[p[0]]&&!ans;++j)\n\t\t\t\t\t\tif(tmp1[j])\n\t\t\t\t\t\t\tfor(re int k=(j-1)*sq2+1;k<=j*sq2&&!ans;++k)\n\t\t\t\t\t\t\t\tif(tmp2[k])\n\t\t\t\t\t\t\t\t\tans=k;\n\t\t\t\t\tfor(re int j=l;j<=r;++j){\n\t\t\t\t\t\t--tmp1[id2[a[j]]];\n\t\t\t\t\t\t--tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcltstream::write(ans?p[ans]:2147483647,10);\n\t\t}\n\t}\n\tclop();\n\treturn 0;\n}\n```\n\n我还没写啥呢咋就$12\\text{KB}$了（\n\n这大概会成为一个系列，名字就叫做「未来算法」（$\\text{Future Algorithm}$），不过也说不定，会不会以后哪天突然蹦出来个「未来算法Episode II」也说不定（","source":"_posts/2018-12-08-future-algorithm-ep1.md","raw":"---\ntitle: 「未来算法Episode I」严格根号分块实现树套树\ndate: 2018-12-08 19:55:00\ntags:\n  - 树套树\n  - 分块\ncategories:\n  - 未来算法\nmathjax: true\n---\n分块天下第一！！！！！！！！！\n\n<!-- more -->\n\n我也不知道我为什么要写这个玩意，大概是我真的被这个外挂一般的东西吓到了吧。\n\n[![](https://i.loli.net/2018/12/08/5c0bb272768cf.png)](https://www.luogu.org/record/show?rid=14518116)\n\n![](https://i.loli.net/2018/12/08/5c0bb2c767fda.jpg)\n\n我们从头说起。点开上面的那个评测记录，我们可以看到一道树套树的模板题。\n\n先退一步来说，假如说我们去掉操作$3$，剩下的操作都可以用主席树来完成。\n\n然而麻烦的是，我们在树上存的是前缀和。想要修改的话，暴力的复杂度是单次$O(n\\text{log}n)$的。\n\n那我们就在外层套个树状数组，把修改$O(n\\text{log}n)$查询$O(\\text{log}n)$均摊成全部$O(\\text{log}^{2}n)$。\n\n然而，很遗憾，我不会树套树，一点都不会，就连上面的这段文字也是我瞎扯出来的。\n\n考虑~~无敌的~~分块。\n\n一般我们想到的分块就是在块内维护`std::set`。这样操作$3$可以做到$O(\\text{log}\\sqrt{n})$，操作$1$、$4$、$5$可以做到$O(\\sqrt{n}\\text{log}\\sqrt{n})$。至于操作$2$，我们在外层套一个二分，然后检查二分到的数的排名是不是$k$，时间复杂度$O(\\text{log}10^{9}\\sqrt{n}\\text{log}\\sqrt{n})$。\n\n然而很明显的，这样做的效率十分低下，除了实现复杂度相对树套树小了一点以外没有任何优势。\n\n我们来看一下[__Shadowice1984__](https://www.luogu.org/space/show?uid=56384)dalao在他的[另一篇题解](https://www.luogu.org/blog/ShadowassIIXVIIIIV/solution-p4119)中做出的评价：\n\n> 这其实是一个误区。主席树之所以采取了二分的思路来解决问题是因为我们要求回答单次询问做到$O(\\text{log}n)$的复杂度，这时候唯一的可行思路就是二分否则我们无法将复杂度控制在一个$\\text{log}$之内。\n> \n> 但是我们现在是使用分块解决问题。分块是有自己复杂度的，就是$O(\\sqrt{n})$而不是$O(\\text{log}n)$，这意味着分块其实和$\\text{log}$的数据结构以及二分法并不是很搭（因为分块的结构本质上就不支持二分）。如果我们需要强行嵌入$\\text{log}$的数据结构的话在绝大部分情况下都会使复杂度凭空多出个$\\text{log}$来，这在强调常数的根号算法中绝对是致命的。\n\n我也是从这位dalao的[blog](https://www.luogu.org/blog/ShadowassIIXVIIIIV/solution-p3380)里看到了严格根号分块实现树套树这种未来算法。\n\n主要思想其实不难理解，既然分块和$\\text{log}$不适合放在一起，我们就再套个分块，或者说，把值域也分成块。\n\n定义`cnt1[i][j]`表示前$i$个块内有多少个元素的值在第$j$个块内，`cnt2[i][j]`表示前$i$个块内有多少个$j$（当然是离散化后的）。不难发现预处理出这两个数组的时间复杂度是$O((n+m)\\sqrt{n})$的。\n\n然后我们来分析每个操作该怎么实现：\n\n1. 首先考虑序列中的整块。从头开始扫一遍值域块，一直扫到给定数所在块的前一个块，然后再在给定数所在块内从头扫到给定数的前一个，查询扫过的值有多少落在这些整块内。剩下的边角块自然地暴力判断。\n2. 还是从头扫一遍值域块，看看每个值域块内有多少数落在给定区间内，大概判断出答案在哪个值域块内。然后在这个值域块内再扫一遍即可。需要注意的是我们需要再开两个数组`tmp1`和`tmp2`来保存边角块的信息。\n3. 直接$O(\\sqrt{n})$暴力重构两个`cnt`就好。\n4. 需要两个类似于操作$2$的临时数组，存储的信息也是类似的。首先在给定数所在值域块内__从后往前扫__，找到答案直接退出。否则还是__从后往前扫所有值域块__，找到第一个非空的块然后进去找。\n5. 操作$4$换个方向即可。\n\n综上所述，该算法的时间复杂度为$O((n+m)\\sqrt{n}+m\\sqrt{n+m})$。当$n$，$m$取到极限值时，差不多是$38172068$，相比之下$O(m\\text{log}^{2}n)\\approx 12183043$。看起来好像比不过树套树，实际上开个$\\text{O}2$跑得比谁都快，正如一开始那张图所示。\n\n不过代码写出来有点长的：\n\n```cpp\n#include<cstdio>\n#include<cstring>\n#include<algorithm>\n#define re register\n#define maxn 50000\n#define maxm 50000\n#define maxs 230\n#define max(a,b) ((a)>=(b)?(a):(b))\n#define min(a,b) ((a)<=(b)?(a):(b))\n#define lowbit(a) ((a)&(-(a)))\n\nnamespace cltstream{\n\t#define size 1048576\n\tchar cltin[size+1],*ih=cltin,*it=cltin;\n\tinline char gc(){\n\t\t#ifdef ONLINE_JUDGE\n\t\t\tif(ih==it){\n\t\t\t\tit=(ih=cltin)+fread(cltin,1,size,stdin);\n\t\t\t\tif(ih==it)\n\t\t\t\t\treturn EOF;\n\t\t\t}\n\t\t\treturn *ih++;\n\t\t#else\n\t\t\treturn getchar();\n\t\t#endif\n\t}\n\n\tchar cltout[size+1],*oh=cltout,*ot=cltout+size;\n\tinline void pc(char c){\n\t\tif(oh==ot){\n\t\t\tfwrite(cltout,1,size,stdout);\n\t\t\toh=cltout;\n\t\t}\n\t\t*oh++=c;\n\t}\n\t#define clop() fwrite(cltstream::cltout,1,cltstream::oh-cltstream::cltout,stdout)\n\t#undef size\n\n\ttemplate <typename _tp>\n\tinline void read(_tp& x){\n\t\tint sn=1;\n\t\tchar c=gc();\n\t\tfor(;c!=45&&(c<48||c>57)&&c!=EOF;c=gc());\n\t\tif(c==45&&c!=EOF)\n\t\t\tsn=-1,c=gc();\n\t\tfor(x=0;c>=48&&c<=57&&c!=EOF;x=(x<<3)+(x<<1)+(c^48),c=gc());\n\t\tx*=sn;\n\t}\n\n\ttemplate <typename _tp>\n\tinline void write(_tp x,char text=-1){\n\t\tif(x<0)\n\t\t\tpc(45),x=-x;\n\t\tif(!x)\n\t\t\tpc(48);\n\t\telse{\n\t\t\tint digit[22];\n\t\t\tfor(digit[0]=0;x;digit[++digit[0]]=x%10,x/=10);\n\t\t\tfor(;digit[0];pc(digit[digit[0]--]^48));\n\t\t}\n\t\tif(text>=0)\n\t\t\tpc(text);\n\t}\n}\n\nint n,m,sq1,sq2;\nint id1[maxn+1],id2[maxn+maxm+1],p[maxn+maxm+1];\nint a[maxn+1],opt[maxm+1][4];\nint cnt1[maxs+1][(maxs<<1)+1],cnt2[maxs+1][maxn+maxm+1],tmp1[(maxs<<1)+1],tmp2[maxn+maxm+1];\n\nint main(){\n\tcltstream::read(n);\n\tcltstream::read(m);\n\tfor(;(sq1+1)*(sq1+1)<=n;++sq1);\n\tfor(re int i=1;i<=n;++i){\n\t\tid1[i]=(i-1)/sq1+1;\n\t\tcltstream::read(a[i]);\n\t\tp[++p[0]]=a[i];\n\t}\n\tfor(re int i=1;i<=m;++i){\n\t\tcltstream::read(opt[i][0]);\n\t\tcltstream::read(opt[i][1]);\n\t\tcltstream::read(opt[i][2]);\n\t\tif(opt[i][0]!=3)\n\t\t\tcltstream::read(opt[i][3]);\n\t\telse\n\t\t\tp[++p[0]]=opt[i][2];\n\t}\n\tstd::sort(p+1,p+p[0]+1);\n\tp[0]=std::unique(p+1,p+p[0]+1)-p-1;\n\tfor(;(sq2+1)*(sq2+1)<=p[0];++sq2);\n\tfor(re int i=1;i<=p[0];++i)\n\t\tid2[i]=(i-1)/sq2+1;\n\tfor(re int i=1;i<=n;++i){\n\t\ta[i]=std::lower_bound(p+1,p+p[0]+1,a[i])-p;\n\t\t++cnt1[id1[i]][id2[a[i]]];\n\t\t++cnt2[id1[i]][a[i]];\n\t}\n\tfor(re int i=1;i<=id1[n];++i){\n\t\tfor(re int j=1;j<=id2[p[0]];++j)\n\t\t\tcnt1[i][j]+=cnt1[i-1][j];\n\t\tfor(re int j=1;j<=p[0];++j)\n\t\t\tcnt2[i][j]+=cnt2[i-1][j];\n\t}\n\tfor(re int i=1;i<=m;++i){\n\t\tre int l,r,x,ans=0;\n\t\tswitch(opt[i][0]){\n\t\t\tcase 1:\n\t\t\t\tl=opt[i][1],r=opt[i][2],x=std::lower_bound(p+1,p+p[0]+1,opt[i][3])-p;\n\t\t\t\tif(id1[l]<id1[r]){\n\t\t\t\t\tfor(re int j=l;j<=id1[l]*sq1;++j)\n\t\t\t\t\t\tans+=(a[j]<x);\n\t\t\t\t\tfor(re int j=(id1[r]-1)*sq1+1;j<=r;++j)\n\t\t\t\t\t\tans+=(a[j]<x);\n\t\t\t\t\tfor(re int j=1;j<id2[x];++j)\n\t\t\t\t\t\tans+=cnt1[id1[r]-1][j]-cnt1[id1[l]][j];\n\t\t\t\t\tfor(re int j=(id2[x]-1)*sq2+1;j<x;++j)\n\t\t\t\t\t\tans+=cnt2[id1[r]-1][j]-cnt2[id1[l]][j];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tfor(re int j=l;j<=r;++j)\n\t\t\t\t\t\tans+=(a[j]<x);\n\t\t\t\tcltstream::write(ans+1,10);\n\t\t\t\tbreak;\n\t\t\tcase 2:\n\t\t\t\tl=opt[i][1],r=opt[i][2],x=opt[i][3];\n\t\t\t\tif(id1[l]<id1[r]){\n\t\t\t\t\tfor(re int j=l;j<=id1[l]*sq1;++j){\n\t\t\t\t\t\t++tmp1[id2[a[j]]];\n\t\t\t\t\t\t++tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=(id1[r]-1)*sq1+1;j<=r;++j){\n\t\t\t\t\t\t++tmp1[id2[a[j]]];\n\t\t\t\t\t\t++tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=1;;++j)\n\t\t\t\t\t\tif(x>cnt1[id1[r]-1][j]-cnt1[id1[l]][j]+tmp1[j])\n\t\t\t\t\t\t\tx-=cnt1[id1[r]-1][j]-cnt1[id1[l]][j]+tmp1[j];\n\t\t\t\t\t\telse{\n\t\t\t\t\t\t\tfor(re int k=(j-1)*sq2+1;k<=j*sq2;++k)\n\t\t\t\t\t\t\t\tif(x>cnt2[id1[r]-1][k]-cnt2[id1[l]][k]+tmp2[k])\n\t\t\t\t\t\t\t\t\tx-=cnt2[id1[r]-1][k]-cnt2[id1[l]][k]+tmp2[k];\n\t\t\t\t\t\t\t\telse{\n\t\t\t\t\t\t\t\t\tcltstream::write(p[k],10);\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=l;j<=id1[l]*sq1;++j){\n\t\t\t\t\t\t--tmp1[id2[a[j]]];\n\t\t\t\t\t\t--tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=(id1[r]-1)*sq1+1;j<=r;++j){\n\t\t\t\t\t\t--tmp1[id2[a[j]]];\n\t\t\t\t\t\t--tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tfor(re int j=l;j<=r;++j){\n\t\t\t\t\t\t++tmp1[id2[a[j]]];\n\t\t\t\t\t\t++tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=1;;++j)\n\t\t\t\t\t\tif(x>tmp1[j])\n\t\t\t\t\t\t\tx-=tmp1[j];\n\t\t\t\t\t\telse{\n\t\t\t\t\t\t\tfor(re int k=(j-1)*sq2+1;k<=j*sq2;++k)\n\t\t\t\t\t\t\t\tif(x>tmp2[k])\n\t\t\t\t\t\t\t\t\tx-=tmp2[k];\n\t\t\t\t\t\t\t\telse{\n\t\t\t\t\t\t\t\t\tcltstream::write(p[k],10);\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=l;j<=r;++j){\n\t\t\t\t\t\t--tmp1[id2[a[j]]];\n\t\t\t\t\t\t--tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 3:\n\t\t\t\tl=opt[i][1],x=std::lower_bound(p+1,p+p[0]+1,opt[i][2])-p;\n\t\t\t\tfor(re int j=id1[l];j<=id1[n];++j){\n\t\t\t\t\t--cnt1[j][id2[a[l]]];\n\t\t\t\t\t++cnt1[j][id2[x]];\n\t\t\t\t\t--cnt2[j][a[l]];\n\t\t\t\t\t++cnt2[j][x];\n\t\t\t\t}\n\t\t\t\ta[l]=x;\n\t\t\t\tbreak;\n\t\t\tcase 4:\n\t\t\t\tl=opt[i][1],r=opt[i][2],x=std::lower_bound(p+1,p+p[0]+1,opt[i][3])-p;\n\t\t\t\tif(id1[l]<id1[r]){\n\t\t\t\t\tfor(re int j=l;j<=id1[l]*sq1;++j){\n\t\t\t\t\t\t++tmp1[id2[a[j]]];\n\t\t\t\t\t\t++tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=(id1[r]-1)*sq1+1;j<=r;++j){\n\t\t\t\t\t\t++tmp1[id2[a[j]]];\n\t\t\t\t\t\t++tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=x-1;j>=(id2[x]-1)*sq2+1&&!ans;--j)\n\t\t\t\t\t\tif(cnt2[id1[r]-1][j]-cnt2[id1[l]][j]+tmp2[j])\n\t\t\t\t\t\t\tans=j;\n\t\t\t\t\tfor(re int j=id2[x]-1;j>=1&&!ans;--j)\n\t\t\t\t\t\tif(cnt1[id1[r]-1][j]-cnt1[id1[l]][j]+tmp1[j])\n\t\t\t\t\t\t\tfor(re int k=j*sq2;k>=(j-1)*sq2+1&&!ans;--k)\n\t\t\t\t\t\t\t\tif(cnt2[id1[r]-1][k]-cnt2[id1[l]][k]+tmp2[k])\n\t\t\t\t\t\t\t\t\tans=k;\n\t\t\t\t\tfor(re int j=l;j<=id1[l]*sq1;++j){\n\t\t\t\t\t\t--tmp1[id2[a[j]]];\n\t\t\t\t\t\t--tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=(id1[r]-1)*sq1+1;j<=r;++j){\n\t\t\t\t\t\t--tmp1[id2[a[j]]];\n\t\t\t\t\t\t--tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tfor(re int j=l;j<=r;++j){\n\t\t\t\t\t\t++tmp1[id2[a[j]]];\n\t\t\t\t\t\t++tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=x-1;j>=(id2[x]-1)*sq2+1&&!ans;--j)\n\t\t\t\t\t\tif(tmp2[j])\n\t\t\t\t\t\t\tans=j;\n\t\t\t\t\tfor(re int j=id2[x]-1;j>=1&&!ans;--j)\n\t\t\t\t\t\tif(tmp1[j])\n\t\t\t\t\t\t\tfor(re int k=j*sq2;k>=(j-1)*sq2+1&&!ans;--k)\n\t\t\t\t\t\t\t\tif(tmp2[k])\n\t\t\t\t\t\t\t\t\tans=k;\n\t\t\t\t\tfor(re int j=l;j<=r;++j){\n\t\t\t\t\t\t--tmp1[id2[a[j]]];\n\t\t\t\t\t\t--tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcltstream::write(ans?p[ans]:-2147483647,10);\n\t\t\t\tbreak;\n\t\t\tcase 5:\n\t\t\t\tl=opt[i][1],r=opt[i][2],x=std::upper_bound(p+1,p+p[0]+1,opt[i][3])-p-1;\n\t\t\t\tif(id1[l]<id1[r]){\n\t\t\t\t\tfor(re int j=l;j<=id1[l]*sq1;++j){\n\t\t\t\t\t\t++tmp1[id2[a[j]]];\n\t\t\t\t\t\t++tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=(id1[r]-1)*sq1+1;j<=r;++j){\n\t\t\t\t\t\t++tmp1[id2[a[j]]];\n\t\t\t\t\t\t++tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=x+1;j<=id2[x]*sq2&&!ans;++j)\n\t\t\t\t\t\tif(cnt2[id1[r]-1][j]-cnt2[id1[l]][j]+tmp2[j])\n\t\t\t\t\t\t\tans=j;\n\t\t\t\t\tfor(re int j=id2[x]+1;j<=id2[p[0]]&&!ans;++j)\n\t\t\t\t\t\tif(cnt1[id1[r]-1][j]-cnt1[id1[l]][j]+tmp1[j])\n\t\t\t\t\t\t\tfor(re int k=(j-1)*sq2+1;k<=j*sq2&&!ans;++k)\n\t\t\t\t\t\t\t\tif(cnt2[id1[r]-1][k]-cnt2[id1[l]][k]+tmp2[k])\n\t\t\t\t\t\t\t\t\tans=k;\n\t\t\t\t\tfor(re int j=l;j<=id1[l]*sq1;++j){\n\t\t\t\t\t\t--tmp1[id2[a[j]]];\n\t\t\t\t\t\t--tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=(id1[r]-1)*sq1+1;j<=r;++j){\n\t\t\t\t\t\t--tmp1[id2[a[j]]];\n\t\t\t\t\t\t--tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse{\n\t\t\t\t\tfor(re int j=l;j<=r;++j){\n\t\t\t\t\t\t++tmp1[id2[a[j]]];\n\t\t\t\t\t\t++tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t\tfor(re int j=x+1;j<=id2[x]*sq2&&!ans;++j)\n\t\t\t\t\t\tif(tmp2[j])\n\t\t\t\t\t\t\tans=j;\n\t\t\t\t\tfor(re int j=id2[x]+1;j<=id2[p[0]]&&!ans;++j)\n\t\t\t\t\t\tif(tmp1[j])\n\t\t\t\t\t\t\tfor(re int k=(j-1)*sq2+1;k<=j*sq2&&!ans;++k)\n\t\t\t\t\t\t\t\tif(tmp2[k])\n\t\t\t\t\t\t\t\t\tans=k;\n\t\t\t\t\tfor(re int j=l;j<=r;++j){\n\t\t\t\t\t\t--tmp1[id2[a[j]]];\n\t\t\t\t\t\t--tmp2[a[j]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcltstream::write(ans?p[ans]:2147483647,10);\n\t\t}\n\t}\n\tclop();\n\treturn 0;\n}\n```\n\n我还没写啥呢咋就$12\\text{KB}$了（\n\n这大概会成为一个系列，名字就叫做「未来算法」（$\\text{Future Algorithm}$），不过也说不定，会不会以后哪天突然蹦出来个「未来算法Episode II」也说不定（","slug":"future-algorithm-ep1","published":1,"updated":"2018-12-12T06:41:34.035Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjpn8w600001xrogutyd0kga5","content":"<p>分块天下第一！！！！！！！！！</p>\n<a id=\"more\"></a>\n<p>我也不知道我为什么要写这个玩意，大概是我真的被这个外挂一般的东西吓到了吧。</p>\n<p><a href=\"https://www.luogu.org/record/show?rid=14518116\" target=\"_blank\" rel=\"noopener\"><img src=\"https://i.loli.net/2018/12/08/5c0bb272768cf.png\" alt=\"\"></a></p>\n<p><img src=\"https://i.loli.net/2018/12/08/5c0bb2c767fda.jpg\" alt=\"\"></p>\n<p>我们从头说起。点开上面的那个评测记录，我们可以看到一道树套树的模板题。</p>\n<p>先退一步来说，假如说我们去掉操作$3$，剩下的操作都可以用主席树来完成。</p>\n<p>然而麻烦的是，我们在树上存的是前缀和。想要修改的话，暴力的复杂度是单次$O(n\\text{log}n)$的。</p>\n<p>那我们就在外层套个树状数组，把修改$O(n\\text{log}n)$查询$O(\\text{log}n)$均摊成全部$O(\\text{log}^{2}n)$。</p>\n<p>然而，很遗憾，我不会树套树，一点都不会，就连上面的这段文字也是我瞎扯出来的。</p>\n<p>考虑<del>无敌的</del>分块。</p>\n<p>一般我们想到的分块就是在块内维护<code>std::set</code>。这样操作$3$可以做到$O(\\text{log}\\sqrt{n})$，操作$1$、$4$、$5$可以做到$O(\\sqrt{n}\\text{log}\\sqrt{n})$。至于操作$2$，我们在外层套一个二分，然后检查二分到的数的排名是不是$k$，时间复杂度$O(\\text{log}10^{9}\\sqrt{n}\\text{log}\\sqrt{n})$。</p>\n<p>然而很明显的，这样做的效率十分低下，除了实现复杂度相对树套树小了一点以外没有任何优势。</p>\n<p>我们来看一下<a href=\"https://www.luogu.org/space/show?uid=56384\" target=\"_blank\" rel=\"noopener\"><strong>Shadowice1984</strong></a>dalao在他的<a href=\"https://www.luogu.org/blog/ShadowassIIXVIIIIV/solution-p4119\" target=\"_blank\" rel=\"noopener\">另一篇题解</a>中做出的评价：</p>\n<blockquote>\n<p>这其实是一个误区。主席树之所以采取了二分的思路来解决问题是因为我们要求回答单次询问做到$O(\\text{log}n)$的复杂度，这时候唯一的可行思路就是二分否则我们无法将复杂度控制在一个$\\text{log}$之内。</p>\n<p>但是我们现在是使用分块解决问题。分块是有自己复杂度的，就是$O(\\sqrt{n})$而不是$O(\\text{log}n)$，这意味着分块其实和$\\text{log}$的数据结构以及二分法并不是很搭（因为分块的结构本质上就不支持二分）。如果我们需要强行嵌入$\\text{log}$的数据结构的话在绝大部分情况下都会使复杂度凭空多出个$\\text{log}$来，这在强调常数的根号算法中绝对是致命的。</p>\n</blockquote>\n<p>我也是从这位dalao的<a href=\"https://www.luogu.org/blog/ShadowassIIXVIIIIV/solution-p3380\" target=\"_blank\" rel=\"noopener\">blog</a>里看到了严格根号分块实现树套树这种未来算法。</p>\n<p>主要思想其实不难理解，既然分块和$\\text{log}$不适合放在一起，我们就再套个分块，或者说，把值域也分成块。</p>\n<p>定义<code>cnt1[i][j]</code>表示前$i$个块内有多少个元素的值在第$j$个块内，<code>cnt2[i][j]</code>表示前$i$个块内有多少个$j$（当然是离散化后的）。不难发现预处理出这两个数组的时间复杂度是$O((n+m)\\sqrt{n})$的。</p>\n<p>然后我们来分析每个操作该怎么实现：</p>\n<ol>\n<li>首先考虑序列中的整块。从头开始扫一遍值域块，一直扫到给定数所在块的前一个块，然后再在给定数所在块内从头扫到给定数的前一个，查询扫过的值有多少落在这些整块内。剩下的边角块自然地暴力判断。</li>\n<li>还是从头扫一遍值域块，看看每个值域块内有多少数落在给定区间内，大概判断出答案在哪个值域块内。然后在这个值域块内再扫一遍即可。需要注意的是我们需要再开两个数组<code>tmp1</code>和<code>tmp2</code>来保存边角块的信息。</li>\n<li>直接$O(\\sqrt{n})$暴力重构两个<code>cnt</code>就好。</li>\n<li>需要两个类似于操作$2$的临时数组，存储的信息也是类似的。首先在给定数所在值域块内<strong>从后往前扫</strong>，找到答案直接退出。否则还是<strong>从后往前扫所有值域块</strong>，找到第一个非空的块然后进去找。</li>\n<li>操作$4$换个方向即可。</li>\n</ol>\n<p>综上所述，该算法的时间复杂度为$O((n+m)\\sqrt{n}+m\\sqrt{n+m})$。当$n$，$m$取到极限值时，差不多是$38172068$，相比之下$O(m\\text{log}^{2}n)\\approx 12183043$。看起来好像比不过树套树，实际上开个$\\text{O}2$跑得比谁都快，正如一开始那张图所示。</p>\n<p>不过代码写出来有点长的：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;cstring&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> re register</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> maxn 50000</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> maxm 50000</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> maxs 230</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> max(a,b) ((a)&gt;=(b)?(a):(b))</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> min(a,b) ((a)&lt;=(b)?(a):(b))</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> lowbit(a) ((a)&amp;(-(a)))</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> cltstream&#123;</span><br><span class=\"line\">\t<span class=\"meta\">#<span class=\"meta-keyword\">define</span> size 1048576</span></span><br><span class=\"line\">\t<span class=\"keyword\">char</span> cltin[size+<span class=\"number\">1</span>],*ih=cltin,*it=cltin;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">char</span> <span class=\"title\">gc</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"meta\">#<span class=\"meta-keyword\">ifdef</span> ONLINE_JUDGE</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(ih==it)&#123;</span><br><span class=\"line\">\t\t\t\tit=(ih=cltin)+fread(cltin,<span class=\"number\">1</span>,size,<span class=\"built_in\">stdin</span>);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(ih==it)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> EOF;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> *ih++;</span><br><span class=\"line\">\t\t<span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> getchar();</span><br><span class=\"line\">\t\t<span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">char</span> cltout[size+<span class=\"number\">1</span>],*oh=cltout,*ot=cltout+size;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">pc</span><span class=\"params\">(<span class=\"keyword\">char</span> c)</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(oh==ot)&#123;</span><br><span class=\"line\">\t\t\tfwrite(cltout,<span class=\"number\">1</span>,size,<span class=\"built_in\">stdout</span>);</span><br><span class=\"line\">\t\t\toh=cltout;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t*oh++=c;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"meta\">#<span class=\"meta-keyword\">define</span> clop() fwrite(cltstream::cltout,1,cltstream::oh-cltstream::cltout,stdout)</span></span><br><span class=\"line\">\t<span class=\"meta\">#<span class=\"meta-keyword\">undef</span> size</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> _tp&gt;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">read</span><span class=\"params\">(_tp&amp; x)</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> sn=<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">char</span> c=gc();</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(;c!=<span class=\"number\">45</span>&amp;&amp;(c&lt;<span class=\"number\">48</span>||c&gt;<span class=\"number\">57</span>)&amp;&amp;c!=EOF;c=gc());</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(c==<span class=\"number\">45</span>&amp;&amp;c!=EOF)</span><br><span class=\"line\">\t\t\tsn=<span class=\"number\">-1</span>,c=gc();</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(x=<span class=\"number\">0</span>;c&gt;=<span class=\"number\">48</span>&amp;&amp;c&lt;=<span class=\"number\">57</span>&amp;&amp;c!=EOF;x=(x&lt;&lt;<span class=\"number\">3</span>)+(x&lt;&lt;<span class=\"number\">1</span>)+(c^<span class=\"number\">48</span>),c=gc());</span><br><span class=\"line\">\t\tx*=sn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> _tp&gt;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">write</span><span class=\"params\">(_tp x,<span class=\"keyword\">char</span> text=<span class=\"number\">-1</span>)</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(x&lt;<span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\tpc(<span class=\"number\">45</span>),x=-x;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(!x)</span><br><span class=\"line\">\t\t\tpc(<span class=\"number\">48</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">int</span> digit[<span class=\"number\">22</span>];</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span>(digit[<span class=\"number\">0</span>]=<span class=\"number\">0</span>;x;digit[++digit[<span class=\"number\">0</span>]]=x%<span class=\"number\">10</span>,x/=<span class=\"number\">10</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span>(;digit[<span class=\"number\">0</span>];pc(digit[digit[<span class=\"number\">0</span>]--]^<span class=\"number\">48</span>));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(text&gt;=<span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\tpc(text);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> n,m,sq1,sq2;</span><br><span class=\"line\"><span class=\"keyword\">int</span> id1[maxn+<span class=\"number\">1</span>],id2[maxn+maxm+<span class=\"number\">1</span>],p[maxn+maxm+<span class=\"number\">1</span>];</span><br><span class=\"line\"><span class=\"keyword\">int</span> a[maxn+<span class=\"number\">1</span>],opt[maxm+<span class=\"number\">1</span>][<span class=\"number\">4</span>];</span><br><span class=\"line\"><span class=\"keyword\">int</span> cnt1[maxs+<span class=\"number\">1</span>][(maxs&lt;&lt;<span class=\"number\">1</span>)+<span class=\"number\">1</span>],cnt2[maxs+<span class=\"number\">1</span>][maxn+maxm+<span class=\"number\">1</span>],tmp1[(maxs&lt;&lt;<span class=\"number\">1</span>)+<span class=\"number\">1</span>],tmp2[maxn+maxm+<span class=\"number\">1</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\tcltstream::read(n);</span><br><span class=\"line\">\tcltstream::read(m);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(;(sq1+<span class=\"number\">1</span>)*(sq1+<span class=\"number\">1</span>)&lt;=n;++sq1);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;++i)&#123;</span><br><span class=\"line\">\t\tid1[i]=(i<span class=\"number\">-1</span>)/sq1+<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\tcltstream::read(a[i]);</span><br><span class=\"line\">\t\tp[++p[<span class=\"number\">0</span>]]=a[i];</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=m;++i)&#123;</span><br><span class=\"line\">\t\tcltstream::read(opt[i][<span class=\"number\">0</span>]);</span><br><span class=\"line\">\t\tcltstream::read(opt[i][<span class=\"number\">1</span>]);</span><br><span class=\"line\">\t\tcltstream::read(opt[i][<span class=\"number\">2</span>]);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(opt[i][<span class=\"number\">0</span>]!=<span class=\"number\">3</span>)</span><br><span class=\"line\">\t\t\tcltstream::read(opt[i][<span class=\"number\">3</span>]);</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\tp[++p[<span class=\"number\">0</span>]]=opt[i][<span class=\"number\">2</span>];</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">std</span>::sort(p+<span class=\"number\">1</span>,p+p[<span class=\"number\">0</span>]+<span class=\"number\">1</span>);</span><br><span class=\"line\">\tp[<span class=\"number\">0</span>]=<span class=\"built_in\">std</span>::unique(p+<span class=\"number\">1</span>,p+p[<span class=\"number\">0</span>]+<span class=\"number\">1</span>)-p<span class=\"number\">-1</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(;(sq2+<span class=\"number\">1</span>)*(sq2+<span class=\"number\">1</span>)&lt;=p[<span class=\"number\">0</span>];++sq2);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=p[<span class=\"number\">0</span>];++i)</span><br><span class=\"line\">\t\tid2[i]=(i<span class=\"number\">-1</span>)/sq2+<span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;++i)&#123;</span><br><span class=\"line\">\t\ta[i]=<span class=\"built_in\">std</span>::lower_bound(p+<span class=\"number\">1</span>,p+p[<span class=\"number\">0</span>]+<span class=\"number\">1</span>,a[i])-p;</span><br><span class=\"line\">\t\t++cnt1[id1[i]][id2[a[i]]];</span><br><span class=\"line\">\t\t++cnt2[id1[i]][a[i]];</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=id1[n];++i)&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=<span class=\"number\">1</span>;j&lt;=id2[p[<span class=\"number\">0</span>]];++j)</span><br><span class=\"line\">\t\t\tcnt1[i][j]+=cnt1[i<span class=\"number\">-1</span>][j];</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=<span class=\"number\">1</span>;j&lt;=p[<span class=\"number\">0</span>];++j)</span><br><span class=\"line\">\t\t\tcnt2[i][j]+=cnt2[i<span class=\"number\">-1</span>][j];</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=m;++i)&#123;</span><br><span class=\"line\">\t\tre <span class=\"keyword\">int</span> l,r,x,ans=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">switch</span>(opt[i][<span class=\"number\">0</span>])&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">\t\t\t\tl=opt[i][<span class=\"number\">1</span>],r=opt[i][<span class=\"number\">2</span>],x=<span class=\"built_in\">std</span>::lower_bound(p+<span class=\"number\">1</span>,p+p[<span class=\"number\">0</span>]+<span class=\"number\">1</span>,opt[i][<span class=\"number\">3</span>])-p;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(id1[l]&lt;id1[r])&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=id1[l]*sq1;++j)</span><br><span class=\"line\">\t\t\t\t\t\tans+=(a[j]&lt;x);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=(id1[r]<span class=\"number\">-1</span>)*sq1+<span class=\"number\">1</span>;j&lt;=r;++j)</span><br><span class=\"line\">\t\t\t\t\t\tans+=(a[j]&lt;x);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=<span class=\"number\">1</span>;j&lt;id2[x];++j)</span><br><span class=\"line\">\t\t\t\t\t\tans+=cnt1[id1[r]<span class=\"number\">-1</span>][j]-cnt1[id1[l]][j];</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=(id2[x]<span class=\"number\">-1</span>)*sq2+<span class=\"number\">1</span>;j&lt;x;++j)</span><br><span class=\"line\">\t\t\t\t\t\tans+=cnt2[id1[r]<span class=\"number\">-1</span>][j]-cnt2[id1[l]][j];</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=r;++j)</span><br><span class=\"line\">\t\t\t\t\t\tans+=(a[j]&lt;x);</span><br><span class=\"line\">\t\t\t\tcltstream::write(ans+<span class=\"number\">1</span>,<span class=\"number\">10</span>);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">\t\t\t\tl=opt[i][<span class=\"number\">1</span>],r=opt[i][<span class=\"number\">2</span>],x=opt[i][<span class=\"number\">3</span>];</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(id1[l]&lt;id1[r])&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=id1[l]*sq1;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t++tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t++tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=(id1[r]<span class=\"number\">-1</span>)*sq1+<span class=\"number\">1</span>;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t++tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t++tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=<span class=\"number\">1</span>;;++j)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(x&gt;cnt1[id1[r]<span class=\"number\">-1</span>][j]-cnt1[id1[l]][j]+tmp1[j])</span><br><span class=\"line\">\t\t\t\t\t\t\tx-=cnt1[id1[r]<span class=\"number\">-1</span>][j]-cnt1[id1[l]][j]+tmp1[j];</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> k=(j<span class=\"number\">-1</span>)*sq2+<span class=\"number\">1</span>;k&lt;=j*sq2;++k)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">if</span>(x&gt;cnt2[id1[r]<span class=\"number\">-1</span>][k]-cnt2[id1[l]][k]+tmp2[k])</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tx-=cnt2[id1[r]<span class=\"number\">-1</span>][k]-cnt2[id1[l]][k]+tmp2[k];</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tcltstream::write(p[k],<span class=\"number\">10</span>);</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=id1[l]*sq1;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t--tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t--tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=(id1[r]<span class=\"number\">-1</span>)*sq1+<span class=\"number\">1</span>;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t--tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t--tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t++tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t++tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=<span class=\"number\">1</span>;;++j)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(x&gt;tmp1[j])</span><br><span class=\"line\">\t\t\t\t\t\t\tx-=tmp1[j];</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> k=(j<span class=\"number\">-1</span>)*sq2+<span class=\"number\">1</span>;k&lt;=j*sq2;++k)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">if</span>(x&gt;tmp2[k])</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tx-=tmp2[k];</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tcltstream::write(p[k],<span class=\"number\">10</span>);</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t--tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t--tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">\t\t\t\tl=opt[i][<span class=\"number\">1</span>],x=<span class=\"built_in\">std</span>::lower_bound(p+<span class=\"number\">1</span>,p+p[<span class=\"number\">0</span>]+<span class=\"number\">1</span>,opt[i][<span class=\"number\">2</span>])-p;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=id1[l];j&lt;=id1[n];++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t--cnt1[j][id2[a[l]]];</span><br><span class=\"line\">\t\t\t\t\t++cnt1[j][id2[x]];</span><br><span class=\"line\">\t\t\t\t\t--cnt2[j][a[l]];</span><br><span class=\"line\">\t\t\t\t\t++cnt2[j][x];</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\ta[l]=x;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">\t\t\t\tl=opt[i][<span class=\"number\">1</span>],r=opt[i][<span class=\"number\">2</span>],x=<span class=\"built_in\">std</span>::lower_bound(p+<span class=\"number\">1</span>,p+p[<span class=\"number\">0</span>]+<span class=\"number\">1</span>,opt[i][<span class=\"number\">3</span>])-p;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(id1[l]&lt;id1[r])&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=id1[l]*sq1;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t++tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t++tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=(id1[r]<span class=\"number\">-1</span>)*sq1+<span class=\"number\">1</span>;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t++tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t++tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=x<span class=\"number\">-1</span>;j&gt;=(id2[x]<span class=\"number\">-1</span>)*sq2+<span class=\"number\">1</span>&amp;&amp;!ans;--j)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(cnt2[id1[r]<span class=\"number\">-1</span>][j]-cnt2[id1[l]][j]+tmp2[j])</span><br><span class=\"line\">\t\t\t\t\t\t\tans=j;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=id2[x]<span class=\"number\">-1</span>;j&gt;=<span class=\"number\">1</span>&amp;&amp;!ans;--j)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(cnt1[id1[r]<span class=\"number\">-1</span>][j]-cnt1[id1[l]][j]+tmp1[j])</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> k=j*sq2;k&gt;=(j<span class=\"number\">-1</span>)*sq2+<span class=\"number\">1</span>&amp;&amp;!ans;--k)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">if</span>(cnt2[id1[r]<span class=\"number\">-1</span>][k]-cnt2[id1[l]][k]+tmp2[k])</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tans=k;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=id1[l]*sq1;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t--tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t--tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=(id1[r]<span class=\"number\">-1</span>)*sq1+<span class=\"number\">1</span>;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t--tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t--tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t++tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t++tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=x<span class=\"number\">-1</span>;j&gt;=(id2[x]<span class=\"number\">-1</span>)*sq2+<span class=\"number\">1</span>&amp;&amp;!ans;--j)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(tmp2[j])</span><br><span class=\"line\">\t\t\t\t\t\t\tans=j;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=id2[x]<span class=\"number\">-1</span>;j&gt;=<span class=\"number\">1</span>&amp;&amp;!ans;--j)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(tmp1[j])</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> k=j*sq2;k&gt;=(j<span class=\"number\">-1</span>)*sq2+<span class=\"number\">1</span>&amp;&amp;!ans;--k)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">if</span>(tmp2[k])</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tans=k;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t--tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t--tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\tcltstream::write(ans?p[ans]:<span class=\"number\">-2147483647</span>,<span class=\"number\">10</span>);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">5</span>:</span><br><span class=\"line\">\t\t\t\tl=opt[i][<span class=\"number\">1</span>],r=opt[i][<span class=\"number\">2</span>],x=<span class=\"built_in\">std</span>::upper_bound(p+<span class=\"number\">1</span>,p+p[<span class=\"number\">0</span>]+<span class=\"number\">1</span>,opt[i][<span class=\"number\">3</span>])-p<span class=\"number\">-1</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(id1[l]&lt;id1[r])&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=id1[l]*sq1;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t++tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t++tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=(id1[r]<span class=\"number\">-1</span>)*sq1+<span class=\"number\">1</span>;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t++tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t++tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=x+<span class=\"number\">1</span>;j&lt;=id2[x]*sq2&amp;&amp;!ans;++j)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(cnt2[id1[r]<span class=\"number\">-1</span>][j]-cnt2[id1[l]][j]+tmp2[j])</span><br><span class=\"line\">\t\t\t\t\t\t\tans=j;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=id2[x]+<span class=\"number\">1</span>;j&lt;=id2[p[<span class=\"number\">0</span>]]&amp;&amp;!ans;++j)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(cnt1[id1[r]<span class=\"number\">-1</span>][j]-cnt1[id1[l]][j]+tmp1[j])</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> k=(j<span class=\"number\">-1</span>)*sq2+<span class=\"number\">1</span>;k&lt;=j*sq2&amp;&amp;!ans;++k)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">if</span>(cnt2[id1[r]<span class=\"number\">-1</span>][k]-cnt2[id1[l]][k]+tmp2[k])</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tans=k;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=id1[l]*sq1;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t--tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t--tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=(id1[r]<span class=\"number\">-1</span>)*sq1+<span class=\"number\">1</span>;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t--tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t--tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t++tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t++tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=x+<span class=\"number\">1</span>;j&lt;=id2[x]*sq2&amp;&amp;!ans;++j)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(tmp2[j])</span><br><span class=\"line\">\t\t\t\t\t\t\tans=j;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=id2[x]+<span class=\"number\">1</span>;j&lt;=id2[p[<span class=\"number\">0</span>]]&amp;&amp;!ans;++j)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(tmp1[j])</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> k=(j<span class=\"number\">-1</span>)*sq2+<span class=\"number\">1</span>;k&lt;=j*sq2&amp;&amp;!ans;++k)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">if</span>(tmp2[k])</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tans=k;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t--tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t--tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\tcltstream::write(ans?p[ans]:<span class=\"number\">2147483647</span>,<span class=\"number\">10</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tclop();</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我还没写啥呢咋就$12\\text{KB}$了（</p>\n<p>这大概会成为一个系列，名字就叫做「未来算法」（$\\text{Future Algorithm}$），不过也说不定，会不会以后哪天突然蹦出来个「未来算法Episode II」也说不定（</p>\n","site":{"data":{}},"excerpt":"<p>分块天下第一！！！！！！！！！</p>","more":"<p>我也不知道我为什么要写这个玩意，大概是我真的被这个外挂一般的东西吓到了吧。</p>\n<p><a href=\"https://www.luogu.org/record/show?rid=14518116\" target=\"_blank\" rel=\"noopener\"><img src=\"https://i.loli.net/2018/12/08/5c0bb272768cf.png\" alt=\"\"></a></p>\n<p><img src=\"https://i.loli.net/2018/12/08/5c0bb2c767fda.jpg\" alt=\"\"></p>\n<p>我们从头说起。点开上面的那个评测记录，我们可以看到一道树套树的模板题。</p>\n<p>先退一步来说，假如说我们去掉操作$3$，剩下的操作都可以用主席树来完成。</p>\n<p>然而麻烦的是，我们在树上存的是前缀和。想要修改的话，暴力的复杂度是单次$O(n\\text{log}n)$的。</p>\n<p>那我们就在外层套个树状数组，把修改$O(n\\text{log}n)$查询$O(\\text{log}n)$均摊成全部$O(\\text{log}^{2}n)$。</p>\n<p>然而，很遗憾，我不会树套树，一点都不会，就连上面的这段文字也是我瞎扯出来的。</p>\n<p>考虑<del>无敌的</del>分块。</p>\n<p>一般我们想到的分块就是在块内维护<code>std::set</code>。这样操作$3$可以做到$O(\\text{log}\\sqrt{n})$，操作$1$、$4$、$5$可以做到$O(\\sqrt{n}\\text{log}\\sqrt{n})$。至于操作$2$，我们在外层套一个二分，然后检查二分到的数的排名是不是$k$，时间复杂度$O(\\text{log}10^{9}\\sqrt{n}\\text{log}\\sqrt{n})$。</p>\n<p>然而很明显的，这样做的效率十分低下，除了实现复杂度相对树套树小了一点以外没有任何优势。</p>\n<p>我们来看一下<a href=\"https://www.luogu.org/space/show?uid=56384\" target=\"_blank\" rel=\"noopener\"><strong>Shadowice1984</strong></a>dalao在他的<a href=\"https://www.luogu.org/blog/ShadowassIIXVIIIIV/solution-p4119\" target=\"_blank\" rel=\"noopener\">另一篇题解</a>中做出的评价：</p>\n<blockquote>\n<p>这其实是一个误区。主席树之所以采取了二分的思路来解决问题是因为我们要求回答单次询问做到$O(\\text{log}n)$的复杂度，这时候唯一的可行思路就是二分否则我们无法将复杂度控制在一个$\\text{log}$之内。</p>\n<p>但是我们现在是使用分块解决问题。分块是有自己复杂度的，就是$O(\\sqrt{n})$而不是$O(\\text{log}n)$，这意味着分块其实和$\\text{log}$的数据结构以及二分法并不是很搭（因为分块的结构本质上就不支持二分）。如果我们需要强行嵌入$\\text{log}$的数据结构的话在绝大部分情况下都会使复杂度凭空多出个$\\text{log}$来，这在强调常数的根号算法中绝对是致命的。</p>\n</blockquote>\n<p>我也是从这位dalao的<a href=\"https://www.luogu.org/blog/ShadowassIIXVIIIIV/solution-p3380\" target=\"_blank\" rel=\"noopener\">blog</a>里看到了严格根号分块实现树套树这种未来算法。</p>\n<p>主要思想其实不难理解，既然分块和$\\text{log}$不适合放在一起，我们就再套个分块，或者说，把值域也分成块。</p>\n<p>定义<code>cnt1[i][j]</code>表示前$i$个块内有多少个元素的值在第$j$个块内，<code>cnt2[i][j]</code>表示前$i$个块内有多少个$j$（当然是离散化后的）。不难发现预处理出这两个数组的时间复杂度是$O((n+m)\\sqrt{n})$的。</p>\n<p>然后我们来分析每个操作该怎么实现：</p>\n<ol>\n<li>首先考虑序列中的整块。从头开始扫一遍值域块，一直扫到给定数所在块的前一个块，然后再在给定数所在块内从头扫到给定数的前一个，查询扫过的值有多少落在这些整块内。剩下的边角块自然地暴力判断。</li>\n<li>还是从头扫一遍值域块，看看每个值域块内有多少数落在给定区间内，大概判断出答案在哪个值域块内。然后在这个值域块内再扫一遍即可。需要注意的是我们需要再开两个数组<code>tmp1</code>和<code>tmp2</code>来保存边角块的信息。</li>\n<li>直接$O(\\sqrt{n})$暴力重构两个<code>cnt</code>就好。</li>\n<li>需要两个类似于操作$2$的临时数组，存储的信息也是类似的。首先在给定数所在值域块内<strong>从后往前扫</strong>，找到答案直接退出。否则还是<strong>从后往前扫所有值域块</strong>，找到第一个非空的块然后进去找。</li>\n<li>操作$4$换个方向即可。</li>\n</ol>\n<p>综上所述，该算法的时间复杂度为$O((n+m)\\sqrt{n}+m\\sqrt{n+m})$。当$n$，$m$取到极限值时，差不多是$38172068$，相比之下$O(m\\text{log}^{2}n)\\approx 12183043$。看起来好像比不过树套树，实际上开个$\\text{O}2$跑得比谁都快，正如一开始那张图所示。</p>\n<p>不过代码写出来有点长的：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;cstdio&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;cstring&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;algorithm&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> re register</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> maxn 50000</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> maxm 50000</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> maxs 230</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> max(a,b) ((a)&gt;=(b)?(a):(b))</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> min(a,b) ((a)&lt;=(b)?(a):(b))</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">define</span> lowbit(a) ((a)&amp;(-(a)))</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> cltstream&#123;</span><br><span class=\"line\">\t<span class=\"meta\">#<span class=\"meta-keyword\">define</span> size 1048576</span></span><br><span class=\"line\">\t<span class=\"keyword\">char</span> cltin[size+<span class=\"number\">1</span>],*ih=cltin,*it=cltin;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">char</span> <span class=\"title\">gc</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"meta\">#<span class=\"meta-keyword\">ifdef</span> ONLINE_JUDGE</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(ih==it)&#123;</span><br><span class=\"line\">\t\t\t\tit=(ih=cltin)+fread(cltin,<span class=\"number\">1</span>,size,<span class=\"built_in\">stdin</span>);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(ih==it)</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">return</span> EOF;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> *ih++;</span><br><span class=\"line\">\t\t<span class=\"meta\">#<span class=\"meta-keyword\">else</span></span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> getchar();</span><br><span class=\"line\">\t\t<span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">char</span> cltout[size+<span class=\"number\">1</span>],*oh=cltout,*ot=cltout+size;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">pc</span><span class=\"params\">(<span class=\"keyword\">char</span> c)</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(oh==ot)&#123;</span><br><span class=\"line\">\t\t\tfwrite(cltout,<span class=\"number\">1</span>,size,<span class=\"built_in\">stdout</span>);</span><br><span class=\"line\">\t\t\toh=cltout;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t*oh++=c;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"meta\">#<span class=\"meta-keyword\">define</span> clop() fwrite(cltstream::cltout,1,cltstream::oh-cltstream::cltout,stdout)</span></span><br><span class=\"line\">\t<span class=\"meta\">#<span class=\"meta-keyword\">undef</span> size</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> _tp&gt;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">read</span><span class=\"params\">(_tp&amp; x)</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">int</span> sn=<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">char</span> c=gc();</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(;c!=<span class=\"number\">45</span>&amp;&amp;(c&lt;<span class=\"number\">48</span>||c&gt;<span class=\"number\">57</span>)&amp;&amp;c!=EOF;c=gc());</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(c==<span class=\"number\">45</span>&amp;&amp;c!=EOF)</span><br><span class=\"line\">\t\t\tsn=<span class=\"number\">-1</span>,c=gc();</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(x=<span class=\"number\">0</span>;c&gt;=<span class=\"number\">48</span>&amp;&amp;c&lt;=<span class=\"number\">57</span>&amp;&amp;c!=EOF;x=(x&lt;&lt;<span class=\"number\">3</span>)+(x&lt;&lt;<span class=\"number\">1</span>)+(c^<span class=\"number\">48</span>),c=gc());</span><br><span class=\"line\">\t\tx*=sn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">template</span> &lt;<span class=\"keyword\">typename</span> _tp&gt;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">inline</span> <span class=\"keyword\">void</span> <span class=\"title\">write</span><span class=\"params\">(_tp x,<span class=\"keyword\">char</span> text=<span class=\"number\">-1</span>)</span></span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(x&lt;<span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\tpc(<span class=\"number\">45</span>),x=-x;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(!x)</span><br><span class=\"line\">\t\t\tpc(<span class=\"number\">48</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">int</span> digit[<span class=\"number\">22</span>];</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span>(digit[<span class=\"number\">0</span>]=<span class=\"number\">0</span>;x;digit[++digit[<span class=\"number\">0</span>]]=x%<span class=\"number\">10</span>,x/=<span class=\"number\">10</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span>(;digit[<span class=\"number\">0</span>];pc(digit[digit[<span class=\"number\">0</span>]--]^<span class=\"number\">48</span>));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(text&gt;=<span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\tpc(text);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> n,m,sq1,sq2;</span><br><span class=\"line\"><span class=\"keyword\">int</span> id1[maxn+<span class=\"number\">1</span>],id2[maxn+maxm+<span class=\"number\">1</span>],p[maxn+maxm+<span class=\"number\">1</span>];</span><br><span class=\"line\"><span class=\"keyword\">int</span> a[maxn+<span class=\"number\">1</span>],opt[maxm+<span class=\"number\">1</span>][<span class=\"number\">4</span>];</span><br><span class=\"line\"><span class=\"keyword\">int</span> cnt1[maxs+<span class=\"number\">1</span>][(maxs&lt;&lt;<span class=\"number\">1</span>)+<span class=\"number\">1</span>],cnt2[maxs+<span class=\"number\">1</span>][maxn+maxm+<span class=\"number\">1</span>],tmp1[(maxs&lt;&lt;<span class=\"number\">1</span>)+<span class=\"number\">1</span>],tmp2[maxn+maxm+<span class=\"number\">1</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">\tcltstream::read(n);</span><br><span class=\"line\">\tcltstream::read(m);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(;(sq1+<span class=\"number\">1</span>)*(sq1+<span class=\"number\">1</span>)&lt;=n;++sq1);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;++i)&#123;</span><br><span class=\"line\">\t\tid1[i]=(i<span class=\"number\">-1</span>)/sq1+<span class=\"number\">1</span>;</span><br><span class=\"line\">\t\tcltstream::read(a[i]);</span><br><span class=\"line\">\t\tp[++p[<span class=\"number\">0</span>]]=a[i];</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=m;++i)&#123;</span><br><span class=\"line\">\t\tcltstream::read(opt[i][<span class=\"number\">0</span>]);</span><br><span class=\"line\">\t\tcltstream::read(opt[i][<span class=\"number\">1</span>]);</span><br><span class=\"line\">\t\tcltstream::read(opt[i][<span class=\"number\">2</span>]);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(opt[i][<span class=\"number\">0</span>]!=<span class=\"number\">3</span>)</span><br><span class=\"line\">\t\t\tcltstream::read(opt[i][<span class=\"number\">3</span>]);</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\tp[++p[<span class=\"number\">0</span>]]=opt[i][<span class=\"number\">2</span>];</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">std</span>::sort(p+<span class=\"number\">1</span>,p+p[<span class=\"number\">0</span>]+<span class=\"number\">1</span>);</span><br><span class=\"line\">\tp[<span class=\"number\">0</span>]=<span class=\"built_in\">std</span>::unique(p+<span class=\"number\">1</span>,p+p[<span class=\"number\">0</span>]+<span class=\"number\">1</span>)-p<span class=\"number\">-1</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(;(sq2+<span class=\"number\">1</span>)*(sq2+<span class=\"number\">1</span>)&lt;=p[<span class=\"number\">0</span>];++sq2);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=p[<span class=\"number\">0</span>];++i)</span><br><span class=\"line\">\t\tid2[i]=(i<span class=\"number\">-1</span>)/sq2+<span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=n;++i)&#123;</span><br><span class=\"line\">\t\ta[i]=<span class=\"built_in\">std</span>::lower_bound(p+<span class=\"number\">1</span>,p+p[<span class=\"number\">0</span>]+<span class=\"number\">1</span>,a[i])-p;</span><br><span class=\"line\">\t\t++cnt1[id1[i]][id2[a[i]]];</span><br><span class=\"line\">\t\t++cnt2[id1[i]][a[i]];</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=id1[n];++i)&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=<span class=\"number\">1</span>;j&lt;=id2[p[<span class=\"number\">0</span>]];++j)</span><br><span class=\"line\">\t\t\tcnt1[i][j]+=cnt1[i<span class=\"number\">-1</span>][j];</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=<span class=\"number\">1</span>;j&lt;=p[<span class=\"number\">0</span>];++j)</span><br><span class=\"line\">\t\t\tcnt2[i][j]+=cnt2[i<span class=\"number\">-1</span>][j];</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> i=<span class=\"number\">1</span>;i&lt;=m;++i)&#123;</span><br><span class=\"line\">\t\tre <span class=\"keyword\">int</span> l,r,x,ans=<span class=\"number\">0</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">switch</span>(opt[i][<span class=\"number\">0</span>])&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">\t\t\t\tl=opt[i][<span class=\"number\">1</span>],r=opt[i][<span class=\"number\">2</span>],x=<span class=\"built_in\">std</span>::lower_bound(p+<span class=\"number\">1</span>,p+p[<span class=\"number\">0</span>]+<span class=\"number\">1</span>,opt[i][<span class=\"number\">3</span>])-p;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(id1[l]&lt;id1[r])&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=id1[l]*sq1;++j)</span><br><span class=\"line\">\t\t\t\t\t\tans+=(a[j]&lt;x);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=(id1[r]<span class=\"number\">-1</span>)*sq1+<span class=\"number\">1</span>;j&lt;=r;++j)</span><br><span class=\"line\">\t\t\t\t\t\tans+=(a[j]&lt;x);</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=<span class=\"number\">1</span>;j&lt;id2[x];++j)</span><br><span class=\"line\">\t\t\t\t\t\tans+=cnt1[id1[r]<span class=\"number\">-1</span>][j]-cnt1[id1[l]][j];</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=(id2[x]<span class=\"number\">-1</span>)*sq2+<span class=\"number\">1</span>;j&lt;x;++j)</span><br><span class=\"line\">\t\t\t\t\t\tans+=cnt2[id1[r]<span class=\"number\">-1</span>][j]-cnt2[id1[l]][j];</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=r;++j)</span><br><span class=\"line\">\t\t\t\t\t\tans+=(a[j]&lt;x);</span><br><span class=\"line\">\t\t\t\tcltstream::write(ans+<span class=\"number\">1</span>,<span class=\"number\">10</span>);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">\t\t\t\tl=opt[i][<span class=\"number\">1</span>],r=opt[i][<span class=\"number\">2</span>],x=opt[i][<span class=\"number\">3</span>];</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(id1[l]&lt;id1[r])&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=id1[l]*sq1;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t++tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t++tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=(id1[r]<span class=\"number\">-1</span>)*sq1+<span class=\"number\">1</span>;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t++tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t++tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=<span class=\"number\">1</span>;;++j)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(x&gt;cnt1[id1[r]<span class=\"number\">-1</span>][j]-cnt1[id1[l]][j]+tmp1[j])</span><br><span class=\"line\">\t\t\t\t\t\t\tx-=cnt1[id1[r]<span class=\"number\">-1</span>][j]-cnt1[id1[l]][j]+tmp1[j];</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> k=(j<span class=\"number\">-1</span>)*sq2+<span class=\"number\">1</span>;k&lt;=j*sq2;++k)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">if</span>(x&gt;cnt2[id1[r]<span class=\"number\">-1</span>][k]-cnt2[id1[l]][k]+tmp2[k])</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tx-=cnt2[id1[r]<span class=\"number\">-1</span>][k]-cnt2[id1[l]][k]+tmp2[k];</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tcltstream::write(p[k],<span class=\"number\">10</span>);</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=id1[l]*sq1;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t--tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t--tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=(id1[r]<span class=\"number\">-1</span>)*sq1+<span class=\"number\">1</span>;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t--tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t--tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t++tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t++tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=<span class=\"number\">1</span>;;++j)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(x&gt;tmp1[j])</span><br><span class=\"line\">\t\t\t\t\t\t\tx-=tmp1[j];</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> k=(j<span class=\"number\">-1</span>)*sq2+<span class=\"number\">1</span>;k&lt;=j*sq2;++k)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">if</span>(x&gt;tmp2[k])</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tx-=tmp2[k];</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tcltstream::write(p[k],<span class=\"number\">10</span>);</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t--tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t--tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">\t\t\t\tl=opt[i][<span class=\"number\">1</span>],x=<span class=\"built_in\">std</span>::lower_bound(p+<span class=\"number\">1</span>,p+p[<span class=\"number\">0</span>]+<span class=\"number\">1</span>,opt[i][<span class=\"number\">2</span>])-p;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=id1[l];j&lt;=id1[n];++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t--cnt1[j][id2[a[l]]];</span><br><span class=\"line\">\t\t\t\t\t++cnt1[j][id2[x]];</span><br><span class=\"line\">\t\t\t\t\t--cnt2[j][a[l]];</span><br><span class=\"line\">\t\t\t\t\t++cnt2[j][x];</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\ta[l]=x;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">\t\t\t\tl=opt[i][<span class=\"number\">1</span>],r=opt[i][<span class=\"number\">2</span>],x=<span class=\"built_in\">std</span>::lower_bound(p+<span class=\"number\">1</span>,p+p[<span class=\"number\">0</span>]+<span class=\"number\">1</span>,opt[i][<span class=\"number\">3</span>])-p;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(id1[l]&lt;id1[r])&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=id1[l]*sq1;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t++tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t++tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=(id1[r]<span class=\"number\">-1</span>)*sq1+<span class=\"number\">1</span>;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t++tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t++tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=x<span class=\"number\">-1</span>;j&gt;=(id2[x]<span class=\"number\">-1</span>)*sq2+<span class=\"number\">1</span>&amp;&amp;!ans;--j)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(cnt2[id1[r]<span class=\"number\">-1</span>][j]-cnt2[id1[l]][j]+tmp2[j])</span><br><span class=\"line\">\t\t\t\t\t\t\tans=j;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=id2[x]<span class=\"number\">-1</span>;j&gt;=<span class=\"number\">1</span>&amp;&amp;!ans;--j)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(cnt1[id1[r]<span class=\"number\">-1</span>][j]-cnt1[id1[l]][j]+tmp1[j])</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> k=j*sq2;k&gt;=(j<span class=\"number\">-1</span>)*sq2+<span class=\"number\">1</span>&amp;&amp;!ans;--k)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">if</span>(cnt2[id1[r]<span class=\"number\">-1</span>][k]-cnt2[id1[l]][k]+tmp2[k])</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tans=k;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=id1[l]*sq1;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t--tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t--tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=(id1[r]<span class=\"number\">-1</span>)*sq1+<span class=\"number\">1</span>;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t--tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t--tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t++tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t++tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=x<span class=\"number\">-1</span>;j&gt;=(id2[x]<span class=\"number\">-1</span>)*sq2+<span class=\"number\">1</span>&amp;&amp;!ans;--j)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(tmp2[j])</span><br><span class=\"line\">\t\t\t\t\t\t\tans=j;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=id2[x]<span class=\"number\">-1</span>;j&gt;=<span class=\"number\">1</span>&amp;&amp;!ans;--j)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(tmp1[j])</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> k=j*sq2;k&gt;=(j<span class=\"number\">-1</span>)*sq2+<span class=\"number\">1</span>&amp;&amp;!ans;--k)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">if</span>(tmp2[k])</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tans=k;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t--tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t--tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\tcltstream::write(ans?p[ans]:<span class=\"number\">-2147483647</span>,<span class=\"number\">10</span>);</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">case</span> <span class=\"number\">5</span>:</span><br><span class=\"line\">\t\t\t\tl=opt[i][<span class=\"number\">1</span>],r=opt[i][<span class=\"number\">2</span>],x=<span class=\"built_in\">std</span>::upper_bound(p+<span class=\"number\">1</span>,p+p[<span class=\"number\">0</span>]+<span class=\"number\">1</span>,opt[i][<span class=\"number\">3</span>])-p<span class=\"number\">-1</span>;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span>(id1[l]&lt;id1[r])&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=id1[l]*sq1;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t++tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t++tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=(id1[r]<span class=\"number\">-1</span>)*sq1+<span class=\"number\">1</span>;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t++tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t++tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=x+<span class=\"number\">1</span>;j&lt;=id2[x]*sq2&amp;&amp;!ans;++j)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(cnt2[id1[r]<span class=\"number\">-1</span>][j]-cnt2[id1[l]][j]+tmp2[j])</span><br><span class=\"line\">\t\t\t\t\t\t\tans=j;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=id2[x]+<span class=\"number\">1</span>;j&lt;=id2[p[<span class=\"number\">0</span>]]&amp;&amp;!ans;++j)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(cnt1[id1[r]<span class=\"number\">-1</span>][j]-cnt1[id1[l]][j]+tmp1[j])</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> k=(j<span class=\"number\">-1</span>)*sq2+<span class=\"number\">1</span>;k&lt;=j*sq2&amp;&amp;!ans;++k)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">if</span>(cnt2[id1[r]<span class=\"number\">-1</span>][k]-cnt2[id1[l]][k]+tmp2[k])</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tans=k;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=id1[l]*sq1;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t--tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t--tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=(id1[r]<span class=\"number\">-1</span>)*sq1+<span class=\"number\">1</span>;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t--tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t--tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t++tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t++tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=x+<span class=\"number\">1</span>;j&lt;=id2[x]*sq2&amp;&amp;!ans;++j)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(tmp2[j])</span><br><span class=\"line\">\t\t\t\t\t\t\tans=j;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=id2[x]+<span class=\"number\">1</span>;j&lt;=id2[p[<span class=\"number\">0</span>]]&amp;&amp;!ans;++j)</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"keyword\">if</span>(tmp1[j])</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> k=(j<span class=\"number\">-1</span>)*sq2+<span class=\"number\">1</span>;k&lt;=j*sq2&amp;&amp;!ans;++k)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"keyword\">if</span>(tmp2[k])</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\tans=k;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> j=l;j&lt;=r;++j)&#123;</span><br><span class=\"line\">\t\t\t\t\t\t--tmp1[id2[a[j]]];</span><br><span class=\"line\">\t\t\t\t\t\t--tmp2[a[j]];</span><br><span class=\"line\">\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\tcltstream::write(ans?p[ans]:<span class=\"number\">2147483647</span>,<span class=\"number\">10</span>);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tclop();</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我还没写啥呢咋就$12\\text{KB}$了（</p>\n<p>这大概会成为一个系列，名字就叫做「未来算法」（$\\text{Future Algorithm}$），不过也说不定，会不会以后哪天突然蹦出来个「未来算法Episode II」也说不定（</p>"},{"title":"一些乱七八糟的数论","date":"2018-11-29T06:41:17.000Z","mathjax":true,"_content":"最近在洛谷日报的待审核列表里翻到了杜教筛的相关内容，打算连着之前的卷积反演啥的一起复习一下。\n\n~~抄袭来源~~参考文献：\n\n- [铃悬的数学小讲堂——狄利克雷卷积与莫比乌斯反演](https://lx-2003.blog.luogu.org/mobius-inversion)\n- [浅谈杜教筛](https://www.luogu.org/blog/54745/dls-tql)\n- [铃悬的数学小讲堂——杜教筛](https://lx-2003.blog.luogu.org/dujiao-sieve)\n\n<!-- more -->\n\n# 数论函数\n\n## 定义与相关性质\n\n数论函数就是定义域为$\\mathbb{N}^{+}$的函数。\n\n两个数论函数相加，就是简单地把函数值相加。\n\n$$(f+g)(n)=f(n)+g(n)$$\n\n数乘也是类似的。\n\n$$(\\alpha f)(n)=\\alpha f(n)$$\n\n点积也是类似的。\n\n$$(f\\cdot g)(n)=f(n)g(n)$$\n\n~~好像没啥用。~~\n\n在数论函数相关的运算中，一个非常重要的运算是狄利克雷卷积。两个数论函数的狄利克雷卷积是这样定义的：\n\n$$(f\\times g)(n)=\\sum\\limits_{i\\mid n}f(i)g(\\cfrac{n}{i})$$\n\n或者说：\n\n$$(f\\times g)(n)=\\sum\\limits_{ij=n}f(i)g(j)$$\n\n它具有以下的一些性质：\n\n交换律，即$f\\times g=g\\times f$。\n\n这很明显。\n\n结合律，即$(f\\times g)\\times h=f\\times(g\\times h)$。\n\n$$\\begin{aligned}\n((f\\times g)\\times h)(n)&=\\sum\\limits_{ij=n}(\\sum\\limits_{kl=i}f(k)g(l))h(j)\\\\\n&=\\sum\\limits_{ijk=n}f(i)g(j)h(k)\n\\end{aligned}$$\n\n$$\\begin{aligned}\n(f\\times(g\\times h))(n)&=\\sum\\limits_{ij=n}f(i)(\\sum\\limits_{kl=j}g(k)h(l))\\\\\n&=\\sum\\limits_{ijk=n}f(i)g(j)h(k)\n\\end{aligned}$$\n\n分配率，即$(f+g)\\times h=f\\times h+g\\times h$。\n\n$$\\begin{aligned}\n((f+g)\\times h)(n)&=\\sum\\limits_{ij=n}(f+g)(i)h(j)\\\\\n&=\\sum\\limits_{ij=n}f(i)h(j)+g(i)h(j)\\\\\n&=(f\\times h)(n)+(g\\times h)(n)\n\\end{aligned}$$\n\n单位元为$\\epsilon(n)=[n=1]$，$f\\times\\epsilon =f$。\n\n这也很明显。\n\n对于任意一个满足$f(1)\\neq 0$的函数$f$，都存在唯一的一个函数$g$使得$f\\times g=\\epsilon$。这时我们称$g$是$f$的逆。\n\n我们可以这样定义一个函数的逆：\n\n$$g(n)=\\cfrac{\\epsilon(n)-\\sum\\limits_{i\\mid n,i\\neq 1}f(i)g(\\cfrac{n}{i})}{f(1)}$$\n\n这样我们就有\n\n$$\\begin{aligned}\n(f\\times g)(n)&=\\sum_{i\\mid n}f(i)g(\\cfrac{n}{i})\\\\\n&=f(1)g(n)+\\sum_{i\\mid n,i\\neq 1}f(i)g(\\cfrac{n}{i})\\\\\n&=\\epsilon(n)-\\sum\\limits_{i\\mid n,i\\neq 1}f(i)g(\\cfrac{n}{i})+\\sum_{i\\mid n,i\\neq 1}f(i)g(\\cfrac{n}{i})\\\\\n&=\\epsilon(n)\n\\end{aligned}$$\n\n## 积性函数与完全积性函数\n\n如果一个数论函数$f$满足\n\n$$\\forall x,y\\in\\mathbb{N}^{+}\\wedge x\\perp y\\;\\;f(xy)=f(x)f(y)$$\n\n我们就说$f$是一个积性函数。\n\n特别的，如果上式去掉$x\\perp y$仍成立，则称$f$是一个完全积性函数。\n\n很明显地，任意一个积性函数$f$一定有$f(1)=1$，这样才能有$f(1\\times n)=f(1)\\times f(n)=f(n)$。\n\n常见的完全积性函数有$\\epsilon,id^{k}$。$\\epsilon$在上文已经提到过。$id^{k}(n)=n^k$。这两个函数的完全积性十分明显。\n\n常见的积性函数有$\\varphi,d,\\sigma$。$\\varphi(n)$的值等于小于等于$n$且与$n$互质的正整数的数量。$d(n)$和$\\sigma(n)$的值分别等于$n$的约数个数和约数和。\n\n关于$\\varphi$的积性，我并不会证（\n\n我们来分析$d$的积性。首先，根据唯一分解定理，$n$的每个因数都可以唯一地分解成$n$所有质因子的非负整数次幂乘积。不妨设\n\n$$n=\\prod\\limits_{i=1}^{N}p_{i}^{r_{i}}$$\n\n其中$p_{i}$都是质数，所有$r_{i}$都是正整数。对于每一个$p_{i}$，它的指数有$(r_{i}+1)$种取值，因而我们有\n\n$$d(n)=\\prod\\limits_{i=1}^{N}(r_{i}+1)$$\n\n我们再假设有一个$m$，且\n\n$$m=\\prod\\limits_{i=1}^{M}q_{i}^{s_{i}}$$\n\n如果说$n\\perp m$，肯定有\n\n$$\\forall i\\in [1,N]\\cap\\mathbb{Z},j\\in [1,M]\\cap\\mathbb{Z}\\;\\;p_{i}\\neq q_{j}$$\n\n于是我们就有\n\n$$nm=(\\prod\\limits_{i=1}^{N}p_{i}^{r_{i}})(\\prod\\limits_{j=1}^{M}q_{j}^{s_{j}})$$\n\n$$\\begin{aligned}\nd(nm)&=(\\prod\\limits_{i=1}^{N}(r_{i}+1))(\\prod\\limits_{j=1}^{M}(s_{j}+1))\\\\\n&=d(n)d(m)\n\\end{aligned}$$\n\n不妨再反过来考虑。如果说$n\\not\\perp m$，那么一定存在一对$(i,j)(i\\in [1,N]\\cap\\mathbb{Z},j\\in [1,M]\\cap\\mathbb{Z})$，使得$p_{i}=q_{j}$。那么$d(n)d(m)$就会有一个因子是$(r_{i}+1)(s_{j}+1)=r_{i}s_{j}+r_{i}+s_{j}+1$。但是仔细思考我们会发现，$d(nm)$中对应的项应该是$r_{i}+s_{j}+1$。因而此时$d(nm)\\neq d(n)d(m)$。\n\n我们再来分析$\\sigma$的积性。还是设\n\n$$n=\\prod\\limits_{i=1}^{N}p_{i}^{r_{i}}$$\n\n其中$p_{i}$都是质数，所有$r_{i}$都是正整数。与$d$不同的是，现在我们是要用$p_{i}$乘出$n$的因数，$p_{i}$在此过程中可以产生的贡献为$p_{i}^x(x\\in [0,r_{i}]\\cap\\mathbb{Z})$。我们可以把这想象成一个$N$个数组，第$i$个数组的长度为$r_{i}+1$，第$j$个元素为$p_{i}^{j-1}$。现在我们每次从每个数组里选出恰好一个元素相乘，要求所有方案的乘积之和。我们知道，这个问题的答案就是\n\n$$\\prod\\limits_{i=1}^{N}\\sum\\limits_{j=0}^{r_{i}}p_{i}^{j}$$\n\n这正是$\\sigma(n)$的值。\n\n接下来的过程就与上文证明$d$的积性如出一辙了，在此不再重复。\n\n现在我们来分析，两个积性函数的卷积是否也是积性函数。~~虽然说都这么问了肯定就是了。~~\n\n$$\\begin{aligned}\n(f\\times g)(n)(f\\times g)(m)&=(\\sum\\limits_{i\\mid n}f(i)g(\\cfrac{n}{i}))(\\sum\\limits_{j\\mid m}f(j)g(\\cfrac{m}{j}))\\\\\n&=\\sum\\limits_{i\\mid n}\\sum\\limits_{j\\mid m}f(i)g(\\cfrac{n}{i})f(j)g(\\cfrac{m}{j})\\\\\n&=\\sum\\limits_{i\\mid n}\\sum\\limits_{j\\mid m}f(ij)g(\\cfrac{nm}{ij})\\\\\n&=\\sum\\limits_{k\\mid nm}f(k)g(\\cfrac{nm}{k})\\\\\n&=(f\\times g)(nm)\n\\end{aligned}$$\n\n关于上面的第四个等号。时刻注意$n\\perp m$，在这种前提下，我们枚举到的$i$和$j$一定也是互质的，那么$ij$的所有值一定是互不相同的。这从$d(nm)=d(n)d(m)$这一等式中也能看出。\n\n再接下来，我们来分析一下一个积性函数的逆是否也是积性函数。\n\n设有一个积性函数$f$，它的逆是$g$。\n\n当$nm=1$时，$g(1)=1$。\n\n当$nm>1$时，我们假设对于任意$n^{\\prime}m^{\\prime}<nm$，都有$g(n^{\\prime}m^{\\prime})=g(n^{\\prime})g(m^{\\prime})$。此时\n\n$$\\begin{aligned}\ng(nm)&=-\\sum\\limits_{k\\mid nm,k\\neq 1}f(k)g(\\cfrac{nm}{k})\\\\\n&=-\\sum\\limits_{i\\mid n,j\\mid m,ij\\neq 1}f(i)f(j)g(\\cfrac{n}{i})g(\\cfrac{m}{j})\\\\\n&=g(n)g(m)-\\sum\\limits_{i\\mid n,j\\mid m}f(i)f(j)g(\\cfrac{n}{i})g(\\cfrac{m}{j})\\\\\n&=g(n)g(m)-(\\sum\\limits_{i\\mid n}f(i)g(\\cfrac{n}{i}))(\\sum\\limits_{j\\mid m}f(j)g(\\cfrac{m}{j}))\\\\\n&=g(n)g(m)-\\epsilon(n)\\epsilon(m)\\\\\n&=g(n)g(m)\n\\end{aligned}$$\n\n~~其实上面这些全都是抄来的（~~\n\n# 莫比乌斯反演\n\n## 正向反演\n\n定义$\\mu$为$1$的逆。也就是说，$\\mu\\times 1=\\epsilon$。\n\n如果您看过其他的一些关于莫比乌斯反演的学习笔记的话，您可能会看到如下的定义：\n\n> 首先地，$\\mu(1)=1$。当$n>1$时，如果$n$的所有质因子互不相同，设其有$k$个质因子，那么$\\mu(n)=(-1)^{k}$。否则，$\\mu(n)=0$。\n\n那么，这两种定义等价吗？\n\n考虑到$\\mu$是一个积性函数，对于任意一个$n>1$，如果我们把它分解成\n\n$$n=\\prod\\limits_{i=1}^{N}p_{i}^{r_{i}}$$\n\n我们就有\n\n$$\\mu(n)=\\prod\\limits_{i=1}^{N}\\mu(p_{i}^{r_{i}})$$\n\n因此，确定一个积性函数的函数值的关键在于确定其在质数的非负整数次幂上的取值。\n\n设有一个质数$p$。不难发现\n\n$$\\mu(p)=-\\mu(1)=-1$$\n\n$$\\mu(p^{2})=-\\mu(1)-\\mu(p)=-1+1=0$$\n\n$$\\mu(p^{3})=-\\mu(1)-\\mu(p)-\\mu(p^{2})=-1+1+0=0$$\n\n$$\\vdots$$\n\n至此，不难看出上文给出的两种定义是等价的。\n\n那么这个东西有什么用呢？\n\n我们设\n\n$$F(n)=\\sum\\limits_{i\\mid n}f(i)$$\n\n或者等价地说，$F=f\\times 1$。我们可以得到\n\n$$\\begin{aligned}\nF&=f\\times 1\\\\\nF\\times\\mu&=f\\times 1\\times\\mu\\\\\nF\\times\\mu&=f\n\\end{aligned}$$\n\n像这样，如果说$F$相对好求，而$f$相对难求，我们就可以通过上式来减小我们求解$f$的难度。具体地说\n\n$$f(n)=\\sum\\limits_{i\\mid n}F(i)\\mu(\\cfrac{n}{i})$$\n\n## 反向反演\n\n有些时候我们还需要用到像下面这样反过来的莫比乌斯反演\n\n$$F(n)=\\sum\\limits_{n\\mid d}f(d)⇔f(n)=\\sum\\limits_{n\\mid d}F(d)\\mu(\\cfrac{d}{n})$$\n\n我们可以定义一种新的运算\n\n$$(f\\otimes g)(n)=\\sum\\limits_{n\\mid d}f(d)g(\\cfrac{d}{n})$$\n\n我们不难证明出它具有结合律。具体过程与上文证明狄利克雷卷积的结合律的过程基本重复。那么我们就有\n\n$$F=f\\otimes 1⇔F\\otimes\\mu=f$$\n\n于是就有了上面的反向反演。\n\n> $\\text{Updated on 2018-12-03}$：\n> \n> 例题……还是算了吧（\n> \n> 发现反演常用的套路都忘的差不多了，还是别丢人了（\n\n# 杜教筛\n\n## 实现与模板题\n\n接下来才是主要内容。\n\n现在，我们要求一个积性函数的前$n$项和。$n\\leqslant 10^{10}$。\n\n我们定义\n\n$$S(n)=\\sum\\limits_{i=1}^{n}f(i)$$\n\n再拿来一个积性函数$g$，然后把它与$f$卷积并求前缀和。\n\n$$\\begin{aligned}\n\\sum_{i=1}^{n}(f\\times g)(i)&=\\sum_{i=1}^{n}\\sum_{j\\mid i}f(j)g(\\cfrac{i}{j})\\\\\n&=\\sum_{i=1}^{n}g(i)\\sum_{j=1}^{\\lfloor\\frac{n}{i}\\rfloor}f(j)\\\\\n&=\\sum_{i=1}^{n}g(i)S(\\lfloor\\cfrac{n}{i}\\rfloor)\n\\end{aligned}$$\n\n然而我的语文实在是太菜了，大概说也说不明白，自行理解吧（\n\n因为$g$也是积性函数，有$g(1)=1$，所以\n\n$$\\begin{aligned}\nS(n)&=g(1)S(n)\\\\\n&=\\sum_{i=1}^{n}g(i)S(\\lfloor\\cfrac{n}{i}\\rfloor)-\\sum_{i=2}^{n}g(i)S(\\lfloor\\cfrac{n}{i}\\rfloor)\\\\\n&=\\sum_{i=1}^{n}(f\\times g)(i)-\\sum_{i=2}^{n}g(i)S(\\lfloor\\cfrac{n}{i}\\rfloor)\n\\end{aligned}$$\n\n就是说从第一项开始的前缀和减去从第二项开始的前缀和等于第一项本身。\n\n如果说我们选择的$g$可以让我们迅速地求出$f\\times g$和$g$的前缀和，我们就可以做到快速求$f$的前缀和了。\n\n关于后面的$g(i)S(\\lfloor\\cfrac{n}{i}\\rfloor)$，如果直接暴力算复杂度会是$O(n)$的，在大部分情况下，这是无法接受的。\n\n我们来分析一下$\\lfloor\\cfrac{n}{i}\\rfloor$。如果$1\\leqslant i\\leqslant\\sqrt{n}$，因为$i$只有$\\sqrt{n}$种不同的取值，$\\lfloor\\cfrac{n}{i}\\rfloor$同样也只有$\\sqrt{n}$种不同的取值。如果$\\sqrt{n}<i\\leqslant n$，$1\\leqslant\\lfloor\\cfrac{n}{i}\\rfloor<\\sqrt{n}$，又因为要向下取整，自然也只有$\\sqrt{n}$种不同的取值。如果我们能够把$\\lfloor\\cfrac{n}{i}\\rfloor$相同的$i$一起计算，就能够将时间杂度优化到$O(\\sqrt{n})$。\n\n大体代码如下：\n\n```cpp\nfor(re int l=1,r;l<=n;l=r+1){\n\tr=n/(n/l);\n\t//......\n}\n```\n\n关于$r$的这个上界是怎么来的，我并不会证（\n\n这样一来，要计算$S(n)$，我们需要调用所有的$\\lfloor\\cfrac{n}{x}\\rfloor$，分别是$\\lfloor\\cfrac{n}{1}\\rfloor,\\lfloor\\cfrac{n}{2}\\rfloor,\\cdots,\\lfloor\\cfrac{n}{\\sqrt{n}}\\rfloor,\\sqrt{n},\\sqrt{n}-1,\\cdots,1$。单独计算一个$S(n)$的时间复杂度很明显是$O(\\sqrt{n})$的。那么这样一来，总体的时间复杂度就是\n\n$$\\begin{aligned}\nO(\\sum\\limits_{i=1}^{\\sqrt{n}}\\sqrt{i}+\\sqrt{\\lfloor\\cfrac{n}{i}\\rfloor})&=O(\\sum\\limits_{i=1}^{\\sqrt{n}}\\sqrt{\\lfloor\\cfrac{n}{i}\\rfloor})\\\\\n&=O(\\int\\limits_{1}^{\\sqrt{n}}\\sqrt{\\lfloor\\cfrac{n}{x}\\rfloor}dx)\\\\\n&=O(\\int\\limits_{1}^{\\sqrt{n}}\\sqrt{\\cfrac{n}{x}}dx)\\\\\n&=O(2n^{\\frac{1}{2}}(n^{\\frac{1}{4}}-1))\\\\\n&=O(n^{\\frac{3}{4}})\n\\end{aligned}$$\n\n因为相比之下$\\sqrt{\\lfloor\\cfrac{n}{i}\\rfloor}$很明显要大一些，我们就可以将$\\sqrt{i}$舍去。然后去掉取整符号并用积分近似。\n\n这个实现方法还可以优化。具体来讲，我们先线性筛出前$m$项，然后再用杜教筛。这么做的时间复杂度是$O(m+\\cfrac{n}{\\sqrt{m}})$，当$m=n^{\\frac{2}{3}}$时取得最小值$O(n^{\\frac{2}{3}})$。\n\n举个例子，就比如说我们要求\n\n$$\\sum\\limits_{i=1}^{n}\\varphi(i)$$\n\n我们取$f=\\varphi,g=1$，这样根据$\\varphi$的性质，$f\\times g=id$。不难看出$g$与$f\\times g$的前缀和都可以$O(1)$求。具体的代码实现差不多长这样：\n\n```cpp\nlong long getSum(int n){\n\tif(n<=maxn)\n\t\treturn phi[n];\n\t//phi是提前线性筛好的前缀和\n\tif(ans.count(n))\n\t\treturn ans[n];\n\t//ans用来实现记忆化的哈希表，比如说unordered_map\n\tre long long res=1LL*n*(n+1)>>1;\n\t//f*g的前缀和\n\tfor(re int l=2,r;l<=n;l=r+1){\n\t//注意要从2开始\n\t\tr=n/(n/l);\n\t\tres-=(r-l+1)*getSum(n/l);\n\t\t//r-l+1是g的前缀和\n\t\t//像这样递归+记忆化求解f的前缀和\n\t}\n\treturn ans[n]=res;\n\t//返回的时候不要忘记存一下\n\t//就比如说我就忘过一次（\n}\n```\n\n以及，不用哈希表也是可以的。因为我们查询的数都是形如$\\lfloor\\cfrac{n}{x}\\rfloor$的，当这个值大于$n^{\\frac{2}{3}}$，即$x<n^{\\frac{1}{3}}$时，我们才会到哈希表里查询。因此我们可以令`ans[x]`表示$S(\\lfloor\\cfrac{n}{x}\\rfloor)$。具体代码我就不写了（\n\n再举个例子，求\n\n$$\\sum\\limits_{i=1}^{n}\\mu(i)$$\n\n取$f=\\mu,g=1,f\\times g=\\epsilon$。代码和上面差不多。\n\n如果您理解了上面两个函数，这道[模板题](https://www.luogu.org/problemnew/show/P4213)您就可以切了。\n\n## 其他题\n\n### [「Luogu-P3768」简单的数学题](https://www.luogu.org/problemnew/show/P3768)\n\n快乐地推式子：\n\n$$\\begin{aligned}\n\\sum\\limits_{i=1}^{n}i\\sum\\limits_{j=1}^{n}j\\text{gcd}(i,j)&=\\sum\\limits_{d=1}^{n}d^{3}\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}i\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}j[i\\perp j]\\\\\n&=\\sum\\limits_{d=1}^{n}d^{3}\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}i\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}j\\sum\\limits_{x\\mid i,x\\mid j}\\mu(x)\\\\\n&=\\sum\\limits_{d=1}^{n}d^{3}\\sum\\limits_{x=1}^{\\lfloor\\frac{n}{d}\\rfloor}x^{2}\\mu(x)\\text{Sum}^{2}(\\lfloor\\cfrac{n}{dx}\\rfloor)\\\\\n&=\\sum\\limits_{i=1}^{n}\\text{Sum}^{2}(\\lfloor\\cfrac{n}{i}\\rfloor)i^{2}\\sum\\limits_{j\\mid i}j\\mu(\\cfrac{i}{j})\\\\\n&=\\sum\\limits_{i=1}^{n}\\text{Sum}^{2}(\\lfloor\\cfrac{n}{i}\\rfloor)i^{2}\\varphi(i)\n\\end{aligned}$$\n\n其中\n\n$$\\text{Sum}(n)=\\sum\\limits_{i=1}^{n}i$$\n\n最后一步是因为\n\n$$\\begin{aligned}\nid\\times\\mu&=\\varphi\\times 1\\times\\mu\\\\\n&=\\varphi\\times\\epsilon\\\\\n&=\\varphi\n\\end{aligned}$$\n\n理解不了上面的式子的话就多看看吧（\n\n不难发现我们是要求$f(n)=n^{2}\\varphi(n)$的前缀和，那么，我们该怎么选取$g$呢？\n\n~~枚举瞎蒙（~~\n\n考虑$g(n)=n^{2}$。\n\n$$\\begin{aligned}\n(f\\times g)(n)&=\\sum\\limits_{i\\mid n}f(i)g(\\cfrac{n}{i})\\\\\n&=\\sum\\limits_{i\\mid n}i^{2}\\varphi(i)\\cfrac{n^{2}}{i^{2}}\\\\\n&=n^{2}\\sum\\limits_{i\\mid n}\\varphi(i)\\\\\n&=n^{3}\n\\end{aligned}$$\n\n~~其实我都不知道我当时是怎么想到这种操作的（~~\n\n然后就和上面一样了。\n\n### [「Luogu-U18201」分析矿洞](https://www.luogu.org/problemnew/show/U18201)\n\n不知道从哪翻出来的题（\n\n是某场个人邀请赛的$\\text{T}1$~~，从某种意义上也能看出那场比赛有多么神仙~~。\n\n$$\\begin{aligned}\n\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{n}\\varphi(\\text{gcd}^{2}(i,j))&=\\sum\\limits_{d=1}^{n}\\varphi(d^{2})\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}[i\\perp j]\\\\\n&=\\sum\\limits_{d=1}^{n}\\varphi(d^{2})\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum\\limits_{x\\mid i,x\\mid j}\\mu(x)\\\\\n&=\\sum\\limits_{d=1}^{n}\\varphi(d^{2})\\sum\\limits_{x=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(x)\\lfloor\\cfrac{n}{dx}\\rfloor^{2}\\\\\n&=\\sum\\limits_{i=1}^{n}\\lfloor\\cfrac{n}{i}\\rfloor^{2}\\sum\\limits_{j\\mid i}\\varphi(j^{2})\\mu(\\cfrac{i}{j})\\\\\n&=\\sum\\limits_{i=1}^{n}\\lfloor\\cfrac{n}{i}\\rfloor^{2}\\sum\\limits_{j\\mid i}j\\varphi(j)\\mu(\\cfrac{i}{j})\n\\end{aligned}$$\n\n设$f_1(n)=n\\varphi(n),f_2(n)=\\mu(n)$，考虑筛$f=f_1\\times f_2$的前缀和。然而，与上面的其它题不同，并不存在一个$g$使我们能够$O(1)$地求出$g$和$f\\times g$的前缀和。一种较优的方案是，令$g=1$，$f\\times g=(id\\cdot\\varphi)\\times\\mu\\times 1=id\\cdot\\varphi$，这样，我们还需要筛出$f_1(n)=n\\varphi(n)$的前缀和。\n\n怎么办？\n\n再套一层杜教筛！\n\n然而可能是常数会有些大也可能是我太菜了自带大常数，好像会跑的很慢（\n\n以及，像这种$n$爆了`int`的，一定要注意经常取模。~~因为这个$\\text{WA}$了好几次（~~\n\n最后，源文件$17\\text{KB}$祭，blog翻页祭。","source":"_posts/2018-11-29-number-theory-learning-notes.md","raw":"---\ntitle: 一些乱七八糟的数论\ndate: 2018-11-29 14:41:17\ntags:\n  - 数论\n  - 杜教筛\ncategories:\n  - 学习笔记\nmathjax: true\n---\n最近在洛谷日报的待审核列表里翻到了杜教筛的相关内容，打算连着之前的卷积反演啥的一起复习一下。\n\n~~抄袭来源~~参考文献：\n\n- [铃悬的数学小讲堂——狄利克雷卷积与莫比乌斯反演](https://lx-2003.blog.luogu.org/mobius-inversion)\n- [浅谈杜教筛](https://www.luogu.org/blog/54745/dls-tql)\n- [铃悬的数学小讲堂——杜教筛](https://lx-2003.blog.luogu.org/dujiao-sieve)\n\n<!-- more -->\n\n# 数论函数\n\n## 定义与相关性质\n\n数论函数就是定义域为$\\mathbb{N}^{+}$的函数。\n\n两个数论函数相加，就是简单地把函数值相加。\n\n$$(f+g)(n)=f(n)+g(n)$$\n\n数乘也是类似的。\n\n$$(\\alpha f)(n)=\\alpha f(n)$$\n\n点积也是类似的。\n\n$$(f\\cdot g)(n)=f(n)g(n)$$\n\n~~好像没啥用。~~\n\n在数论函数相关的运算中，一个非常重要的运算是狄利克雷卷积。两个数论函数的狄利克雷卷积是这样定义的：\n\n$$(f\\times g)(n)=\\sum\\limits_{i\\mid n}f(i)g(\\cfrac{n}{i})$$\n\n或者说：\n\n$$(f\\times g)(n)=\\sum\\limits_{ij=n}f(i)g(j)$$\n\n它具有以下的一些性质：\n\n交换律，即$f\\times g=g\\times f$。\n\n这很明显。\n\n结合律，即$(f\\times g)\\times h=f\\times(g\\times h)$。\n\n$$\\begin{aligned}\n((f\\times g)\\times h)(n)&=\\sum\\limits_{ij=n}(\\sum\\limits_{kl=i}f(k)g(l))h(j)\\\\\n&=\\sum\\limits_{ijk=n}f(i)g(j)h(k)\n\\end{aligned}$$\n\n$$\\begin{aligned}\n(f\\times(g\\times h))(n)&=\\sum\\limits_{ij=n}f(i)(\\sum\\limits_{kl=j}g(k)h(l))\\\\\n&=\\sum\\limits_{ijk=n}f(i)g(j)h(k)\n\\end{aligned}$$\n\n分配率，即$(f+g)\\times h=f\\times h+g\\times h$。\n\n$$\\begin{aligned}\n((f+g)\\times h)(n)&=\\sum\\limits_{ij=n}(f+g)(i)h(j)\\\\\n&=\\sum\\limits_{ij=n}f(i)h(j)+g(i)h(j)\\\\\n&=(f\\times h)(n)+(g\\times h)(n)\n\\end{aligned}$$\n\n单位元为$\\epsilon(n)=[n=1]$，$f\\times\\epsilon =f$。\n\n这也很明显。\n\n对于任意一个满足$f(1)\\neq 0$的函数$f$，都存在唯一的一个函数$g$使得$f\\times g=\\epsilon$。这时我们称$g$是$f$的逆。\n\n我们可以这样定义一个函数的逆：\n\n$$g(n)=\\cfrac{\\epsilon(n)-\\sum\\limits_{i\\mid n,i\\neq 1}f(i)g(\\cfrac{n}{i})}{f(1)}$$\n\n这样我们就有\n\n$$\\begin{aligned}\n(f\\times g)(n)&=\\sum_{i\\mid n}f(i)g(\\cfrac{n}{i})\\\\\n&=f(1)g(n)+\\sum_{i\\mid n,i\\neq 1}f(i)g(\\cfrac{n}{i})\\\\\n&=\\epsilon(n)-\\sum\\limits_{i\\mid n,i\\neq 1}f(i)g(\\cfrac{n}{i})+\\sum_{i\\mid n,i\\neq 1}f(i)g(\\cfrac{n}{i})\\\\\n&=\\epsilon(n)\n\\end{aligned}$$\n\n## 积性函数与完全积性函数\n\n如果一个数论函数$f$满足\n\n$$\\forall x,y\\in\\mathbb{N}^{+}\\wedge x\\perp y\\;\\;f(xy)=f(x)f(y)$$\n\n我们就说$f$是一个积性函数。\n\n特别的，如果上式去掉$x\\perp y$仍成立，则称$f$是一个完全积性函数。\n\n很明显地，任意一个积性函数$f$一定有$f(1)=1$，这样才能有$f(1\\times n)=f(1)\\times f(n)=f(n)$。\n\n常见的完全积性函数有$\\epsilon,id^{k}$。$\\epsilon$在上文已经提到过。$id^{k}(n)=n^k$。这两个函数的完全积性十分明显。\n\n常见的积性函数有$\\varphi,d,\\sigma$。$\\varphi(n)$的值等于小于等于$n$且与$n$互质的正整数的数量。$d(n)$和$\\sigma(n)$的值分别等于$n$的约数个数和约数和。\n\n关于$\\varphi$的积性，我并不会证（\n\n我们来分析$d$的积性。首先，根据唯一分解定理，$n$的每个因数都可以唯一地分解成$n$所有质因子的非负整数次幂乘积。不妨设\n\n$$n=\\prod\\limits_{i=1}^{N}p_{i}^{r_{i}}$$\n\n其中$p_{i}$都是质数，所有$r_{i}$都是正整数。对于每一个$p_{i}$，它的指数有$(r_{i}+1)$种取值，因而我们有\n\n$$d(n)=\\prod\\limits_{i=1}^{N}(r_{i}+1)$$\n\n我们再假设有一个$m$，且\n\n$$m=\\prod\\limits_{i=1}^{M}q_{i}^{s_{i}}$$\n\n如果说$n\\perp m$，肯定有\n\n$$\\forall i\\in [1,N]\\cap\\mathbb{Z},j\\in [1,M]\\cap\\mathbb{Z}\\;\\;p_{i}\\neq q_{j}$$\n\n于是我们就有\n\n$$nm=(\\prod\\limits_{i=1}^{N}p_{i}^{r_{i}})(\\prod\\limits_{j=1}^{M}q_{j}^{s_{j}})$$\n\n$$\\begin{aligned}\nd(nm)&=(\\prod\\limits_{i=1}^{N}(r_{i}+1))(\\prod\\limits_{j=1}^{M}(s_{j}+1))\\\\\n&=d(n)d(m)\n\\end{aligned}$$\n\n不妨再反过来考虑。如果说$n\\not\\perp m$，那么一定存在一对$(i,j)(i\\in [1,N]\\cap\\mathbb{Z},j\\in [1,M]\\cap\\mathbb{Z})$，使得$p_{i}=q_{j}$。那么$d(n)d(m)$就会有一个因子是$(r_{i}+1)(s_{j}+1)=r_{i}s_{j}+r_{i}+s_{j}+1$。但是仔细思考我们会发现，$d(nm)$中对应的项应该是$r_{i}+s_{j}+1$。因而此时$d(nm)\\neq d(n)d(m)$。\n\n我们再来分析$\\sigma$的积性。还是设\n\n$$n=\\prod\\limits_{i=1}^{N}p_{i}^{r_{i}}$$\n\n其中$p_{i}$都是质数，所有$r_{i}$都是正整数。与$d$不同的是，现在我们是要用$p_{i}$乘出$n$的因数，$p_{i}$在此过程中可以产生的贡献为$p_{i}^x(x\\in [0,r_{i}]\\cap\\mathbb{Z})$。我们可以把这想象成一个$N$个数组，第$i$个数组的长度为$r_{i}+1$，第$j$个元素为$p_{i}^{j-1}$。现在我们每次从每个数组里选出恰好一个元素相乘，要求所有方案的乘积之和。我们知道，这个问题的答案就是\n\n$$\\prod\\limits_{i=1}^{N}\\sum\\limits_{j=0}^{r_{i}}p_{i}^{j}$$\n\n这正是$\\sigma(n)$的值。\n\n接下来的过程就与上文证明$d$的积性如出一辙了，在此不再重复。\n\n现在我们来分析，两个积性函数的卷积是否也是积性函数。~~虽然说都这么问了肯定就是了。~~\n\n$$\\begin{aligned}\n(f\\times g)(n)(f\\times g)(m)&=(\\sum\\limits_{i\\mid n}f(i)g(\\cfrac{n}{i}))(\\sum\\limits_{j\\mid m}f(j)g(\\cfrac{m}{j}))\\\\\n&=\\sum\\limits_{i\\mid n}\\sum\\limits_{j\\mid m}f(i)g(\\cfrac{n}{i})f(j)g(\\cfrac{m}{j})\\\\\n&=\\sum\\limits_{i\\mid n}\\sum\\limits_{j\\mid m}f(ij)g(\\cfrac{nm}{ij})\\\\\n&=\\sum\\limits_{k\\mid nm}f(k)g(\\cfrac{nm}{k})\\\\\n&=(f\\times g)(nm)\n\\end{aligned}$$\n\n关于上面的第四个等号。时刻注意$n\\perp m$，在这种前提下，我们枚举到的$i$和$j$一定也是互质的，那么$ij$的所有值一定是互不相同的。这从$d(nm)=d(n)d(m)$这一等式中也能看出。\n\n再接下来，我们来分析一下一个积性函数的逆是否也是积性函数。\n\n设有一个积性函数$f$，它的逆是$g$。\n\n当$nm=1$时，$g(1)=1$。\n\n当$nm>1$时，我们假设对于任意$n^{\\prime}m^{\\prime}<nm$，都有$g(n^{\\prime}m^{\\prime})=g(n^{\\prime})g(m^{\\prime})$。此时\n\n$$\\begin{aligned}\ng(nm)&=-\\sum\\limits_{k\\mid nm,k\\neq 1}f(k)g(\\cfrac{nm}{k})\\\\\n&=-\\sum\\limits_{i\\mid n,j\\mid m,ij\\neq 1}f(i)f(j)g(\\cfrac{n}{i})g(\\cfrac{m}{j})\\\\\n&=g(n)g(m)-\\sum\\limits_{i\\mid n,j\\mid m}f(i)f(j)g(\\cfrac{n}{i})g(\\cfrac{m}{j})\\\\\n&=g(n)g(m)-(\\sum\\limits_{i\\mid n}f(i)g(\\cfrac{n}{i}))(\\sum\\limits_{j\\mid m}f(j)g(\\cfrac{m}{j}))\\\\\n&=g(n)g(m)-\\epsilon(n)\\epsilon(m)\\\\\n&=g(n)g(m)\n\\end{aligned}$$\n\n~~其实上面这些全都是抄来的（~~\n\n# 莫比乌斯反演\n\n## 正向反演\n\n定义$\\mu$为$1$的逆。也就是说，$\\mu\\times 1=\\epsilon$。\n\n如果您看过其他的一些关于莫比乌斯反演的学习笔记的话，您可能会看到如下的定义：\n\n> 首先地，$\\mu(1)=1$。当$n>1$时，如果$n$的所有质因子互不相同，设其有$k$个质因子，那么$\\mu(n)=(-1)^{k}$。否则，$\\mu(n)=0$。\n\n那么，这两种定义等价吗？\n\n考虑到$\\mu$是一个积性函数，对于任意一个$n>1$，如果我们把它分解成\n\n$$n=\\prod\\limits_{i=1}^{N}p_{i}^{r_{i}}$$\n\n我们就有\n\n$$\\mu(n)=\\prod\\limits_{i=1}^{N}\\mu(p_{i}^{r_{i}})$$\n\n因此，确定一个积性函数的函数值的关键在于确定其在质数的非负整数次幂上的取值。\n\n设有一个质数$p$。不难发现\n\n$$\\mu(p)=-\\mu(1)=-1$$\n\n$$\\mu(p^{2})=-\\mu(1)-\\mu(p)=-1+1=0$$\n\n$$\\mu(p^{3})=-\\mu(1)-\\mu(p)-\\mu(p^{2})=-1+1+0=0$$\n\n$$\\vdots$$\n\n至此，不难看出上文给出的两种定义是等价的。\n\n那么这个东西有什么用呢？\n\n我们设\n\n$$F(n)=\\sum\\limits_{i\\mid n}f(i)$$\n\n或者等价地说，$F=f\\times 1$。我们可以得到\n\n$$\\begin{aligned}\nF&=f\\times 1\\\\\nF\\times\\mu&=f\\times 1\\times\\mu\\\\\nF\\times\\mu&=f\n\\end{aligned}$$\n\n像这样，如果说$F$相对好求，而$f$相对难求，我们就可以通过上式来减小我们求解$f$的难度。具体地说\n\n$$f(n)=\\sum\\limits_{i\\mid n}F(i)\\mu(\\cfrac{n}{i})$$\n\n## 反向反演\n\n有些时候我们还需要用到像下面这样反过来的莫比乌斯反演\n\n$$F(n)=\\sum\\limits_{n\\mid d}f(d)⇔f(n)=\\sum\\limits_{n\\mid d}F(d)\\mu(\\cfrac{d}{n})$$\n\n我们可以定义一种新的运算\n\n$$(f\\otimes g)(n)=\\sum\\limits_{n\\mid d}f(d)g(\\cfrac{d}{n})$$\n\n我们不难证明出它具有结合律。具体过程与上文证明狄利克雷卷积的结合律的过程基本重复。那么我们就有\n\n$$F=f\\otimes 1⇔F\\otimes\\mu=f$$\n\n于是就有了上面的反向反演。\n\n> $\\text{Updated on 2018-12-03}$：\n> \n> 例题……还是算了吧（\n> \n> 发现反演常用的套路都忘的差不多了，还是别丢人了（\n\n# 杜教筛\n\n## 实现与模板题\n\n接下来才是主要内容。\n\n现在，我们要求一个积性函数的前$n$项和。$n\\leqslant 10^{10}$。\n\n我们定义\n\n$$S(n)=\\sum\\limits_{i=1}^{n}f(i)$$\n\n再拿来一个积性函数$g$，然后把它与$f$卷积并求前缀和。\n\n$$\\begin{aligned}\n\\sum_{i=1}^{n}(f\\times g)(i)&=\\sum_{i=1}^{n}\\sum_{j\\mid i}f(j)g(\\cfrac{i}{j})\\\\\n&=\\sum_{i=1}^{n}g(i)\\sum_{j=1}^{\\lfloor\\frac{n}{i}\\rfloor}f(j)\\\\\n&=\\sum_{i=1}^{n}g(i)S(\\lfloor\\cfrac{n}{i}\\rfloor)\n\\end{aligned}$$\n\n然而我的语文实在是太菜了，大概说也说不明白，自行理解吧（\n\n因为$g$也是积性函数，有$g(1)=1$，所以\n\n$$\\begin{aligned}\nS(n)&=g(1)S(n)\\\\\n&=\\sum_{i=1}^{n}g(i)S(\\lfloor\\cfrac{n}{i}\\rfloor)-\\sum_{i=2}^{n}g(i)S(\\lfloor\\cfrac{n}{i}\\rfloor)\\\\\n&=\\sum_{i=1}^{n}(f\\times g)(i)-\\sum_{i=2}^{n}g(i)S(\\lfloor\\cfrac{n}{i}\\rfloor)\n\\end{aligned}$$\n\n就是说从第一项开始的前缀和减去从第二项开始的前缀和等于第一项本身。\n\n如果说我们选择的$g$可以让我们迅速地求出$f\\times g$和$g$的前缀和，我们就可以做到快速求$f$的前缀和了。\n\n关于后面的$g(i)S(\\lfloor\\cfrac{n}{i}\\rfloor)$，如果直接暴力算复杂度会是$O(n)$的，在大部分情况下，这是无法接受的。\n\n我们来分析一下$\\lfloor\\cfrac{n}{i}\\rfloor$。如果$1\\leqslant i\\leqslant\\sqrt{n}$，因为$i$只有$\\sqrt{n}$种不同的取值，$\\lfloor\\cfrac{n}{i}\\rfloor$同样也只有$\\sqrt{n}$种不同的取值。如果$\\sqrt{n}<i\\leqslant n$，$1\\leqslant\\lfloor\\cfrac{n}{i}\\rfloor<\\sqrt{n}$，又因为要向下取整，自然也只有$\\sqrt{n}$种不同的取值。如果我们能够把$\\lfloor\\cfrac{n}{i}\\rfloor$相同的$i$一起计算，就能够将时间杂度优化到$O(\\sqrt{n})$。\n\n大体代码如下：\n\n```cpp\nfor(re int l=1,r;l<=n;l=r+1){\n\tr=n/(n/l);\n\t//......\n}\n```\n\n关于$r$的这个上界是怎么来的，我并不会证（\n\n这样一来，要计算$S(n)$，我们需要调用所有的$\\lfloor\\cfrac{n}{x}\\rfloor$，分别是$\\lfloor\\cfrac{n}{1}\\rfloor,\\lfloor\\cfrac{n}{2}\\rfloor,\\cdots,\\lfloor\\cfrac{n}{\\sqrt{n}}\\rfloor,\\sqrt{n},\\sqrt{n}-1,\\cdots,1$。单独计算一个$S(n)$的时间复杂度很明显是$O(\\sqrt{n})$的。那么这样一来，总体的时间复杂度就是\n\n$$\\begin{aligned}\nO(\\sum\\limits_{i=1}^{\\sqrt{n}}\\sqrt{i}+\\sqrt{\\lfloor\\cfrac{n}{i}\\rfloor})&=O(\\sum\\limits_{i=1}^{\\sqrt{n}}\\sqrt{\\lfloor\\cfrac{n}{i}\\rfloor})\\\\\n&=O(\\int\\limits_{1}^{\\sqrt{n}}\\sqrt{\\lfloor\\cfrac{n}{x}\\rfloor}dx)\\\\\n&=O(\\int\\limits_{1}^{\\sqrt{n}}\\sqrt{\\cfrac{n}{x}}dx)\\\\\n&=O(2n^{\\frac{1}{2}}(n^{\\frac{1}{4}}-1))\\\\\n&=O(n^{\\frac{3}{4}})\n\\end{aligned}$$\n\n因为相比之下$\\sqrt{\\lfloor\\cfrac{n}{i}\\rfloor}$很明显要大一些，我们就可以将$\\sqrt{i}$舍去。然后去掉取整符号并用积分近似。\n\n这个实现方法还可以优化。具体来讲，我们先线性筛出前$m$项，然后再用杜教筛。这么做的时间复杂度是$O(m+\\cfrac{n}{\\sqrt{m}})$，当$m=n^{\\frac{2}{3}}$时取得最小值$O(n^{\\frac{2}{3}})$。\n\n举个例子，就比如说我们要求\n\n$$\\sum\\limits_{i=1}^{n}\\varphi(i)$$\n\n我们取$f=\\varphi,g=1$，这样根据$\\varphi$的性质，$f\\times g=id$。不难看出$g$与$f\\times g$的前缀和都可以$O(1)$求。具体的代码实现差不多长这样：\n\n```cpp\nlong long getSum(int n){\n\tif(n<=maxn)\n\t\treturn phi[n];\n\t//phi是提前线性筛好的前缀和\n\tif(ans.count(n))\n\t\treturn ans[n];\n\t//ans用来实现记忆化的哈希表，比如说unordered_map\n\tre long long res=1LL*n*(n+1)>>1;\n\t//f*g的前缀和\n\tfor(re int l=2,r;l<=n;l=r+1){\n\t//注意要从2开始\n\t\tr=n/(n/l);\n\t\tres-=(r-l+1)*getSum(n/l);\n\t\t//r-l+1是g的前缀和\n\t\t//像这样递归+记忆化求解f的前缀和\n\t}\n\treturn ans[n]=res;\n\t//返回的时候不要忘记存一下\n\t//就比如说我就忘过一次（\n}\n```\n\n以及，不用哈希表也是可以的。因为我们查询的数都是形如$\\lfloor\\cfrac{n}{x}\\rfloor$的，当这个值大于$n^{\\frac{2}{3}}$，即$x<n^{\\frac{1}{3}}$时，我们才会到哈希表里查询。因此我们可以令`ans[x]`表示$S(\\lfloor\\cfrac{n}{x}\\rfloor)$。具体代码我就不写了（\n\n再举个例子，求\n\n$$\\sum\\limits_{i=1}^{n}\\mu(i)$$\n\n取$f=\\mu,g=1,f\\times g=\\epsilon$。代码和上面差不多。\n\n如果您理解了上面两个函数，这道[模板题](https://www.luogu.org/problemnew/show/P4213)您就可以切了。\n\n## 其他题\n\n### [「Luogu-P3768」简单的数学题](https://www.luogu.org/problemnew/show/P3768)\n\n快乐地推式子：\n\n$$\\begin{aligned}\n\\sum\\limits_{i=1}^{n}i\\sum\\limits_{j=1}^{n}j\\text{gcd}(i,j)&=\\sum\\limits_{d=1}^{n}d^{3}\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}i\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}j[i\\perp j]\\\\\n&=\\sum\\limits_{d=1}^{n}d^{3}\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}i\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}j\\sum\\limits_{x\\mid i,x\\mid j}\\mu(x)\\\\\n&=\\sum\\limits_{d=1}^{n}d^{3}\\sum\\limits_{x=1}^{\\lfloor\\frac{n}{d}\\rfloor}x^{2}\\mu(x)\\text{Sum}^{2}(\\lfloor\\cfrac{n}{dx}\\rfloor)\\\\\n&=\\sum\\limits_{i=1}^{n}\\text{Sum}^{2}(\\lfloor\\cfrac{n}{i}\\rfloor)i^{2}\\sum\\limits_{j\\mid i}j\\mu(\\cfrac{i}{j})\\\\\n&=\\sum\\limits_{i=1}^{n}\\text{Sum}^{2}(\\lfloor\\cfrac{n}{i}\\rfloor)i^{2}\\varphi(i)\n\\end{aligned}$$\n\n其中\n\n$$\\text{Sum}(n)=\\sum\\limits_{i=1}^{n}i$$\n\n最后一步是因为\n\n$$\\begin{aligned}\nid\\times\\mu&=\\varphi\\times 1\\times\\mu\\\\\n&=\\varphi\\times\\epsilon\\\\\n&=\\varphi\n\\end{aligned}$$\n\n理解不了上面的式子的话就多看看吧（\n\n不难发现我们是要求$f(n)=n^{2}\\varphi(n)$的前缀和，那么，我们该怎么选取$g$呢？\n\n~~枚举瞎蒙（~~\n\n考虑$g(n)=n^{2}$。\n\n$$\\begin{aligned}\n(f\\times g)(n)&=\\sum\\limits_{i\\mid n}f(i)g(\\cfrac{n}{i})\\\\\n&=\\sum\\limits_{i\\mid n}i^{2}\\varphi(i)\\cfrac{n^{2}}{i^{2}}\\\\\n&=n^{2}\\sum\\limits_{i\\mid n}\\varphi(i)\\\\\n&=n^{3}\n\\end{aligned}$$\n\n~~其实我都不知道我当时是怎么想到这种操作的（~~\n\n然后就和上面一样了。\n\n### [「Luogu-U18201」分析矿洞](https://www.luogu.org/problemnew/show/U18201)\n\n不知道从哪翻出来的题（\n\n是某场个人邀请赛的$\\text{T}1$~~，从某种意义上也能看出那场比赛有多么神仙~~。\n\n$$\\begin{aligned}\n\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{n}\\varphi(\\text{gcd}^{2}(i,j))&=\\sum\\limits_{d=1}^{n}\\varphi(d^{2})\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}[i\\perp j]\\\\\n&=\\sum\\limits_{d=1}^{n}\\varphi(d^{2})\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum\\limits_{x\\mid i,x\\mid j}\\mu(x)\\\\\n&=\\sum\\limits_{d=1}^{n}\\varphi(d^{2})\\sum\\limits_{x=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(x)\\lfloor\\cfrac{n}{dx}\\rfloor^{2}\\\\\n&=\\sum\\limits_{i=1}^{n}\\lfloor\\cfrac{n}{i}\\rfloor^{2}\\sum\\limits_{j\\mid i}\\varphi(j^{2})\\mu(\\cfrac{i}{j})\\\\\n&=\\sum\\limits_{i=1}^{n}\\lfloor\\cfrac{n}{i}\\rfloor^{2}\\sum\\limits_{j\\mid i}j\\varphi(j)\\mu(\\cfrac{i}{j})\n\\end{aligned}$$\n\n设$f_1(n)=n\\varphi(n),f_2(n)=\\mu(n)$，考虑筛$f=f_1\\times f_2$的前缀和。然而，与上面的其它题不同，并不存在一个$g$使我们能够$O(1)$地求出$g$和$f\\times g$的前缀和。一种较优的方案是，令$g=1$，$f\\times g=(id\\cdot\\varphi)\\times\\mu\\times 1=id\\cdot\\varphi$，这样，我们还需要筛出$f_1(n)=n\\varphi(n)$的前缀和。\n\n怎么办？\n\n再套一层杜教筛！\n\n然而可能是常数会有些大也可能是我太菜了自带大常数，好像会跑的很慢（\n\n以及，像这种$n$爆了`int`的，一定要注意经常取模。~~因为这个$\\text{WA}$了好几次（~~\n\n最后，源文件$17\\text{KB}$祭，blog翻页祭。","slug":"number-theory-learning-notes","published":1,"updated":"2018-12-12T02:07:41.534Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjpn8w61c0028roguqbymtdyy","content":"<p>最近在洛谷日报的待审核列表里翻到了杜教筛的相关内容，打算连着之前的卷积反演啥的一起复习一下。</p>\n<p><del>抄袭来源</del>参考文献：</p>\n<ul>\n<li><a href=\"https://lx-2003.blog.luogu.org/mobius-inversion\" target=\"_blank\" rel=\"noopener\">铃悬的数学小讲堂——狄利克雷卷积与莫比乌斯反演</a></li>\n<li><a href=\"https://www.luogu.org/blog/54745/dls-tql\" target=\"_blank\" rel=\"noopener\">浅谈杜教筛</a></li>\n<li><a href=\"https://lx-2003.blog.luogu.org/dujiao-sieve\" target=\"_blank\" rel=\"noopener\">铃悬的数学小讲堂——杜教筛</a></li>\n</ul>\n<a id=\"more\"></a>\n<h1 id=\"数论函数\"><a href=\"#数论函数\" class=\"headerlink\" title=\"数论函数\"></a>数论函数</h1><h2 id=\"定义与相关性质\"><a href=\"#定义与相关性质\" class=\"headerlink\" title=\"定义与相关性质\"></a>定义与相关性质</h2><p>数论函数就是定义域为$\\mathbb{N}^{+}$的函数。</p>\n<p>两个数论函数相加，就是简单地把函数值相加。</p>\n<script type=\"math/tex; mode=display\">(f+g)(n)=f(n)+g(n)</script><p>数乘也是类似的。</p>\n<script type=\"math/tex; mode=display\">(\\alpha f)(n)=\\alpha f(n)</script><p>点积也是类似的。</p>\n<script type=\"math/tex; mode=display\">(f\\cdot g)(n)=f(n)g(n)</script><p><del>好像没啥用。</del></p>\n<p>在数论函数相关的运算中，一个非常重要的运算是狄利克雷卷积。两个数论函数的狄利克雷卷积是这样定义的：</p>\n<script type=\"math/tex; mode=display\">(f\\times g)(n)=\\sum\\limits_{i\\mid n}f(i)g(\\cfrac{n}{i})</script><p>或者说：</p>\n<script type=\"math/tex; mode=display\">(f\\times g)(n)=\\sum\\limits_{ij=n}f(i)g(j)</script><p>它具有以下的一些性质：</p>\n<p>交换律，即$f\\times g=g\\times f$。</p>\n<p>这很明显。</p>\n<p>结合律，即$(f\\times g)\\times h=f\\times(g\\times h)$。</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\n((f\\times g)\\times h)(n)&=\\sum\\limits_{ij=n}(\\sum\\limits_{kl=i}f(k)g(l))h(j)\\\\\n&=\\sum\\limits_{ijk=n}f(i)g(j)h(k)\n\\end{aligned}</script><script type=\"math/tex; mode=display\">\\begin{aligned}\n(f\\times(g\\times h))(n)&=\\sum\\limits_{ij=n}f(i)(\\sum\\limits_{kl=j}g(k)h(l))\\\\\n&=\\sum\\limits_{ijk=n}f(i)g(j)h(k)\n\\end{aligned}</script><p>分配率，即$(f+g)\\times h=f\\times h+g\\times h$。</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\n((f+g)\\times h)(n)&=\\sum\\limits_{ij=n}(f+g)(i)h(j)\\\\\n&=\\sum\\limits_{ij=n}f(i)h(j)+g(i)h(j)\\\\\n&=(f\\times h)(n)+(g\\times h)(n)\n\\end{aligned}</script><p>单位元为$\\epsilon(n)=[n=1]$，$f\\times\\epsilon =f$。</p>\n<p>这也很明显。</p>\n<p>对于任意一个满足$f(1)\\neq 0$的函数$f$，都存在唯一的一个函数$g$使得$f\\times g=\\epsilon$。这时我们称$g$是$f$的逆。</p>\n<p>我们可以这样定义一个函数的逆：</p>\n<script type=\"math/tex; mode=display\">g(n)=\\cfrac{\\epsilon(n)-\\sum\\limits_{i\\mid n,i\\neq 1}f(i)g(\\cfrac{n}{i})}{f(1)}</script><p>这样我们就有</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\n(f\\times g)(n)&=\\sum_{i\\mid n}f(i)g(\\cfrac{n}{i})\\\\\n&=f(1)g(n)+\\sum_{i\\mid n,i\\neq 1}f(i)g(\\cfrac{n}{i})\\\\\n&=\\epsilon(n)-\\sum\\limits_{i\\mid n,i\\neq 1}f(i)g(\\cfrac{n}{i})+\\sum_{i\\mid n,i\\neq 1}f(i)g(\\cfrac{n}{i})\\\\\n&=\\epsilon(n)\n\\end{aligned}</script><h2 id=\"积性函数与完全积性函数\"><a href=\"#积性函数与完全积性函数\" class=\"headerlink\" title=\"积性函数与完全积性函数\"></a>积性函数与完全积性函数</h2><p>如果一个数论函数$f$满足</p>\n<script type=\"math/tex; mode=display\">\\forall x,y\\in\\mathbb{N}^{+}\\wedge x\\perp y\\;\\;f(xy)=f(x)f(y)</script><p>我们就说$f$是一个积性函数。</p>\n<p>特别的，如果上式去掉$x\\perp y$仍成立，则称$f$是一个完全积性函数。</p>\n<p>很明显地，任意一个积性函数$f$一定有$f(1)=1$，这样才能有$f(1\\times n)=f(1)\\times f(n)=f(n)$。</p>\n<p>常见的完全积性函数有$\\epsilon,id^{k}$。$\\epsilon$在上文已经提到过。$id^{k}(n)=n^k$。这两个函数的完全积性十分明显。</p>\n<p>常见的积性函数有$\\varphi,d,\\sigma$。$\\varphi(n)$的值等于小于等于$n$且与$n$互质的正整数的数量。$d(n)$和$\\sigma(n)$的值分别等于$n$的约数个数和约数和。</p>\n<p>关于$\\varphi$的积性，我并不会证（</p>\n<p>我们来分析$d$的积性。首先，根据唯一分解定理，$n$的每个因数都可以唯一地分解成$n$所有质因子的非负整数次幂乘积。不妨设</p>\n<script type=\"math/tex; mode=display\">n=\\prod\\limits_{i=1}^{N}p_{i}^{r_{i}}</script><p>其中$p_{i}$都是质数，所有$r_{i}$都是正整数。对于每一个$p_{i}$，它的指数有$(r_{i}+1)$种取值，因而我们有</p>\n<script type=\"math/tex; mode=display\">d(n)=\\prod\\limits_{i=1}^{N}(r_{i}+1)</script><p>我们再假设有一个$m$，且</p>\n<script type=\"math/tex; mode=display\">m=\\prod\\limits_{i=1}^{M}q_{i}^{s_{i}}</script><p>如果说$n\\perp m$，肯定有</p>\n<script type=\"math/tex; mode=display\">\\forall i\\in [1,N]\\cap\\mathbb{Z},j\\in [1,M]\\cap\\mathbb{Z}\\;\\;p_{i}\\neq q_{j}</script><p>于是我们就有</p>\n<script type=\"math/tex; mode=display\">nm=(\\prod\\limits_{i=1}^{N}p_{i}^{r_{i}})(\\prod\\limits_{j=1}^{M}q_{j}^{s_{j}})</script><script type=\"math/tex; mode=display\">\\begin{aligned}\nd(nm)&=(\\prod\\limits_{i=1}^{N}(r_{i}+1))(\\prod\\limits_{j=1}^{M}(s_{j}+1))\\\\\n&=d(n)d(m)\n\\end{aligned}</script><p>不妨再反过来考虑。如果说$n\\not\\perp m$，那么一定存在一对$(i,j)(i\\in [1,N]\\cap\\mathbb{Z},j\\in [1,M]\\cap\\mathbb{Z})$，使得$p_{i}=q_{j}$。那么$d(n)d(m)$就会有一个因子是$(r_{i}+1)(s_{j}+1)=r_{i}s_{j}+r_{i}+s_{j}+1$。但是仔细思考我们会发现，$d(nm)$中对应的项应该是$r_{i}+s_{j}+1$。因而此时$d(nm)\\neq d(n)d(m)$。</p>\n<p>我们再来分析$\\sigma$的积性。还是设</p>\n<script type=\"math/tex; mode=display\">n=\\prod\\limits_{i=1}^{N}p_{i}^{r_{i}}</script><p>其中$p_{i}$都是质数，所有$r_{i}$都是正整数。与$d$不同的是，现在我们是要用$p_{i}$乘出$n$的因数，$p_{i}$在此过程中可以产生的贡献为$p_{i}^x(x\\in [0,r_{i}]\\cap\\mathbb{Z})$。我们可以把这想象成一个$N$个数组，第$i$个数组的长度为$r_{i}+1$，第$j$个元素为$p_{i}^{j-1}$。现在我们每次从每个数组里选出恰好一个元素相乘，要求所有方案的乘积之和。我们知道，这个问题的答案就是</p>\n<script type=\"math/tex; mode=display\">\\prod\\limits_{i=1}^{N}\\sum\\limits_{j=0}^{r_{i}}p_{i}^{j}</script><p>这正是$\\sigma(n)$的值。</p>\n<p>接下来的过程就与上文证明$d$的积性如出一辙了，在此不再重复。</p>\n<p>现在我们来分析，两个积性函数的卷积是否也是积性函数。<del>虽然说都这么问了肯定就是了。</del></p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\n(f\\times g)(n)(f\\times g)(m)&=(\\sum\\limits_{i\\mid n}f(i)g(\\cfrac{n}{i}))(\\sum\\limits_{j\\mid m}f(j)g(\\cfrac{m}{j}))\\\\\n&=\\sum\\limits_{i\\mid n}\\sum\\limits_{j\\mid m}f(i)g(\\cfrac{n}{i})f(j)g(\\cfrac{m}{j})\\\\\n&=\\sum\\limits_{i\\mid n}\\sum\\limits_{j\\mid m}f(ij)g(\\cfrac{nm}{ij})\\\\\n&=\\sum\\limits_{k\\mid nm}f(k)g(\\cfrac{nm}{k})\\\\\n&=(f\\times g)(nm)\n\\end{aligned}</script><p>关于上面的第四个等号。时刻注意$n\\perp m$，在这种前提下，我们枚举到的$i$和$j$一定也是互质的，那么$ij$的所有值一定是互不相同的。这从$d(nm)=d(n)d(m)$这一等式中也能看出。</p>\n<p>再接下来，我们来分析一下一个积性函数的逆是否也是积性函数。</p>\n<p>设有一个积性函数$f$，它的逆是$g$。</p>\n<p>当$nm=1$时，$g(1)=1$。</p>\n<p>当$nm&gt;1$时，我们假设对于任意$n^{\\prime}m^{\\prime}&lt;nm$，都有$g(n^{\\prime}m^{\\prime})=g(n^{\\prime})g(m^{\\prime})$。此时</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\ng(nm)&=-\\sum\\limits_{k\\mid nm,k\\neq 1}f(k)g(\\cfrac{nm}{k})\\\\\n&=-\\sum\\limits_{i\\mid n,j\\mid m,ij\\neq 1}f(i)f(j)g(\\cfrac{n}{i})g(\\cfrac{m}{j})\\\\\n&=g(n)g(m)-\\sum\\limits_{i\\mid n,j\\mid m}f(i)f(j)g(\\cfrac{n}{i})g(\\cfrac{m}{j})\\\\\n&=g(n)g(m)-(\\sum\\limits_{i\\mid n}f(i)g(\\cfrac{n}{i}))(\\sum\\limits_{j\\mid m}f(j)g(\\cfrac{m}{j}))\\\\\n&=g(n)g(m)-\\epsilon(n)\\epsilon(m)\\\\\n&=g(n)g(m)\n\\end{aligned}</script><p><del>其实上面这些全都是抄来的（</del></p>\n<h1 id=\"莫比乌斯反演\"><a href=\"#莫比乌斯反演\" class=\"headerlink\" title=\"莫比乌斯反演\"></a>莫比乌斯反演</h1><h2 id=\"正向反演\"><a href=\"#正向反演\" class=\"headerlink\" title=\"正向反演\"></a>正向反演</h2><p>定义$\\mu$为$1$的逆。也就是说，$\\mu\\times 1=\\epsilon$。</p>\n<p>如果您看过其他的一些关于莫比乌斯反演的学习笔记的话，您可能会看到如下的定义：</p>\n<blockquote>\n<p>首先地，$\\mu(1)=1$。当$n&gt;1$时，如果$n$的所有质因子互不相同，设其有$k$个质因子，那么$\\mu(n)=(-1)^{k}$。否则，$\\mu(n)=0$。</p>\n</blockquote>\n<p>那么，这两种定义等价吗？</p>\n<p>考虑到$\\mu$是一个积性函数，对于任意一个$n&gt;1$，如果我们把它分解成</p>\n<script type=\"math/tex; mode=display\">n=\\prod\\limits_{i=1}^{N}p_{i}^{r_{i}}</script><p>我们就有</p>\n<script type=\"math/tex; mode=display\">\\mu(n)=\\prod\\limits_{i=1}^{N}\\mu(p_{i}^{r_{i}})</script><p>因此，确定一个积性函数的函数值的关键在于确定其在质数的非负整数次幂上的取值。</p>\n<p>设有一个质数$p$。不难发现</p>\n<script type=\"math/tex; mode=display\">\\mu(p)=-\\mu(1)=-1</script><script type=\"math/tex; mode=display\">\\mu(p^{2})=-\\mu(1)-\\mu(p)=-1+1=0</script><script type=\"math/tex; mode=display\">\\mu(p^{3})=-\\mu(1)-\\mu(p)-\\mu(p^{2})=-1+1+0=0</script><script type=\"math/tex; mode=display\">\\vdots</script><p>至此，不难看出上文给出的两种定义是等价的。</p>\n<p>那么这个东西有什么用呢？</p>\n<p>我们设</p>\n<script type=\"math/tex; mode=display\">F(n)=\\sum\\limits_{i\\mid n}f(i)</script><p>或者等价地说，$F=f\\times 1$。我们可以得到</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\nF&=f\\times 1\\\\\nF\\times\\mu&=f\\times 1\\times\\mu\\\\\nF\\times\\mu&=f\n\\end{aligned}</script><p>像这样，如果说$F$相对好求，而$f$相对难求，我们就可以通过上式来减小我们求解$f$的难度。具体地说</p>\n<script type=\"math/tex; mode=display\">f(n)=\\sum\\limits_{i\\mid n}F(i)\\mu(\\cfrac{n}{i})</script><h2 id=\"反向反演\"><a href=\"#反向反演\" class=\"headerlink\" title=\"反向反演\"></a>反向反演</h2><p>有些时候我们还需要用到像下面这样反过来的莫比乌斯反演</p>\n<script type=\"math/tex; mode=display\">F(n)=\\sum\\limits_{n\\mid d}f(d)⇔f(n)=\\sum\\limits_{n\\mid d}F(d)\\mu(\\cfrac{d}{n})</script><p>我们可以定义一种新的运算</p>\n<script type=\"math/tex; mode=display\">(f\\otimes g)(n)=\\sum\\limits_{n\\mid d}f(d)g(\\cfrac{d}{n})</script><p>我们不难证明出它具有结合律。具体过程与上文证明狄利克雷卷积的结合律的过程基本重复。那么我们就有</p>\n<script type=\"math/tex; mode=display\">F=f\\otimes 1⇔F\\otimes\\mu=f</script><p>于是就有了上面的反向反演。</p>\n<blockquote>\n<p>$\\text{Updated on 2018-12-03}$：</p>\n<p>例题……还是算了吧（</p>\n<p>发现反演常用的套路都忘的差不多了，还是别丢人了（</p>\n</blockquote>\n<h1 id=\"杜教筛\"><a href=\"#杜教筛\" class=\"headerlink\" title=\"杜教筛\"></a>杜教筛</h1><h2 id=\"实现与模板题\"><a href=\"#实现与模板题\" class=\"headerlink\" title=\"实现与模板题\"></a>实现与模板题</h2><p>接下来才是主要内容。</p>\n<p>现在，我们要求一个积性函数的前$n$项和。$n\\leqslant 10^{10}$。</p>\n<p>我们定义</p>\n<script type=\"math/tex; mode=display\">S(n)=\\sum\\limits_{i=1}^{n}f(i)</script><p>再拿来一个积性函数$g$，然后把它与$f$卷积并求前缀和。</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\n\\sum_{i=1}^{n}(f\\times g)(i)&=\\sum_{i=1}^{n}\\sum_{j\\mid i}f(j)g(\\cfrac{i}{j})\\\\\n&=\\sum_{i=1}^{n}g(i)\\sum_{j=1}^{\\lfloor\\frac{n}{i}\\rfloor}f(j)\\\\\n&=\\sum_{i=1}^{n}g(i)S(\\lfloor\\cfrac{n}{i}\\rfloor)\n\\end{aligned}</script><p>然而我的语文实在是太菜了，大概说也说不明白，自行理解吧（</p>\n<p>因为$g$也是积性函数，有$g(1)=1$，所以</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\nS(n)&=g(1)S(n)\\\\\n&=\\sum_{i=1}^{n}g(i)S(\\lfloor\\cfrac{n}{i}\\rfloor)-\\sum_{i=2}^{n}g(i)S(\\lfloor\\cfrac{n}{i}\\rfloor)\\\\\n&=\\sum_{i=1}^{n}(f\\times g)(i)-\\sum_{i=2}^{n}g(i)S(\\lfloor\\cfrac{n}{i}\\rfloor)\n\\end{aligned}</script><p>就是说从第一项开始的前缀和减去从第二项开始的前缀和等于第一项本身。</p>\n<p>如果说我们选择的$g$可以让我们迅速地求出$f\\times g$和$g$的前缀和，我们就可以做到快速求$f$的前缀和了。</p>\n<p>关于后面的$g(i)S(\\lfloor\\cfrac{n}{i}\\rfloor)$，如果直接暴力算复杂度会是$O(n)$的，在大部分情况下，这是无法接受的。</p>\n<p>我们来分析一下$\\lfloor\\cfrac{n}{i}\\rfloor$。如果$1\\leqslant i\\leqslant\\sqrt{n}$，因为$i$只有$\\sqrt{n}$种不同的取值，$\\lfloor\\cfrac{n}{i}\\rfloor$同样也只有$\\sqrt{n}$种不同的取值。如果$\\sqrt{n}&lt;i\\leqslant n$，$1\\leqslant\\lfloor\\cfrac{n}{i}\\rfloor&lt;\\sqrt{n}$，又因为要向下取整，自然也只有$\\sqrt{n}$种不同的取值。如果我们能够把$\\lfloor\\cfrac{n}{i}\\rfloor$相同的$i$一起计算，就能够将时间杂度优化到$O(\\sqrt{n})$。</p>\n<p>大体代码如下：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> l=<span class=\"number\">1</span>,r;l&lt;=n;l=r+<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">\tr=n/(n/l);</span><br><span class=\"line\">\t<span class=\"comment\">//......</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>关于$r$的这个上界是怎么来的，我并不会证（</p>\n<p>这样一来，要计算$S(n)$，我们需要调用所有的$\\lfloor\\cfrac{n}{x}\\rfloor$，分别是$\\lfloor\\cfrac{n}{1}\\rfloor,\\lfloor\\cfrac{n}{2}\\rfloor,\\cdots,\\lfloor\\cfrac{n}{\\sqrt{n}}\\rfloor,\\sqrt{n},\\sqrt{n}-1,\\cdots,1$。单独计算一个$S(n)$的时间复杂度很明显是$O(\\sqrt{n})$的。那么这样一来，总体的时间复杂度就是</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\nO(\\sum\\limits_{i=1}^{\\sqrt{n}}\\sqrt{i}+\\sqrt{\\lfloor\\cfrac{n}{i}\\rfloor})&=O(\\sum\\limits_{i=1}^{\\sqrt{n}}\\sqrt{\\lfloor\\cfrac{n}{i}\\rfloor})\\\\\n&=O(\\int\\limits_{1}^{\\sqrt{n}}\\sqrt{\\lfloor\\cfrac{n}{x}\\rfloor}dx)\\\\\n&=O(\\int\\limits_{1}^{\\sqrt{n}}\\sqrt{\\cfrac{n}{x}}dx)\\\\\n&=O(2n^{\\frac{1}{2}}(n^{\\frac{1}{4}}-1))\\\\\n&=O(n^{\\frac{3}{4}})\n\\end{aligned}</script><p>因为相比之下$\\sqrt{\\lfloor\\cfrac{n}{i}\\rfloor}$很明显要大一些，我们就可以将$\\sqrt{i}$舍去。然后去掉取整符号并用积分近似。</p>\n<p>这个实现方法还可以优化。具体来讲，我们先线性筛出前$m$项，然后再用杜教筛。这么做的时间复杂度是$O(m+\\cfrac{n}{\\sqrt{m}})$，当$m=n^{\\frac{2}{3}}$时取得最小值$O(n^{\\frac{2}{3}})$。</p>\n<p>举个例子，就比如说我们要求</p>\n<script type=\"math/tex; mode=display\">\\sum\\limits_{i=1}^{n}\\varphi(i)</script><p>我们取$f=\\varphi,g=1$，这样根据$\\varphi$的性质，$f\\times g=id$。不难看出$g$与$f\\times g$的前缀和都可以$O(1)$求。具体的代码实现差不多长这样：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">long</span> <span class=\"keyword\">long</span> <span class=\"title\">getSum</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(n&lt;=maxn)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> phi[n];</span><br><span class=\"line\">\t<span class=\"comment\">//phi是提前线性筛好的前缀和</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(ans.count(n))</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> ans[n];</span><br><span class=\"line\">\t<span class=\"comment\">//ans用来实现记忆化的哈希表，比如说unordered_map</span></span><br><span class=\"line\">\tre <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> res=<span class=\"number\">1L</span>L*n*(n+<span class=\"number\">1</span>)&gt;&gt;<span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//f*g的前缀和</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> l=<span class=\"number\">2</span>,r;l&lt;=n;l=r+<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//注意要从2开始</span></span><br><span class=\"line\">\t\tr=n/(n/l);</span><br><span class=\"line\">\t\tres-=(r-l+<span class=\"number\">1</span>)*getSum(n/l);</span><br><span class=\"line\">\t\t<span class=\"comment\">//r-l+1是g的前缀和</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//像这样递归+记忆化求解f的前缀和</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ans[n]=res;</span><br><span class=\"line\">\t<span class=\"comment\">//返回的时候不要忘记存一下</span></span><br><span class=\"line\">\t<span class=\"comment\">//就比如说我就忘过一次（</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>以及，不用哈希表也是可以的。因为我们查询的数都是形如$\\lfloor\\cfrac{n}{x}\\rfloor$的，当这个值大于$n^{\\frac{2}{3}}$，即$x&lt;n^{\\frac{1}{3}}$时，我们才会到哈希表里查询。因此我们可以令<code>ans[x]</code>表示$S(\\lfloor\\cfrac{n}{x}\\rfloor)$。具体代码我就不写了（</p>\n<p>再举个例子，求</p>\n<script type=\"math/tex; mode=display\">\\sum\\limits_{i=1}^{n}\\mu(i)</script><p>取$f=\\mu,g=1,f\\times g=\\epsilon$。代码和上面差不多。</p>\n<p>如果您理解了上面两个函数，这道<a href=\"https://www.luogu.org/problemnew/show/P4213\" target=\"_blank\" rel=\"noopener\">模板题</a>您就可以切了。</p>\n<h2 id=\"其他题\"><a href=\"#其他题\" class=\"headerlink\" title=\"其他题\"></a>其他题</h2><h3 id=\"「Luogu-P3768」简单的数学题\"><a href=\"#「Luogu-P3768」简单的数学题\" class=\"headerlink\" title=\"「Luogu-P3768」简单的数学题\"></a><a href=\"https://www.luogu.org/problemnew/show/P3768\" target=\"_blank\" rel=\"noopener\">「Luogu-P3768」简单的数学题</a></h3><p>快乐地推式子：</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\n\\sum\\limits_{i=1}^{n}i\\sum\\limits_{j=1}^{n}j\\text{gcd}(i,j)&=\\sum\\limits_{d=1}^{n}d^{3}\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}i\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}j[i\\perp j]\\\\\n&=\\sum\\limits_{d=1}^{n}d^{3}\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}i\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}j\\sum\\limits_{x\\mid i,x\\mid j}\\mu(x)\\\\\n&=\\sum\\limits_{d=1}^{n}d^{3}\\sum\\limits_{x=1}^{\\lfloor\\frac{n}{d}\\rfloor}x^{2}\\mu(x)\\text{Sum}^{2}(\\lfloor\\cfrac{n}{dx}\\rfloor)\\\\\n&=\\sum\\limits_{i=1}^{n}\\text{Sum}^{2}(\\lfloor\\cfrac{n}{i}\\rfloor)i^{2}\\sum\\limits_{j\\mid i}j\\mu(\\cfrac{i}{j})\\\\\n&=\\sum\\limits_{i=1}^{n}\\text{Sum}^{2}(\\lfloor\\cfrac{n}{i}\\rfloor)i^{2}\\varphi(i)\n\\end{aligned}</script><p>其中</p>\n<script type=\"math/tex; mode=display\">\\text{Sum}(n)=\\sum\\limits_{i=1}^{n}i</script><p>最后一步是因为</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\nid\\times\\mu&=\\varphi\\times 1\\times\\mu\\\\\n&=\\varphi\\times\\epsilon\\\\\n&=\\varphi\n\\end{aligned}</script><p>理解不了上面的式子的话就多看看吧（</p>\n<p>不难发现我们是要求$f(n)=n^{2}\\varphi(n)$的前缀和，那么，我们该怎么选取$g$呢？</p>\n<p><del>枚举瞎蒙（</del></p>\n<p>考虑$g(n)=n^{2}$。</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\n(f\\times g)(n)&=\\sum\\limits_{i\\mid n}f(i)g(\\cfrac{n}{i})\\\\\n&=\\sum\\limits_{i\\mid n}i^{2}\\varphi(i)\\cfrac{n^{2}}{i^{2}}\\\\\n&=n^{2}\\sum\\limits_{i\\mid n}\\varphi(i)\\\\\n&=n^{3}\n\\end{aligned}</script><p><del>其实我都不知道我当时是怎么想到这种操作的（</del></p>\n<p>然后就和上面一样了。</p>\n<h3 id=\"「Luogu-U18201」分析矿洞\"><a href=\"#「Luogu-U18201」分析矿洞\" class=\"headerlink\" title=\"「Luogu-U18201」分析矿洞\"></a><a href=\"https://www.luogu.org/problemnew/show/U18201\" target=\"_blank\" rel=\"noopener\">「Luogu-U18201」分析矿洞</a></h3><p>不知道从哪翻出来的题（</p>\n<p>是某场个人邀请赛的$\\text{T}1$<del>，从某种意义上也能看出那场比赛有多么神仙</del>。</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\n\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{n}\\varphi(\\text{gcd}^{2}(i,j))&=\\sum\\limits_{d=1}^{n}\\varphi(d^{2})\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}[i\\perp j]\\\\\n&=\\sum\\limits_{d=1}^{n}\\varphi(d^{2})\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum\\limits_{x\\mid i,x\\mid j}\\mu(x)\\\\\n&=\\sum\\limits_{d=1}^{n}\\varphi(d^{2})\\sum\\limits_{x=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(x)\\lfloor\\cfrac{n}{dx}\\rfloor^{2}\\\\\n&=\\sum\\limits_{i=1}^{n}\\lfloor\\cfrac{n}{i}\\rfloor^{2}\\sum\\limits_{j\\mid i}\\varphi(j^{2})\\mu(\\cfrac{i}{j})\\\\\n&=\\sum\\limits_{i=1}^{n}\\lfloor\\cfrac{n}{i}\\rfloor^{2}\\sum\\limits_{j\\mid i}j\\varphi(j)\\mu(\\cfrac{i}{j})\n\\end{aligned}</script><p>设$f_1(n)=n\\varphi(n),f_2(n)=\\mu(n)$，考虑筛$f=f_1\\times f_2$的前缀和。然而，与上面的其它题不同，并不存在一个$g$使我们能够$O(1)$地求出$g$和$f\\times g$的前缀和。一种较优的方案是，令$g=1$，$f\\times g=(id\\cdot\\varphi)\\times\\mu\\times 1=id\\cdot\\varphi$，这样，我们还需要筛出$f_1(n)=n\\varphi(n)$的前缀和。</p>\n<p>怎么办？</p>\n<p>再套一层杜教筛！</p>\n<p>然而可能是常数会有些大也可能是我太菜了自带大常数，好像会跑的很慢（</p>\n<p>以及，像这种$n$爆了<code>int</code>的，一定要注意经常取模。<del>因为这个$\\text{WA}$了好几次（</del></p>\n<p>最后，源文件$17\\text{KB}$祭，blog翻页祭。</p>\n","site":{"data":{}},"excerpt":"<p>最近在洛谷日报的待审核列表里翻到了杜教筛的相关内容，打算连着之前的卷积反演啥的一起复习一下。</p>\n<p><del>抄袭来源</del>参考文献：</p>\n<ul>\n<li><a href=\"https://lx-2003.blog.luogu.org/mobius-inversion\" target=\"_blank\" rel=\"noopener\">铃悬的数学小讲堂——狄利克雷卷积与莫比乌斯反演</a></li>\n<li><a href=\"https://www.luogu.org/blog/54745/dls-tql\" target=\"_blank\" rel=\"noopener\">浅谈杜教筛</a></li>\n<li><a href=\"https://lx-2003.blog.luogu.org/dujiao-sieve\" target=\"_blank\" rel=\"noopener\">铃悬的数学小讲堂——杜教筛</a></li>\n</ul>","more":"<h1 id=\"数论函数\"><a href=\"#数论函数\" class=\"headerlink\" title=\"数论函数\"></a>数论函数</h1><h2 id=\"定义与相关性质\"><a href=\"#定义与相关性质\" class=\"headerlink\" title=\"定义与相关性质\"></a>定义与相关性质</h2><p>数论函数就是定义域为$\\mathbb{N}^{+}$的函数。</p>\n<p>两个数论函数相加，就是简单地把函数值相加。</p>\n<script type=\"math/tex; mode=display\">(f+g)(n)=f(n)+g(n)</script><p>数乘也是类似的。</p>\n<script type=\"math/tex; mode=display\">(\\alpha f)(n)=\\alpha f(n)</script><p>点积也是类似的。</p>\n<script type=\"math/tex; mode=display\">(f\\cdot g)(n)=f(n)g(n)</script><p><del>好像没啥用。</del></p>\n<p>在数论函数相关的运算中，一个非常重要的运算是狄利克雷卷积。两个数论函数的狄利克雷卷积是这样定义的：</p>\n<script type=\"math/tex; mode=display\">(f\\times g)(n)=\\sum\\limits_{i\\mid n}f(i)g(\\cfrac{n}{i})</script><p>或者说：</p>\n<script type=\"math/tex; mode=display\">(f\\times g)(n)=\\sum\\limits_{ij=n}f(i)g(j)</script><p>它具有以下的一些性质：</p>\n<p>交换律，即$f\\times g=g\\times f$。</p>\n<p>这很明显。</p>\n<p>结合律，即$(f\\times g)\\times h=f\\times(g\\times h)$。</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\n((f\\times g)\\times h)(n)&=\\sum\\limits_{ij=n}(\\sum\\limits_{kl=i}f(k)g(l))h(j)\\\\\n&=\\sum\\limits_{ijk=n}f(i)g(j)h(k)\n\\end{aligned}</script><script type=\"math/tex; mode=display\">\\begin{aligned}\n(f\\times(g\\times h))(n)&=\\sum\\limits_{ij=n}f(i)(\\sum\\limits_{kl=j}g(k)h(l))\\\\\n&=\\sum\\limits_{ijk=n}f(i)g(j)h(k)\n\\end{aligned}</script><p>分配率，即$(f+g)\\times h=f\\times h+g\\times h$。</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\n((f+g)\\times h)(n)&=\\sum\\limits_{ij=n}(f+g)(i)h(j)\\\\\n&=\\sum\\limits_{ij=n}f(i)h(j)+g(i)h(j)\\\\\n&=(f\\times h)(n)+(g\\times h)(n)\n\\end{aligned}</script><p>单位元为$\\epsilon(n)=[n=1]$，$f\\times\\epsilon =f$。</p>\n<p>这也很明显。</p>\n<p>对于任意一个满足$f(1)\\neq 0$的函数$f$，都存在唯一的一个函数$g$使得$f\\times g=\\epsilon$。这时我们称$g$是$f$的逆。</p>\n<p>我们可以这样定义一个函数的逆：</p>\n<script type=\"math/tex; mode=display\">g(n)=\\cfrac{\\epsilon(n)-\\sum\\limits_{i\\mid n,i\\neq 1}f(i)g(\\cfrac{n}{i})}{f(1)}</script><p>这样我们就有</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\n(f\\times g)(n)&=\\sum_{i\\mid n}f(i)g(\\cfrac{n}{i})\\\\\n&=f(1)g(n)+\\sum_{i\\mid n,i\\neq 1}f(i)g(\\cfrac{n}{i})\\\\\n&=\\epsilon(n)-\\sum\\limits_{i\\mid n,i\\neq 1}f(i)g(\\cfrac{n}{i})+\\sum_{i\\mid n,i\\neq 1}f(i)g(\\cfrac{n}{i})\\\\\n&=\\epsilon(n)\n\\end{aligned}</script><h2 id=\"积性函数与完全积性函数\"><a href=\"#积性函数与完全积性函数\" class=\"headerlink\" title=\"积性函数与完全积性函数\"></a>积性函数与完全积性函数</h2><p>如果一个数论函数$f$满足</p>\n<script type=\"math/tex; mode=display\">\\forall x,y\\in\\mathbb{N}^{+}\\wedge x\\perp y\\;\\;f(xy)=f(x)f(y)</script><p>我们就说$f$是一个积性函数。</p>\n<p>特别的，如果上式去掉$x\\perp y$仍成立，则称$f$是一个完全积性函数。</p>\n<p>很明显地，任意一个积性函数$f$一定有$f(1)=1$，这样才能有$f(1\\times n)=f(1)\\times f(n)=f(n)$。</p>\n<p>常见的完全积性函数有$\\epsilon,id^{k}$。$\\epsilon$在上文已经提到过。$id^{k}(n)=n^k$。这两个函数的完全积性十分明显。</p>\n<p>常见的积性函数有$\\varphi,d,\\sigma$。$\\varphi(n)$的值等于小于等于$n$且与$n$互质的正整数的数量。$d(n)$和$\\sigma(n)$的值分别等于$n$的约数个数和约数和。</p>\n<p>关于$\\varphi$的积性，我并不会证（</p>\n<p>我们来分析$d$的积性。首先，根据唯一分解定理，$n$的每个因数都可以唯一地分解成$n$所有质因子的非负整数次幂乘积。不妨设</p>\n<script type=\"math/tex; mode=display\">n=\\prod\\limits_{i=1}^{N}p_{i}^{r_{i}}</script><p>其中$p_{i}$都是质数，所有$r_{i}$都是正整数。对于每一个$p_{i}$，它的指数有$(r_{i}+1)$种取值，因而我们有</p>\n<script type=\"math/tex; mode=display\">d(n)=\\prod\\limits_{i=1}^{N}(r_{i}+1)</script><p>我们再假设有一个$m$，且</p>\n<script type=\"math/tex; mode=display\">m=\\prod\\limits_{i=1}^{M}q_{i}^{s_{i}}</script><p>如果说$n\\perp m$，肯定有</p>\n<script type=\"math/tex; mode=display\">\\forall i\\in [1,N]\\cap\\mathbb{Z},j\\in [1,M]\\cap\\mathbb{Z}\\;\\;p_{i}\\neq q_{j}</script><p>于是我们就有</p>\n<script type=\"math/tex; mode=display\">nm=(\\prod\\limits_{i=1}^{N}p_{i}^{r_{i}})(\\prod\\limits_{j=1}^{M}q_{j}^{s_{j}})</script><script type=\"math/tex; mode=display\">\\begin{aligned}\nd(nm)&=(\\prod\\limits_{i=1}^{N}(r_{i}+1))(\\prod\\limits_{j=1}^{M}(s_{j}+1))\\\\\n&=d(n)d(m)\n\\end{aligned}</script><p>不妨再反过来考虑。如果说$n\\not\\perp m$，那么一定存在一对$(i,j)(i\\in [1,N]\\cap\\mathbb{Z},j\\in [1,M]\\cap\\mathbb{Z})$，使得$p_{i}=q_{j}$。那么$d(n)d(m)$就会有一个因子是$(r_{i}+1)(s_{j}+1)=r_{i}s_{j}+r_{i}+s_{j}+1$。但是仔细思考我们会发现，$d(nm)$中对应的项应该是$r_{i}+s_{j}+1$。因而此时$d(nm)\\neq d(n)d(m)$。</p>\n<p>我们再来分析$\\sigma$的积性。还是设</p>\n<script type=\"math/tex; mode=display\">n=\\prod\\limits_{i=1}^{N}p_{i}^{r_{i}}</script><p>其中$p_{i}$都是质数，所有$r_{i}$都是正整数。与$d$不同的是，现在我们是要用$p_{i}$乘出$n$的因数，$p_{i}$在此过程中可以产生的贡献为$p_{i}^x(x\\in [0,r_{i}]\\cap\\mathbb{Z})$。我们可以把这想象成一个$N$个数组，第$i$个数组的长度为$r_{i}+1$，第$j$个元素为$p_{i}^{j-1}$。现在我们每次从每个数组里选出恰好一个元素相乘，要求所有方案的乘积之和。我们知道，这个问题的答案就是</p>\n<script type=\"math/tex; mode=display\">\\prod\\limits_{i=1}^{N}\\sum\\limits_{j=0}^{r_{i}}p_{i}^{j}</script><p>这正是$\\sigma(n)$的值。</p>\n<p>接下来的过程就与上文证明$d$的积性如出一辙了，在此不再重复。</p>\n<p>现在我们来分析，两个积性函数的卷积是否也是积性函数。<del>虽然说都这么问了肯定就是了。</del></p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\n(f\\times g)(n)(f\\times g)(m)&=(\\sum\\limits_{i\\mid n}f(i)g(\\cfrac{n}{i}))(\\sum\\limits_{j\\mid m}f(j)g(\\cfrac{m}{j}))\\\\\n&=\\sum\\limits_{i\\mid n}\\sum\\limits_{j\\mid m}f(i)g(\\cfrac{n}{i})f(j)g(\\cfrac{m}{j})\\\\\n&=\\sum\\limits_{i\\mid n}\\sum\\limits_{j\\mid m}f(ij)g(\\cfrac{nm}{ij})\\\\\n&=\\sum\\limits_{k\\mid nm}f(k)g(\\cfrac{nm}{k})\\\\\n&=(f\\times g)(nm)\n\\end{aligned}</script><p>关于上面的第四个等号。时刻注意$n\\perp m$，在这种前提下，我们枚举到的$i$和$j$一定也是互质的，那么$ij$的所有值一定是互不相同的。这从$d(nm)=d(n)d(m)$这一等式中也能看出。</p>\n<p>再接下来，我们来分析一下一个积性函数的逆是否也是积性函数。</p>\n<p>设有一个积性函数$f$，它的逆是$g$。</p>\n<p>当$nm=1$时，$g(1)=1$。</p>\n<p>当$nm&gt;1$时，我们假设对于任意$n^{\\prime}m^{\\prime}&lt;nm$，都有$g(n^{\\prime}m^{\\prime})=g(n^{\\prime})g(m^{\\prime})$。此时</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\ng(nm)&=-\\sum\\limits_{k\\mid nm,k\\neq 1}f(k)g(\\cfrac{nm}{k})\\\\\n&=-\\sum\\limits_{i\\mid n,j\\mid m,ij\\neq 1}f(i)f(j)g(\\cfrac{n}{i})g(\\cfrac{m}{j})\\\\\n&=g(n)g(m)-\\sum\\limits_{i\\mid n,j\\mid m}f(i)f(j)g(\\cfrac{n}{i})g(\\cfrac{m}{j})\\\\\n&=g(n)g(m)-(\\sum\\limits_{i\\mid n}f(i)g(\\cfrac{n}{i}))(\\sum\\limits_{j\\mid m}f(j)g(\\cfrac{m}{j}))\\\\\n&=g(n)g(m)-\\epsilon(n)\\epsilon(m)\\\\\n&=g(n)g(m)\n\\end{aligned}</script><p><del>其实上面这些全都是抄来的（</del></p>\n<h1 id=\"莫比乌斯反演\"><a href=\"#莫比乌斯反演\" class=\"headerlink\" title=\"莫比乌斯反演\"></a>莫比乌斯反演</h1><h2 id=\"正向反演\"><a href=\"#正向反演\" class=\"headerlink\" title=\"正向反演\"></a>正向反演</h2><p>定义$\\mu$为$1$的逆。也就是说，$\\mu\\times 1=\\epsilon$。</p>\n<p>如果您看过其他的一些关于莫比乌斯反演的学习笔记的话，您可能会看到如下的定义：</p>\n<blockquote>\n<p>首先地，$\\mu(1)=1$。当$n&gt;1$时，如果$n$的所有质因子互不相同，设其有$k$个质因子，那么$\\mu(n)=(-1)^{k}$。否则，$\\mu(n)=0$。</p>\n</blockquote>\n<p>那么，这两种定义等价吗？</p>\n<p>考虑到$\\mu$是一个积性函数，对于任意一个$n&gt;1$，如果我们把它分解成</p>\n<script type=\"math/tex; mode=display\">n=\\prod\\limits_{i=1}^{N}p_{i}^{r_{i}}</script><p>我们就有</p>\n<script type=\"math/tex; mode=display\">\\mu(n)=\\prod\\limits_{i=1}^{N}\\mu(p_{i}^{r_{i}})</script><p>因此，确定一个积性函数的函数值的关键在于确定其在质数的非负整数次幂上的取值。</p>\n<p>设有一个质数$p$。不难发现</p>\n<script type=\"math/tex; mode=display\">\\mu(p)=-\\mu(1)=-1</script><script type=\"math/tex; mode=display\">\\mu(p^{2})=-\\mu(1)-\\mu(p)=-1+1=0</script><script type=\"math/tex; mode=display\">\\mu(p^{3})=-\\mu(1)-\\mu(p)-\\mu(p^{2})=-1+1+0=0</script><script type=\"math/tex; mode=display\">\\vdots</script><p>至此，不难看出上文给出的两种定义是等价的。</p>\n<p>那么这个东西有什么用呢？</p>\n<p>我们设</p>\n<script type=\"math/tex; mode=display\">F(n)=\\sum\\limits_{i\\mid n}f(i)</script><p>或者等价地说，$F=f\\times 1$。我们可以得到</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\nF&=f\\times 1\\\\\nF\\times\\mu&=f\\times 1\\times\\mu\\\\\nF\\times\\mu&=f\n\\end{aligned}</script><p>像这样，如果说$F$相对好求，而$f$相对难求，我们就可以通过上式来减小我们求解$f$的难度。具体地说</p>\n<script type=\"math/tex; mode=display\">f(n)=\\sum\\limits_{i\\mid n}F(i)\\mu(\\cfrac{n}{i})</script><h2 id=\"反向反演\"><a href=\"#反向反演\" class=\"headerlink\" title=\"反向反演\"></a>反向反演</h2><p>有些时候我们还需要用到像下面这样反过来的莫比乌斯反演</p>\n<script type=\"math/tex; mode=display\">F(n)=\\sum\\limits_{n\\mid d}f(d)⇔f(n)=\\sum\\limits_{n\\mid d}F(d)\\mu(\\cfrac{d}{n})</script><p>我们可以定义一种新的运算</p>\n<script type=\"math/tex; mode=display\">(f\\otimes g)(n)=\\sum\\limits_{n\\mid d}f(d)g(\\cfrac{d}{n})</script><p>我们不难证明出它具有结合律。具体过程与上文证明狄利克雷卷积的结合律的过程基本重复。那么我们就有</p>\n<script type=\"math/tex; mode=display\">F=f\\otimes 1⇔F\\otimes\\mu=f</script><p>于是就有了上面的反向反演。</p>\n<blockquote>\n<p>$\\text{Updated on 2018-12-03}$：</p>\n<p>例题……还是算了吧（</p>\n<p>发现反演常用的套路都忘的差不多了，还是别丢人了（</p>\n</blockquote>\n<h1 id=\"杜教筛\"><a href=\"#杜教筛\" class=\"headerlink\" title=\"杜教筛\"></a>杜教筛</h1><h2 id=\"实现与模板题\"><a href=\"#实现与模板题\" class=\"headerlink\" title=\"实现与模板题\"></a>实现与模板题</h2><p>接下来才是主要内容。</p>\n<p>现在，我们要求一个积性函数的前$n$项和。$n\\leqslant 10^{10}$。</p>\n<p>我们定义</p>\n<script type=\"math/tex; mode=display\">S(n)=\\sum\\limits_{i=1}^{n}f(i)</script><p>再拿来一个积性函数$g$，然后把它与$f$卷积并求前缀和。</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\n\\sum_{i=1}^{n}(f\\times g)(i)&=\\sum_{i=1}^{n}\\sum_{j\\mid i}f(j)g(\\cfrac{i}{j})\\\\\n&=\\sum_{i=1}^{n}g(i)\\sum_{j=1}^{\\lfloor\\frac{n}{i}\\rfloor}f(j)\\\\\n&=\\sum_{i=1}^{n}g(i)S(\\lfloor\\cfrac{n}{i}\\rfloor)\n\\end{aligned}</script><p>然而我的语文实在是太菜了，大概说也说不明白，自行理解吧（</p>\n<p>因为$g$也是积性函数，有$g(1)=1$，所以</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\nS(n)&=g(1)S(n)\\\\\n&=\\sum_{i=1}^{n}g(i)S(\\lfloor\\cfrac{n}{i}\\rfloor)-\\sum_{i=2}^{n}g(i)S(\\lfloor\\cfrac{n}{i}\\rfloor)\\\\\n&=\\sum_{i=1}^{n}(f\\times g)(i)-\\sum_{i=2}^{n}g(i)S(\\lfloor\\cfrac{n}{i}\\rfloor)\n\\end{aligned}</script><p>就是说从第一项开始的前缀和减去从第二项开始的前缀和等于第一项本身。</p>\n<p>如果说我们选择的$g$可以让我们迅速地求出$f\\times g$和$g$的前缀和，我们就可以做到快速求$f$的前缀和了。</p>\n<p>关于后面的$g(i)S(\\lfloor\\cfrac{n}{i}\\rfloor)$，如果直接暴力算复杂度会是$O(n)$的，在大部分情况下，这是无法接受的。</p>\n<p>我们来分析一下$\\lfloor\\cfrac{n}{i}\\rfloor$。如果$1\\leqslant i\\leqslant\\sqrt{n}$，因为$i$只有$\\sqrt{n}$种不同的取值，$\\lfloor\\cfrac{n}{i}\\rfloor$同样也只有$\\sqrt{n}$种不同的取值。如果$\\sqrt{n}&lt;i\\leqslant n$，$1\\leqslant\\lfloor\\cfrac{n}{i}\\rfloor&lt;\\sqrt{n}$，又因为要向下取整，自然也只有$\\sqrt{n}$种不同的取值。如果我们能够把$\\lfloor\\cfrac{n}{i}\\rfloor$相同的$i$一起计算，就能够将时间杂度优化到$O(\\sqrt{n})$。</p>\n<p>大体代码如下：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> l=<span class=\"number\">1</span>,r;l&lt;=n;l=r+<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">\tr=n/(n/l);</span><br><span class=\"line\">\t<span class=\"comment\">//......</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>关于$r$的这个上界是怎么来的，我并不会证（</p>\n<p>这样一来，要计算$S(n)$，我们需要调用所有的$\\lfloor\\cfrac{n}{x}\\rfloor$，分别是$\\lfloor\\cfrac{n}{1}\\rfloor,\\lfloor\\cfrac{n}{2}\\rfloor,\\cdots,\\lfloor\\cfrac{n}{\\sqrt{n}}\\rfloor,\\sqrt{n},\\sqrt{n}-1,\\cdots,1$。单独计算一个$S(n)$的时间复杂度很明显是$O(\\sqrt{n})$的。那么这样一来，总体的时间复杂度就是</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\nO(\\sum\\limits_{i=1}^{\\sqrt{n}}\\sqrt{i}+\\sqrt{\\lfloor\\cfrac{n}{i}\\rfloor})&=O(\\sum\\limits_{i=1}^{\\sqrt{n}}\\sqrt{\\lfloor\\cfrac{n}{i}\\rfloor})\\\\\n&=O(\\int\\limits_{1}^{\\sqrt{n}}\\sqrt{\\lfloor\\cfrac{n}{x}\\rfloor}dx)\\\\\n&=O(\\int\\limits_{1}^{\\sqrt{n}}\\sqrt{\\cfrac{n}{x}}dx)\\\\\n&=O(2n^{\\frac{1}{2}}(n^{\\frac{1}{4}}-1))\\\\\n&=O(n^{\\frac{3}{4}})\n\\end{aligned}</script><p>因为相比之下$\\sqrt{\\lfloor\\cfrac{n}{i}\\rfloor}$很明显要大一些，我们就可以将$\\sqrt{i}$舍去。然后去掉取整符号并用积分近似。</p>\n<p>这个实现方法还可以优化。具体来讲，我们先线性筛出前$m$项，然后再用杜教筛。这么做的时间复杂度是$O(m+\\cfrac{n}{\\sqrt{m}})$，当$m=n^{\\frac{2}{3}}$时取得最小值$O(n^{\\frac{2}{3}})$。</p>\n<p>举个例子，就比如说我们要求</p>\n<script type=\"math/tex; mode=display\">\\sum\\limits_{i=1}^{n}\\varphi(i)</script><p>我们取$f=\\varphi,g=1$，这样根据$\\varphi$的性质，$f\\times g=id$。不难看出$g$与$f\\times g$的前缀和都可以$O(1)$求。具体的代码实现差不多长这样：</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">long</span> <span class=\"keyword\">long</span> <span class=\"title\">getSum</span><span class=\"params\">(<span class=\"keyword\">int</span> n)</span></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(n&lt;=maxn)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> phi[n];</span><br><span class=\"line\">\t<span class=\"comment\">//phi是提前线性筛好的前缀和</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(ans.count(n))</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> ans[n];</span><br><span class=\"line\">\t<span class=\"comment\">//ans用来实现记忆化的哈希表，比如说unordered_map</span></span><br><span class=\"line\">\tre <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> res=<span class=\"number\">1L</span>L*n*(n+<span class=\"number\">1</span>)&gt;&gt;<span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//f*g的前缀和</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(re <span class=\"keyword\">int</span> l=<span class=\"number\">2</span>,r;l&lt;=n;l=r+<span class=\"number\">1</span>)&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//注意要从2开始</span></span><br><span class=\"line\">\t\tr=n/(n/l);</span><br><span class=\"line\">\t\tres-=(r-l+<span class=\"number\">1</span>)*getSum(n/l);</span><br><span class=\"line\">\t\t<span class=\"comment\">//r-l+1是g的前缀和</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//像这样递归+记忆化求解f的前缀和</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ans[n]=res;</span><br><span class=\"line\">\t<span class=\"comment\">//返回的时候不要忘记存一下</span></span><br><span class=\"line\">\t<span class=\"comment\">//就比如说我就忘过一次（</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>以及，不用哈希表也是可以的。因为我们查询的数都是形如$\\lfloor\\cfrac{n}{x}\\rfloor$的，当这个值大于$n^{\\frac{2}{3}}$，即$x&lt;n^{\\frac{1}{3}}$时，我们才会到哈希表里查询。因此我们可以令<code>ans[x]</code>表示$S(\\lfloor\\cfrac{n}{x}\\rfloor)$。具体代码我就不写了（</p>\n<p>再举个例子，求</p>\n<script type=\"math/tex; mode=display\">\\sum\\limits_{i=1}^{n}\\mu(i)</script><p>取$f=\\mu,g=1,f\\times g=\\epsilon$。代码和上面差不多。</p>\n<p>如果您理解了上面两个函数，这道<a href=\"https://www.luogu.org/problemnew/show/P4213\" target=\"_blank\" rel=\"noopener\">模板题</a>您就可以切了。</p>\n<h2 id=\"其他题\"><a href=\"#其他题\" class=\"headerlink\" title=\"其他题\"></a>其他题</h2><h3 id=\"「Luogu-P3768」简单的数学题\"><a href=\"#「Luogu-P3768」简单的数学题\" class=\"headerlink\" title=\"「Luogu-P3768」简单的数学题\"></a><a href=\"https://www.luogu.org/problemnew/show/P3768\" target=\"_blank\" rel=\"noopener\">「Luogu-P3768」简单的数学题</a></h3><p>快乐地推式子：</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\n\\sum\\limits_{i=1}^{n}i\\sum\\limits_{j=1}^{n}j\\text{gcd}(i,j)&=\\sum\\limits_{d=1}^{n}d^{3}\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}i\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}j[i\\perp j]\\\\\n&=\\sum\\limits_{d=1}^{n}d^{3}\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}i\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}j\\sum\\limits_{x\\mid i,x\\mid j}\\mu(x)\\\\\n&=\\sum\\limits_{d=1}^{n}d^{3}\\sum\\limits_{x=1}^{\\lfloor\\frac{n}{d}\\rfloor}x^{2}\\mu(x)\\text{Sum}^{2}(\\lfloor\\cfrac{n}{dx}\\rfloor)\\\\\n&=\\sum\\limits_{i=1}^{n}\\text{Sum}^{2}(\\lfloor\\cfrac{n}{i}\\rfloor)i^{2}\\sum\\limits_{j\\mid i}j\\mu(\\cfrac{i}{j})\\\\\n&=\\sum\\limits_{i=1}^{n}\\text{Sum}^{2}(\\lfloor\\cfrac{n}{i}\\rfloor)i^{2}\\varphi(i)\n\\end{aligned}</script><p>其中</p>\n<script type=\"math/tex; mode=display\">\\text{Sum}(n)=\\sum\\limits_{i=1}^{n}i</script><p>最后一步是因为</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\nid\\times\\mu&=\\varphi\\times 1\\times\\mu\\\\\n&=\\varphi\\times\\epsilon\\\\\n&=\\varphi\n\\end{aligned}</script><p>理解不了上面的式子的话就多看看吧（</p>\n<p>不难发现我们是要求$f(n)=n^{2}\\varphi(n)$的前缀和，那么，我们该怎么选取$g$呢？</p>\n<p><del>枚举瞎蒙（</del></p>\n<p>考虑$g(n)=n^{2}$。</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\n(f\\times g)(n)&=\\sum\\limits_{i\\mid n}f(i)g(\\cfrac{n}{i})\\\\\n&=\\sum\\limits_{i\\mid n}i^{2}\\varphi(i)\\cfrac{n^{2}}{i^{2}}\\\\\n&=n^{2}\\sum\\limits_{i\\mid n}\\varphi(i)\\\\\n&=n^{3}\n\\end{aligned}</script><p><del>其实我都不知道我当时是怎么想到这种操作的（</del></p>\n<p>然后就和上面一样了。</p>\n<h3 id=\"「Luogu-U18201」分析矿洞\"><a href=\"#「Luogu-U18201」分析矿洞\" class=\"headerlink\" title=\"「Luogu-U18201」分析矿洞\"></a><a href=\"https://www.luogu.org/problemnew/show/U18201\" target=\"_blank\" rel=\"noopener\">「Luogu-U18201」分析矿洞</a></h3><p>不知道从哪翻出来的题（</p>\n<p>是某场个人邀请赛的$\\text{T}1$<del>，从某种意义上也能看出那场比赛有多么神仙</del>。</p>\n<script type=\"math/tex; mode=display\">\\begin{aligned}\n\\sum\\limits_{i=1}^{n}\\sum\\limits_{j=1}^{n}\\varphi(\\text{gcd}^{2}(i,j))&=\\sum\\limits_{d=1}^{n}\\varphi(d^{2})\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}[i\\perp j]\\\\\n&=\\sum\\limits_{d=1}^{n}\\varphi(d^{2})\\sum\\limits_{i=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum\\limits_{j=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\sum\\limits_{x\\mid i,x\\mid j}\\mu(x)\\\\\n&=\\sum\\limits_{d=1}^{n}\\varphi(d^{2})\\sum\\limits_{x=1}^{\\lfloor\\frac{n}{d}\\rfloor}\\mu(x)\\lfloor\\cfrac{n}{dx}\\rfloor^{2}\\\\\n&=\\sum\\limits_{i=1}^{n}\\lfloor\\cfrac{n}{i}\\rfloor^{2}\\sum\\limits_{j\\mid i}\\varphi(j^{2})\\mu(\\cfrac{i}{j})\\\\\n&=\\sum\\limits_{i=1}^{n}\\lfloor\\cfrac{n}{i}\\rfloor^{2}\\sum\\limits_{j\\mid i}j\\varphi(j)\\mu(\\cfrac{i}{j})\n\\end{aligned}</script><p>设$f_1(n)=n\\varphi(n),f_2(n)=\\mu(n)$，考虑筛$f=f_1\\times f_2$的前缀和。然而，与上面的其它题不同，并不存在一个$g$使我们能够$O(1)$地求出$g$和$f\\times g$的前缀和。一种较优的方案是，令$g=1$，$f\\times g=(id\\cdot\\varphi)\\times\\mu\\times 1=id\\cdot\\varphi$，这样，我们还需要筛出$f_1(n)=n\\varphi(n)$的前缀和。</p>\n<p>怎么办？</p>\n<p>再套一层杜教筛！</p>\n<p>然而可能是常数会有些大也可能是我太菜了自带大常数，好像会跑的很慢（</p>\n<p>以及，像这种$n$爆了<code>int</code>的，一定要注意经常取模。<del>因为这个$\\text{WA}$了好几次（</del></p>\n<p>最后，源文件$17\\text{KB}$祭，blog翻页祭。</p>"}],"PostAsset":[],"PostCategory":[{"post_id":"cjpn8w5qh0001rogukfpdh6zm","category_id":"cjpn8w5qm0004rogudm4qsw2q","_id":"cjpn8w5s5000eroguylylihtp"},{"post_id":"cjpn8w5ql0003roguntequ2fa","category_id":"cjpn8w5qr0009roguslzia98n","_id":"cjpn8w5se000irogudk3072bx"},{"post_id":"cjpn8w5qo0006roguumr2uug0","category_id":"cjpn8w5qr0009roguslzia98n","_id":"cjpn8w5si000lrogu4ixhwmy8"},{"post_id":"cjpn8w5qp0007roguuvouxbeu","category_id":"cjpn8w5qr0009roguslzia98n","_id":"cjpn8w5sk000proguo0ykp6px"},{"post_id":"cjpn8w5qr0008roguzuzyuq0u","category_id":"cjpn8w5qr0009roguslzia98n","_id":"cjpn8w5sm000trogumxj7v5sk"},{"post_id":"cjpn8w5qs000crogulr5amtmz","category_id":"cjpn8w5sk000orogulaabypz2","_id":"cjpn8w5sn000xroguc7as7vb1"},{"post_id":"cjpn8w5rz000drogu7b7swr15","category_id":"cjpn8w5sm000urogu8dwp8dj7","_id":"cjpn8w5sp0010rogut13bqz80"},{"post_id":"cjpn8w5tl001mroguyff9y10z","category_id":"cjpn8w5sk000orogulaabypz2","_id":"cjpn8w5tn001proguqyn1vj5c"},{"post_id":"cjpn8w5zj001rroguoopprye2","category_id":"cjpn8w5qm0004rogudm4qsw2q","_id":"cjpn8w5zm001urogu3lo4mh1a"},{"post_id":"cjpn8w5zz001wrogusvj1og8f","category_id":"cjpn8w5qr0009roguslzia98n","_id":"cjpn8w6030020rogua01n05gm"},{"post_id":"cjpn8w600001xrogutyd0kga5","category_id":"cjpn8w603001zrogus48a0y7o","_id":"cjpn8w6080025rogu18pxfpzy"},{"post_id":"cjpn8w61c0028roguqbymtdyy","category_id":"cjpn8w5sk000orogulaabypz2","_id":"cjpn8w61d002aroguehdiudoi"}],"PostTag":[{"post_id":"cjpn8w5qh0001rogukfpdh6zm","tag_id":"cjpn8w5qo0005rogu5r0u5e0k","_id":"cjpn8w5qs000broguveko2yps"},{"post_id":"cjpn8w5ql0003roguntequ2fa","tag_id":"cjpn8w5qs000arogughvrzxyx","_id":"cjpn8w5sk000nroguuq5yc0vc"},{"post_id":"cjpn8w5ql0003roguntequ2fa","tag_id":"cjpn8w5s6000grogut5v066w6","_id":"cjpn8w5sl000qrogud8cuuxyx"},{"post_id":"cjpn8w5ql0003roguntequ2fa","tag_id":"cjpn8w5sg000jrogusg9m5wbl","_id":"cjpn8w5sl000srogumxxcwku0"},{"post_id":"cjpn8w5qo0006roguumr2uug0","tag_id":"cjpn8w5sj000mrogu0nainnv8","_id":"cjpn8w5sn000wroguw037doda"},{"post_id":"cjpn8w5qo0006roguumr2uug0","tag_id":"cjpn8w5sl000rrogu2l21bahp","_id":"cjpn8w5so000yroguzuc2sdl1"},{"post_id":"cjpn8w5qp0007roguuvouxbeu","tag_id":"cjpn8w5sj000mrogu0nainnv8","_id":"cjpn8w5sq0012rogu2qcwzozs"},{"post_id":"cjpn8w5qp0007roguuvouxbeu","tag_id":"cjpn8w5qs000arogughvrzxyx","_id":"cjpn8w5sq0013roguwuhodccm"},{"post_id":"cjpn8w5qr0008roguzuzyuq0u","tag_id":"cjpn8w5sp0011rogujsatntap","_id":"cjpn8w5st0019roguhozbxqfo"},{"post_id":"cjpn8w5qr0008roguzuzyuq0u","tag_id":"cjpn8w5sq0014rogukvr6439b","_id":"cjpn8w5st001arogujidvj9uc"},{"post_id":"cjpn8w5qr0008roguzuzyuq0u","tag_id":"cjpn8w5sr0015rogu3ivhdwya","_id":"cjpn8w5su001crogue2iilzzb"},{"post_id":"cjpn8w5qr0008roguzuzyuq0u","tag_id":"cjpn8w5sr0016rogux85f95jv","_id":"cjpn8w5su001drogu6imllm02"},{"post_id":"cjpn8w5qr0008roguzuzyuq0u","tag_id":"cjpn8w5s6000grogut5v066w6","_id":"cjpn8w5sv001frogureycky89"},{"post_id":"cjpn8w5qs000crogulr5amtmz","tag_id":"cjpn8w5ss0018roguvoiqtrp3","_id":"cjpn8w5sv001groguq5tfbuq0"},{"post_id":"cjpn8w5qs000crogulr5amtmz","tag_id":"cjpn8w5st001brogupsaa89ow","_id":"cjpn8w5sw001iroguur7azoqk"},{"post_id":"cjpn8w5rz000drogu7b7swr15","tag_id":"cjpn8w5su001eroguy00zctyk","_id":"cjpn8w5sw001jroguv6oi4iry"},{"post_id":"cjpn8w5rz000drogu7b7swr15","tag_id":"cjpn8w5sv001hrogu6w2g2j0i","_id":"cjpn8w5sw001kroguj41kbl3h"},{"post_id":"cjpn8w5tl001mroguyff9y10z","tag_id":"cjpn8w5tn001orogu079c9ae8","_id":"cjpn8w5to001qrogum3poku6v"},{"post_id":"cjpn8w5zj001rroguoopprye2","tag_id":"cjpn8w5zm001trogucmn8n6b0","_id":"cjpn8w5zn001vroguj34eac27"},{"post_id":"cjpn8w5zz001wrogusvj1og8f","tag_id":"cjpn8w5sj000mrogu0nainnv8","_id":"cjpn8w6050022rogu4xyeeupa"},{"post_id":"cjpn8w5zz001wrogusvj1og8f","tag_id":"cjpn8w602001yrogufwejw8n5","_id":"cjpn8w6060023roguv8tnty23"},{"post_id":"cjpn8w600001xrogutyd0kga5","tag_id":"cjpn8w6040021rogugb8ac15r","_id":"cjpn8w6090026rogubr1l1xg8"},{"post_id":"cjpn8w600001xrogutyd0kga5","tag_id":"cjpn8w6060024rogut4t4sfve","_id":"cjpn8w6090027rogusrnl11um"},{"post_id":"cjpn8w61c0028roguqbymtdyy","tag_id":"cjpn8w5qs000arogughvrzxyx","_id":"cjpn8w61d002broguutgzpsxd"},{"post_id":"cjpn8w61c0028roguqbymtdyy","tag_id":"cjpn8w61d0029rogu6zxv2ub7","_id":"cjpn8w61e002crogus8oxt6ot"}],"Tag":[{"name":"其它","_id":"cjpn8w5qo0005rogu5r0u5e0k"},{"name":"数论","_id":"cjpn8w5qs000arogughvrzxyx"},{"name":"组合数学","_id":"cjpn8w5s6000grogut5v066w6"},{"name":"期望","_id":"cjpn8w5sg000jrogusg9m5wbl"},{"name":"洛谷","_id":"cjpn8w5sj000mrogu0nainnv8"},{"name":"差分","_id":"cjpn8w5sl000rrogu2l21bahp"},{"name":"SDOI","_id":"cjpn8w5sp0011rogujsatntap"},{"name":"2009","_id":"cjpn8w5sq0014rogukvr6439b"},{"name":"离散化","_id":"cjpn8w5sr0015rogu3ivhdwya"},{"name":"树状数组","_id":"cjpn8w5sr0016rogux85f95jv"},{"name":"状态压缩","_id":"cjpn8w5ss0018roguvoiqtrp3"},{"name":"动态规划","_id":"cjpn8w5st001brogupsaa89ow"},{"name":"NOIp","_id":"cjpn8w5su001eroguy00zctyk"},{"name":"2018","_id":"cjpn8w5sv001hrogu6w2g2j0i"},{"name":"珂朵莉树","_id":"cjpn8w5tn001orogu079c9ae8"},{"name":"毒瘤题","_id":"cjpn8w5zm001trogucmn8n6b0"},{"name":"线段树","_id":"cjpn8w602001yrogufwejw8n5"},{"name":"树套树","_id":"cjpn8w6040021rogugb8ac15r"},{"name":"分块","_id":"cjpn8w6060024rogut4t4sfve"},{"name":"杜教筛","_id":"cjpn8w61d0029rogu6zxv2ub7"}]}}