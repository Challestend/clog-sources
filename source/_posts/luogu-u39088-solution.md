---
title: 「Luogu-U39088」孤立元
date: 2018-09-27 14:29:56
tags:
mathjax: true
---
[https://www.luogu.org/problemnew/show/U39088](https://www.luogu.org/problemnew/show/U39088)

自己出的第一道~~毒瘤~~数论题$\text{qaq}$。

对于每一个$i(1<i<n)$，如果它成为了孤立元，那么一定有$i-1\notin B$且$i+1\notin B$，而其他$n-3$个数无论怎样都无法阻止$i$对所有孤立元的和产生贡献，此时，其他$n-3$个数中有且仅有$m-1$个属于$B$，其总方案数为$C_{n-3}^{m-1}$。而对于$1$和$n$来说，它们只有$1$个相邻的元素，因此方案数为$C_{n-2}^{m-1}$。本题答案即为
$$\frac{\sum_{i=2}^{n-1}iC_{n-3}^{m-1}+(n+1)C_{n-2}^{m-1}}{C_{n}^{m}}$$
将这个式子进行一系列惨无人道的化简与整理后，我们得到如下形式
$$\frac{(n+1)(n-m)(n-m-1)}{2n(n-1)}+\frac{(n+1)(n-m)}{n(n-1)}$$
于是做法就有了，先$O(n)$预处理出逆元，然后单次询问即可$O(1)$解决。

但是常数好像会很大，我原计划是要将数据范围开到$10^{7}$级别的，然而自己写的标程都跑不过，于是只能一路削到现在的$10^{6}$……
